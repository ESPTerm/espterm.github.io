{"version":3,"sources":["webpack:///app.9aae724-en.js","webpack:///webpack/bootstrap b64d5b4ad8c9e58eb51b","webpack:///./js/utils.js","webpack:///./js/lib/chibi.js","webpack:///./node_modules/events/events.js","webpack:///./js/term/themes.js","webpack:///./js/modal.js","webpack:///./js/notif.js","webpack:///./js/term/screen_attr_bits.js","webpack:///./js/lib/color_utils.js","webpack:///./js/term/demo.js","webpack:///./js/lang.js","webpack:///./js/index.js","webpack:///./js/lib/polyfills.js","webpack:///./js/appcommon.js","webpack:///./js/wifi.js","webpack:///./lang/en.php","webpack:///./js/gpio_control.js","webpack:///./js/term/index.js","webpack:///./js/term/screen.js","webpack:///./js/term/screen_parser.js","webpack:///./js/term/screen_layout.js","webpack:///./js/term/screen_renderer.js","webpack:///./js/term/connection.js","webpack:///./js/term/input.js","webpack:///./js/term/upload.js","webpack:///./js/term/soft_keyboard.js","webpack:///./js/term/debug.js","webpack:///./js/term/buttons.js","webpack:///./js/term_conf.js","webpack:///./js/lib/colortriangle.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","mk","e","document","createElement","qs","querySelector","qsa","querySelectorAll","cr","hdl","which","this","parse2B","arguments","length","undefined","charCodeAt","parse3B","encode2B","lsb","msb","String","fromCharCode","encode3B","xsb","_typeof","Symbol","iterator","obj","constructor","fireReady","domready","readyfn","fireLoaded","pageloaded","loadedfn","nodeLoop","fn","nodes","cssCamel","replace","result","charAt","toUpperCase","computeStyle","elm","currentStyle","w","getComputedStyle","getPropertyValue","queryPair","value","encodeURIComponent","setCss","style","showCss","display","serializeData","subelm","j","querystring","Array","nodeName","elements","disabled","type","selected","checked","substring","classHelper","classes","action","classarray","has","split","clz","classList","remove","add","toggle","contains","insertHtml","position","tmpnodes","tmpnode","innerHTML","lastChild","parentNode","insertBefore","nextSibling","appendChild","firstChild","chibi","selector","cb","nodelist","json","nodeType","each","apply","first","shift","last","pop","odd","odds","push","even","evens","hide","show","state","removeChild","css","getClass","className","setClass","addClass","removeClass","toggleClass","set","hasClass","html","htmlBefore","htmlAfter","htmlAppend","htmlPrepend","attr","toLowerCase","cssText","setAttribute","getAttribute","data","key","val","values","check","on","event","addEventListener","attachEvent","off","removeEventListener","detachEvent","window","onload","ajax","options","opts","assign","method","nocache","timeout","loader","callback","loaderFn","_loader","url","query","indexOf","xhr","XMLHttpRequest","ts","Date","toString","open","abortTmeo","setTimeout","console","error","abort","onreadystatechange","readyState","responseText","status","clearTimeout","setRequestHeader","send","post","ready","loaded","entityMap","&","<",">","\"","'","/","`","=","htmlEscape","string","EventEmitter","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNaN","TypeError","emit","er","handler","len","args","listeners","Error","err","context","slice","addListener","listener","newListener","warned","trace","once","g","removeListener","fired","list","splice","removeAllListeners","listenerCount","evlistener","emitter","$","_require","rgb255ToHex","themes","fgbgThemes","colorTable256","buildColorTable","fill","red","green","blue","redValue","greenValue","blueValue","gray","SELECTION_FG","SELECTION_BG","themePreview","themeN","forEach","elem","shade","dataset","fg","test","toHex","color","bg","backgroundColor","ensureColorTable256","getColor","palette","substr","Math","floor","now","modal","curCloseCb","sel","closeCb","$m","init","stopImmediatePropagation","nt","$balloon","timerHideBegin","timerHideEnd","canCancel","stopTimeouts","message","isError","ATTR_FG","ATTR_BG","ATTR_BOLD","ATTR_UNDERLINE","ATTR_INVERSE","ATTR_BLINK","ATTR_ITALIC","ATTR_STRIKE","ATTR_OVERLINE","ATTR_FAINT","ATTR_FRAKTUR","pad","M","TAU","PI","hue2rgb","v1","v2","h","hsl2rgb","r","b","var_1","var_2","rgb2hsl","min","max","d_r","d_g","d_b","hex2rgb","hex","groups","match","bytes","pow","map","x","parseInt","join","rgb2hex","round","_toConsumableArray","arr","isArray","arr2","from","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","writable","setPrototypeOf","__proto__","_classCallCheck","instance","Constructor","_get","receiver","Function","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","_createClass","defineProperties","target","props","descriptor","protoProps","staticProps","_require2","encodeAsCodePoint","fromCodePoint","ANSIParser","reset","joinChunks","currentSequence","sequence","content","numbers","numOr1","number","mode","text","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","next","done","character","code","codePointAt","parseSequence","return","TERM_DEFAULT_STYLE","getRainbowColor","t","sin","ScrollingTerminal","screen","_this","width","height","termScreen","parser","handleParsed","buttonLabels","_lastLoad","loadTimer","showPage","cursor","y","visible","trackMouse","theme","defaultFG","defaultBG","rainbow","superRainbow","clear","scroll","newLine","moveBack","writeChar","deleteForward","insertBlanks","load","clampCursor","write","encodeColor","attributes","serialized","lastStyle","index","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","cell","foreground","background","setForeground","setBackground","setAttributes","topicData","screenOpts","getScreenOpts","title","getTitle","buttons","getButtons","getCursor","serializeScreen","_screenOpts","_title","_buttons","_cursor","_screen","_this2","clearInterval","_loadTimer","setInterval","update","getUpdate","Process","_EventEmitter","demoData","mouseReceiver","demoshIndex","Clear","_Process","destroy","screenfetch","Screenfetch","_Process2","_this6","image","location","hostname","devicePixelRatio","filter","line","trim","chars","loop","local-echo","_Process3","LocalEcho","_len","_key","includes","label","shell","info","Info","_Process4","_this9","_len2","_key2","fast","showSplash","then","printText","_this10","splash","levels"," ",".","-","*","#","characters","repeat","cursorX","cursorY","moveTo","moveX","moveY","abs","drawCell","level","Promise","resolve","reject","cycles","dx","parts","colors","PrintColors","_Process5","ls","ListCommands","_Process6","SetTheme","_this13","_Process7","maxnum","Number","isFinite","terminal","drawnScreenFG","ShowThemes","_this14","_Process8","savedCursorStyle","_this15","fgType","bgType","get24FG","set24FG","v","get24BG","set24BG","make24Control","getValue","setValue","getDisplay","shouldShow","parseValue","input","moveAfterInput","controls","count","selection","render","selectedX","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","control","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","_console","_len3","_key3","log","concat","getControlCount","getSelectedControl","parsed","SetCursor","_Process9","_len4","_key4","steady","ToggleRainbow","_this17","su","_Process10","_didWarnRainbow","mouse","MouseDemo","_this18","_Process11","_this19","boxes","generateRandomBox","grabbedBox","grabOffset","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","box","drawnX","random","reverse","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","button","scrollInsideBox","getBoxAt","_boxes","amount","sudo","Sudo","_this20","didDestroy","_Process12","_this21","_len5","_key5","child","setButtons","run","make","Make","_this22","_Process14","_len6","_key6","pwd","cd","whoami","navigator","userAgent","uname","mkdir","rm","cp","mv","ln","touch","exit","github","GoToGithub","_Process15","autocompleteIndex","DemoShell","printInfo","_this24","history","historyIndex","cursorPos","lastInputLength","prompt","success","unshift","current","visual","prefix","startsWith","newInput","copyFromHistoryIndex","completed","getCompleted","words","moveForward","rest","parse","command","inQuote","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","spawn","_this25","_child","writeChars","demoInterface","onButtonPress","row","column","modifiers","mouseMove","mouseDown","mouseUp","didInit","termInit","TermConf","$defineProperty","stringFromCharCode","highSurrogate","lowSurrogate","codeUnits","codePoint","RangeError","pageShown","notify","menuOpen","inp","keyCode","ctrlKey","submit","$x","dots","$this","step","deltaY","evt","createEvent","initEvent","dispatchEvent","fireEvent","preventDefault","msgAt","search","errs","decodeURIComponent","humanReadableErrors","lbls","lbl","childNodes","textContent","JSON","stringify","fademsgbox","time","msg","innerWidth","removeAttribute","br","href","vis","noAutoShow","bnr","id","tr","HTTPS","protocol","calc_dBm","toFixed","selectSta","password","ip","hasPassword","onScan","resp","rescan","inProgress","APs","$list","sort","a","rssi","ap","enc","item","$item","essid","curSSID","inner","escapedSSID","rssi_perc","authTypes","$th","conn_ssid","conn_pass","startScanning","scanAPs","_demo","_demo_aps","_root","wifiInit","cfg","disp1","disp2","sta_ssid","sta_password","sta_active_ip","sta_active_ssid","WiFi","wifi.connected_ip_is","wifi.not_conn","wifi.enter_passwd","term_nav.fullscreen","term_conn.connecting","term_conn.waiting_content","term_conn.disconnected","term_conn.waiting_server","term_conn.reconnecting","scheduleSample","enablePolling","scheduledSampleTimeout","sampleGPIOs","onSampled","PERIOD_FAIL","io2","lastState","$in2","io4","$in4","io5","$in5","PERIOD_NORMAL","getargs","_utils","GPIO_Ctl","doPoll","num","localize","Notify","TermScreen","TermConnection","TermInput","TermUpload","initSoftKeyboard","attachDebugger","initButtons","conn","termUpload","onMouseDown","onMouseMove","onMouseUp","onMouseWheel","setAlts","setMouseMode","touchSelectMenu","rect","getBoundingClientRect","transform","copyButton","copySelectionToClipboard","labels","layout","renderer","scr","errmsg","setLinkVisibility","setButtonVisibility","showLinks","showButtons","showSplashTimeout","delay","statusScreen","loading","screenFG","screenBG","screenAttrs","onerror","errorMsg","file","col","canvas","fullscreenIcon","isFullscreen","properFullscreen","fitScreen","screenPadding","padding","fitScreenIfNeeded","fitIntoWidth","fitIntoHeight","innerHeight","toggleFitScreen","resizeButtonIcon","Element","requestFullscreen","webkitRequestFullscreen","checkForFullscreen","body","updateSize","span","termUpl","ScreenParser","ScreenLayout","_debug","audioCtx","AudioContext","webkitAudioContext","warn","_window","debug","Proxy","updateLayout","renderScreen","blinking","hanging","selectable","start","end","setSelectable","mouseMode","clicks","movement","bracketedPaste","blinkingCellCount","reverseVideo","screenLines","selecting","selectStart","screenToGrid","selectMove","selectEnd","getNormalizedSelection","altKey","offsetX","offsetY","touchPosition","touchDownTime","touchDidMove","getTouchPositionOffset","clientX","left","clientY","top","touches","_this$layout","_this$layout2","selectionPos","gridToScreen","_this$layout3","resetSelection","aggregateWheelDelta","wheelDeltaY","reason","isInSelection","screenSelection","hasBlinkingCells","_selection","_ref","_getNormalizedSelecti","colAfterStart","colBeforeEnd","onStartLine","onEndLine","screenLength","lines","previousLineIndex","selectedText","getSelectedText","textarea","select","execCommand","Notification","permission","focus","requestPermission","_lastBeep","_convolver","createConvolver","impulseLength","sampleRate","impulse","createBuffer","getChannelData","buffer","connect","destination","mainOsc","createOscillator","mainGain","createGain","gain","frequency","surrOsc","surrGain","startTime","currentTime","stop","requestAnimationFrame","_parser","updates","topic","resetScreen","loadTheme","setDefaultColors","defFG","defBG","cursorVisible","inputAlts","trackMouseClicks","trackMouseMovement","cursorBlinking","resetCursorBlink","cursorStyle","debugEnabled","showConfigLinks","fontFamily","fontStack","fontSize","backgroundImage","beep","frameX","frameY","frameWidth","frameHeight","cells","pushFrame","cellXInFrame","cellYInFrame","showNotification","du","str","NaN","contentLoaded","ci","strArray","topics","collectOneTerminatedString","collectColor","cursorShape","flags","cursorAttrs","regionStart","regionEnd","charsetGx","charsetG0","charsetG1","cursorFg","cursorBg","freeHeap","clientCount","attrs","lastChar","frameLength","MASK_LINE_ATTR","MASK_BLINK","pushCell","hasFG","hasBG","cellFG","cellBG","cellAttrs","charCode","parseUpdate","CanvasRenderer","DEFAULT_FONT","gridScaleX","gridScaleY","_windowScale","_padding","windowState","charSize","scheduleSizeUpdate","scheduleDraw","_scheduledSizeUpdate","fontStyle","fontWeight","weight","rounded","cellSize","getCellSize","drawnScreenLines","_this3","withScale","getCharWidthFor","getFont","updateCharSize","ceil","didChange","realWidth","realHeight","originalWidth","terminalAspect","resetDrawn","serializeRenderData","fonts","_slicedToArray","sliceIterator","_arr","_n","_d","_e","_s","_i","frakturExceptions","C","H","I","R","Z","ctx","getContext","_palette","graphics","statusFont","blinkStyleOn","blinkInterval","cursorBlinkOn","cursorBlinkInterval","resetBlink","drawnScreen","drawnScreenBG","drawnScreenAttrs","drawnCursor","font","measureText","why","aggregateTime","_scheduledDraw","draw","_this4","intervals","cellWidth","cellHeight","isDefaultBG","fillStyle","screenX","screenY","isBorderCell","fillX","fillY","fillWidth","fillHeight","right","bottom","clearRect","fillRect","_ref2","underline","strike","overline","globalAlpha","alphaToFraktur","dblWidth","dblHeightTop","dblHeightBot","save","translate","scale","beginPath","clip","cw","ch","c2w","c2h","offset","dotSpacingX","dotSpacingY","dotSize","alignRight","dy","dotSizeY","lineTo","strokeStyle","stroke","fillText","lineWidth","lineCap","lineY","restore","radius","drawStatus","startDrawLoop","stopDrawLoop","_cellSize","setTransform","drawStart","textAlign","textBaseline","FONT_MASK","fontGroups","Map","updateMap","isCursor","wasCursor","inSelection","_ref3","_ref4","didUpdate","debugFilledUpdates","keys","previous","redrawMap","maskedCells","isTextWide","shouldUpdate","isWideCell","checkRadius","adjacentDidUpdate","getAdjacentCells","adjacentCell","regions","masked","region","other","_region2","endX","endY","rectX","rectY","rectWidth","rectHeight","drawBackground","setCell","fontIndex","drawCharacter","cursorWidth","_ref5","drawEnd","screenWidth","screenHeight","rotate","_drawTimerThread","threadID","drawTimerLoop","_this5","demo","ws","heartbeatTimeout","pingInterval","xoff","autoXoffTimeout","reconnTimeout","forceClosing","queue","blobReader","FileReader","onDecodedWSMessage","disconnectTimeout","hidden","closeSocket","heartbeat","flushQueue","readAsText","onWSMessage","close","alert","WebSocket","onWSOpen","onWSClose","onHeartbeatFail","_this7","_this8","sendPing","sendString","sendButton","initKeys","allFn","shouldAcceptEvent","metaKey","handleKeyDown","clipboardData","setData","getData","setContent","all_fn","mb1","mb2","mb3","packModifiersForMouse","KEY_NAMES","3","6","8","9","12","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","58","59","60","61","62","63","64","91","92","93","106","107","109","110","111","144","145","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","186","187","188","189","190","192","194","219","220","221","222","224","np_alt","cu_alt","fn_alt","mt_click","mt_move","no_keys","crlf_mode","fa","alt","normal","ca","na","keymap","Backspace","Tab","Enter","Control+Enter","Escape","ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Home","Insert","Delete","End","PageUp","PageDown","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Shift+F1","Shift+F2","Shift+F3","Shift+F4","Shift+F5","Shift+F6","Shift+F7","Shift+F8","Shift+F9","Shift+F10","Shift+F11","Shift+F12","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Numpad*","Numpad+","Numpad-","Numpad.","Numpad/","Control+]","Control+\\","Control+[","Control+^","Control+_","Control+ArrowLeft","Control+ArrowRight","Control+ArrowUp","Control+ArrowDown","Control+Home","Control+End","Shift+ArrowLeft","Shift+ArrowRight","Shift+ArrowUp","Shift+ArrowDown","Shift+Home","Shift+End","Alt+ArrowLeft","Alt+ArrowRight","Meta+ArrowLeft","Meta+ArrowRight","Alt+Backspace","Meta+Backspace","Control+Shift+C","Control+Insert","Control+F12","activeElement","HTMLTextAreaElement","keyBlacklist","softModifiers","ctrl","meta","shiftKey","binding","itemModifiers","cu","np","crlf","click","move","dir","blockKeys","yes","openUploadDialog","updateStatus","onDialogClose","fuTout","line_i","startUpload","fuClose","inline_pos","send_delay_ms","nl_str","CR","LF","CRLF","uploadLine","canSend","curLine","maxChunk","MAX_LINE_LEN","chunk","pt","closeWhenReady","reader","files","ftype","confirm","txt","keyInput","shortcutBar","keyboardOpen","updateInputPosition","_screen$layout$gridTo","_screen$layout$gridTo2","lastCompositionString","sendInputDelta","newValue","resend","stopPropagation","isComposing","inputType","shortcuts","Control","Esc","←","↓","↑","→","touchMoved","shortcut","fakeEvent","connection","debugCanvas","toolbar","tooltip","updateTooltip","updateToolbar","selectedCell","onMouseOut","updateCanvasSize","_screen$layout$window","screenAttached","eventNode","setScreenAttached","attached","setToolbarAttached","enabled","drawData","showUpdates","endTime","frames","scrollRegion","performance","frame","isDrawing","drawLoop","_screen$layout$window2","lineJoin","_cells$get","_cells$get2","timestamp","elapsedTime","delete","framesToDelete","strokeRect","_selectedCell","_selectedCell2","setLineDash","lineDashOffset","_drawData$scrollRegio","pad2","formatColor","makeSpan","styles","formatAttributes","textDecoration","opacity","preview","bgPreview","formattedCodePoint","Cell","Foreground","Background","Character","Attributes","table","Text","posX","posY","toolbarData","toolbarNodes","initToolbar","fancyGraphics","Position","Style","Visible","Hanging","internal","Flags","Cursor Attributes","Code Page","Heap","Clients","drawing","Last Update","Show Updates","Fancy Graphics","Redraw Screen","group","Node","drawTime","_require3","container","pushButton","blur","popButton","clr","hsl","boxShadow","selectedTheme","showColor","ex","ColorTriangle","uppercase","trianglePointerSize","size","parseColor","initInput","$presets","thm","tit","xfg","xbg","nextTheme","selectedIndex","prevTheme","times","win","doc","triangleSize","wheelPointerColor1","wheelPointerColor2","trianglePointerColor1","trianglePointerColor2","pixelRatio","setOptions","calculateProperties","createContainer","createTriangle","createWheel","createWheelPointer","createTrianglePointer","attachEvents","setHEX","innerSize","wheelThickness","wheelPointerSize","wheelRadius","triangleRadius","triangleSideLength","sqrt","hue","third","saturation","lightness","hx","cos","hy","sx","sy","vx","vy","mx","my","borderRadius","wheel","margin","drawWheel","arc","triangle","triangleCtx","closePath","grad0","createLinearGradient","hsla","addColorStop","grad1","globalCompositeOperation","wheelPointer","drawPointer","trianglePointer","color1","color2","getRGB","setRGB","getHSL","setHSL","initColor","calculatePositions","moveWheelPointer","drawTriangle","moveTrianglePointer","down","mousedown","mousemove","mouseup","xy","getRelativeCoordinates","x0","y0","rad","atan2","rad0","rad1","tan","maxR","rad2","atan","widthShare","dflt","ct","openColorTriangle","offsetWidth","getHEX","fireChangeEvent","offsetTop","offsetHeight","el","getElement","offsetLeft","zIndex","inject","closeColorTriangle","dispose"],"mappings":"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","file":"app.9aae724-en.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 10);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n/** Make a node */\nexports.mk = function mk(e) {\n  return document.createElement(e);\n};\n\n/** Find one by query */\nexports.qs = function qs(s) {\n  return document.querySelector(s);\n};\n\n/** Find all by query */\nexports.qsa = function qsa(s) {\n  return document.querySelectorAll(s);\n};\n\n/**\n * Filter 'spacebar' and 'return' from keypress handler,\n * and when they're pressed, fire the callback.\n * use $(...).on('keypress', cr(handler))\n */\nexports.cr = function cr(hdl) {\n  return function (e) {\n    if (e.which === 10 || e.which === 13 || e.which === 32) {\n      hdl.call(this, e);\n    }\n  };\n};\n\n/** Decode number from 2B encoding */\nexports.parse2B = function parse2B(s) {\n  var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  return s.charCodeAt(i++) - 1 + (s.charCodeAt(i) - 1) * 127;\n};\n\n/** Decode number from 3B encoding */\nexports.parse3B = function parse3B(s) {\n  var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  return s.charCodeAt(i) - 1 + (s.charCodeAt(i + 1) - 1) * 127 + (s.charCodeAt(i + 2) - 1) * 127 * 127;\n};\n\n/** Encode using 2B encoding, returns string. */\nexports.encode2B = function encode2B(n) {\n  var lsb = void 0,\n      msb = void 0;\n  lsb = n % 127;\n  n = (n - lsb) / 127;\n  lsb += 1;\n  msb = n + 1;\n  return String.fromCharCode(lsb) + String.fromCharCode(msb);\n};\n\n/** Encode using 3B encoding, returns string. */\nexports.encode3B = function encode3B(n) {\n  var lsb = void 0,\n      msb = void 0,\n      xsb = void 0;\n  lsb = n % 127;\n  n = (n - lsb) / 127;\n  lsb += 1;\n  msb = n % 127;\n  n = (n - msb) / 127;\n  msb += 1;\n  xsb = n + 1;\n  return String.fromCharCode(lsb) + String.fromCharCode(msb) + String.fromCharCode(xsb);\n};\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/*!chibi 3.0.7, Copyright 2012-2016 Kyle Barrow, released under MIT license */\n\n// MODIFIED VERSION.\n(function () {\n\t'use strict';\n\n\tvar readyfn = [],\n\t    loadedfn = [],\n\t    domready = false,\n\t    pageloaded = false,\n\t    d = document,\n\t    w = window;\n\n\t// Fire any function calls on ready event\n\tfunction fireReady() {\n\t\tvar i;\n\t\tdomready = true;\n\t\tfor (i = 0; i < readyfn.length; i += 1) {\n\t\t\treadyfn[i]();\n\t\t}\n\t\treadyfn = [];\n\t}\n\n\t// Fire any function calls on loaded event\n\tfunction fireLoaded() {\n\t\tvar i;\n\t\tpageloaded = true;\n\t\t// For browsers with no DOM loaded support\n\t\tif (!domready) {\n\t\t\tfireReady();\n\t\t}\n\t\tfor (i = 0; i < loadedfn.length; i += 1) {\n\t\t\tloadedfn[i]();\n\t\t}\n\t\tloadedfn = [];\n\t}\n\n\t// Check DOM ready, page loaded\n\tif (d.addEventListener) {\n\t\t// Standards\n\t\td.addEventListener('DOMContentLoaded', fireReady, false);\n\t\tw.addEventListener('load', fireLoaded, false);\n\t} else if (d.attachEvent) {\n\t\t// IE\n\t\td.attachEvent('onreadystatechange', fireReady);\n\t\t// IE < 9\n\t\tw.attachEvent('onload', fireLoaded);\n\t} else {\n\t\t// Anything else\n\t\tw.onload = fireLoaded;\n\t}\n\n\t// Utility functions\n\n\t// Loop through node array\n\tfunction nodeLoop(fn, nodes) {\n\t\tvar i;\n\t\t// Good idea to walk up the DOM\n\t\tfor (i = nodes.length - 1; i >= 0; i -= 1) {\n\t\t\tfn(nodes[i]);\n\t\t}\n\t}\n\n\t// Convert to camel case\n\tfunction cssCamel(property) {\n\t\treturn property.replace(/-\\w/g, function (result) {\n\t\t\treturn result.charAt(1).toUpperCase();\n\t\t});\n\t}\n\n\t// Get computed style\n\tfunction computeStyle(elm, property) {\n\t\t// IE, everything else or null\n\t\treturn elm.currentStyle ? elm.currentStyle[cssCamel(property)] : w.getComputedStyle ? w.getComputedStyle(elm, null).getPropertyValue(property) : null;\n\t}\n\n\t// Returns URI encoded query string pair\n\tfunction queryPair(name, value) {\n\t\treturn encodeURIComponent(name).replace(/%20/g, '+') + '=' + encodeURIComponent(value).replace(/%20/g, '+');\n\t}\n\n\t// Set CSS, important to wrap in try to prevent error thown on unsupported property\n\tfunction setCss(elm, property, value) {\n\t\ttry {\n\t\t\telm.style[cssCamel(property)] = value;\n\t\t} catch (e) {}\n\t}\n\n\t// Show CSS\n\tfunction showCss(elm) {\n\t\telm.style.display = '';\n\t\t// For elements still hidden by style block\n\t\tif (computeStyle(elm, 'display') === 'none') {\n\t\t\telm.style.display = 'block';\n\t\t}\n\t}\n\n\t// Serialize form & JSON values\n\tfunction serializeData(nodes) {\n\t\tvar querystring = '',\n\t\t    subelm,\n\t\t    i,\n\t\t    j;\n\t\tif (nodes.constructor === Object) {\n\t\t\t// Serialize JSON data\n\t\t\tfor (subelm in nodes) {\n\t\t\t\tif (nodes.hasOwnProperty(subelm)) {\n\t\t\t\t\tif (nodes[subelm].constructor === Array) {\n\t\t\t\t\t\tfor (i = 0; i < nodes[subelm].length; i += 1) {\n\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm, nodes[subelm][i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tquerystring += '&' + queryPair(subelm, nodes[subelm]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Serialize node data\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tif (elm.nodeName === 'FORM') {\n\t\t\t\t\tfor (i = 0; i < elm.elements.length; i += 1) {\n\t\t\t\t\t\tsubelm = elm.elements[i];\n\n\t\t\t\t\t\tif (!subelm.disabled) {\n\t\t\t\t\t\t\tswitch (subelm.type) {\n\t\t\t\t\t\t\t\t// Ignore buttons, unsupported XHR 1 form fields\n\t\t\t\t\t\t\t\tcase 'button':\n\t\t\t\t\t\t\t\tcase 'image':\n\t\t\t\t\t\t\t\tcase 'file':\n\t\t\t\t\t\t\t\tcase 'submit':\n\t\t\t\t\t\t\t\tcase 'reset':\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'select-one':\n\t\t\t\t\t\t\t\t\tif (subelm.length > 0) {\n\t\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm.value);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'select-multiple':\n\t\t\t\t\t\t\t\t\tfor (j = 0; j < subelm.length; j += 1) {\n\t\t\t\t\t\t\t\t\t\tif (subelm[j].selected) {\n\t\t\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm[j].value);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'checkbox':\n\t\t\t\t\t\t\t\tcase 'radio':\n\t\t\t\t\t\t\t\t\tif (subelm.checked) {\n\t\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm.value);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t// Everything else including shinny new HTML5 input types\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm.value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t}\n\t\t// Tidy up first &\n\t\treturn querystring.length > 0 ? querystring.substring(1) : '';\n\t}\n\n\t// Class helper\n\tfunction classHelper(classes, action, nodes) {\n\t\tvar classarray,\n\t\t    search,\n\t\t    i,\n\t\t    replace,\n\t\t    has = false;\n\t\tif (classes) {\n\t\t\t// Trim any whitespace\n\t\t\tclassarray = classes.split(/\\s+/);\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tfor (i = 0; i < classarray.length; i += 1) {\n\t\t\t\t\tvar clz = classarray[i];\n\t\t\t\t\tif (action === 'remove') {\n\t\t\t\t\t\telm.classList.remove(clz);\n\t\t\t\t\t} else if (action === 'add') {\n\t\t\t\t\t\telm.classList.add(clz);\n\t\t\t\t\t} else if (action === 'toggle') {\n\t\t\t\t\t\telm.classList.toggle(clz);\n\t\t\t\t\t} else if (action === 'has') {\n\t\t\t\t\t\tif (elm.classList.contains(clz)) {\n\t\t\t\t\t\t\thas = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// search = new RegExp('\\\\b' + classarray[i] + '\\\\b', 'g');\n\t\t\t\t\t// replace = new RegExp(' *' + classarray[i] + '\\\\b', 'g');\n\t\t\t\t\t// if (action === 'remove') {\n\t\t\t\t\t// \telm.className = elm.className.replace(search, '');\n\t\t\t\t\t// } else if (action === 'toggle') {\n\t\t\t\t\t// \telm.className = (elm.className.match(search)) ? elm.className.replace(replace, '') : elm.className + ' ' + classarray[i];\n\t\t\t\t\t// } else if (action === 'has') {\n\t\t\t\t\t// \tif (elm.className.match(search)) {\n\t\t\t\t\t// \t\thas = true;\n\t\t\t\t\t// \t\tbreak;\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t}\n\t\treturn has;\n\t}\n\n\t// HTML insertion helper\n\tfunction insertHtml(value, position, nodes) {\n\t\tvar tmpnodes, tmpnode;\n\t\tif (value) {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\t// No insertAdjacentHTML support for FF < 8 and IE doesn't allow insertAdjacentHTML table manipulation, so use this instead\n\t\t\t\t// Convert string to node. We can't innerHTML on a document fragment\n\t\t\t\ttmpnodes = d.createElement('div');\n\t\t\t\ttmpnodes.innerHTML = value;\n\t\t\t\twhile ((tmpnode = tmpnodes.lastChild) !== null) {\n\t\t\t\t\t// Catch error in unlikely case elm has been removed\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (position === 'before') {\n\t\t\t\t\t\t\telm.parentNode.insertBefore(tmpnode, elm);\n\t\t\t\t\t\t} else if (position === 'after') {\n\t\t\t\t\t\t\telm.parentNode.insertBefore(tmpnode, elm.nextSibling);\n\t\t\t\t\t\t} else if (position === 'append') {\n\t\t\t\t\t\t\telm.appendChild(tmpnode);\n\t\t\t\t\t\t} else if (position === 'prepend') {\n\t\t\t\t\t\t\telm.insertBefore(tmpnode, elm.firstChild);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t}\n\t}\n\n\t// Get nodes and return chibi\n\tfunction chibi(selector) {\n\t\tvar cb,\n\t\t    nodes = [],\n\t\t    json = false,\n\t\t    nodelist,\n\t\t    i;\n\n\t\tif (selector) {\n\n\t\t\t// Element node, would prefer to use (selector instanceof HTMLElement) but no IE support\n\t\t\tif (selector.nodeType && selector.nodeType === 1) {\n\t\t\t\tnodes = [selector]; // return element as node list\n\t\t\t} else if ((typeof selector === 'undefined' ? 'undefined' : _typeof(selector)) === 'object') {\n\t\t\t\t// JSON, document object or node list, would prefer to use (selector instanceof NodeList) but no IE support\n\t\t\t\tjson = typeof selector.length !== 'number';\n\t\t\t\tnodes = selector;\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\tnodelist = d.querySelectorAll(selector);\n\n\t\t\t\t// Convert node list to array so results have full access to array methods\n\t\t\t\t// Array.prototype.slice.call not supported in IE < 9 and often slower than loop anyway\n\t\t\t\tfor (i = 0; i < nodelist.length; i += 1) {\n\t\t\t\t\tnodes[i] = nodelist[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Only attach nodes if not JSON\n\t\tcb = json ? {} : nodes;\n\n\t\t// Public functions\n\n\t\t// Executes a function on nodes\n\t\tcb.each = function (fn) {\n\t\t\tif (typeof fn === 'function') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t// <= IE 8 loses scope so need to apply\n\t\t\t\t\treturn fn.apply(elm, arguments);\n\t\t\t\t}, nodes);\n\t\t\t}\n\t\t\treturn cb;\n\t\t};\n\t\t// Find first\n\t\tcb.first = function () {\n\t\t\treturn chibi(nodes.shift());\n\t\t};\n\t\t// Find last\n\t\tcb.last = function () {\n\t\t\treturn chibi(nodes.pop());\n\t\t};\n\t\t// Find odd\n\t\tcb.odd = function () {\n\t\t\tvar odds = [],\n\t\t\t    i;\n\t\t\tfor (i = 0; i < nodes.length; i += 2) {\n\t\t\t\todds.push(nodes[i]);\n\t\t\t}\n\t\t\treturn chibi(odds);\n\t\t};\n\t\t// Find even\n\t\tcb.even = function () {\n\t\t\tvar evens = [],\n\t\t\t    i;\n\t\t\tfor (i = 1; i < nodes.length; i += 2) {\n\t\t\t\tevens.push(nodes[i]);\n\t\t\t}\n\t\t\treturn chibi(evens);\n\t\t};\n\t\t// Hide node\n\t\tcb.hide = function () {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\telm.style.display = 'none';\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Show node\n\t\tcb.show = function () {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tshowCss(elm);\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Toggle node display\n\t\tcb.toggle = function (state) {\n\t\t\tif (typeof state != 'undefined') {\n\t\t\t\t// ADDED\n\t\t\t\tif (state) cb.show();else cb.hide();\n\t\t\t} else {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t// computeStyle instead of style.display == 'none' catches elements that are hidden via style block\n\t\t\t\t\tif (computeStyle(elm, 'display') === 'none') {\n\t\t\t\t\t\tshowCss(elm);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telm.style.display = 'none';\n\t\t\t\t\t}\n\t\t\t\t}, nodes);\n\t\t\t}\n\t\t\treturn cb;\n\t\t};\n\t\t// Remove node\n\t\tcb.remove = function () {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\t// Catch error in unlikely case elm has been removed\n\t\t\t\ttry {\n\t\t\t\t\telm.parentNode.removeChild(elm);\n\t\t\t\t} catch (e) {}\n\t\t\t}, nodes);\n\t\t\treturn chibi();\n\t\t};\n\t\t// Get/Set CSS\n\t\tcb.css = function (property, value) {\n\t\t\tif (property) {\n\t\t\t\tif (value || value === '') {\n\t\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t\tsetCss(elm, property, value);\n\t\t\t\t\t}, nodes);\n\t\t\t\t\treturn cb;\n\t\t\t\t}\n\t\t\t\tif (nodes[0]) {\n\t\t\t\t\tif (nodes[0].style[cssCamel(property)]) {\n\t\t\t\t\t\treturn nodes[0].style[cssCamel(property)];\n\t\t\t\t\t}\n\t\t\t\t\tif (computeStyle(nodes[0], property)) {\n\t\t\t\t\t\treturn computeStyle(nodes[0], property);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Get class(es)\n\t\tcb.getClass = function () {\n\t\t\tif (nodes[0] && nodes[0].className.length > 0) {\n\t\t\t\t// Weak IE trim support\n\t\t\t\treturn nodes[0].className.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '').replace(/\\s+/, ' ');\n\t\t\t}\n\t\t};\n\t\t// Set (replaces) classes\n\t\tcb.setClass = function (classes) {\n\t\t\tif (classes || classes === '') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\telm.className = classes;\n\t\t\t\t}, nodes);\n\t\t\t}\n\t\t\treturn cb;\n\t\t};\n\t\t// Add class\n\t\tcb.addClass = function (classes) {\n\t\t\tclassHelper(classes, 'add', nodes);\n\t\t\t// if (classes) {\n\t\t\t// \tnodeLoop(function (elm) {\n\t\t\t// \t\telm.className += ' ' + classes;\n\t\t\t// \t}, nodes);\n\t\t\t// }\n\t\t\treturn cb;\n\t\t};\n\t\t// Remove class\n\t\tcb.removeClass = function (classes) {\n\t\t\tclassHelper(classes, 'remove', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Toggle class\n\t\tcb.toggleClass = function (classes, set) {\n\t\t\tvar method = typeof set === 'undefined' ? 'toggle' : +set ? 'add' : 'remove';\n\t\t\tclassHelper(classes, method, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Has class\n\t\tcb.hasClass = function (classes) {\n\t\t\treturn classHelper(classes, 'has', nodes);\n\t\t};\n\t\t// Get/set HTML\n\t\tcb.html = function (value) {\n\t\t\tif (value || value === '') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\telm.innerHTML = value;\n\t\t\t\t}, nodes);\n\t\t\t\treturn cb;\n\t\t\t}\n\t\t\tif (nodes[0]) {\n\t\t\t\treturn nodes[0].innerHTML;\n\t\t\t}\n\t\t};\n\t\t// Insert HTML before selector\n\t\tcb.htmlBefore = function (value) {\n\t\t\tinsertHtml(value, 'before', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Insert HTML after selector\n\t\tcb.htmlAfter = function (value) {\n\t\t\tinsertHtml(value, 'after', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Insert HTML after selector innerHTML\n\t\tcb.htmlAppend = function (value) {\n\t\t\tinsertHtml(value, 'append', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Insert HTML before selector innerHTML\n\t\tcb.htmlPrepend = function (value) {\n\t\t\tinsertHtml(value, 'prepend', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Get/Set HTML attributes\n\t\tcb.attr = function (property, value) {\n\t\t\tif (property) {\n\t\t\t\tproperty = property.toLowerCase();\n\t\t\t\t// IE < 9 doesn't allow style or class via get/setAttribute so switch. cssText returns prettier CSS anyway\n\t\t\t\tif (typeof value !== 'undefined') {\n\t\t\t\t\t//FIXED BUG HERE\n\t\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t\tif (property === 'style') {\n\t\t\t\t\t\t\telm.style.cssText = value;\n\t\t\t\t\t\t} else if (property === 'class') {\n\t\t\t\t\t\t\telm.className = value;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telm.setAttribute(property, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, nodes);\n\t\t\t\t\treturn cb;\n\t\t\t\t}\n\t\t\t\tif (nodes[0]) {\n\t\t\t\t\tif (property === 'style') {\n\t\t\t\t\t\tif (nodes[0].style.cssText) {\n\t\t\t\t\t\t\treturn nodes[0].style.cssText;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (property === 'class') {\n\t\t\t\t\t\tif (nodes[0].className) {\n\t\t\t\t\t\t\treturn nodes[0].className;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (nodes[0].getAttribute(property)) {\n\t\t\t\t\t\t\treturn nodes[0].getAttribute(property);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Get/Set HTML data property\n\t\tcb.data = function (key, value) {\n\t\t\tif (key) {\n\t\t\t\treturn cb.attr('data-' + key, value);\n\t\t\t}\n\t\t};\n\t\t// Get/Set form element values\n\t\tcb.val = function (value) {\n\t\t\tvar values, i, j;\n\t\t\tif (typeof value != 'undefined') {\n\t\t\t\t// FIXED A BUG HERE\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\tswitch (elm.nodeName) {\n\t\t\t\t\t\tcase 'SELECT':\n\t\t\t\t\t\t\tif (typeof value === 'string' || typeof value === 'number') {\n\t\t\t\t\t\t\t\tvalue = [value];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (i = 0; i < elm.length; i += 1) {\n\t\t\t\t\t\t\t\t// Multiple select\n\t\t\t\t\t\t\t\tfor (j = 0; j < value.length; j += 1) {\n\t\t\t\t\t\t\t\t\telm[i].selected = '';\n\t\t\t\t\t\t\t\t\tif (elm[i].value === \"\" + value[j]) {\n\t\t\t\t\t\t\t\t\t\telm[i].selected = 'selected';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'INPUT':\n\t\t\t\t\t\tcase 'TEXTAREA':\n\t\t\t\t\t\tcase 'BUTTON':\n\t\t\t\t\t\t\telm.value = value;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}, nodes);\n\n\t\t\t\treturn cb;\n\t\t\t}\n\t\t\tif (nodes[0]) {\n\t\t\t\tswitch (nodes[0].nodeName) {\n\t\t\t\t\tcase 'SELECT':\n\t\t\t\t\t\tvalues = [];\n\t\t\t\t\t\tfor (i = 0; i < nodes[0].length; i += 1) {\n\t\t\t\t\t\t\tif (nodes[0][i].selected) {\n\t\t\t\t\t\t\t\tvalues.push(nodes[0][i].value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn values.length > 1 ? values : values[0];\n\t\t\t\t\tcase 'INPUT':\n\t\t\t\t\tcase 'TEXTAREA':\n\t\t\t\t\tcase 'BUTTON':\n\t\t\t\t\t\treturn nodes[0].value;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Return matching checked checkbox or radios\n\t\tcb.checked = function (check) {\n\t\t\tif (typeof check === 'boolean') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\tif (elm.nodeName === 'INPUT' && (elm.type === 'checkbox' || elm.type === 'radio')) {\n\t\t\t\t\t\telm.checked = check;\n\t\t\t\t\t}\n\t\t\t\t}, nodes);\n\t\t\t\treturn cb;\n\t\t\t}\n\t\t\tif (nodes[0] && nodes[0].nodeName === 'INPUT' && (nodes[0].type === 'checkbox' || nodes[0].type === 'radio')) {\n\t\t\t\treturn !!nodes[0].checked;\n\t\t\t}\n\t\t};\n\t\t// Add event handler\n\t\tcb.on = function (event, fn) {\n\t\t\tif (selector === w || selector === d) {\n\t\t\t\tnodes = [selector];\n\t\t\t}\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tif (d.addEventListener) {\n\t\t\t\t\telm.addEventListener(event, fn, false);\n\t\t\t\t} else if (d.attachEvent) {\n\t\t\t\t\t// <= IE 8 loses scope so need to apply, we add this to object so we can detach later (can't detach anonymous functions)\n\t\t\t\t\telm[event + fn] = function () {\n\t\t\t\t\t\treturn fn.apply(elm, arguments);\n\t\t\t\t\t};\n\t\t\t\t\telm.attachEvent('on' + event, elm[event + fn]);\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Remove event handler\n\t\tcb.off = function (event, fn) {\n\t\t\tif (selector === w || selector === d) {\n\t\t\t\tnodes = [selector];\n\t\t\t}\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tif (d.addEventListener) {\n\t\t\t\t\telm.removeEventListener(event, fn, false);\n\t\t\t\t} else if (d.attachEvent) {\n\t\t\t\t\telm.detachEvent('on' + event, elm[event + fn]);\n\t\t\t\t\t// Tidy up\n\t\t\t\t\telm[event + fn] = null;\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\treturn cb;\n\t}\n\n\t// Basic XHR\n\tchibi.ajax = function (options) {\n\t\t// if options is a number, it's timeout in ms\n\t\tvar opts = Object.assign({\n\t\t\tmethod: 'GET',\n\t\t\tnocache: true,\n\t\t\ttimeout: 5000,\n\t\t\tloader: true,\n\t\t\tcallback: null\n\t\t}, options);\n\t\topts.method = opts.method.toUpperCase();\n\n\t\tvar loaderFn = opts.loader ? chibi._loader : function () {};\n\t\tvar url = opts.url;\n\t\tvar method = opts.method;\n\t\tvar query = null;\n\n\t\tif (opts.data) {\n\t\t\tquery = serializeData(opts.data);\n\t\t}\n\n\t\tif (query && method === 'GET') {\n\t\t\turl += url.indexOf('?') === -1 ? '?' + query : '&' + query;\n\t\t\tquery = null;\n\t\t}\n\n\t\tvar xhr = new XMLHttpRequest();\n\n\t\t// prevent caching\n\t\tif (opts.nocache) {\n\t\t\tvar ts = (+new Date()).toString(36);\n\t\t\turl += (url.indexOf('?') === -1 ? '?' : '&') + '_=' + ts;\n\t\t}\n\n\t\tloaderFn(true);\n\n\t\txhr.open(method, url, true);\n\t\txhr.timeout = opts.timeout;\n\n\t\t// Abort after given timeout\n\t\tvar abortTmeo = setTimeout(function () {\n\t\t\tconsole.error(\"XHR timed out.\");\n\t\t\txhr.abort();\n\t\t\tloaderFn(false);\n\t\t}, opts.timeout + 10);\n\n\t\txhr.onreadystatechange = function () {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tloaderFn(false);\n\n\t\t\t\topts.callback && opts.callback(xhr.responseText, xhr.status);\n\n\t\t\t\tclearTimeout(abortTmeo);\n\t\t\t}\n\t\t};\n\n\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\t\tif (method === 'POST') {\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t}\n\n\t\txhr.send(query);\n\t\treturn xhr;\n\t};\n\n\tchibi._loader = function () {};\n\n\t// Alias to cb.ajax(url, 'get', callback)\n\tchibi.get = function (url, callback, opts) {\n\t\topts = opts || {};\n\t\topts.url = url;\n\t\topts.callback = callback;\n\t\topts.method = 'GET';\n\t\treturn chibi.ajax(opts);\n\t};\n\n\t// Alias to cb.ajax(url, 'post', callback)\n\tchibi.post = function (url, callback, opts) {\n\t\topts = opts || {};\n\t\topts.url = url;\n\t\topts.callback = callback;\n\t\topts.method = 'POST';\n\t\treturn chibi.ajax(opts);\n\t};\n\n\t// Fire on DOM ready\n\tchibi.ready = function (fn) {\n\t\tif (fn) {\n\t\t\tif (domready) {\n\t\t\t\tfn();\n\t\t\t\treturn chibi;\n\t\t\t} else {\n\t\t\t\treadyfn.push(fn);\n\t\t\t}\n\t\t}\n\t};\n\n\t// Fire on page loaded\n\tchibi.loaded = function (fn) {\n\t\tif (fn) {\n\t\t\tif (pageloaded) {\n\t\t\t\tfn();\n\t\t\t\treturn chibi;\n\t\t\t} else {\n\t\t\t\tloadedfn.push(fn);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar entityMap = {\n\t\t'&': '&amp;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'\"': '&quot;',\n\t\t\"'\": '&#39;',\n\t\t'/': '&#x2F;',\n\t\t'`': '&#x60;',\n\t\t'=': '&#x3D;'\n\t};\n\n\tchibi.htmlEscape = function (string) {\n\t\treturn String(string).replace(/[&<>\"'`=\\/]/g, function (s) {\n\t\t\treturn entityMap[s];\n\t\t});\n\t};\n\n\t// Set Chibi's global namespace here ($)\n\tmodule.exports = chibi;\n})();\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar $ = __webpack_require__(1);\n\nvar _require = __webpack_require__(7),\n    rgb255ToHex = _require.rgb255ToHex;\n\nvar themes = exports.themes = [[// 0 - Tango - terminator\n'#111213', '#CC0000', '#4E9A06', '#C4A000', '#3465A4', '#75507B', '#06989A', '#D3D7CF', '#555753', '#EF2929', '#8AE234', '#FCE94F', '#729FCF', '#AD7FA8', '#34E2E2', '#EEEEEC'], [// 1 - Linux (CGA) - terminator\n'#000000', '#aa0000', '#00aa00', '#aa5500', '#0000aa', '#aa00aa', '#00aaaa', '#aaaaaa', '#555555', '#ff5555', '#55ff55', '#ffff55', '#5555ff', '#ff55ff', '#55ffff', '#ffffff'], [// 2 - xterm - terminator\n'#000000', '#cd0000', '#00cd00', '#cdcd00', '#0000ee', '#cd00cd', '#00cdcd', '#e5e5e5', '#7f7f7f', '#ff0000', '#00ff00', '#ffff00', '#5c5cff', '#ff00ff', '#00ffff', '#ffffff'], [// 3 - rxvt - terminator\n'#000000', '#cd0000', '#00cd00', '#cdcd00', '#0000cd', '#cd00cd', '#00cdcd', '#faebd7', '#404040', '#ff0000', '#00ff00', '#ffff00', '#0000ff', '#ff00ff', '#00ffff', '#ffffff'], [// 4 - Ambience - terminator\n'#2e3436', '#cc0000', '#4e9a06', '#c4a000', '#3465a4', '#75507b', '#06989a', '#d3d7cf', '#555753', '#ef2929', '#8ae234', '#fce94f', '#729fcf', '#ad7fa8', '#34e2e2', '#eeeeec'], [// 5 - Solarized Dark - terminator\n'#073642', '#dc322f', '#859900', '#b58900', '#268bd2', '#d33682', '#2aa198', '#eee8d5', '#002b36', '#cb4b16', '#586e75', '#657b83', '#839496', '#6c71c4', '#93a1a1', '#fdf6e3'], [// 6 - CGA NTSC - wikipedia\n'#000000', '#69001A', '#117800', '#769100', '#1A00A6', '#8019AB', '#289E76', '#A4A4A4', '#484848', '#C54E76', '#6DD441', '#D2ED46', '#765BFF', '#DC75FF', '#84FAD2', '#FFFFFF'], [// 7 - ZX Spectrum - wikipedia\n'#000000', '#aa0000', '#00aa00', '#aaaa00', '#0000aa', '#aa00aa', '#00aaaa', '#aaaaaa', '#000000', '#ff0000', '#00FF00', '#ffff00', '#0000ff', '#ff00ff', '#00ffff', '#ffffff'], [// 8 - Apple II - wikipedia\n'#000000', '#722640', '#0E5940', '#808080', '#40337F', '#E434FE', '#1B9AFE', '#BFB3FF', '#404C00', '#E46501', '#1BCB01', '#BFCC80', '#808080', '#F1A6BF', '#8DD9BF', '#ffffff'], [// 9 - Commodore - wikipedia\n'#000000', '#8D3E37', '#55A049', '#AAB95D', '#40318D', '#80348B', '#72C1C8', '#D59F74', '#8B5429', '#B86962', '#94E089', '#FFFFB2', '#8071CC', '#AA5FB6', '#87D6DD', '#ffffff'], [// 10 - Solarized Light - https://github.com/sgerrand/xfce4-terminal-colors-solarized\n'#eee8d5', '#dc322f', '#859900', '#b58900', '#268bd2', '#d33682', '#2aa198', '#073642', '#fdf6e3', '#cb4b16', '#93a1a1', '#839496', '#657b83', '#6c71c4', '#586e75', '#002b36'], [// 11 - Solarized Dark High contrast - https://github.com/sgerrand/xfce4-terminal-colors-solarized\n'#073642', '#dc322f', '#859900', '#b58900', '#268bd2', '#d33682', '#2aa198', '#fdf6e3', '#002b36', '#cb4b16', '#657b83', '#839496', '#93a1a1', '#6c71c4', '#eee8d5', '#fdf6e3']];\n\nexports.fgbgThemes = [['#AAAAAA', '#000000', 'Lnx', 'Linux'], ['#FFFFFF', '#000000', 'W+K', 'White on Black'], ['#00FF00', '#000000', 'Lim', 'Lime'], ['#E53C00', '#000000', 'Nix', 'Nixie'], ['#EFF0F1', '#31363B', 'Brz', 'Breeze'], ['#FFFFFF', '#300A24', 'Amb', 'Ambiance'], ['#839496', '#002B36', 'SoD', 'Solarized Dark'], ['#93a1a1', '#002b36', 'SoH', 'Solarized Dark (High Contrast)'], ['#657B83', '#FDF6E3', 'SoL', 'Solarized Light'], ['#000000', '#FFD75F', 'Wsp', 'Wasp'], ['#000000', '#FFFFDD', 'K+Y', 'Black on Yellow'], ['#000000', '#FFFFFF', 'K+W', 'Black on White']];\n\nvar colorTable256 = null;\n\nexports.buildColorTable = function () {\n  if (colorTable256 !== null) return colorTable256;\n\n  // 256color lookup table\n  // should not be used to look up 0-15\n  colorTable256 = new Array(16).fill('#000000');\n\n  // fill color table\n  // colors 16-231 are a 6x6x6 color cube\n  for (var red = 0; red < 6; red++) {\n    for (var green = 0; green < 6; green++) {\n      for (var blue = 0; blue < 6; blue++) {\n        var redValue = red * 40 + (red ? 55 : 0);\n        var greenValue = green * 40 + (green ? 55 : 0);\n        var blueValue = blue * 40 + (blue ? 55 : 0);\n        colorTable256.push(rgb255ToHex(redValue, greenValue, blueValue));\n      }\n    }\n  }\n  // colors 232-255 are a grayscale ramp, sans black and white\n  for (var gray = 0; gray < 24; gray++) {\n    var value = gray * 10 + 8;\n    colorTable256.push(rgb255ToHex(value, value, value));\n  }\n\n  return colorTable256;\n};\n\nexports.SELECTION_FG = '#333';\nexports.SELECTION_BG = '#b2d7fe';\n\nexports.themePreview = function (themeN) {\n  $('[data-fg]').forEach(function (elem) {\n    var shade = elem.dataset.fg;\n    if (/^\\d+$/.test(shade)) shade = exports.toHex(shade, themeN);\n    elem.style.color = shade;\n  });\n  $('[data-bg]').forEach(function (elem) {\n    var shade = elem.dataset.bg;\n    if (/^\\d+$/.test(shade)) shade = exports.toHex(shade, themeN);\n    elem.style.backgroundColor = shade;\n  });\n};\n\nexports.colorTable256 = null;\nexports.ensureColorTable256 = function () {\n  if (!exports.colorTable256) exports.colorTable256 = exports.buildColorTable();\n};\n\nexports.getColor = function (i) {\n  var palette = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  // return palette color if it exists\n  if (i < 16 && i in palette) return palette[i];\n\n  // -1 for selection foreground, -2 for selection background\n  if (i === -1) return exports.SELECTION_FG;\n  if (i === -2) return exports.SELECTION_BG;\n\n  // 256 color\n  if (i > 15 && i < 256) {\n    exports.ensureColorTable256();\n    return exports.colorTable256[i];\n  }\n\n  // 24-bit color, encoded as (hex) + 256 (such that #000000 == 256)\n  if (i > 255) {\n    i -= 256;\n    return '#' + ('000000' + i.toString(16)).substr(-6);\n  }\n\n  // return error color\n  return Math.floor(Date.now() / 1000) % 2 === 0 ? '#ff0ff' : '#00ff00';\n};\n\nexports.toHex = function (shade, themeN) {\n  if (/^\\d+$/.test(shade)) {\n    shade = +shade;\n    return exports.getColor(shade, themes[themeN]);\n  }\n  return shade;\n};\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar $ = __webpack_require__(1);\n\n/** Module for toggling a modal overlay */\nvar modal = {};\nvar curCloseCb = null;\n\nmodal.show = function (sel, closeCb) {\n  var $m = $(sel);\n  $m.removeClass('hidden visible');\n  setTimeout(function () {\n    $m.addClass('visible');\n  }, 1);\n  curCloseCb = closeCb;\n};\n\nmodal.hide = function (sel) {\n  var $m = $(sel);\n  $m.removeClass('visible');\n  setTimeout(function () {\n    $m.addClass('hidden');\n    if (curCloseCb) curCloseCb();\n  }, 500); // transition time\n};\n\nmodal.init = function () {\n  // close modal by click outside the dialog\n  $('.Modal').on('click', function () {\n    if ($(this).hasClass('no-close')) return; // this is a no-close modal\n    modal.hide(this);\n  });\n\n  $('.Dialog').on('click', function (e) {\n    e.stopImmediatePropagation();\n  });\n\n  // Hide all modals on esc\n  $(window).on('keydown', function (e) {\n    if (e.which === 27) {\n      modal.hide('.Modal');\n    }\n  });\n};\n\nmodule.exports = modal;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar $ = __webpack_require__(1);\nvar modal = __webpack_require__(4);\n\nvar nt = {};\nvar sel = '#notif';\nvar $balloon = void 0;\n\nvar timerHideBegin = void 0; // timeout to start hiding (transition)\nvar timerHideEnd = void 0; // timeout to add the hidden class\nvar canCancel = false;\n\nvar stopTimeouts = function stopTimeouts() {\n  clearTimeout(timerHideBegin);\n  clearTimeout(timerHideEnd);\n};\n\nnt.show = function (message, timeout, isError) {\n  $balloon.toggleClass('error', isError === true);\n  $balloon.html(message);\n  modal.show($balloon);\n  stopTimeouts();\n\n  if (!timeout || timeout <= 0) {\n    timeout = 2500;\n  }\n\n  timerHideBegin = setTimeout(nt.hide, timeout);\n\n  canCancel = false;\n  setTimeout(function () {\n    canCancel = true;\n  }, 500);\n};\n\nnt.hide = function () {\n  var $m = $(sel);\n  $m.removeClass('visible');\n  timerHideEnd = setTimeout(function () {\n    $m.addClass('hidden');\n  }, 250); // transition time\n};\n\nnt.init = function () {\n  $balloon = $(sel);\n\n  // close by click outside\n  $(document).on('click', function () {\n    if (!canCancel) return;\n    nt.hide(this);\n  });\n\n  // click caused by selecting, prevent it from bubbling\n  $balloon.on('click', function (e) {\n    e.stopImmediatePropagation();\n    return false;\n  });\n\n  // stop fading if moused\n  $balloon.on('mouseenter', function () {\n    stopTimeouts();\n    $balloon.removeClass('hidden').addClass('visible');\n  });\n};\n\nmodule.exports = nt;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n// Bits in the cell attribs word\n\n/* eslint-disable no-multi-spaces */\nexports.ATTR_FG = 1 << 0; // 1 if not using default background color (ignore cell bg) - color extension bit\nexports.ATTR_BG = 1 << 1; // 1 if not using default foreground color (ignore cell fg) - color extension bit\nexports.ATTR_BOLD = 1 << 2; // Bold font\nexports.ATTR_UNDERLINE = 1 << 3; // Underline decoration\nexports.ATTR_INVERSE = 1 << 4; // Invert colors - this is useful so we can clear then with SGR manipulation commands\nexports.ATTR_BLINK = 1 << 5; // Blinking\nexports.ATTR_ITALIC = 1 << 6; // Italic font\nexports.ATTR_STRIKE = 1 << 7; // Strike-through decoration\nexports.ATTR_OVERLINE = 1 << 8; // Over-line decoration\nexports.ATTR_FAINT = 1 << 9; // Faint foreground color (reduced alpha)\nexports.ATTR_FRAKTUR = 1 << 10; // Fraktur font (unicode substitution)\n/* eslint-enable no-multi-spaces */\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n/*\n * Copyright (c) 2010 Tim Baumann\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n// NOTE:\n// Extracted from ColorTriangle and\n// Converted to ES6 by MightyPork (2017)\n\n/*******************\n * Color conversion *\n *******************/\n\nvar M = Math;\nvar TAU = 2 * M.PI;\n\nexports.hue2rgb = function (v1, v2, h) {\n  if (h < 0) h += 1;\n  if (h > 1) h -= 1;\n\n  if (6 * h < 1) return v1 + (v2 - v1) * 6 * h;\n  if (2 * h < 1) return v2;\n  if (3 * h < 2) return v1 + (v2 - v1) * (2 / 3 - h) * 6;\n  return v1;\n};\n\nexports.hsl2rgb = function (h, s, l) {\n  h /= TAU;\n  var r = void 0,\n      g = void 0,\n      b = void 0;\n\n  if (s === 0) {\n    r = g = b = l;\n  } else {\n    var var_1 = void 0,\n        var_2 = void 0;\n\n    if (l < 0.5) var_2 = l * (1 + s);else var_2 = l + s - s * l;\n\n    var_1 = 2 * l - var_2;\n\n    r = exports.hue2rgb(var_1, var_2, h + 1 / 3);\n    g = exports.hue2rgb(var_1, var_2, h);\n    b = exports.hue2rgb(var_1, var_2, h - 1 / 3);\n  }\n  return [r, g, b];\n};\n\nexports.rgb2hsl = function (r, g, b) {\n  var min = M.min(r, g, b);\n  var max = M.max(r, g, b);\n  var d = max - min; // delta\n\n  var h = void 0,\n      s = void 0,\n      l = void 0;\n\n  l = (max + min) / 2;\n\n  if (d === 0) {\n    // gray\n    h = s = 0; // HSL results from 0 to 1\n  } else {\n    // chroma\n    if (l < 0.5) s = d / (max + min);else s = d / (2 - max - min);\n\n    var d_r = ((max - r) / 6 + d / 2) / d;\n    var d_g = ((max - g) / 6 + d / 2) / d;\n    var d_b = ((max - b) / 6 + d / 2) / d; // deltas\n\n    if (r === max) h = d_b - d_g;else if (g === max) h = 1 / 3 + d_r - d_b;else if (b === max) h = 2 / 3 + d_g - d_r;\n\n    if (h < 0) h += 1;else if (h > 1) h -= 1;\n  }\n  h *= TAU;\n  return [h, s, l];\n};\n\nexports.hex2rgb = function (hex) {\n  var groups = hex.match(/^#([\\da-f]{3,6})$/i);\n  if (groups) {\n    hex = groups[1];\n    var bytes = hex.length / 3;\n    var max = Math.pow(16, bytes) - 1;\n    return [0, 1, 2].map(function (x) {\n      return parseInt(hex.slice(x * bytes, (x + 1) * bytes), 16) / max;\n    });\n  }\n  return [0, 0, 0];\n};\n\nfunction pad(n) {\n  return ('00' + n).substr(-2);\n}\n\nexports.rgb255ToHex = function (r, g, b) {\n  return '#' + [r, g, b].map(function (x) {\n    return pad(x.toString(16));\n  }).join('');\n};\n\nexports.rgb2hex = function (r, g, b) {\n  return '#' + [r, g, b].map(function (x) {\n    return pad(Math.round(x * 255).toString(16));\n  }).join('');\n};\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar EventEmitter = __webpack_require__(2);\n\nvar _require = __webpack_require__(0),\n    parse2B = _require.parse2B;\n\nvar _require2 = __webpack_require__(3),\n    themes = _require2.themes;\n\nvar encodeAsCodePoint = function encodeAsCodePoint(i) {\n  return String.fromCodePoint(i + (i >= 0xD800 ? 0x801 : 1));\n};\n\nvar ANSIParser = function () {\n  function ANSIParser(handler) {\n    _classCallCheck(this, ANSIParser);\n\n    this.reset();\n    this.handler = handler;\n    this.joinChunks = true;\n  }\n\n  _createClass(ANSIParser, [{\n    key: 'reset',\n    value: function reset() {\n      this.currentSequence = 0;\n      this.sequence = '';\n    }\n  }, {\n    key: 'parseSequence',\n    value: function parseSequence(sequence) {\n      if (sequence[0] === '[') {\n        var type = sequence[sequence.length - 1];\n        var content = sequence.substring(1, sequence.length - 1);\n\n        var numbers = content ? content.split(';').map(function (i) {\n          return +i.replace(/\\D/g, '');\n        }) : [];\n        var numOr1 = numbers.length ? numbers[0] : 1;\n        if (type === 'H') {\n          this.handler('set-cursor', (numbers[0] | 0) - 1, (numbers[1] | 0) - 1);\n        } else if (type >= 'A' && type <= 'D') {\n          this.handler('move-cursor-' + (type <= 'B' ? 'y' : 'x'), (type === 'B' || type === 'C' ? 1 : -1) * numOr1);\n        } else if (type === 'E' || type === 'F') {\n          this.handler('move-cursor-line', (type === 'E' ? 1 : -1) * numOr1);\n        } else if (type === 'G') {\n          this.handler('set-cursor-x', numOr1 - 1);\n        } else if (type === 'J') {\n          var number = numbers.length ? numbers[0] : 2;\n          if (number === 2) this.handler('clear');\n        } else if (type === 'P') {\n          this.handler('delete', numOr1);\n        } else if (type === '@') {\n          this.handler('insert-blanks', numOr1);\n        } else if (type === 'q') this.handler('set-cursor-style', numOr1);else if (type === 'm') {\n          if (!numbers.length) {\n            this.handler('reset-style');\n            return;\n          }\n          var _type = void 0;\n          while (_type = numbers.shift()) {\n            if (_type === 0) this.handler('reset-style');else if (_type === 1) this.handler('add-attrs', 1 << 2); // bold\n            else if (_type === 2) this.handler('add-attrs', 1 << 9); // faint\n              else if (_type === 3) this.handler('add-attrs', 1 << 6); // italic\n                else if (_type === 4) this.handler('add-attrs', 1 << 3); // underline\n                  else if (_type === 5 || _type === 6) this.handler('add-attrs', 1 << 5); // blink\n                    else if (_type === 7) this.handler('add-attrs', 1 << 4); // invert\n                      else if (_type === 9) this.handler('add-attrs', 1 << 7); // strike\n                        else if (_type === 20) this.handler('add-attrs', 1 << 10); // fraktur\n                          else if (_type >= 30 && _type <= 37) this.handler('set-color-fg', _type % 10);else if (_type >= 40 && _type <= 47) this.handler('set-color-bg', _type % 10);else if (_type === 39) this.handler('reset-color-fg');else if (_type === 49) this.handler('reset-color-bg');else if (_type >= 90 && _type <= 98) this.handler('set-color-fg', _type % 10 + 8);else if (_type >= 100 && _type <= 108) this.handler('set-color-bg', _type % 10 + 8);else if (_type === 38 || _type === 48) {\n                              var mode = numbers.shift();\n                              if (mode === 2) {\n                                var r = numbers.shift();\n                                var g = numbers.shift();\n                                var b = numbers.shift();\n                                var color = (r << 16 | g << 8 | b) + 256;\n                                if (_type === 38) this.handler('set-color-fg', color);\n                                if (_type === 48) this.handler('set-color-bg', color);\n                              } else if (mode === 5) {\n                                var _color = (numbers.shift() | 0) & 0xFF;\n                                if (_type === 38) this.handler('set-color-fg', _color);\n                                if (_type === 48) this.handler('set-color-bg', _color);\n                              }\n                            }\n          }\n        } else if (type === 'h' || type === 'l') {\n          if (content === '?25') {\n            if (type === 'h') this.handler('show-cursor');else if (type === 'l') this.handler('hide-cursor');\n          }\n        }\n      }\n    }\n  }, {\n    key: 'write',\n    value: function write(text) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = text.toString()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var character = _step.value;\n\n          var code = character.codePointAt(0);\n          if (code === 0x1b) this.currentSequence = 1;else if (this.currentSequence === 1 && character === '[') {\n            this.currentSequence = 2;\n            this.sequence += '[';\n          } else if (this.currentSequence && character.match(/[\\x40-\\x7e]/)) {\n            this.parseSequence(this.sequence + character);\n            this.currentSequence = 0;\n            this.sequence = '';\n          } else if (this.currentSequence > 1) this.sequence += character;else if (this.currentSequence === 1) {\n            // something something nothing\n            this.currentSequence = 0;\n            this.handler('write', character);\n          } else if (code < 0x03) this.handler('_null');else if (code === 0x03) this.handler('sigint');else if (code <= 0x06) this.handler('_null');else if (code === 0x07) this.handler('bell');else if (code === 0x08) this.handler('back');else if (code === 0x09) this.handler('tab');else if (code === 0x0a) this.handler('new-line');else if (code === 0x0d) this.handler('return');else if (code === 0x15) this.handler('delete-line');else if (code === 0x17) this.handler('delete-word');else this.handler('write', character);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      if (!this.joinChunks) this.reset();\n    }\n  }]);\n\n  return ANSIParser;\n}();\n\nvar TERM_DEFAULT_STYLE = [0, 0, 0];\n\nvar getRainbowColor = function getRainbowColor(t) {\n  var r = Math.floor(Math.sin(t) * 2.5 + 2.5);\n  var g = Math.floor(Math.sin(t + 2 / 3 * Math.PI) * 2.5 + 2.5);\n  var b = Math.floor(Math.sin(t + 4 / 3 * Math.PI) * 2.5 + 2.5);\n  return 16 + 36 * r + 6 * g + b;\n};\n\nvar ScrollingTerminal = function () {\n  function ScrollingTerminal(screen) {\n    var _this = this;\n\n    _classCallCheck(this, ScrollingTerminal);\n\n    this.width = 80;\n    this.height = 25;\n    this.termScreen = screen;\n    this.parser = new ANSIParser(function () {\n      return _this.handleParsed.apply(_this, arguments);\n    });\n    this.buttonLabels = [];\n\n    this.reset();\n\n    this._lastLoad = Date.now();\n    this.loadTimer();\n\n    window.showPage();\n  }\n\n  _createClass(ScrollingTerminal, [{\n    key: 'reset',\n    value: function reset() {\n      this.style = TERM_DEFAULT_STYLE.slice();\n      this.cursor = { x: 0, y: 0, style: 1, visible: true };\n      this.trackMouse = false;\n      this.theme = 0;\n      this.defaultFG = 7;\n      this.defaultBG = 0;\n      this.rainbow = this.superRainbow = false;\n      this.parser.reset();\n      this.clear();\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      this.screen = [];\n      for (var i = 0; i < this.width * this.height; i++) {\n        this.screen.push([' ', this.style.slice()]);\n      }\n    }\n  }, {\n    key: 'scroll',\n    value: function scroll() {\n      this.screen.splice(0, this.width);\n      for (var i = 0; i < this.width; i++) {\n        this.screen.push([' ', TERM_DEFAULT_STYLE.slice()]);\n      }\n      this.cursor.y--;\n    }\n  }, {\n    key: 'newLine',\n    value: function newLine() {\n      this.cursor.y++;\n      if (this.cursor.y >= this.height) this.scroll();\n    }\n  }, {\n    key: 'writeChar',\n    value: function writeChar(character) {\n      this.screen[this.cursor.y * this.width + this.cursor.x] = [character, this.style.slice()];\n      this.cursor.x++;\n      if (this.cursor.x >= this.width) {\n        this.cursor.x = 0;\n        this.newLine();\n      }\n    }\n  }, {\n    key: 'moveBack',\n    value: function moveBack() {\n      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n\n      for (var i = 0; i < n; i++) {\n        this.cursor.x--;\n        if (this.cursor.x < 0) {\n          if (this.cursor.y > 0) this.cursor.x = this.width - 1;else this.cursor.x = 0;\n          this.cursor.y = Math.max(0, this.cursor.y - 1);\n        }\n      }\n    }\n  }, {\n    key: 'moveForward',\n    value: function moveForward() {\n      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n\n      for (var i = 0; i < n; i++) {\n        this.cursor.x++;\n        if (this.cursor.x >= this.width) {\n          this.cursor.x = 0;\n          this.cursor.y++;\n          if (this.cursor.y >= this.height) this.scroll();\n        }\n      }\n    }\n  }, {\n    key: 'deleteChar',\n    value: function deleteChar() {\n      // FIXME unused?\n      this.moveBack();\n      this.screen.splice((this.cursor.y + 1) * this.width, 0, [' ', TERM_DEFAULT_STYLE.slice()]);\n      this.screen.splice(this.cursor.y * this.width + this.cursor.x, 1);\n    }\n  }, {\n    key: 'deleteForward',\n    value: function deleteForward(n) {\n      n = Math.min(this.width, n);\n      for (var i = 0; i < n; i++) {\n        this.screen.splice((this.cursor.y + 1) * this.width, 0, [' ', TERM_DEFAULT_STYLE.slice()]);\n      }this.screen.splice(this.cursor.y * this.width + this.cursor.x, n);\n    }\n  }, {\n    key: 'clampCursor',\n    value: function clampCursor() {\n      if (this.cursor.x < 0) this.cursor.x = 0;\n      if (this.cursor.y < 0) this.cursor.y = 0;\n      if (this.cursor.x > this.width - 1) this.cursor.x = this.width - 1;\n      if (this.cursor.y > this.height - 1) this.cursor.y = this.height - 1;\n    }\n  }, {\n    key: 'handleParsed',\n    value: function handleParsed(action) {\n      if (action === 'write') {\n        this.writeChar(arguments.length <= 1 ? undefined : arguments[1]);\n      } else if (action === 'delete') {\n        this.deleteForward(arguments.length <= 1 ? undefined : arguments[1]);\n      } else if (action === 'insert-blanks') {\n        this.insertBlanks(arguments.length <= 1 ? undefined : arguments[1]); // FIXME undefined?\n      } else if (action === 'clear') {\n        this.clear();\n      } else if (action === 'bell') {\n        this.termScreen.load('U\\x01B');\n      } else if (action === 'back') {\n        this.moveBack();\n      } else if (action === 'new-line') {\n        this.newLine();\n        this.cursor.x = 0;\n      } else if (action === 'return') {\n        this.cursor.x = 0;\n      } else if (action === 'set-cursor') {\n        this.cursor.x = arguments.length <= 2 ? undefined : arguments[2];\n        this.cursor.y = arguments.length <= 1 ? undefined : arguments[1];\n        this.clampCursor();\n      } else if (action === 'move-cursor-y') {\n        this.cursor.y += arguments.length <= 1 ? undefined : arguments[1];\n        this.clampCursor();\n      } else if (action === 'move-cursor-x') {\n        this.cursor.x += arguments.length <= 1 ? undefined : arguments[1];\n        this.clampCursor();\n      } else if (action === 'move-cursor-line') {\n        this.cursor.x = 0;\n        this.cursor.y += arguments.length <= 1 ? undefined : arguments[1];\n        this.clampCursor();\n      } else if (action === 'set-cursor-x') {\n        this.cursor.x = arguments.length <= 1 ? undefined : arguments[1];\n      } else if (action === 'set-cursor-style') {\n        this.cursor.style = Math.max(0, Math.min(6, arguments.length <= 1 ? undefined : arguments[1]));\n      } else if (action === 'reset-style') {\n        this.style = TERM_DEFAULT_STYLE.slice();\n      } else if (action === 'add-attrs') {\n        this.style[2] |= arguments.length <= 1 ? undefined : arguments[1];\n      } else if (action === 'set-color-fg') {\n        this.style[0] = arguments.length <= 1 ? undefined : arguments[1];\n        this.style[2] |= 1;\n      } else if (action === 'set-color-bg') {\n        this.style[1] = arguments.length <= 1 ? undefined : arguments[1];\n        this.style[2] |= 1 << 1;\n      } else if (action === 'reset-color-fg') {\n        this.style[0] = 0;\n        if (this.style[2] & 1) this.style[2] ^= 1;\n      } else if (action === 'reset-color-bg') {\n        this.style[1] = 0;\n        if (this.style[2] & 1 << 1) this.style[2] ^= 1 << 1;\n      } else if (action === 'hide-cursor') {\n        this.cursor.visible = false;\n      } else if (action === 'show-cursor') {\n        this.cursor.visible = true;\n      }\n    }\n  }, {\n    key: 'write',\n    value: function write(text) {\n      this.parser.write(text);\n    }\n  }, {\n    key: 'getScreenOpts',\n    value: function getScreenOpts() {\n      var data = 'O';\n      data += encodeAsCodePoint(25);\n      data += encodeAsCodePoint(80);\n      data += encodeAsCodePoint(this.theme);\n      data += this.encodeColor(this.defaultFG);\n      data += this.encodeColor(this.defaultBG);\n      var attributes = +this.cursor.visible;\n      attributes |= (3 << 5) * +this.trackMouse; // track mouse controls both\n      attributes |= 3 << 7; // buttons/links always visible\n      attributes |= this.cursor.style << 9;\n      data += encodeAsCodePoint(attributes);\n      return data;\n    }\n  }, {\n    key: 'getButtons',\n    value: function getButtons() {\n      var data = 'B';\n      data += encodeAsCodePoint(this.buttonLabels.length);\n      data += this.buttonLabels.map(function (x) {\n        return '\\x01' + x + '\\x01';\n      }).join('');\n      return data;\n    }\n  }, {\n    key: 'getTitle',\n    value: function getTitle() {\n      return 'TESPTerm Web UI Demo\\x01';\n    }\n  }, {\n    key: 'getCursor',\n    value: function getCursor() {\n      var data = 'C';\n      data += encodeAsCodePoint(this.cursor.y);\n      data += encodeAsCodePoint(this.cursor.x);\n      data += encodeAsCodePoint(0);\n      return data;\n    }\n  }, {\n    key: 'encodeColor',\n    value: function encodeColor(color) {\n      if (color < 256) {\n        return encodeAsCodePoint(color);\n      } else {\n        color -= 256;\n        return encodeAsCodePoint(color & 0xFFF | 0x10000) + encodeAsCodePoint(color >> 12);\n      }\n    }\n  }, {\n    key: 'serializeScreen',\n    value: function serializeScreen() {\n      var serialized = 'S';\n      serialized += encodeAsCodePoint(0) + encodeAsCodePoint(0);\n      serialized += encodeAsCodePoint(this.height) + encodeAsCodePoint(this.width);\n\n      var lastStyle = [null, null, null];\n      var index = 0;\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.screen[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var cell = _step2.value;\n\n          var style = cell[1].slice();\n          if (this.rainbow) {\n            var x = index % this.width;\n            var y = Math.floor(index / this.width);\n            // C instead of F in mask and 1 << 8 in attrs to change attr bits 1 and 2\n            var t = (x + y) / 10 + Date.now() / 1000;\n            if (this.superRainbow) {\n              t = (x * y + Date.now()) / 100 + Date.now() / 1000;\n            }\n            style[0] = getRainbowColor(t);\n            style[1] = 0;\n            if (this.superRainbow) style[1] = getRainbowColor(t / 10);\n            style[2] = style[2] | 1;\n            if (!this.superRainbow && style[2] & 1 << 1) style[2] ^= 1 << 1;\n            index++;\n          }\n\n          var foreground = style[0];\n          var background = style[1];\n          var attributes = style[2];\n          var setForeground = foreground !== lastStyle[0];\n          var setBackground = background !== lastStyle[1];\n          var setAttributes = attributes !== lastStyle[2];\n\n          if (setForeground && setBackground) {\n            if (foreground < 256 && background < 256) {\n              serialized += '\\x03' + encodeAsCodePoint(background << 8 | foreground);\n            } else {\n              serialized += '\\x05' + this.encodeColor(foreground);\n              serialized += '\\x06' + this.encodeColor(background);\n            }\n          } else if (setForeground) serialized += '\\x05' + this.encodeColor(foreground);else if (setBackground) serialized += '\\x06' + this.encodeColor(background);\n          if (setAttributes) serialized += '\\x04' + encodeAsCodePoint(attributes);\n          lastStyle = style;\n\n          serialized += cell[0];\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return serialized;\n    }\n  }, {\n    key: 'getUpdate',\n    value: function getUpdate() {\n      var topics = 0;\n      var topicData = [];\n      var screenOpts = this.getScreenOpts();\n      var title = this.getTitle();\n      var buttons = this.getButtons();\n      var cursor = this.getCursor();\n      var screen = this.serializeScreen();\n      if (this._screenOpts !== screenOpts) {\n        this._screenOpts = screenOpts;\n        topicData.push(screenOpts);\n      }\n      if (this._title !== title) {\n        this._title = title;\n        topicData.push(title);\n      }\n      if (this._buttons !== buttons) {\n        this._buttons = buttons;\n        topicData.push(buttons);\n      }\n      if (this._cursor !== cursor) {\n        this._cursor = cursor;\n        topicData.push(cursor);\n      }\n      if (this._screen !== screen) {\n        this._screen = screen;\n        topicData.push(screen);\n      }\n      if (!topicData.length) return '';\n      return 'U' + encodeAsCodePoint(topics) + topicData.join('');\n    }\n  }, {\n    key: 'loadTimer',\n    value: function loadTimer() {\n      var _this2 = this;\n\n      clearInterval(this._loadTimer);\n      this._loadTimer = setInterval(function () {\n        var update = _this2.getUpdate();\n        if (update) _this2.termScreen.load(update);\n      }, 30);\n    }\n  }]);\n\n  return ScrollingTerminal;\n}();\n\nvar Process = function (_EventEmitter) {\n  _inherits(Process, _EventEmitter);\n\n  function Process() {\n    _classCallCheck(this, Process);\n\n    return _possibleConstructorReturn(this, (Process.__proto__ || Object.getPrototypeOf(Process)).apply(this, arguments));\n  }\n\n  _createClass(Process, [{\n    key: 'write',\n    value: function write(data) {\n      this.emit('in', data);\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy() {\n      // death.\n      this.emit('exit', 0);\n    }\n  }, {\n    key: 'run',\n    value: function run() {\n      // noop\n    }\n  }]);\n\n  return Process;\n}(EventEmitter);\n\nvar demoData = {\n  buttons: [],\n  mouseReceiver: null\n};\n\nvar demoshIndex = {\n  clear: function (_Process) {\n    _inherits(Clear, _Process);\n\n    function Clear() {\n      _classCallCheck(this, Clear);\n\n      return _possibleConstructorReturn(this, (Clear.__proto__ || Object.getPrototypeOf(Clear)).apply(this, arguments));\n    }\n\n    _createClass(Clear, [{\n      key: 'run',\n      value: function run() {\n        this.emit('write', '\\x1b[2J\\x1b[1;1H');\n        this.destroy();\n      }\n    }]);\n\n    return Clear;\n  }(Process),\n  screenfetch: function (_Process2) {\n    _inherits(Screenfetch, _Process2);\n\n    function Screenfetch() {\n      _classCallCheck(this, Screenfetch);\n\n      return _possibleConstructorReturn(this, (Screenfetch.__proto__ || Object.getPrototypeOf(Screenfetch)).apply(this, arguments));\n    }\n\n    _createClass(Screenfetch, [{\n      key: 'run',\n      value: function run() {\n        var _this6 = this;\n\n        var image = ('\\n ###.                          ESPTerm Demo\\n   \\'###.                       Hostname: ' + window.location.hostname + '\\n     \\'###.                     Shell: ESPTerm Demo Shell\\n       \\'###.                   Resolution: 80x25@' + window.devicePixelRatio + 'x\\n         :###-\\n       .###\\'\\n     .###\\'\\n   .###\\'      ###############\\n ###\\'         ###############\\n      ').split('\\n').filter(function (line) {\n          return line.trim();\n        });\n\n        var chars = '';\n        for (var y = 0; y < image.length; y++) {\n          for (var x = 0; x < 80; x++) {\n            if (image[y][x]) {\n              chars += '\\x1B[38;5;' + getRainbowColor((x + y) / 10) + 'm' + image[y][x];\n            } else chars += ' ';\n          }\n        }\n\n        this.emit('write', '\\r\\n\\x1b[?25l');\n        var loop = function loop() {\n          _this6.emit('write', chars.substr(0, 80));\n          chars = chars.substr(80);\n          if (chars.length) setTimeout(loop, 50);else {\n            _this6.emit('write', '\\r\\n\\x1b[?25h');\n            _this6.destroy();\n          }\n        };\n        loop();\n      }\n    }]);\n\n    return Screenfetch;\n  }(Process),\n  'local-echo': function (_Process3) {\n    _inherits(LocalEcho, _Process3);\n\n    function LocalEcho() {\n      _classCallCheck(this, LocalEcho);\n\n      return _possibleConstructorReturn(this, (LocalEcho.__proto__ || Object.getPrototypeOf(LocalEcho)).apply(this, arguments));\n    }\n\n    _createClass(LocalEcho, [{\n      key: 'run',\n      value: function run() {\n        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        if (!args.includes('--suppress-note')) {\n          this.emit('write', '\\x1b[38;5;239mNote: not all terminal features are supported and may not work as expected in this demo\\x1b[m\\n');\n        }\n        this.emit('buttons', [{\n          label: 'Exit',\n          action: function action(shell) {\n            shell.write('\\x03');\n          }\n        }]);\n      }\n    }, {\n      key: 'write',\n      value: function write(data) {\n        this.emit('write', data);\n      }\n    }]);\n\n    return LocalEcho;\n  }(Process),\n  info: function (_Process4) {\n    _inherits(Info, _Process4);\n\n    function Info() {\n      _classCallCheck(this, Info);\n\n      return _possibleConstructorReturn(this, (Info.__proto__ || Object.getPrototypeOf(Info)).apply(this, arguments));\n    }\n\n    _createClass(Info, [{\n      key: 'run',\n      value: function run() {\n        var _this9 = this;\n\n        for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n          args[_key2] = arguments[_key2];\n        }\n\n        var fast = args.includes('--fast');\n        this.showSplash().then(function () {\n          _this9.printText(fast);\n        });\n      }\n    }, {\n      key: 'showSplash',\n      value: function showSplash() {\n        var _this10 = this;\n\n        var splash = '\\n              -#####- -###*..#####- ######-\\n              -#*    -#-    .## .##.  *#-\\n              -##### .-###*..#####-   *#-  -*##*- #*-#--#**#-*##-\\n              -#*        -#-.##.      *#-  *##@#* ##.  -#* *# .#*\\n              -#####--####- .##.      *#-  -*#@@- ##.  -#* *# .#*\\n      '.split('\\n').filter(function (line) {\n          return line.trim();\n        });\n        var levels = {\n          ' ': -231,\n          '.': 4,\n          '-': 8,\n          '*': 17,\n          '#': 24\n        };\n        var characters = {\n          ' ': ' ',\n          '.': '░',\n          '-': '▒',\n          '*': '▓',\n          '#': '█'\n        };\n        for (var i in splash) {\n          if (splash[i].length < 79) splash[i] += ' '.repeat(79 - splash[i].length);\n        }\n        this.emit('write', '\\r\\n'.repeat(splash.length + 1));\n        this.emit('write', '\\x1b[A'.repeat(splash.length));\n        this.emit('write', '\\x1b[?25l');\n\n        var cursorX = 0;\n        var cursorY = 0;\n        var moveTo = function moveTo(x, y) {\n          var moveX = x - cursorX;\n          var moveY = y - cursorY;\n          _this10.emit('write', '\\x1B[' + Math.abs(moveX) + (moveX > 0 ? 'C' : 'D'));\n          _this10.emit('write', '\\x1B[' + Math.abs(moveY) + (moveY > 0 ? 'B' : 'A'));\n          cursorX = x;\n          cursorY = y;\n        };\n        var drawCell = function drawCell(x, y) {\n          moveTo(x, y);\n          if (splash[y][x] === '@') {\n            _this10.emit('write', '\\x1b[48;5;238m\\x1b[38;5;255m▄\\b');\n          } else {\n            var level = 231 + levels[splash[y][x]];\n            var character = characters[splash[y][x]];\n            _this10.emit('write', '\\x1B[48;5;' + level + 'm\\x1B[38;5;' + level + 'm' + character + '\\b');\n          }\n        };\n        return new Promise(function (resolve, reject) {\n          var self = _this10;\n          var x = 13;\n          var cycles = 0;\n          var loop = function loop() {\n            for (var y = 0; y < splash.length; y++) {\n              var dx = x - y;\n              if (dx > 0) drawCell(dx, y);\n            }\n\n            if (++x < 70) {\n              if (++cycles >= 3) {\n                setTimeout(loop, 50);\n                cycles = 0;\n              } else loop();\n            } else {\n              moveTo(0, splash.length);\n              self.emit('write', '\\x1b[m\\x1b[?25h');\n              resolve();\n            }\n          };\n          loop();\n        });\n      }\n    }, {\n      key: 'printText',\n      value: function printText() {\n        var fast = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n        // lots of printing\n        var parts = ['', '  ESPTerm is a VT100-like terminal emulator running on the ESP8266 WiFi chip.', '', '  \\x1b[93mThis is an online demo of the web user interface, simulating a simple ', '  terminal in your browser.\\x1b[m', '', '  Type \\x1b[92mls\\x1b[m to list available commands.', '  Use the \\x1b[94mlinks\\x1b[m below this screen for a demo of the options and more info.', ''];\n\n        if (fast) {\n          this.emit('write', parts.join('\\r\\n') + '\\r\\n');\n          this.destroy();\n        } else {\n          var self = this;\n          var loop = function loop() {\n            self.emit('write', parts.shift() + '\\r\\n');\n            if (parts.length) setTimeout(loop, 17);else self.destroy();\n          };\n          loop();\n        }\n      }\n    }]);\n\n    return Info;\n  }(Process),\n  colors: function (_Process5) {\n    _inherits(PrintColors, _Process5);\n\n    function PrintColors() {\n      _classCallCheck(this, PrintColors);\n\n      return _possibleConstructorReturn(this, (PrintColors.__proto__ || Object.getPrototypeOf(PrintColors)).apply(this, arguments));\n    }\n\n    _createClass(PrintColors, [{\n      key: 'run',\n      value: function run() {\n        this.emit('write', '\\r\\n');\n        var fgtext = 'foreground-color';\n        this.emit('write', '    ');\n        for (var i = 0; i < 16; i++) {\n          this.emit('write', '\\x1b[' + (i < 8 ? '3' + i : '9' + (i - 8)) + 'm');\n          this.emit('write', fgtext[i] + ' ');\n        }\n        this.emit('write', '\\r\\n    ');\n        for (var _i = 0; _i < 16; _i++) {\n          this.emit('write', '\\x1b[' + (_i < 8 ? '4' + _i : '10' + (_i - 8)) + 'm  ');\n        }\n        this.emit('write', '\\x1b[m\\r\\n');\n        for (var r = 0; r < 6; r++) {\n          this.emit('write', '    ');\n          for (var g = 0; g < 6; g++) {\n            for (var b = 0; b < 6; b++) {\n              this.emit('write', '\\x1B[48;5;' + (16 + r * 36 + g * 6 + b) + 'm  ');\n            }\n            this.emit('write', '\\x1b[m');\n          }\n          this.emit('write', '\\r\\n');\n        }\n        this.emit('write', '    ');\n        for (var _g = 0; _g < 24; _g++) {\n          this.emit('write', '\\x1B[48;5;' + (232 + _g) + 'm  ');\n        }\n        this.emit('write', '\\x1b[m\\r\\n\\n');\n        this.destroy();\n      }\n    }]);\n\n    return PrintColors;\n  }(Process),\n  ls: function (_Process6) {\n    _inherits(ListCommands, _Process6);\n\n    function ListCommands() {\n      _classCallCheck(this, ListCommands);\n\n      return _possibleConstructorReturn(this, (ListCommands.__proto__ || Object.getPrototypeOf(ListCommands)).apply(this, arguments));\n    }\n\n    _createClass(ListCommands, [{\n      key: 'run',\n      value: function run() {\n        this.emit('write', '\\x1b[92mList of demo commands\\x1b[m\\r\\n');\n        for (var i in demoshIndex) {\n          if (typeof demoshIndex[i] === 'string') continue;\n          this.emit('write', i + '\\r\\n');\n        }\n        this.destroy();\n      }\n    }]);\n\n    return ListCommands;\n  }(Process),\n  theme: function (_Process7) {\n    _inherits(SetTheme, _Process7);\n\n    function SetTheme(shell) {\n      _classCallCheck(this, SetTheme);\n\n      var _this13 = _possibleConstructorReturn(this, (SetTheme.__proto__ || Object.getPrototypeOf(SetTheme)).call(this));\n\n      _this13.shell = shell;\n      return _this13;\n    }\n\n    _createClass(SetTheme, [{\n      key: 'run',\n      value: function run() {\n        var theme = +(arguments.length <= 0 ? undefined : arguments[0]) | 0;\n        var maxnum = themes.length;\n        if (!arguments.length || !Number.isFinite(theme) || theme < 0 || theme >= maxnum) {\n          this.emit('write', '\\x1B[31mUsage: theme [0\\u2013' + (maxnum - 1) + ']\\n');\n          this.destroy();\n          return;\n        }\n        this.shell.terminal.theme = theme;\n        // HACK: reset drawn screen to prevent only partly redrawn screen\n        this.shell.terminal.termScreen.drawnScreenFG = [];\n        this.emit('write', '');\n        this.destroy();\n      }\n    }]);\n\n    return SetTheme;\n  }(Process),\n  themes: function (_Process8) {\n    _inherits(ShowThemes, _Process8);\n\n    function ShowThemes(shell) {\n      _classCallCheck(this, ShowThemes);\n\n      var _this14 = _possibleConstructorReturn(this, (ShowThemes.__proto__ || Object.getPrototypeOf(ShowThemes)).call(this));\n\n      _this14.shell = shell;\n      _this14.parser = new ANSIParser(function () {\n        return _this14.handler.apply(_this14, arguments);\n      });\n      return _this14;\n    }\n\n    _createClass(ShowThemes, [{\n      key: 'destroy',\n      value: function destroy() {\n        this.shell.terminal.cursor.style = this.savedCursorStyle;\n        this.emit('write', '\\n\\n');\n        _get(ShowThemes.prototype.__proto__ || Object.getPrototypeOf(ShowThemes.prototype), 'destroy', this).call(this);\n      }\n    }, {\n      key: 'run',\n      value: function run() {\n        var _this15 = this;\n\n        this.savedCursorStyle = this.shell.terminal.cursor.style;\n        this.shell.terminal.cursor.style = 3;\n\n        this.fgType = 0;\n        this.bgType = 0;\n\n        var get24FG = function get24FG() {\n          return _this15.shell.terminal.defaultFG - 256;\n        };\n        var set24FG = function set24FG(v) {\n          _this15.shell.terminal.defaultFG = v + 256;\n        };\n        var get24BG = function get24BG() {\n          return _this15.shell.terminal.defaultBG - 256;\n        };\n        var set24BG = function set24BG(v) {\n          _this15.shell.terminal.defaultBG = v + 256;\n        };\n\n        var make24Control = function make24Control(label, index, _getValue, _setValue, type) {\n          index *= 4;\n\n          return {\n            label: label,\n            length: 1,\n            getValue: function getValue() {\n              return _getValue() >> index & 0xF;\n            },\n            getDisplay: function getDisplay() {\n              return (_getValue() >> index & 0xF).toString(16);\n            },\n            setValue: function setValue(value) {\n              _setValue(_getValue() & (0xFFFFFF ^ 0xF << index) | (value & 0xF) << index);\n            },\n            shouldShow: function shouldShow() {\n              return _this15[type + 'Type'] === 1;\n            },\n            parseValue: function parseValue(input) {\n              return parseInt(input, 16) & 0xF;\n            },\n            moveAfterInput: index !== 0\n          };\n        };\n\n        this.controls = [{\n          label: 'Theme: ',\n          length: themes.length.toString().length,\n          getValue: function getValue() {\n            return _this15.shell.terminal.theme;\n          },\n          setValue: function setValue(value) {\n            var count = themes.length;\n            _this15.shell.terminal.theme = (value % count + count) % count;\n          }\n        }, {\n          label: ' Default Foreground: ',\n          length: 6,\n          getValue: function getValue() {\n            return _this15.fgType;\n          },\n          getDisplay: function getDisplay() {\n            return _this15.fgType === 0 ? '256' : '24-bit';\n          },\n          setValue: function setValue(value) {\n            _this15.fgType = (value % 2 + 2) % 2;\n          }\n        }, {\n          label: ' ',\n          length: 3,\n          getValue: function getValue() {\n            return _this15.shell.terminal.defaultFG & 0xFF;\n          },\n          setValue: function setValue(value) {\n            _this15.shell.terminal.defaultFG = value & 0xFF;\n          },\n          shouldShow: function shouldShow() {\n            return _this15.fgType === 0;\n          },\n          parseValue: function parseValue(input) {\n            return parseInt(input, 16);\n          }\n        }, make24Control(' #', 5, get24FG, set24FG, 'fg'), make24Control('', 4, get24FG, set24FG, 'fg'), make24Control('', 3, get24FG, set24FG, 'fg'), make24Control('', 2, get24FG, set24FG, 'fg'), make24Control('', 1, get24FG, set24FG, 'fg'), make24Control('', 0, get24FG, set24FG, 'fg'), {\n          label: ' Default Background: ',\n          length: 6,\n          getValue: function getValue() {\n            return _this15.bgType;\n          },\n          getDisplay: function getDisplay() {\n            return _this15.bgType === 0 ? '256' : '24-bit';\n          },\n          setValue: function setValue(value) {\n            _this15.bgType = (value % 2 + 2) % 2;\n          }\n        }, {\n          label: ' ',\n          length: 3,\n          getValue: function getValue() {\n            return _this15.shell.terminal.defaultBG & 0xFF;\n          },\n          setValue: function setValue(value) {\n            _this15.shell.terminal.defaultBG = value & 0xFF;\n          },\n          shouldShow: function shouldShow() {\n            return _this15.bgType === 0;\n          },\n          parseValue: function parseValue(input) {\n            return parseInt(input, 16);\n          }\n        }, make24Control(' #', 5, get24BG, set24BG, 'bg'), make24Control('', 4, get24BG, set24BG, 'bg'), make24Control('', 3, get24BG, set24BG, 'bg'), make24Control('', 2, get24BG, set24BG, 'bg'), make24Control('', 1, get24BG, set24BG, 'bg'), make24Control('', 0, get24BG, set24BG, 'bg')];\n        this.selection = 0;\n\n        this.emit('write', '\\x1b[1mThemes\\x1b[m\\n\\n\\n\\n\\x1b[2A');\n\n        this.render();\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        this.emit('write', '\\x1b[m\\r');\n        // no ^[2K implementation, here's a hack\n        this.emit('write', ' '.repeat(this.shell.terminal.width - 1) + '\\r');\n\n        var index = 0;\n        var selectedX = 0;\n        var _iteratorNormalCompletion3 = true;\n        var _didIteratorError3 = false;\n        var _iteratorError3 = undefined;\n\n        try {\n          for (var _iterator3 = this.controls[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n            var control = _step3.value;\n\n            if (control.shouldShow && !control.shouldShow()) continue;\n            if (control.label) {\n              this.emit('write', '\\x1B[1m' + control.label + '\\x1B[m');\n            }\n            // TODO: colors\n            this.emit('write', '\\x1b[38;5;255m\\x1b[48;5;16m');\n            var value = control.getDisplay ? control.getDisplay() : control.getValue().toString();\n            this.emit('write', (control.fill || ' ').repeat(Math.max(0, control.length - value.length)));\n            this.emit('write', value.substr(0, control.length));\n            this.emit('write', '\\x1b[m');\n\n            if (index === this.selection) {\n              selectedX = this.shell.terminal.cursor.x - 1;\n\n              // draw arrows\n              this.emit('write', '\\x1b[m\\x1b[D\\x1b[A▲\\x1b[D\\x1b[2B▼\\x1b[A');\n            } else {\n              // clear arrows if they were there\n              this.emit('write', '\\x1b[m\\x1b[D\\x1b[A \\x1b[D\\x1b[2B \\x1b[A');\n            }\n\n            index++;\n          }\n        } catch (err) {\n          _didIteratorError3 = true;\n          _iteratorError3 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion3 && _iterator3.return) {\n              _iterator3.return();\n            }\n          } finally {\n            if (_didIteratorError3) {\n              throw _iteratorError3;\n            }\n          }\n        }\n\n        this.shell.terminal.cursor.x = selectedX;\n      }\n    }, {\n      key: 'write',\n      value: function write(data) {\n        this.parser.write(data);\n      }\n    }, {\n      key: 'getControlCount',\n      value: function getControlCount() {\n        var count = 0;\n        var _iteratorNormalCompletion4 = true;\n        var _didIteratorError4 = false;\n        var _iteratorError4 = undefined;\n\n        try {\n          for (var _iterator4 = this.controls[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n            var control = _step4.value;\n\n            if (control.shouldShow && !control.shouldShow()) continue;\n            count++;\n          }\n        } catch (err) {\n          _didIteratorError4 = true;\n          _iteratorError4 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion4 && _iterator4.return) {\n              _iterator4.return();\n            }\n          } finally {\n            if (_didIteratorError4) {\n              throw _iteratorError4;\n            }\n          }\n        }\n\n        return count;\n      }\n    }, {\n      key: 'getSelectedControl',\n      value: function getSelectedControl() {\n        var selected = null;\n        var index = 0;\n        var _iteratorNormalCompletion5 = true;\n        var _didIteratorError5 = false;\n        var _iteratorError5 = undefined;\n\n        try {\n          for (var _iterator5 = this.controls[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n            var control = _step5.value;\n\n            if (control.shouldShow && !control.shouldShow()) continue;\n            if (index === this.selection) {\n              selected = control;\n              break;\n            }\n            index++;\n          }\n        } catch (err) {\n          _didIteratorError5 = true;\n          _iteratorError5 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion5 && _iterator5.return) {\n              _iterator5.return();\n            }\n          } finally {\n            if (_didIteratorError5) {\n              throw _iteratorError5;\n            }\n          }\n        }\n\n        return selected;\n      }\n    }, {\n      key: 'handler',\n      value: function handler(action) {\n        var _console;\n\n        for (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n          args[_key3 - 1] = arguments[_key3];\n        }\n\n        (_console = console).log.apply(_console, [action].concat(args));\n\n        if (action === 'move-cursor-x') {\n          this.selection += args[0];\n          var count = this.getControlCount();\n          this.selection = (this.selection % count + count) % count;\n        } else if (action === 'move-cursor-y') {\n          var control = this.getSelectedControl();\n          if (control) control.setValue(control.getValue() - args[0]);\n        } else if (action === 'write') {\n          var _control = this.getSelectedControl();\n          if (_control && _control.parseValue) {\n            var parsed = _control.parseValue(args[0]);\n            if (Number.isFinite(parsed)) {\n              _control.setValue(parsed);\n              if (_control.moveAfterInput) {\n                if (this.selection < this.getControlCount() - 1) this.selection++;\n              }\n            }\n          }\n        }\n\n        this.render();\n      }\n    }]);\n\n    return ShowThemes;\n  }(Process),\n  cursor: function (_Process9) {\n    _inherits(SetCursor, _Process9);\n\n    function SetCursor() {\n      _classCallCheck(this, SetCursor);\n\n      return _possibleConstructorReturn(this, (SetCursor.__proto__ || Object.getPrototypeOf(SetCursor)).apply(this, arguments));\n    }\n\n    _createClass(SetCursor, [{\n      key: 'run',\n      value: function run() {\n        for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n          args[_key4] = arguments[_key4];\n        }\n\n        var steady = args.includes('--steady');\n        if (args.includes('block')) {\n          this.emit('write', '\\x1B[' + 2 * steady + ' q');\n        } else if (args.includes('line')) {\n          this.emit('write', '\\x1B[' + (3 + steady) + ' q');\n        } else if (args.includes('bar') || args.includes('beam')) {\n          this.emit('write', '\\x1B[' + (5 + steady) + ' q');\n        } else {\n          this.emit('write', '\\x1b[31mUsage: cursor [block|line|bar] [--steady]\\r\\n');\n        }\n        this.destroy();\n      }\n    }]);\n\n    return SetCursor;\n  }(Process),\n  rainbow: function (_Process10) {\n    _inherits(ToggleRainbow, _Process10);\n\n    function ToggleRainbow(shell) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      _classCallCheck(this, ToggleRainbow);\n\n      var _this17 = _possibleConstructorReturn(this, (ToggleRainbow.__proto__ || Object.getPrototypeOf(ToggleRainbow)).call(this));\n\n      _this17.shell = shell;\n      _this17.su = options.su;\n      _this17.abort = false;\n      return _this17;\n    }\n\n    _createClass(ToggleRainbow, [{\n      key: 'write',\n      value: function write(data) {\n        var newLine = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n        if (data === 'y') {\n          this.shell.terminal.rainbow = !this.shell.terminal.rainbow;\n          this.shell.terminal.superRainbow = true;\n          demoData._didWarnRainbow = true;\n        } else {\n          this.emit('write', data);\n        }\n        if (newLine) this.emit('write', '\\x1b[0;32m\\x1b[G\\x1b[79PRainbow!\\n');\n        this.destroy();\n      }\n    }, {\n      key: 'run',\n      value: function run() {\n        if (this.su && !this.shell.terminal.rainbow) {\n          if (!demoData._didWarnRainbow) {\n            this.emit('write', '\\x1b[31;1mWarning: flashy colors. Continue? [y/N] ');\n          } else {\n            this.write('y', false);\n          }\n        } else {\n          this.shell.terminal.rainbow = !this.shell.terminal.rainbow;\n          this.shell.terminal.superRainbow = false;\n          this.destroy();\n        }\n      }\n    }, {\n      key: 'destroy',\n      value: function destroy() {\n        this.abort = true;\n        _get(ToggleRainbow.prototype.__proto__ || Object.getPrototypeOf(ToggleRainbow.prototype), 'destroy', this).call(this);\n      }\n    }]);\n\n    return ToggleRainbow;\n  }(Process),\n  mouse: function (_Process11) {\n    _inherits(MouseDemo, _Process11);\n\n    function MouseDemo(shell) {\n      _classCallCheck(this, MouseDemo);\n\n      var _this18 = _possibleConstructorReturn(this, (MouseDemo.__proto__ || Object.getPrototypeOf(MouseDemo)).call(this));\n\n      _this18.shell = shell;\n      return _this18;\n    }\n\n    _createClass(MouseDemo, [{\n      key: 'run',\n      value: function run() {\n        var _this19 = this;\n\n        var self = this;\n        this.emit('buttons', [{\n          label: 'Exit',\n          action: function action(shell) {\n            shell.write('\\x03');\n          }\n        }, {\n          label: 'Add Box',\n          action: function action() {\n            self.boxes.push(self.generateRandomBox());\n            self.render();\n          }\n        }]);\n\n        this.shell.terminal.trackMouse = true;\n        demoData.mouseReceiver = this;\n\n        this.boxes = Array(3).fill(0).map(function (x) {\n          return _this19.generateRandomBox();\n        });\n        this.grabbedBox = null;\n        this.grabOffset = [0, 0];\n\n        this.render();\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        this.emit('write', '\\x1b[m\\x1b[2J\\x1b[1;1H');\n        this.emit('write', '\\x1b[97m\\x1b[1mMouse Demo\\r\\n\\x1b[mMove boxes around or scroll their contents!');\n\n        // draw boxes\n        var _iteratorNormalCompletion6 = true;\n        var _didIteratorError6 = false;\n        var _iteratorError6 = undefined;\n\n        try {\n          for (var _iterator6 = this.boxes[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n            var box = _step6.value;\n\n            this.emit('write', '\\x1B[' + (box.y + 1) + ';' + (box.x + 1) + 'H');\n            this.emit('write', '\\x1B[m\\x1B[48;2;' + box.color.join(';') + 'm');\n            for (var y = box.y; y < box.y + box.height; y++) {\n              var drawnX = 0;\n              for (var x = box.x; x < box.x + box.width; x++) {\n                if (x < 0 || x >= this.shell.terminal.width - 1) continue;\n                if (y < 0 || y >= this.shell.terminal.height) continue;\n                drawnX++;\n                this.emit('write', box.content[y - box.y][x - box.x]);\n              }\n              this.emit('write', '\\x1b[D'.repeat(drawnX) + '\\x1b[B');\n            }\n          }\n\n          // move cursor to mouse\n        } catch (err) {\n          _didIteratorError6 = true;\n          _iteratorError6 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion6 && _iterator6.return) {\n              _iterator6.return();\n            }\n          } finally {\n            if (_didIteratorError6) {\n              throw _iteratorError6;\n            }\n          }\n        }\n\n        if (this.mouse) {\n          this.emit('write', '\\x1B[' + (this.mouse.y + 1) + ';' + (this.mouse.x + 1) + 'H');\n        }\n      }\n    }, {\n      key: 'generateRandomBox',\n      value: function generateRandomBox() {\n        var chars = 'abcdefghijklmnopqrstuvwxyz-*()!@#$%';\n        var content = [];\n        var width = [5, 10, 15][Math.floor(Math.random() * 3)];\n        var height = [4, 5, 6][Math.floor(Math.random() * 3)];\n\n        for (var y = 0; y < height; y++) {\n          content.push('');\n          for (var x = 0; x < width; x++) {\n            if (Math.random() > 0.6) {\n              content[y] += chars[Math.floor(Math.random() * chars.length)];\n            } else content[y] += ' ';\n          }\n        }\n\n        return {\n          x: Math.floor(Math.random() * (this.shell.terminal.width - 1)) + 1,\n          y: Math.floor(Math.random() * (this.shell.terminal.height - 1)) + 1,\n          width: width,\n          height: height,\n          color: [Math.random(), Math.random(), Math.random()].map(function (x) {\n            return Math.floor(x * 255);\n          }),\n          content: content\n        };\n      }\n    }, {\n      key: 'getBoxAt',\n      value: function getBoxAt(x, y) {\n        var boxes = this.boxes.slice().reverse(); // top to bottom, like drawing order\n        var _iteratorNormalCompletion7 = true;\n        var _didIteratorError7 = false;\n        var _iteratorError7 = undefined;\n\n        try {\n          for (var _iterator7 = boxes[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n            var box = _step7.value;\n\n            if (box.x <= x && box.x + box.width > x && box.y <= y && box.y + box.height > y) {\n              return box;\n            }\n          }\n        } catch (err) {\n          _didIteratorError7 = true;\n          _iteratorError7 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion7 && _iterator7.return) {\n              _iterator7.return();\n            }\n          } finally {\n            if (_didIteratorError7) {\n              throw _iteratorError7;\n            }\n          }\n        }\n      }\n    }, {\n      key: 'mouseMove',\n      value: function mouseMove(x, y) {\n        this.mouse = { x: x, y: y };\n        if (this.grabbedBox) {\n          this.grabbedBox.x = x + this.grabOffset[0];\n          this.grabbedBox.y = y + this.grabOffset[1];\n        }\n        this.render();\n      }\n    }, {\n      key: 'mouseDown',\n      value: function mouseDown(x, y, button) {\n        if (button === 4) this.scrollInsideBox(this.getBoxAt(x, y), -1);else if (button === 5) this.scrollInsideBox(this.getBoxAt(x, y), 1);else {\n          var box = this.getBoxAt(x, y);\n          if (box) {\n            var _boxes;\n\n            this.grabbedBox = box;\n            this.grabOffset = [box.x - x, box.y - y];\n            // move grabbed box to top of stack\n            (_boxes = this.boxes).push.apply(_boxes, _toConsumableArray(this.boxes.splice(this.boxes.indexOf(box), 1)));\n          }\n        }\n        this.render();\n      }\n    }, {\n      key: 'mouseUp',\n      value: function mouseUp(x, y, button) {\n        this.grabbedBox = null;\n      }\n    }, {\n      key: 'scrollInsideBox',\n      value: function scrollInsideBox(box, amount) {\n        if (!box) return;\n        var content = box.content.slice();\n        box.content = [];\n        for (var i = 0; i < content.length; i++) {\n          box.content.push(content[(i + amount % content.length + content.length) % content.length]);\n        }\n      }\n    }, {\n      key: 'destroy',\n      value: function destroy() {\n        this.shell.terminal.write('\\x1b[m\\x1b[2J\\x1b[1;1H');\n        this.shell.terminal.trackMouse = false;\n        if (demoData.mouseReceiver === this) demoData.mouseReceiver = null;\n        _get(MouseDemo.prototype.__proto__ || Object.getPrototypeOf(MouseDemo.prototype), 'destroy', this).call(this);\n      }\n    }]);\n\n    return MouseDemo;\n  }(Process),\n  sudo: function (_Process12) {\n    _inherits(Sudo, _Process12);\n\n    function Sudo(shell) {\n      _classCallCheck(this, Sudo);\n\n      var _this20 = _possibleConstructorReturn(this, (Sudo.__proto__ || Object.getPrototypeOf(Sudo)).call(this));\n\n      _this20.shell = shell;\n      _this20.didDestroy = false;\n      return _this20;\n    }\n\n    _createClass(Sudo, [{\n      key: 'run',\n      value: function run() {\n        var _this21 = this;\n\n        for (var _len5 = arguments.length, args = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n          args[_key5] = arguments[_key5];\n        }\n\n        if (args.length === 0) {\n          this.emit('write', '\\x1b[31mUsage: sudo [command]\\x1b[m\\r\\n');\n          this.destroy();\n        } else {\n          var name = args.shift();\n          if (this.shell.index[name]) {\n            var _Process13 = this.shell.index[name];\n            if (_Process13 instanceof Function) {\n              var child = this.child = new _Process13(this.shell, { su: true });\n              this.on('in', function (data) {\n                return child.write(data);\n              });\n              var write = function write(data) {\n                return _this21.emit('write', data);\n              };\n              var setButtons = function setButtons(buttons) {\n                return _this21.emit('buttons', buttons);\n              };\n              child.on('write', write);\n              child.on('buttons', setButtons);\n              child.on('exit', function (code) {\n                child.removeListener('write', write);\n                child.removeListener('buttons', setButtons);\n                _this21.destroy();\n              });\n              child.run.apply(child, args);\n            } else {\n              this.emit('write', _Process13);\n              this.destroy();\n            }\n          } else {\n            this.emit('write', 'sudo: ' + name + ': command not found\\r\\n');\n            this.destroy();\n          }\n        }\n      }\n    }, {\n      key: 'destroy',\n      value: function destroy() {\n        if (this.didDestroy) return;\n        this.didDestroy = true;\n        if (this.child) this.child.destroy();\n        _get(Sudo.prototype.__proto__ || Object.getPrototypeOf(Sudo.prototype), 'destroy', this).call(this);\n      }\n    }]);\n\n    return Sudo;\n  }(Process),\n  make: function (_Process14) {\n    _inherits(Make, _Process14);\n\n    function Make(shell) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      _classCallCheck(this, Make);\n\n      var _this22 = _possibleConstructorReturn(this, (Make.__proto__ || Object.getPrototypeOf(Make)).call(this));\n\n      _this22.su = options.su;\n      return _this22;\n    }\n\n    _createClass(Make, [{\n      key: 'run',\n      value: function run() {\n        for (var _len6 = arguments.length, args = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n          args[_key6] = arguments[_key6];\n        }\n\n        if (args.length === 0) this.emit('write', '\\x1b[31mmake: *** No targets specified.  Stop.\\x1b[0m\\r\\n');else if (args.length === 3 && args.join(' ').toLowerCase() === 'me a sandwich') {\n          if (this.su) {\n            var b = '\\x1b[33m';\n            var r = '\\x1b[0m';\n            var l = '\\x1b[32m';\n            var c = '\\x1b[38;5;229m';\n            var h = '\\x1b[38;5;225m';\n            this.emit('write', '                    ' + b + '_.---._\\r\\n' + '                _.-~       ~-._\\r\\n' + '            _.-~               ~-._\\r\\n' + '        _.-~                       ~---._\\r\\n' + '    _.-~                                 ~\\\\\\r\\n' + ' .-~                                    _.;\\r\\n' + ' :-._                               _.-~ ./\\r\\n' + ' `-._~-._                   _..__.-~ _.-~\\r\\n' + ('  ' + c + '/  ' + b + '~-._~-._              / .__..--' + c + '~-' + l + '---._\\r\\n') + (c + ' \\\\_____(_' + b + ';-._\\\\.        _.-~_/' + c + '       ~)' + l + '.. . \\\\\\r\\n') + (l + '    /(_____  ' + b + '\\\\`--...--~_.-~' + c + '______..-+' + l + '_______)\\r\\n') + (l + '  .(_________/' + b + '`--...--~/' + l + '    _/ ' + h + '          ' + b + '/\\\\\\r\\n') + (b + ' /-._' + h + '     \\\\_     ' + l + '(___./_..-~' + h + '__.....' + b + '__..-~./\\r\\n') + (b + ' `-._~-._' + h + '   ~\\\\--------~  .-~' + b + '_..__.-~ _.-~\\r\\n') + (b + '     ~-._~-._ ' + h + '~---------`  ' + b + '/ .__..--~\\r\\n') + (b + '         ~-._\\\\.        _.-~_/\\r\\n') + (b + '             \\\\`--...--~_.-~\\r\\n') + (b + '              `--...--~' + r + '\\r\\n'));\n          } else {\n            this.emit('write', '\\x1b[31mmake: me a sandwich : Permission denied\\x1b[0m\\r\\n');\n          }\n        } else {\n          this.emit('write', '\\x1B[31mmake: *** No rule to make target \\'' + args.join(' ').toLowerCase() + '\\'.  Stop.\\x1B[0m\\r\\n');\n        }\n        this.destroy();\n      }\n    }]);\n\n    return Make;\n  }(Process),\n  pwd: '/this/is/a/demo\\r\\n',\n  cd: '\\x1b[38;5;239mNo directories to change to\\r\\n',\n  whoami: window.navigator.userAgent + '\\r\\n',\n  hostname: '' + window.location.hostname,\n  uname: 'ESPTerm Demo\\r\\n',\n  mkdir: '\\x1b[38;5;239mDid not create a directory because this is a demo.\\r\\n',\n  rm: '\\x1b[38;5;239mDid not delete anything because this is a demo.\\r\\n',\n  cp: '\\x1b[38;5;239mNothing to copy because this is a demo.\\r\\n',\n  mv: '\\x1b[38;5;239mNothing to move because this is a demo.\\r\\n',\n  ln: '\\x1b[38;5;239mNothing to link because this is a demo.\\r\\n',\n  touch: '\\x1b[38;5;239mNothing to touch\\r\\n',\n  exit: '\\x1b[38;5;239mNowhere to go\\r\\n',\n  github: function (_Process15) {\n    _inherits(GoToGithub, _Process15);\n\n    function GoToGithub() {\n      _classCallCheck(this, GoToGithub);\n\n      return _possibleConstructorReturn(this, (GoToGithub.__proto__ || Object.getPrototypeOf(GoToGithub)).apply(this, arguments));\n    }\n\n    _createClass(GoToGithub, [{\n      key: 'run',\n      value: function run() {\n        window.open('https://github.com/espterm/espterm-firmware');\n        this.destroy();\n      }\n    }]);\n\n    return GoToGithub;\n  }(Process)\n};\nvar autocompleteIndex = {\n  'local-echo': 'local-echo [--suppress-note]',\n  theme: 'theme [n]',\n  cursor: 'cursor [block|line|bar] [--steady]',\n  sudo: 'sudo [command]'\n};\n\nvar DemoShell = function () {\n  function DemoShell(terminal, printInfo) {\n    var _this24 = this;\n\n    _classCallCheck(this, DemoShell);\n\n    this.terminal = terminal;\n    this.terminal.reset();\n    this.parser = new ANSIParser(function () {\n      return _this24.handleParsed.apply(_this24, arguments);\n    });\n    this.history = [];\n    this.historyIndex = 0;\n    this.cursorPos = 0;\n    this.lastInputLength = 0;\n    this.child = null;\n    this.index = demoshIndex;\n\n    if (printInfo) this.run('info');else this.prompt();\n  }\n\n  _createClass(DemoShell, [{\n    key: 'write',\n    value: function write(text) {\n      if (this.child) {\n        if (text.codePointAt(0) === 3) this.child.destroy();else this.child.write(text);\n      } else this.parser.write(text);\n    }\n  }, {\n    key: 'prompt',\n    value: function prompt() {\n      var success = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n      if (this.terminal.cursor.x !== 0) this.terminal.write('\\x1b[m\\x1b[38;5;238m⏎\\r\\n');\n      this.terminal.write('\\x1b[34;1mdemosh \\x1b[m');\n      if (!success) this.terminal.write('\\x1b[31m');\n      this.terminal.write('$ \\x1b[m');\n      this.history.unshift('');\n      this.cursorPos = 0;\n\n      this.setButtons();\n    }\n  }, {\n    key: 'copyFromHistoryIndex',\n    value: function copyFromHistoryIndex() {\n      if (!this.historyIndex) return;\n      var current = this.history[this.historyIndex];\n      this.history[0] = current;\n      this.historyIndex = 0;\n    }\n  }, {\n    key: 'getCompleted',\n    value: function getCompleted() {\n      var visual = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (this.history[0]) {\n        var input = this.history[0];\n        var prefix = '';\n        if (input.startsWith('sudo ')) {\n          var newInput = input.replace(/^(sudo\\s+)+/, '');\n          prefix = input.substr(0, input.length - newInput.length);\n          input = newInput;\n        }\n        if (!input) return null;\n        for (var name in this.index) {\n          if (name.startsWith(input) && name !== input) {\n            if (visual && name in autocompleteIndex) return prefix + autocompleteIndex[name];\n            return prefix + name;\n          }\n        }\n        return null;\n      }\n      return null;\n    }\n  }, {\n    key: 'handleParsed',\n    value: function handleParsed(action) {\n      this.terminal.write('\\x1B[' + (this.lastInputLength - this.cursorPos) + 'P');\n      this.terminal.write('\\b\\x1b[P'.repeat(this.cursorPos));\n\n      if (action === 'write') {\n        this.copyFromHistoryIndex();\n        this.history[0] = this.history[0].substr(0, this.cursorPos) + (arguments.length <= 1 ? undefined : arguments[1]) + this.history[0].substr(this.cursorPos);\n        this.cursorPos++;\n      } else if (action === 'back') {\n        this.copyFromHistoryIndex();\n        this.history[0] = this.history[0].substr(0, this.cursorPos - 1) + this.history[0].substr(this.cursorPos);\n        this.cursorPos--;\n        if (this.cursorPos < 0) this.cursorPos = 0;\n      } else if (action === 'tab') {\n        var _completed = this.getCompleted();\n        if (_completed) {\n          this.history[0] = _completed;\n          this.cursorPos = this.history[0].length;\n        }\n      } else if (action === 'move-cursor-x') {\n        this.cursorPos = Math.max(0, Math.min(this.history[this.historyIndex].length, this.cursorPos + (arguments.length <= 1 ? undefined : arguments[1])));\n      } else if (action === 'delete-line') {\n        this.copyFromHistoryIndex();\n        this.history[0] = '';\n        this.cursorPos = 0;\n      } else if (action === 'delete-word') {\n        this.copyFromHistoryIndex();\n        var words = this.history[0].substr(0, this.cursorPos).split(' ');\n        words.pop();\n        this.history[0] = words.join(' ') + this.history[0].substr(this.cursorPos);\n        this.cursorPos = words.join(' ').length;\n      } else if (action === 'move-cursor-y') {\n        this.historyIndex -= arguments.length <= 1 ? undefined : arguments[1];\n        if (this.historyIndex < 0) this.historyIndex = 0;\n        if (this.historyIndex >= this.history.length) this.historyIndex = this.history.length - 1;\n        this.cursorPos = this.history[this.historyIndex].length;\n      }\n\n      this.terminal.write(this.history[this.historyIndex]);\n      this.terminal.write('\\b'.repeat(this.history[this.historyIndex].length));\n      this.terminal.moveForward(this.cursorPos);\n\n      this.lastInputLength = this.cursorPos;\n\n      var completed = this.getCompleted(true);\n      if (this.historyIndex === 0 && completed && action !== 'return') {\n        // show closest match faintly\n        var rest = completed.substr(this.history[0].length);\n        this.terminal.write('\\x1B[2m' + rest + '\\x1B[m' + '\\b'.repeat(rest.length));\n        this.lastInputLength += rest.length;\n      }\n\n      if (action === 'return') {\n        this.terminal.write('\\n');\n        this.parse(this.history[this.historyIndex]);\n      }\n    }\n  }, {\n    key: 'parse',\n    value: function parse(input) {\n      if (input === 'help') input = 'info';\n      // TODO: basic chaining (i.e. semicolon)\n      if (input) this.run(input);else this.prompt();\n    }\n  }, {\n    key: 'run',\n    value: function run(command) {\n      var parts = [''];\n\n      var inQuote = false;\n      var _iteratorNormalCompletion8 = true;\n      var _didIteratorError8 = false;\n      var _iteratorError8 = undefined;\n\n      try {\n        for (var _iterator8 = command.trim()[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n          var character = _step8.value;\n\n          if (inQuote && character !== inQuote) {\n            parts[parts.length - 1] += character;\n          } else if (inQuote) {\n            inQuote = false;\n          } else if (character === '\"' || character === \"'\") {\n            inQuote = character;\n          } else if (character.match(/\\s/)) {\n            if (parts[parts.length - 1]) parts.push('');\n          } else parts[parts.length - 1] += character;\n        }\n      } catch (err) {\n        _didIteratorError8 = true;\n        _iteratorError8 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion8 && _iterator8.return) {\n            _iterator8.return();\n          }\n        } finally {\n          if (_didIteratorError8) {\n            throw _iteratorError8;\n          }\n        }\n      }\n\n      var name = parts.shift();\n\n      if (name in this.index) {\n        this.spawn(name, parts);\n      } else {\n        this.terminal.write('demosh: Unknown command: ' + name + '\\r\\n');\n        this.prompt(false);\n      }\n    }\n  }, {\n    key: 'spawn',\n    value: function spawn(name) {\n      var _this25 = this;\n\n      var args = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n      var Process = this.index[name];\n      if (Process instanceof Function) {\n        var _child;\n\n        this.setButtons([]);\n        this.child = new Process(this);\n        var write = function write(data) {\n          return _this25.terminal.write(data);\n        };\n        var setButtons = function setButtons(buttons) {\n          return _this25.setButtons(buttons);\n        };\n        this.child.on('write', write);\n        this.child.on('buttons', setButtons);\n        this.child.on('exit', function (code) {\n          if (_this25.child) {\n            _this25.child.removeListener('write', write);\n            _this25.child.removeListener('buttons', setButtons);\n          }\n          _this25.child = null;\n          _this25.prompt(!code);\n        });\n        (_child = this.child).run.apply(_child, _toConsumableArray(args));\n      } else {\n        this.terminal.write(Process);\n        this.prompt();\n      }\n    }\n  }, {\n    key: 'setButtons',\n    value: function setButtons(buttons) {\n      if (!buttons) {\n        var shell = this;\n        var writeChars = function writeChars(chars) {\n          var loop = function loop() {\n            shell.write(chars[0]);\n            chars = chars.substr(1);\n            if (chars) setTimeout(loop, 100);\n          };\n          setTimeout(loop, 200);\n        };\n\n        buttons = [{\n          label: 'Open GitHub',\n          action: function action(shell) {\n            if (shell.child) shell.child.destroy();\n            writeChars('github\\r');\n          }\n        }, {\n          label: 'Help',\n          action: function action(shell) {\n            if (shell.child) shell.child.destroy();\n            writeChars('info\\r');\n          }\n        }];\n      }\n      if (!buttons.length) buttons.push({ label: '', action: function action() {}\n      });\n      this.buttons = buttons;\n      this.terminal.buttonLabels = buttons.map(function (x) {\n        return x.label;\n      });\n    }\n  }, {\n    key: 'onButtonPress',\n    value: function onButtonPress(index) {\n      var button = this.buttons[index];\n      if (!button) return;\n      button.action(this, this.terminal);\n    }\n  }]);\n\n  return DemoShell;\n}();\n\nwindow.demoInterface = module.exports = {\n  input: function input(data) {\n    var type = data[0];\n    var content = data.substr(1);\n\n    if (type === 's') {\n      this.shell.write(content);\n    } else if (type === 'b') {\n      var button = content.charCodeAt(0);\n      this.shell.onButtonPress(button - 1);\n    } else if (type === 'm' || type === 'p' || type === 'r') {\n      var row = parse2B(content, 0);\n      var column = parse2B(content, 2);\n      var _button = parse2B(content, 4);\n      var modifiers = parse2B(content, 6);\n\n      if (demoData.mouseReceiver) {\n        if (type === 'm') demoData.mouseReceiver.mouseMove(column, row, _button, modifiers);else if (type === 'p') demoData.mouseReceiver.mouseDown(column, row, _button, modifiers);else if (type === 'r') demoData.mouseReceiver.mouseUp(column, row, _button, modifiers);\n      }\n    }\n  },\n\n  didInit: false,\n  init: function init(screen) {\n    if (this.didInit) return;\n    this.didInit = true;\n    this.terminal = new ScrollingTerminal(screen);\n    this.shell = new DemoShell(this.terminal, true);\n  }\n};\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar data = __webpack_require__(14);\n\nmodule.exports = function localize(key) {\n  return data[key] || '?' + key + '?';\n};\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n__webpack_require__(11);\n__webpack_require__(4);\n__webpack_require__(5);\n__webpack_require__(12);\ntry {\n  __webpack_require__(8);\n} catch (err) {}\n__webpack_require__(13);\n__webpack_require__(15);\n\nvar $ = __webpack_require__(1);\n\nvar _require = __webpack_require__(0),\n    qs = _require.qs;\n\n/* Export stuff to the global scope for inline scripts */\n\n\nwindow.termInit = __webpack_require__(16);\nwindow.$ = $;\nwindow.qs = qs;\n\nwindow.themes = __webpack_require__(3);\n\nwindow.TermConf = __webpack_require__(27);\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */\nif (!String.fromCodePoint) {\n  (function () {\n    var defineProperty = function () {\n      // IE 8 only supports `Object.defineProperty` on DOM elements\n      try {\n        var object = {};\n        var $defineProperty = Object.defineProperty;\n        var result = $defineProperty(object, object, object) && $defineProperty;\n      } catch (error) {}\n      return result;\n    }();\n    var stringFromCharCode = String.fromCharCode;\n    var floor = Math.floor;\n    var fromCodePoint = function fromCodePoint() {\n      var MAX_SIZE = 0x4000;\n      var codeUnits = [];\n      var highSurrogate;\n      var lowSurrogate;\n      var index = -1;\n      var length = arguments.length;\n      if (!length) {\n        return '';\n      }\n      var result = '';\n      while (++index < length) {\n        var codePoint = Number(arguments[index]);\n        if (!isFinite(codePoint) || // `NaN`, `+Infinity`, or `-Infinity`\n        codePoint < 0 || // not a valid Unicode code point\n        codePoint > 0x10FFFF || // not a valid Unicode code point\n        floor(codePoint) != codePoint // not an integer\n        ) {\n            throw RangeError('Invalid code point: ' + codePoint);\n          }\n        if (codePoint <= 0xFFFF) {\n          // BMP code point\n          codeUnits.push(codePoint);\n        } else {\n          // Astral code point; split in surrogate halves\n          // http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\n          codePoint -= 0x10000;\n          highSurrogate = (codePoint >> 10) + 0xD800;\n          lowSurrogate = codePoint % 0x400 + 0xDC00;\n          codeUnits.push(highSurrogate, lowSurrogate);\n        }\n        if (index + 1 == length || codeUnits.length > MAX_SIZE) {\n          result += stringFromCharCode.apply(null, codeUnits);\n          codeUnits.length = 0;\n        }\n      }\n      return result;\n    };\n    if (defineProperty) {\n      defineProperty(String, 'fromCodePoint', {\n        'value': fromCodePoint,\n        'configurable': true,\n        'writable': true\n      });\n    } else {\n      String.fromCodePoint = fromCodePoint;\n    }\n  })();\n}\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar $ = __webpack_require__(1);\n\nvar _require = __webpack_require__(0),\n    mk = _require.mk,\n    qs = _require.qs,\n    qsa = _require.qsa,\n    cr = _require.cr;\n\nvar modal = __webpack_require__(4);\nvar notify = __webpack_require__(5);\n\n/** Global generic init */\n$.ready(function () {\n  // Opening menu on mobile / narrow screen\n  function menuOpen() {\n    $('#menu').toggleClass('expanded');\n  }\n  $('#brand').on('click', menuOpen).on('keypress', cr(menuOpen));\n\n  // Checkbox UI (checkbox CSS and hidden input with int value)\n  $('.Row.checkbox').forEach(function (x) {\n    var inp = x.querySelector('input');\n    var box = x.querySelector('.box');\n\n    $(box).toggleClass('checked', inp.value);\n\n    var hdl = function hdl() {\n      inp.value = 1 - inp.value;\n      $(box).toggleClass('checked', inp.value);\n    };\n\n    $(x).on('click', hdl).on('keypress', cr(hdl));\n  });\n\n  // Expanding boxes on mobile\n  $('.Box.mobcol,.Box.fold').forEach(function (x) {\n    var h = x.querySelector('h2');\n\n    var hdl = function hdl() {\n      if ($(x).hasClass('d-expanded')) {\n        $(x).removeClass('d-expanded');\n      } else {\n        $(x).toggleClass('expanded');\n      }\n    };\n    $(h).on('click', hdl).on('keypress', cr(hdl));\n  });\n\n  $('form').forEach(function (x) {\n    $(x).on('keypress', function (e) {\n      if ((e.keyCode === 10 || e.keyCode === 13) && e.ctrlKey) {\n        x.submit();\n      }\n    });\n  });\n\n  // loader dots...\n  setInterval(function () {\n    $('.anim-dots').each(function (x) {\n      var $x = $(x);\n      var dots = $x.html() + '.';\n      if (dots.length === 5) dots = '.';\n      $x.html(dots);\n    });\n  }, 1000);\n\n  // flipping number boxes with the mouse wheel\n  $('input[type=number]').on('wheel', function (e) {\n    var $this = $(this);\n    var val = +$this.val();\n    if (isNaN(val)) val = 1;\n\n    var step = +($this.attr('step') || 1);\n    var min = +$this.attr('min');\n    var max = +$this.attr('max');\n    if (e.deltaY > 0) {\n      val += step;\n    } else {\n      val -= step;\n    }\n\n    if (Number.isFinite(min)) val = Math.max(val, +min);\n    if (Number.isFinite(max)) val = Math.min(val, +max);\n    $this.val(val);\n\n    if ('createEvent' in document) {\n      var evt = document.createEvent('HTMLEvents');\n      evt.initEvent('change', false, true);\n      $this[0].dispatchEvent(evt);\n    } else {\n      $this[0].fireEvent('onchange');\n    }\n\n    e.preventDefault();\n  });\n\n  try {\n    do {\n      var msgAt = void 0,\n          box = void 0;\n      // populate the form errors box from GET arg ?err=...\n      // (a way to pass errors back from server via redirect)\n      msgAt = window.location.search.indexOf('err=');\n      if (msgAt !== -1 && qs('.Box.errors')) {\n        var _ret = function () {\n          var errs = decodeURIComponent(window.location.search.substr(msgAt + 4)).split(',');\n          var humanReadableErrors = [];\n          errs.forEach(function (er) {\n            if (er.length === 0) return;\n            var lbls = qsa('label[for=\"' + er + '\"]');\n            if (lbls && lbls.length > 0) {\n              for (var i = 0; i < lbls.length; i++) {\n                var lbl = lbls[i];\n                lbl.classList.add('error');\n                if (i === 0) humanReadableErrors.push(lbl.childNodes[0].textContent.trim().replace(/: ?$/, ''));\n              }\n            } else {\n              console.log(JSON.stringify(er));\n              humanReadableErrors.push(er);\n            }\n          });\n\n          qs('.Box.errors .list').innerHTML = humanReadableErrors.join(', ');\n          qs('.Box.errors').classList.remove('hidden');\n          return 'break';\n        }();\n\n        if (_ret === 'break') break;\n      }\n\n      var fademsgbox = function fademsgbox(box, time) {\n        box.classList.remove('hidden');\n        setTimeout(function () {\n          box.classList.add('hiding');\n          setTimeout(function () {\n            box.classList.add('hidden');\n          }, 1000);\n        }, time);\n      };\n\n      msgAt = window.location.search.indexOf('errmsg=');\n      box = qs('.Box.errmessage');\n      if (msgAt !== -1 && box) {\n        var msg = decodeURIComponent(window.location.search.substr(msgAt + 7));\n        box.innerHTML = msg;\n        fademsgbox(box, 3000);\n        break;\n      }\n\n      msgAt = window.location.search.indexOf('msg=');\n      box = qs('.Box.message');\n      if (msgAt !== -1 && box) {\n        var _msg = decodeURIComponent(window.location.search.substr(msgAt + 4));\n        box.innerHTML = _msg;\n        fademsgbox(box, 2000);\n        break;\n      }\n    } while (0);\n  } catch (e) {\n    console.error(e);\n  }\n\n  modal.init();\n  notify.init();\n\n  // remove tabindices from h2 if wide\n  if (window.innerWidth > 550) {\n    $('.Box h2').forEach(function (x) {\n      x.removeAttribute('tabindex');\n    });\n\n    // brand works as a link back to term in widescreen mode\n    var br = qs('#brand');\n    br && br.addEventListener('click', function () {\n      window.location.href = '/'; // go to terminal\n    });\n  }\n});\n\n// setup the ajax loader\n$._loader = function (vis) {\n  $('#loader').toggleClass('show', vis);\n};\n\nvar pageShown = false;\n// reveal content on load\nfunction showPage() {\n  pageShown = true;\n  $('#content').addClass('load');\n}\n// HACKITY HACK: fix this later\nwindow.showPage = showPage;\n\n// Auto reveal pages other than the terminal (sets window.noAutoShow)\n$.ready(function () {\n  if (window.noAutoShow === true) {\n    setTimeout(function () {\n      if (!pageShown) {\n        var bnr = mk('P');\n        bnr.id = 'load-failed';\n        bnr.innerHTML = 'Server connection failed! Trying again' + '<span class=\"anim-dots\" style=\"width:1.5em;text-align:left;display:inline-block\">.</span>';\n        qs('#screen').appendChild(bnr);\n        qs('#screen').classList.add('failed');\n        showPage();\n      }\n    }, 2000);\n  } else {\n    setTimeout(function () {\n      showPage();\n    }, 1);\n  }\n});\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar $ = __webpack_require__(1);\n\nvar _require = __webpack_require__(0),\n    mk = _require.mk;\n\nvar tr = __webpack_require__(9);\n\nvar HTTPS = window.location.protocol.match(/s:/);\n\n{\n\n  // Get XX % for a slider input\n  var calc_dBm = function calc_dBm(inp) {\n    return '+' + (inp.value * 0.25).toFixed(2) + ' dBm';\n  };\n\n  // Display selected STA SSID etc\n\n\n  var selectSta = function selectSta(name, password, ip) {\n    $('#sta_ssid').val(name);\n    $('#sta_password').val(password);\n\n    $('#sta-nw').toggleClass('hidden', name.length === 0);\n    $('#sta-nw-nil').toggleClass('hidden', name.length > 0);\n\n    $('#sta-nw .essid').html($.htmlEscape(name));\n    var hasPassword = !!password;\n\n    // (the following is kind of confusing with the double-double negations,\n    // but it works)\n    $('#sta-nw .passwd').toggleClass('hidden', !hasPassword);\n    $('#sta-nw .nopasswd').toggleClass('hidden', hasPassword);\n\n    $('#sta-nw .ip').html(ip.length > 0 ? tr('wifi.connected_ip_is') + ip : tr('wifi.not_conn'));\n  };\n\n  /** Update display for received response */\n\n\n  var onScan = function onScan(resp, status) {\n    // var ap_json = {\n    //  \"result\": {\n    //    \"inProgress\": \"0\",\n    //    \"APs\": [\n    //      {\"essid\": \"Chlivek\", \"bssid\": \"88:f7:c7:52:b3:99\", \"rssi\": \"204\", \"enc\": \"4\", \"channel\": \"1\"},\n    //      {\"essid\": \"TyNikdy\", \"bssid\": \"5c:f4:ab:0d:f1:1b\", \"rssi\": \"164\", \"enc\": \"3\", \"channel\": \"1\"},\n    //    ]\n    //  }\n    // };\n\n    if (status !== 200) {\n      // bad response\n      rescan(5000); // wait 5s then retry\n      return;\n    }\n\n    try {\n      resp = JSON.parse(resp);\n    } catch (e) {\n      console.log(e);\n      rescan(5000);\n      return;\n    }\n\n    var done = !resp.result.inProgress && resp.result.APs.length > 0;\n    rescan(done ? 15000 : 1000);\n    if (!done) return; // no redraw yet\n\n    // clear the AP list\n    var $list = $('#ap-list');\n    // remove old APs\n    $('#ap-list .AP').remove();\n\n    $list.toggleClass('hidden', !done);\n    $('#ap-loader').toggleClass('hidden', done);\n\n    // scan done\n    resp.result.APs.sort(function (a, b) {\n      return b.rssi - a.rssi;\n    }).forEach(function (ap) {\n      ap.enc = parseInt(ap.enc);\n\n      if (ap.enc > 4) return; // hide unsupported auths\n\n      var item = mk('div');\n\n      var $item = $(item).data('ssid', ap.essid).data('pwd', ap.enc).attr('tabindex', 0).addClass('AP');\n\n      // mark current SSID\n      if (ap.essid === curSSID) {\n        $item.addClass('selected');\n      }\n\n      var inner = mk('div');\n      var escapedSSID = $.htmlEscape(ap.essid);\n      $(inner).addClass('inner').htmlAppend('<div class=\"rssi\">' + ap.rssi_perc + '</div>').htmlAppend('<div class=\"essid\" title=\"' + escapedSSID + '\">' + escapedSSID + '</div>').htmlAppend('<div class=\"auth\">' + authTypes[ap.enc] + '</div>');\n\n      $item.on('click', function () {\n        var $th = $(this);\n\n        var conn_ssid = $th.data('ssid');\n        var conn_pass = '';\n\n        if (+$th.data('pwd')) {\n          // this AP needs a password\n          conn_pass = window.prompt(tr('wifi.enter_passwd').replace(':ssid:', conn_ssid));\n          if (!conn_pass) return;\n        }\n\n        $('#sta_password').val(conn_pass);\n        $('#sta_ssid').val(conn_ssid);\n        selectSta(conn_ssid, conn_pass, '');\n      });\n\n      item.appendChild(inner);\n      $list[0].appendChild(item);\n    });\n  };\n\n  var startScanning = function startScanning() {\n    $('#ap-loader').removeClass('hidden');\n    $('#ap-scan').addClass('hidden');\n    $('#ap-loader .anim-dots').html('.');\n\n    scanAPs();\n  };\n\n  /** Ask the CGI what APs are visible (async) */\n\n\n  var scanAPs = function scanAPs() {\n    if (window._demo) {\n      onScan(window._demo_aps, 200);\n    } else {\n      $.get((HTTPS ? 'https' : 'http') + '://' + window._root + '/cfg/wifi/scan', onScan);\n    }\n  };\n\n  var rescan = function rescan(time) {\n    setTimeout(scanAPs, time);\n  };\n\n  /** Set up the WiFi page */\n\n\n  var wifiInit = function wifiInit(cfg) {\n    // Update slider value displays\n    $('.Row.range').forEach(function (x) {\n      var inp = x.querySelector('input');\n      var disp1 = x.querySelector('.x-disp1');\n      var disp2 = x.querySelector('.x-disp2');\n      var t = calc_dBm(inp);\n      $(disp1).html(t);\n      $(disp2).html(t);\n      $(inp).on('input', function () {\n        t = calc_dBm(inp);\n        $(disp1).html(t);\n        $(disp2).html(t);\n      });\n    });\n\n    // Forget STA credentials\n    $('#forget-sta').on('click', function () {\n      selectSta('', '', '');\n      return false;\n    });\n\n    selectSta(cfg.sta_ssid, cfg.sta_password, cfg.sta_active_ip);\n    curSSID = cfg.sta_active_ssid;\n  };\n\n  var w = window.WiFi = {};\n\n  var authTypes = ['Open', 'WEP', 'WPA', 'WPA2', 'WPA/WPA2'];\n  var curSSID = void 0;\n\n  w.init = wifiInit;\n  w.startScanning = startScanning;\n}\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports) {\n\n/* Generated language file */\nmodule.exports={\"wifi.connected_ip_is\":\"Connected, IP is \",\"wifi.not_conn\":\"Not connected.\",\"wifi.enter_passwd\":\"Enter password for \\\":ssid:\\\"\",\"term_nav.fullscreen\":\"Fullscreen\",\"term_conn.connecting\":\"Connecting\",\"term_conn.waiting_content\":\"Waiting for content\",\"term_conn.disconnected\":\"Disconnected\",\"term_conn.waiting_server\":\"Waiting for server\",\"term_conn.reconnecting\":\"Reconnecting\"}\n\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _utils = __webpack_require__(0);\n\nvar $ = __webpack_require__(1);\n\nvar HTTPS = window.location.protocol.match(/s:/);\n\nvar PERIOD_NORMAL = 500;\nvar PERIOD_FAIL = 2500;\n\nvar w = window.GPIO_Ctl = {};\n\nvar scheduledSampleTimeout = null;\nvar lastState = { 'io2': -1, 'io4': -1, 'io5': -1 };\n\nvar $in2 = void 0,\n    $in4 = void 0,\n    $in5 = void 0;\n\nvar enablePolling = void 0;\n\nfunction scheduleSample(time) {\n  if (!enablePolling || window._demo) return; // no scanning in demo mode\n\n  clearTimeout(scheduledSampleTimeout);\n  scheduledSampleTimeout = setTimeout(sampleGPIOs, time);\n}\n\nfunction onSampled(resp, status) {\n  if (status !== 200) {\n    // bad response\n    scheduleSample(PERIOD_FAIL); // wait 5s then retry\n    return;\n  }\n\n  try {\n    if ((typeof resp === 'undefined' ? 'undefined' : _typeof(resp)) !== 'object') resp = JSON.parse(resp);\n\n    if (resp.io2 !== lastState.io2) $in2.toggleClass('active', resp.io2);\n    if (resp.io4 !== lastState.io4) $in4.toggleClass('active', resp.io4);\n    if (resp.io5 !== lastState.io5) $in5.toggleClass('active', resp.io5);\n  } catch (e) {\n    console.log(e);\n    scheduleSample(PERIOD_FAIL);\n    return;\n  }\n\n  lastState = resp;\n\n  scheduleSample(PERIOD_NORMAL);\n}\n\nfunction sampleGPIOs() {\n  var getargs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n\n  clearTimeout(scheduledSampleTimeout);\n  $.get((HTTPS ? 'https' : 'http') + '://' + window._root + '/api/v1/gpio' + getargs, onSampled, { loader: getargs !== '' });\n}\n\nw.init = function (state, doPoll) {\n\n  $in2 = $('.x-in2');\n  $in4 = $('.x-in4');\n  $in5 = $('.x-in5');\n\n  enablePolling = doPoll;\n\n  $('.gpio-indicator, .x-in-handle').on('click', function (e) {\n    var num = $(this).data('num');\n    sampleGPIOs('?do' + num + '=' + (1 - lastState['io' + num]));\n  });\n\n  $('.x-in-handle').on('keypress', (0, _utils.cr)(function (e) {\n    var num = $(this).data('num');\n    sampleGPIOs('?do' + num + '=' + (1 - lastState['io' + num]));\n  }));\n\n  onSampled(state, 200);\n};\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar $ = __webpack_require__(1);\n\nvar _require = __webpack_require__(0),\n    qs = _require.qs,\n    mk = _require.mk;\n\nvar localize = __webpack_require__(9);\nvar Notify = __webpack_require__(5);\nvar TermScreen = __webpack_require__(17);\nvar TermConnection = __webpack_require__(21);\nvar TermInput = __webpack_require__(22);\nvar TermUpload = __webpack_require__(23);\nvar initSoftKeyboard = __webpack_require__(24);\nvar attachDebugger = __webpack_require__(25);\nvar initButtons = __webpack_require__(26);\n\n/** Init the terminal sub-module - called from HTML */\nmodule.exports = function (opts) {\n  var screen = new TermScreen();\n  var conn = new TermConnection(screen);\n  var input = TermInput(conn, screen);\n  var termUpload = TermUpload(conn, input, screen);\n  input.termUpload = termUpload;\n\n  // forward screen input events\n  screen.on('mousedown', function () {\n    return input.onMouseDown.apply(input, arguments);\n  });\n  screen.on('mousemove', function () {\n    return input.onMouseMove.apply(input, arguments);\n  });\n  screen.on('mouseup', function () {\n    return input.onMouseUp.apply(input, arguments);\n  });\n  screen.on('mousewheel', function () {\n    return input.onMouseWheel.apply(input, arguments);\n  });\n  screen.on('input-alts', function () {\n    return input.setAlts.apply(input, arguments);\n  });\n  screen.on('mouse-mode', function () {\n    return input.setMouseMode.apply(input, arguments);\n  });\n\n  // touch selection menu (the Copy button)\n  $.ready(function () {\n    var touchSelectMenu = qs('#touch-select-menu');\n    screen.on('show-touch-select-menu', function (x, y) {\n      var rect = touchSelectMenu.getBoundingClientRect();\n      x -= rect.width / 2;\n      y -= rect.height / 2;\n\n      touchSelectMenu.classList.add('open');\n      touchSelectMenu.style.transform = 'translate(' + x + 'px,' + y + 'px)';\n    });\n    screen.on('hide-touch-select-menu', function () {\n      return touchSelectMenu.classList.remove('open');\n    });\n\n    var copyButton = qs('#touch-select-copy-btn');\n    if (copyButton) {\n      copyButton.addEventListener('click', function () {\n        screen.copySelectionToClipboard();\n      });\n    }\n  });\n\n  // buttons\n  var buttons = initButtons(input);\n  screen.on('buttons-update', function (update) {\n    buttons.labels = update.labels;\n    buttons.colors = update.colors;\n  });\n  // TODO: don't access the renderer here\n  buttons.palette = screen.layout.renderer.palette;\n  screen.layout.renderer.on('palette-update', function (palette) {\n    buttons.palette = palette;\n  });\n\n  screen.on('full-load', function () {\n    var scr = qs('#screen');\n    var errmsg = qs('#load-failed');\n    if (scr) scr.classList.remove('failed');\n    if (errmsg) errmsg.parentNode.removeChild(errmsg);\n  });\n\n  var setLinkVisibility = function setLinkVisibility(visible) {\n    var buttons = [].concat(_toConsumableArray(document.querySelectorAll('.x-term-conf-btn')));\n    if (visible) buttons.forEach(function (x) {\n      return x.classList.remove('hidden');\n    });else buttons.forEach(function (x) {\n      return x.classList.add('hidden');\n    });\n  };\n  var setButtonVisibility = function setButtonVisibility(visible) {\n    if (visible) qs('#action-buttons').classList.remove('hidden');else qs('#action-buttons').classList.add('hidden');\n  };\n\n  screen.on('opts-update', function () {\n    setLinkVisibility(screen.showLinks);\n    setButtonVisibility(screen.showButtons);\n  });\n\n  screen.on('title-update', function (text) {\n    qs('#screen-title').textContent = text;\n    if (!text) text = 'Terminal';\n    qs('title').textContent = text + ' :: ESPTerm';\n  });\n\n  // connection status\n\n  var showSplashTimeout = null;\n  var showSplash = function showSplash(obj) {\n    var delay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 250;\n\n    clearTimeout(showSplashTimeout);\n    showSplashTimeout = setTimeout(function () {\n      screen.window.statusScreen = obj;\n    }, delay);\n  };\n\n  conn.on('open', function () {\n    // console.log('*open')\n    showSplash({ title: localize('term_conn.connecting'), loading: true });\n  });\n  conn.on('connect', function () {\n    // console.log('*connect')\n    showSplash({ title: localize('term_conn.waiting_content'), loading: true });\n  });\n  screen.on('load', function () {\n    // console.log('*load')\n    clearTimeout(showSplashTimeout);\n    if (screen.window.statusScreen) screen.window.statusScreen = null;\n  });\n  conn.on('disconnect', function () {\n    // console.log('*disconnect')\n    showSplash({ title: localize('term_conn.disconnected') }, 500);\n    screen.screen = [];\n    screen.screenFG = [];\n    screen.screenBG = [];\n    screen.screenAttrs = [];\n  });\n  conn.on('silence', function () {\n    // console.log('*silence')\n    showSplash({ title: localize('term_conn.waiting_server'), loading: true }, 0);\n  });\n  // conn.on('ping-fail', () => { screen.window.statusScreen = { title: 'Disconnected' } })\n  conn.on('ping-success', function () {\n    // console.log('*ping-success')\n    showSplash({ title: localize('term_conn.reconnecting'), loading: true }, 0);\n  });\n\n  conn.init();\n  input.init(opts);\n  termUpload.init();\n  Notify.init();\n\n  window.onerror = function (errorMsg, file, line, col) {\n    Notify.show('<b>JS ERROR!</b><br>' + errorMsg + '<br>at ' + file + ':' + line + ':' + col, 10000, true);\n    return false;\n  };\n\n  qs('#screen').appendChild(screen.layout.canvas);\n\n  initSoftKeyboard(screen, input);\n  if (attachDebugger) attachDebugger(screen, conn);\n\n  // fullscreen mode\n\n  var fullscreenIcon = {}; // dummy\n  var isFullscreen = false;\n  var properFullscreen = false;\n  var fitScreen = false;\n  var screenPadding = screen.layout.window.padding;\n  var fitScreenIfNeeded = function fitScreenIfNeeded() {\n    if (isFullscreen) {\n      fullscreenIcon.className = 'icn-resize-small';\n      if (properFullscreen) {\n        screen.layout.window.fitIntoWidth = window.screen.width;\n        screen.layout.window.fitIntoHeight = window.screen.height;\n        screen.layout.window.padding = 0;\n      } else {\n        screen.layout.window.fitIntoWidth = window.innerWidth;\n        if (qs('#term-nav').classList.contains('hidden')) {\n          screen.layout.window.fitIntoHeight = window.innerHeight;\n        } else {\n          screen.layout.window.fitIntoHeight = window.innerHeight - 24;\n        }\n        screen.layout.window.padding = 0;\n      }\n    } else {\n      fullscreenIcon.className = 'icn-resize-full';\n      screen.layout.window.fitIntoWidth = fitScreen ? window.innerWidth - 4 : 0;\n      screen.layout.window.fitIntoHeight = fitScreen ? window.innerHeight : 0;\n      screen.layout.window.padding = screenPadding;\n    }\n  };\n  fitScreenIfNeeded();\n  window.addEventListener('resize', fitScreenIfNeeded);\n\n  var toggleFitScreen = function toggleFitScreen() {\n    fitScreen = !fitScreen;\n    var resizeButtonIcon = qs('#resize-button-icon');\n    if (fitScreen) {\n      resizeButtonIcon.classList.remove('icn-resize-small');\n      resizeButtonIcon.classList.add('icn-resize-full');\n    } else {\n      resizeButtonIcon.classList.remove('icn-resize-full');\n      resizeButtonIcon.classList.add('icn-resize-small');\n    }\n    fitScreenIfNeeded();\n  };\n\n  qs('#term-fit-screen').addEventListener('click', function () {\n    toggleFitScreen();\n    return false;\n  });\n\n  // add fullscreen mode & button\n  if (window.Element.prototype.requestFullscreen || window.Element.prototype.webkitRequestFullscreen) {\n    properFullscreen = true;\n\n    var checkForFullscreen = function checkForFullscreen() {\n      // document.fullscreenElement is not really supported yet, so here's a hack\n      if (isFullscreen && (window.innerWidth !== window.screen.width || window.innerHeight !== window.screen.height)) {\n        isFullscreen = false;\n        fitScreenIfNeeded();\n      }\n    };\n    setInterval(checkForFullscreen, 500);\n  }\n\n  // (why are the buttons anchors?)\n  var button = mk('a');\n  button.id = 'fullscreen-button';\n  button.href = '#';\n  button.addEventListener('click', function (e) {\n    e.preventDefault();\n\n    if (document.body.classList.contains('pseudo-fullscreen')) {\n      document.body.classList.remove('pseudo-fullscreen');\n      isFullscreen = false;\n      fitScreenIfNeeded();\n      return;\n    }\n\n    isFullscreen = true;\n    fitScreenIfNeeded();\n    screen.layout.updateSize();\n\n    if (properFullscreen) {\n      if (screen.layout.canvas.requestFullscreen) screen.layout.canvas.requestFullscreen();else screen.layout.canvas.webkitRequestFullscreen();\n    } else {\n      document.body.classList.add('pseudo-fullscreen');\n    }\n  });\n  fullscreenIcon = mk('i');\n  fullscreenIcon.className = 'icn-resize-full';\n  button.appendChild(fullscreenIcon);\n  var span = mk('span');\n  span.textContent = localize('term_nav.fullscreen');\n  button.appendChild(span);\n  qs('#term-nav').insertBefore(button, qs('#term-nav').firstChild);\n\n  // for debugging\n  window.termScreen = screen;\n  window.buttons = buttons;\n  window.conn = conn;\n  window.input = input;\n  window.termUpl = termUpload;\n};\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar EventEmitter = __webpack_require__(2);\n\nvar _require = __webpack_require__(0),\n    mk = _require.mk;\n\nvar notify = __webpack_require__(5);\nvar ScreenParser = __webpack_require__(18);\nvar ScreenLayout = __webpack_require__(19);\n\nvar _require2 = __webpack_require__(6),\n    ATTR_BLINK = _require2.ATTR_BLINK;\n\n/**\n * A terminal screen.\n */\n\n\nmodule.exports = function (_EventEmitter) {\n  _inherits(TermScreen, _EventEmitter);\n\n  function TermScreen() {\n    _classCallCheck(this, TermScreen);\n\n    var _this = _possibleConstructorReturn(this, (TermScreen.__proto__ || Object.getPrototypeOf(TermScreen)).call(this));\n\n    _this.parser = new ScreenParser();\n    _this.layout = new ScreenLayout();\n\n    // debug screen handle\n    _this._debug = null;\n\n    if ('AudioContext' in window || 'webkitAudioContext' in window) {\n      _this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n    } else {\n      console.warn('No AudioContext!');\n    }\n\n    _this._window = {\n      width: 0,\n      height: 0,\n      // two bits. LSB: debug enabled by user, MSB: debug enabled by server\n      debug: 0,\n      statusScreen: null\n\n      // make writing to window update size and draw\n    };_this.window = new Proxy(_this._window, {\n      set: function set(target, key, value) {\n        if (target[key] !== value) {\n          target[key] = value;\n          self.updateLayout();\n          self.renderScreen('window:' + key + '=' + value);\n          self.emit('update-window:' + key, value);\n        }\n        return true;\n      }\n    });\n\n    _this.on('update-window:debug', function (debug) {\n      _this.layout.window.debug = !!debug;\n    });\n\n    _this.cursor = {\n      x: 0,\n      y: 0,\n      blinking: true,\n      visible: true,\n      hanging: false,\n      style: 'block'\n    };\n\n    var self = _this;\n\n    // current selection\n    _this.selection = {\n      // when false, this will prevent selection in favor of mouse events,\n      // though alt can be held to override it\n      selectable: null,\n\n      // selection start and end (x, y) tuples\n      start: [0, 0],\n      end: [0, 0],\n\n      setSelectable: function setSelectable(value) {\n        if (value !== this.selectable) {\n          this.selectable = self.layout.selectable = value;\n        }\n      }\n    };\n\n    // mouse features\n    _this.mouseMode = { clicks: false, movement: false };\n\n    _this.showLinks = false;\n    _this.showButtons = false;\n    _this.title = '';\n\n    _this.bracketedPaste = false;\n    _this.blinkingCellCount = 0;\n    _this.reverseVideo = false;\n\n    _this.screen = [];\n    _this.screenFG = [];\n    _this.screenBG = [];\n    _this.screenAttrs = [];\n    _this.screenLines = [];\n\n    // For testing TODO remove\n    //   this.screenLines[0] = 0b001\n    //   this.screenLines[1] = 0b010\n    //   this.screenLines[2] = 0b100\n    //   this.screenLines[3] = 0b011\n    //   this.screenLines[4] = 0b101\n\n    var selecting = false;\n\n    var selectStart = function selectStart(x, y) {\n      if (selecting) return;\n      selecting = true;\n      _this.selection.start = _this.selection.end = _this.layout.screenToGrid(x, y, true);\n      _this.renderScreen('select-start');\n    };\n\n    var selectMove = function selectMove(x, y) {\n      if (!selecting) return;\n      _this.selection.end = _this.layout.screenToGrid(x, y, true);\n      _this.renderScreen('select-move');\n    };\n\n    var selectEnd = function selectEnd(x, y) {\n      if (!selecting) return;\n      selecting = false;\n      _this.selection.end = _this.layout.screenToGrid(x, y, true);\n      _this.renderScreen('select-end');\n      Object.assign(_this.selection, _this.getNormalizedSelection());\n    };\n\n    // bind event listeners\n\n    _this.layout.on('mousedown', function (e) {\n      _this.emit('hide-touch-select-menu');\n      if ((_this.selection.selectable || e.altKey) && e.button === 0) {\n        selectStart(e.offsetX, e.offsetY);\n      } else {\n        _this.emit.apply(_this, ['mousedown'].concat(_toConsumableArray(_this.layout.screenToGrid(e.offsetX, e.offsetY)), [e.button + 1]));\n      }\n    });\n\n    window.addEventListener('mousemove', function (e) {\n      selectMove(e.offsetX, e.offsetY);\n    });\n\n    window.addEventListener('mouseup', function (e) {\n      selectEnd(e.offsetX, e.offsetY);\n    });\n\n    // touch event listeners\n\n    var touchPosition = null;\n    var touchDownTime = 0;\n    var touchSelectMinTime = 500;\n    var touchDidMove = false;\n\n    var getTouchPositionOffset = function getTouchPositionOffset(touch) {\n      var rect = _this.layout.canvas.getBoundingClientRect();\n      return [touch.clientX - rect.left, touch.clientY - rect.top];\n    };\n\n    _this.layout.on('touchstart', function (e) {\n      touchPosition = getTouchPositionOffset(e.touches[0]);\n      touchDidMove = false;\n      touchDownTime = Date.now();\n\n      if (_this.mouseMode.clicks) {\n        var _this$layout;\n\n        _this.emit.apply(_this, ['mousedown'].concat(_toConsumableArray((_this$layout = _this.layout).screenToGrid.apply(_this$layout, _toConsumableArray(touchPosition))), [1]));\n        e.preventDefault();\n      }\n    });\n\n    _this.layout.on('touchmove', function (e) {\n      touchPosition = getTouchPositionOffset(e.touches[0]);\n\n      if (!selecting && touchDidMove === false) {\n        if (touchDownTime < Date.now() - touchSelectMinTime) {\n          selectStart.apply(undefined, _toConsumableArray(touchPosition));\n        }\n      } else if (selecting) {\n        e.preventDefault();\n        selectMove.apply(undefined, _toConsumableArray(touchPosition));\n      } else if (_this.mouseMode.movement && !selecting) {\n        var _this$layout2;\n\n        _this.emit.apply(_this, ['mousemove'].concat(_toConsumableArray((_this$layout2 = _this.layout).screenToGrid.apply(_this$layout2, _toConsumableArray(touchPosition)))));\n        e.preventDefault();\n      }\n\n      touchDidMove = true;\n    });\n\n    _this.layout.on('touchend', function (e) {\n      if (e.touches[0]) {\n        touchPosition = getTouchPositionOffset(e.touches[0]);\n      }\n\n      if (selecting) {\n        e.preventDefault();\n        selectEnd.apply(undefined, _toConsumableArray(touchPosition));\n\n        // selection ended; show touch select menu\n        // use middle position for x and one line above for y\n        var selectionPos = _this.layout.gridToScreen((_this.selection.start[0] + _this.selection.end[0]) / 2, _this.selection.start[1] - 1);\n\n        _this.emit('show-touch-select-menu', selectionPos[0], selectionPos[1]);\n      } else if (_this.mouseMode.clicks) {\n        var _this$layout3;\n\n        _this.emit.apply(_this, ['mouseup'].concat(_toConsumableArray((_this$layout3 = _this.layout).screenToGrid.apply(_this$layout3, _toConsumableArray(touchPosition))), [1]));\n        e.preventDefault();\n      }\n\n      if (!touchDidMove && !_this.mouseMode.clicks) {\n        _this.emit('tap', Object.assign(e, {\n          x: touchPosition[0],\n          y: touchPosition[1]\n        }));\n      } else if (!touchDidMove) _this.resetSelection();\n\n      touchPosition = null;\n    });\n\n    _this.on('tap', function (e) {\n      if (_this.selection.start[0] !== _this.selection.end[0] || _this.selection.start[1] !== _this.selection.end[1]) {\n        // selection is not empty\n        _this.resetSelection();\n      } else {\n        e.preventDefault();\n        _this.emit('open-soft-keyboard');\n      }\n    });\n\n    _this.layout.on('mousemove', function (e) {\n      if (!selecting) {\n        _this.emit.apply(_this, ['mousemove'].concat(_toConsumableArray(_this.layout.screenToGrid(e.offsetX, e.offsetY))));\n      }\n    });\n\n    _this.layout.on('mouseup', function (e) {\n      if (!selecting) {\n        _this.emit.apply(_this, ['mouseup'].concat(_toConsumableArray(_this.layout.screenToGrid(e.offsetX, e.offsetY)), [e.button + 1]));\n      }\n    });\n\n    var aggregateWheelDelta = 0;\n    _this.layout.on('wheel', function (e) {\n      if (_this.mouseMode.clicks) {\n        if (Math.abs(e.wheelDeltaY) === 120) {\n          // mouse wheel scrolling\n          _this.emit.apply(_this, ['mousewheel'].concat(_toConsumableArray(_this.layout.screenToGrid(e.offsetX, e.offsetY)), [e.deltaY > 0 ? 1 : -1]));\n        } else {\n          // smooth scrolling\n          aggregateWheelDelta -= e.wheelDeltaY;\n          if (Math.abs(aggregateWheelDelta) >= 40) {\n            _this.emit.apply(_this, ['mousewheel'].concat(_toConsumableArray(_this.layout.screenToGrid(e.offsetX, e.offsetY)), [aggregateWheelDelta > 0 ? 1 : -1]));\n            aggregateWheelDelta = 0;\n          }\n        }\n\n        // prevent page scrolling\n        e.preventDefault();\n      }\n    });\n\n    _this.layout.on('contextmenu', function (e) {\n      if (_this.mouseMode.clicks) {\n        // prevent mouse keys getting stuck\n        e.preventDefault();\n      }\n      selectEnd(e.offsetX, e.offsetY);\n    });\n    return _this;\n  }\n\n  _createClass(TermScreen, [{\n    key: 'resetScreen',\n    value: function resetScreen() {\n      var _window = this.window,\n          width = _window.width,\n          height = _window.height;\n\n      this.blinkingCellCount = 0;\n      this.screen.screen = new Array(width * height).fill(' ');\n      this.screen.screenFG = new Array(width * height).fill(0);\n      this.screen.screenBG = new Array(width * height).fill(0);\n      this.screen.screenAttrs = new Array(width * height).fill(0);\n      this.screen.screenLines = new Array(height).fill(0);\n    }\n  }, {\n    key: 'updateLayout',\n    value: function updateLayout() {\n      this.layout.window.width = this.window.width;\n      this.layout.window.height = this.window.height;\n    }\n  }, {\n    key: 'renderScreen',\n    value: function renderScreen(reason) {\n      var selection = [];\n\n      for (var cell = 0; cell < this.screen.length; cell++) {\n        selection.push(this.isInSelection(cell % this.window.width, Math.floor(cell / this.window.width)));\n      }\n\n      this.layout.render(reason, {\n        width: this.window.width,\n        height: this.window.height,\n        screen: this.screen,\n        screenFG: this.screenFG,\n        screenBG: this.screenBG,\n        screenSelection: selection,\n        screenAttrs: this.screenAttrs,\n        screenLines: this.screenLines,\n        cursor: this.cursor,\n        statusScreen: this.window.statusScreen,\n        reverseVideo: this.reverseVideo,\n        hasBlinkingCells: !!this.blinkingCellCount\n      });\n    }\n  }, {\n    key: 'resetSelection',\n    value: function resetSelection() {\n      this.selection.start = this.selection.end = [0, 0];\n      this.emit('hide-touch-select-menu');\n      this.renderScreen('select-reset');\n    }\n\n    /**\n     * Returns a normalized version of the current selection, such that `start`\n     * is always before `end`.\n     * @returns {Object} the normalized selection, with `start` and `end`\n     */\n\n  }, {\n    key: 'getNormalizedSelection',\n    value: function getNormalizedSelection() {\n      var _selection = this.selection,\n          start = _selection.start,\n          end = _selection.end;\n      // if the start line is after the end line, or if they're both on the same\n      // line but the start column comes after the end column, swap\n\n      if (start[1] > end[1] || start[1] === end[1] && start[0] > end[0]) {\n        var _ref = [end, start];\n        start = _ref[0];\n        end = _ref[1];\n      }\n      return { start: start, end: end };\n    }\n\n    /**\n     * Returns whether or not a given cell is in the current selection.\n     * @param {number} col - the column (x)\n     * @param {number} line - the line (y)\n     * @returns {boolean}\n     */\n\n  }, {\n    key: 'isInSelection',\n    value: function isInSelection(col, line) {\n      var _getNormalizedSelecti = this.getNormalizedSelection(),\n          start = _getNormalizedSelecti.start,\n          end = _getNormalizedSelecti.end;\n\n      var colAfterStart = start[0] <= col;\n      var colBeforeEnd = col < end[0];\n      var onStartLine = line === start[1];\n      var onEndLine = line === end[1];\n\n      if (onStartLine && onEndLine) return colAfterStart && colBeforeEnd;else if (onStartLine) return colAfterStart;else if (onEndLine) return colBeforeEnd;else return start[1] < line && line < end[1];\n    }\n\n    /**\n     * Sweeps for selected cells and joins them in a multiline string.\n     * @returns {string} the selection\n     */\n\n  }, {\n    key: 'getSelectedText',\n    value: function getSelectedText() {\n      var screenLength = this.window.width * this.window.height;\n      var lines = [];\n      var previousLineIndex = -1;\n\n      for (var cell = 0; cell < screenLength; cell++) {\n        var x = cell % this.window.width;\n        var y = Math.floor(cell / this.window.width);\n\n        if (this.isInSelection(x, y)) {\n          if (previousLineIndex !== y) {\n            previousLineIndex = y;\n            lines.push('');\n          }\n          lines[lines.length - 1] += this.screen[cell];\n        }\n      }\n\n      return lines.join('\\n');\n    }\n\n    /**\n     * Copies the selection to clipboard and creates a notification balloon.\n     */\n\n  }, {\n    key: 'copySelectionToClipboard',\n    value: function copySelectionToClipboard() {\n      var selectedText = this.getSelectedText();\n      // don't copy anything if nothing is selected\n      if (!selectedText) return;\n      var textarea = mk('textarea');\n      document.body.appendChild(textarea);\n      textarea.value = selectedText;\n      textarea.select();\n      if (document.execCommand('copy')) {\n        notify.show('Copied to clipboard');\n      } else {\n        notify.show('Failed to copy');\n      }\n      document.body.removeChild(textarea);\n    }\n\n    /**\n     * Shows an actual notification (if possible) or a notification balloon.\n     * @param {string} text - the notification content\n     */\n\n  }, {\n    key: 'showNotification',\n    value: function showNotification(text) {\n      console.info('Notification: ' + text);\n      if (window.Notification && window.Notification.permission === 'granted') {\n        var notification = new window.Notification('ESPTerm', {\n          body: text\n        });\n        notification.addEventListener('click', function () {\n          return window.focus();\n        });\n      } else {\n        if (window.Notification && window.Notification.permission !== 'denied') {\n          window.Notification.requestPermission();\n        } else {\n          // Fallback using the built-in notification balloon\n          notify.show(text);\n        }\n      }\n    }\n\n    /**\n     * Creates a beep sound.\n     */\n\n  }, {\n    key: 'beep',\n    value: function beep() {\n      var audioCtx = this.audioCtx;\n      if (!audioCtx) return;\n\n      // prevent screeching\n      if (this._lastBeep && this._lastBeep > Date.now() - 50) return;\n      this._lastBeep = Date.now();\n\n      if (!this._convolver) {\n        this._convolver = audioCtx.createConvolver();\n        var impulseLength = audioCtx.sampleRate * 0.8;\n        var impulse = audioCtx.createBuffer(2, impulseLength, audioCtx.sampleRate);\n        for (var i = 0; i < impulseLength; i++) {\n          impulse.getChannelData(0)[i] = Math.pow(1 - i / impulseLength, 7 + Math.random());\n          impulse.getChannelData(1)[i] = Math.pow(1 - i / impulseLength, 7 + Math.random());\n        }\n        this._convolver.buffer = impulse;\n        this._convolver.connect(audioCtx.destination);\n      }\n\n      // main beep\n      var mainOsc = audioCtx.createOscillator();\n      var mainGain = audioCtx.createGain();\n      mainOsc.connect(mainGain);\n      mainGain.gain.value = 4;\n      mainOsc.frequency.value = 750;\n      mainOsc.type = 'sine';\n\n      // surrogate beep (making it sound like 'oops')\n      var surrOsc = audioCtx.createOscillator();\n      var surrGain = audioCtx.createGain();\n      surrOsc.connect(surrGain);\n      surrGain.gain.value = 2;\n      surrOsc.frequency.value = 400;\n      surrOsc.type = 'sine';\n\n      mainGain.connect(this._convolver);\n      surrGain.connect(this._convolver);\n\n      var startTime = audioCtx.currentTime;\n      mainOsc.start();\n      mainOsc.stop(startTime + 0.5);\n      surrOsc.start(startTime + 0.05);\n      surrOsc.stop(startTime + 0.8);\n\n      var loop = function loop() {\n        if (audioCtx.currentTime < startTime + 0.8) window.requestAnimationFrame(loop);\n        mainGain.gain.value *= 0.8;\n        surrGain.gain.value *= 0.8;\n      };\n      loop();\n    }\n  }, {\n    key: 'load',\n    value: function load() {\n      var _parser;\n\n      var updates = (_parser = this.parser).parse.apply(_parser, arguments);\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = updates[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var update = _step.value;\n\n          switch (update.topic) {\n            case 'screen-opts':\n              if (update.width !== this.window.width || update.height !== this.window.height) {\n                this.window.width = update.width;\n                this.window.height = update.height;\n                this.resetScreen();\n              }\n              this.layout.renderer.loadTheme(update.theme);\n              this.layout.renderer.setDefaultColors(update.defFG, update.defBG);\n              this.cursor.visible = update.cursorVisible;\n              this.emit.apply(this, ['input-alts'].concat(_toConsumableArray(update.inputAlts)));\n              this.mouseMode.clicks = update.trackMouseClicks;\n              this.mouseMode.movement = update.trackMouseMovement;\n              this.emit('mouse-mode', update.trackMouseClicks, update.trackMouseMovement);\n              this.selection.setSelectable(!update.trackMouseClicks && !update.trackMouseMovement);\n              if (this.cursor.blinking !== update.cursorBlinking) {\n                this.cursor.blinking = update.cursorBlinking;\n                this.layout.renderer.resetCursorBlink();\n              }\n              this.cursor.style = update.cursorStyle;\n              this.bracketedPaste = update.bracketedPaste;\n              this.reverseVideo = update.reverseVideo;\n              this.window.debug &= 1;\n              this.window.debug |= +update.debugEnabled << 1;\n\n              this.showLinks = update.showConfigLinks;\n              this.showButtons = update.showButtons;\n              this.emit('opts-update');\n              break;\n\n            case 'double-lines':\n              this.screenLines = update.lines;\n              this.renderScreen('double-lines');\n              break;\n\n            case 'static-opts':\n              this.layout.window.fontFamily = update.fontStack || null;\n              this.layout.window.fontSize = update.fontSize;\n              break;\n\n            case 'cursor':\n              if (this.cursor.x !== update.x || this.cursor.y !== update.y || this.cursor.hanging !== update.hanging) {\n                this.cursor.x = update.x;\n                this.cursor.y = update.y;\n                this.cursor.hanging = update.hanging;\n                this.layout.renderer.resetCursorBlink();\n                this.emit('cursor-moved');\n                this.renderScreen('cursor-moved');\n              }\n              break;\n\n            case 'title':\n              this.emit('title-update', this.title = update.title);\n              break;\n\n            case 'buttons-update':\n              this.emit('buttons-update', update);\n              break;\n\n            case 'backdrop':\n              this.backgroundImage = update.image;\n              break;\n\n            case 'bell':\n              this.beep();\n              break;\n\n            case 'internal':\n              this.emit('internal', update);\n              break;\n\n            case 'content':\n              var frameX = update.frameX,\n                  frameY = update.frameY,\n                  frameWidth = update.frameWidth,\n                  frameHeight = update.frameHeight,\n                  cells = update.cells;\n\n\n              if (this._debug && this.window.debug) {\n                this._debug.pushFrame([frameX, frameY, frameWidth, frameHeight]);\n              }\n\n              for (var cell = 0; cell < cells.length; cell++) {\n                var data = cells[cell];\n\n                var cellXInFrame = cell % frameWidth;\n                var cellYInFrame = Math.floor(cell / frameWidth);\n                var index = (frameY + cellYInFrame) * this.window.width + frameX + cellXInFrame;\n\n                if ((this.screenAttrs[index] & ATTR_BLINK) !== (data[3] & ATTR_BLINK)) {\n                  if (data[3] & ATTR_BLINK) this.blinkingCellCount++;else this.blinkingCellCount--;\n                }\n\n                this.screen[index] = data[0];\n                this.screenFG[index] = data[1];\n                this.screenBG[index] = data[2];\n                this.screenAttrs[index] = data[3];\n              }\n\n              if (this.window.debug) console.log('Blinking cells: ' + this.blinkingCellCount);\n\n              this.renderScreen('load');\n              this.emit('load');\n              break;\n\n            case 'full-load-complete':\n              this.emit('full-load');\n              break;\n\n            case 'notification':\n              this.showNotification(update.content);\n              break;\n\n            default:\n              console.warn('Unhandled update', update);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.emit('update');\n    }\n  }]);\n\n  return TermScreen;\n}(EventEmitter);\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _require = __webpack_require__(6),\n    ATTR_FG = _require.ATTR_FG,\n    ATTR_BG = _require.ATTR_BG,\n    ATTR_BOLD = _require.ATTR_BOLD,\n    ATTR_UNDERLINE = _require.ATTR_UNDERLINE,\n    ATTR_BLINK = _require.ATTR_BLINK,\n    ATTR_STRIKE = _require.ATTR_STRIKE,\n    ATTR_OVERLINE = _require.ATTR_OVERLINE,\n    ATTR_FAINT = _require.ATTR_FAINT;\n\n// constants for decoding the update blob\n\n\nvar SEQ_SKIP = 1;\nvar SEQ_REPEAT = 2;\nvar SEQ_SET_COLORS = 3;\nvar SEQ_SET_ATTRS = 4;\nvar SEQ_SET_FG = 5;\nvar SEQ_SET_BG = 6;\nvar SEQ_SET_ATTR_0 = 7;\n\n// decode a number encoded as a unicode code point\nfunction du(str) {\n  if (!str) return NaN;\n  var num = str.codePointAt(0);\n  if (num > 0xDFFF) num -= 0x800;\n  return num - 1;\n}\n\n/* eslint-disable no-multi-spaces */\n//                                mnemonic\nvar TOPIC_SCREEN_OPTS = 'O'; // O-ptions\nvar TOPIC_STATIC_OPTS = 'P'; // P-arams\nvar TOPIC_CONTENT = 'S'; // S-creen\nvar TOPIC_TITLE = 'T'; // T-itle\nvar TOPIC_BUTTONS = 'B'; // B-uttons\nvar TOPIC_CURSOR = 'C'; // C-ursor\nvar TOPIC_INTERNAL = 'D'; // D-ebug\nvar TOPIC_BELL = '!'; // !!!\nvar TOPIC_BACKDROP = 'W'; // W-allpaper\nvar TOPIC_DOUBLE_LINES = 'H'; // H-uge\n\nvar OPT_CURSOR_VISIBLE = 1 << 0;\nvar OPT_DEBUGBAR = 1 << 1;\nvar OPT_CURSORS_ALT_MODE = 1 << 2;\nvar OPT_NUMPAD_ALT_MODE = 1 << 3;\nvar OPT_FN_ALT_MODE = 1 << 4;\nvar OPT_CLICK_TRACKING = 1 << 5;\nvar OPT_MOVE_TRACKING = 1 << 6;\nvar OPT_SHOW_BUTTONS = 1 << 7;\nvar OPT_SHOW_CONFIG_LINKS = 1 << 8;\n// const OPT_CURSOR_SHAPE   = (7 << 9)\nvar OPT_CRLF_MODE = 1 << 12;\nvar OPT_BRACKETED_PASTE = 1 << 13;\nvar OPT_REVERSE_VIDEO = 1 << 14;\n\n/* eslint-enable no-multi-spaces */\n\n/**\n * A parser for screen update messages\n */\nmodule.exports = function () {\n  function ScreenParser() {\n    _classCallCheck(this, ScreenParser);\n\n    // true if full content was loaded\n    this.contentLoaded = false;\n  }\n\n  _createClass(ScreenParser, [{\n    key: 'parseUpdate',\n    value: function parseUpdate(str) {\n      // console.log(`update ${str}`)\n\n      // current index\n      var ci = 0;\n      var strArray = Array.from ? Array.from(str) : str.split('');\n\n      var text = void 0;\n      var topics = du(strArray[ci++]);\n\n      var collectOneTerminatedString = function collectOneTerminatedString() {\n        // TODO optimize this\n        text = '';\n        while (ci < strArray.length) {\n          var c = strArray[ci++];\n          if (c !== '\\x01') {\n            text += c;\n          } else {\n            break;\n          }\n        }\n        return text;\n      };\n\n      var collectColor = function collectColor() {\n        var c = du(strArray[ci++]);\n        if (c & 0x10000) {\n          // support for trueColor\n          c &= 0xFFF;\n          c |= (du(strArray[ci++]) & 0xFFF) << 12;\n          c += 256;\n        }\n        return c;\n      };\n\n      var updates = [];\n\n      while (ci < strArray.length) {\n        var topic = strArray[ci++];\n\n        if (topic === TOPIC_SCREEN_OPTS) {\n          var height = du(strArray[ci++]);\n          var width = du(strArray[ci++]);\n          var theme = du(strArray[ci++]);\n          var defFG = collectColor();\n          var defBG = collectColor();\n\n          // process attributes\n          var attributes = du(strArray[ci++]);\n\n          var cursorVisible = !!(attributes & OPT_CURSOR_VISIBLE);\n\n          // HACK: input alts are formatted as arguments for Input#setAlts\n          var inputAlts = [!!(attributes & OPT_CURSORS_ALT_MODE), !!(attributes & OPT_NUMPAD_ALT_MODE), !!(attributes & OPT_FN_ALT_MODE), !!(attributes & OPT_CRLF_MODE)];\n\n          var trackMouseClicks = !!(attributes & OPT_CLICK_TRACKING);\n          var trackMouseMovement = !!(attributes & OPT_MOVE_TRACKING);\n\n          // 0 - Block blink     2 - Block steady (1 is unused)\n          // 3 - Underline blink 4 - Underline steady\n          // 5 - I-bar blink     6 - I-bar steady\n          var cursorShape = attributes >> 9 & 0x07;\n          // if it's not zero, decrement such that the two most significant bits\n          // are the type and the least significant bit is the blink state\n          if (cursorShape > 0) cursorShape--;\n          var cursorStyle = cursorShape >> 1;\n          var cursorBlinking = !(cursorShape & 1);\n          if (cursorStyle === 0) cursorStyle = 'block';else if (cursorStyle === 1) cursorStyle = 'line';else cursorStyle = 'bar';\n\n          var showButtons = !!(attributes & OPT_SHOW_BUTTONS);\n          var showConfigLinks = !!(attributes & OPT_SHOW_CONFIG_LINKS);\n\n          var bracketedPaste = !!(attributes & OPT_BRACKETED_PASTE);\n          var reverseVideo = !!(attributes & OPT_REVERSE_VIDEO);\n\n          var debugEnabled = !!(attributes & OPT_DEBUGBAR);\n\n          updates.push({\n            topic: 'screen-opts',\n            width: width,\n            height: height,\n            theme: theme,\n            defFG: defFG,\n            defBG: defBG,\n            cursorVisible: cursorVisible,\n            cursorBlinking: cursorBlinking,\n            cursorStyle: cursorStyle,\n            inputAlts: inputAlts,\n            trackMouseClicks: trackMouseClicks,\n            trackMouseMovement: trackMouseMovement,\n            showButtons: showButtons,\n            showConfigLinks: showConfigLinks,\n            bracketedPaste: bracketedPaste,\n            reverseVideo: reverseVideo,\n            debugEnabled: debugEnabled\n          });\n        } else if (topic === TOPIC_CURSOR) {\n          // cursor position\n          var y = du(strArray[ci++]);\n          var x = du(strArray[ci++]);\n          var hanging = !!du(strArray[ci++]);\n\n          updates.push({\n            topic: 'cursor',\n            x: x,\n            y: y,\n            hanging: hanging\n          });\n        } else if (topic === TOPIC_STATIC_OPTS) {\n          var fontStack = collectOneTerminatedString();\n          var fontSize = du(strArray[ci++]);\n\n          updates.push({\n            topic: 'static-opts',\n            fontStack: fontStack,\n            fontSize: fontSize\n          });\n        } else if (topic === TOPIC_DOUBLE_LINES) {\n          var lines = [];\n          var count = du(strArray[ci++]);\n          for (var i = 0; i < count; i++) {\n            // format: INDEX<<3 | (dbl-h-bot : dbl-h-top : dbl-w)\n            var n = du(strArray[ci++]);\n            lines[n >> 3] = n & 7;\n          }\n          updates.push({ topic: 'double-lines', lines: lines });\n        } else if (topic === TOPIC_TITLE) {\n          updates.push({ topic: 'title', title: collectOneTerminatedString() });\n        } else if (topic === TOPIC_BUTTONS) {\n          var _count = du(strArray[ci++]);\n\n          var labels = [];\n          var colors = [];\n          for (var j = 0; j < _count; j++) {\n            colors.push(collectColor());\n            labels.push(collectOneTerminatedString());\n          }\n\n          updates.push({\n            topic: 'buttons-update',\n            labels: labels,\n            colors: colors\n          });\n        } else if (topic === TOPIC_BACKDROP) {\n          updates.push({ topic: 'backdrop', image: collectOneTerminatedString() });\n        } else if (topic === TOPIC_BELL) {\n          updates.push({ topic: 'bell' });\n        } else if (topic === TOPIC_INTERNAL) {\n          // debug info\n          var flags = du(strArray[ci++]);\n          var cursorAttrs = du(strArray[ci++]);\n          var regionStart = du(strArray[ci++]);\n          var regionEnd = du(strArray[ci++]);\n          var charsetGx = du(strArray[ci++]);\n          var charsetG0 = strArray[ci++];\n          var charsetG1 = strArray[ci++];\n\n          var cursorFg = collectColor();\n          var cursorBg = collectColor();\n\n          var freeHeap = du(strArray[ci++]);\n          var clientCount = du(strArray[ci++]);\n\n          updates.push({\n            topic: 'internal',\n            flags: flags,\n            cursorAttrs: cursorAttrs,\n            regionStart: regionStart,\n            regionEnd: regionEnd,\n            charsetGx: charsetGx,\n            charsetG0: charsetG0,\n            charsetG1: charsetG1,\n            cursorFg: cursorFg,\n            cursorBg: cursorBg,\n            freeHeap: freeHeap,\n            clientCount: clientCount\n          });\n        } else if (topic === TOPIC_CONTENT) {\n          (function () {\n            // set screen content\n            var frameY = du(strArray[ci++]);\n            var frameX = du(strArray[ci++]);\n            var frameHeight = du(strArray[ci++]);\n            var frameWidth = du(strArray[ci++]);\n\n            // content\n            var fg = 7;\n            var bg = 0;\n            var attrs = 0;\n            var cell = 0; // cell index\n            var lastChar = ' ';\n            var frameLength = frameWidth * frameHeight;\n\n            var MASK_LINE_ATTR = ATTR_UNDERLINE | ATTR_OVERLINE | ATTR_STRIKE;\n            var MASK_BLINK = ATTR_BLINK;\n\n            var cells = [];\n\n            var pushCell = function pushCell() {\n              var hasFG = attrs & ATTR_FG;\n              var hasBG = attrs & ATTR_BG;\n              var cellFG = fg;\n              var cellBG = bg;\n              var cellAttrs = attrs;\n\n              // use 0,0 if no fg/bg. this is to match back-end implementation\n              // and allow leaving out fg/bg setting for cells with none\n              if (!hasFG) cellFG = 0;\n              if (!hasBG) cellBG = 0;\n\n              // Remove blink attribute if it wouldn't have any effect\n              if (cellAttrs & MASK_BLINK && (lastChar === ' ' && (cellAttrs & MASK_LINE_ATTR) === 0 || // no line styles\n              fg === bg && hasFG && hasBG // invisible text\n              )) {\n                cellAttrs ^= MASK_BLINK;\n              }\n\n              // 8 dark system colors turn bright when bold\n              if (cellAttrs & ATTR_BOLD && !(cellAttrs & ATTR_FAINT) && hasFG && cellFG < 8) {\n                cellFG += 8;\n              }\n\n              cells.push([lastChar, cellFG, cellBG, cellAttrs]);\n            };\n\n            while (ci < strArray.length && cell < frameLength) {\n              var character = strArray[ci++];\n              var charCode = character.codePointAt(0);\n\n              var data = void 0,\n                  _count2 = void 0;\n              switch (charCode) {\n                case SEQ_REPEAT:\n                  _count2 = du(strArray[ci++]);\n                  for (var _j = 0; _j < _count2; _j++) {\n                    pushCell();\n                    if (++cell > frameLength) break;\n                  }\n                  break;\n\n                case SEQ_SKIP:\n                  cell += du(strArray[ci++]);\n                  break;\n\n                case SEQ_SET_COLORS:\n                  data = du(strArray[ci++]);\n                  fg = data & 0xFF;\n                  bg = data >> 8 & 0xFF;\n                  break;\n\n                case SEQ_SET_ATTRS:\n                  data = du(strArray[ci++]);\n                  attrs = data & 0xFFFF;\n                  break;\n\n                case SEQ_SET_ATTR_0:\n                  attrs = 0;\n                  break;\n\n                case SEQ_SET_FG:\n                  data = du(strArray[ci++]);\n                  if (data & 0x10000) {\n                    data &= 0xFFF;\n                    data |= (du(strArray[ci++]) & 0xFFF) << 12;\n                    data += 256;\n                  }\n                  fg = data;\n                  break;\n\n                case SEQ_SET_BG:\n                  data = du(strArray[ci++]);\n                  if (data & 0x10000) {\n                    data &= 0xFFF;\n                    data |= (du(strArray[ci++]) & 0xFFF) << 12;\n                    data += 256;\n                  }\n                  bg = data;\n                  break;\n\n                default:\n                  if (charCode < 32) character = '\\uFFFD';\n                  lastChar = character;\n                  pushCell();\n                  cell++;\n              }\n            }\n\n            updates.push({\n              topic: 'content',\n              frameX: frameX,\n              frameY: frameY,\n              frameWidth: frameWidth,\n              frameHeight: frameHeight,\n              cells: cells\n            });\n          })();\n        }\n\n        if (topics & 0x3B && !this.contentLoaded) {\n          updates.push({ topic: 'full-load-complete' });\n          this.contentLoaded = true;\n        }\n      }\n\n      return updates;\n    }\n\n    /**\n     * Parses a message from the server\n     * @param {string} message - the message\n     */\n\n  }, {\n    key: 'parse',\n    value: function parse(message) {\n      var content = message.substr(1);\n      var updates = [];\n\n      // This is a good place for debugging the message\n      // console.log(message)\n\n      switch (message[0]) {\n        case 'U':\n          updates.push.apply(updates, _toConsumableArray(this.parseUpdate(content)));\n          break;\n\n        case 'G':\n          return [{\n            topic: 'notification',\n            content: content\n          }];\n\n        default:\n          console.warn('Bad data message type; ignoring.\\n' + JSON.stringify(message));\n      }\n\n      return updates;\n    }\n  }]);\n\n  return ScreenParser;\n}();\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar EventEmitter = __webpack_require__(2);\nvar CanvasRenderer = __webpack_require__(20);\n\nvar DEFAULT_FONT = '\"DejaVu Sans Mono\", \"Liberation Mono\", \"Inconsolata\", \"Menlo\", monospace';\n\n/**\n * Manages terminal screen layout and sizing\n */\nmodule.exports = function (_EventEmitter) {\n  _inherits(ScreenLayout, _EventEmitter);\n\n  function ScreenLayout() {\n    _classCallCheck(this, ScreenLayout);\n\n    var _this = _possibleConstructorReturn(this, (ScreenLayout.__proto__ || Object.getPrototypeOf(ScreenLayout)).call(this));\n\n    _this.canvas = document.createElement('canvas');\n    _this.renderer = new CanvasRenderer(_this.canvas);\n\n    _this._window = {\n      width: 0,\n      height: 0,\n      devicePixelRatio: 1,\n      fontFamily: DEFAULT_FONT,\n      fontSize: 20,\n      padding: 6,\n      gridScaleX: 1.0,\n      gridScaleY: 1.2,\n      fitIntoWidth: 0,\n      fitIntoHeight: 0,\n      debug: false\n\n      // scaling caused by fitIntoWidth/fitIntoHeight\n    };_this._windowScale = 1;\n\n    // actual padding, as it may be disabled by fullscreen mode etc.\n    _this._padding = 0;\n\n    // properties of this.window that require updating size and redrawing\n    _this.windowState = {\n      width: 0,\n      height: 0,\n      devicePixelRatio: 0,\n      padding: 0,\n      gridScaleX: 0,\n      gridScaleY: 0,\n      fontFamily: '',\n      fontSize: 0,\n      fitIntoWidth: 0,\n      fitIntoHeight: 0\n    };\n\n    _this.charSize = { width: 0, height: 0 };\n\n    var self = _this;\n\n    // make writing to window update size and draw\n    _this.window = new Proxy(_this._window, {\n      set: function set(target, key, value) {\n        if (target[key] !== value) {\n          target[key] = value;\n          self.scheduleSizeUpdate();\n          self.renderer.scheduleDraw('window:' + key + '=' + value);\n          self.emit('update-window:' + key, value);\n        }\n        return true;\n      }\n    });\n\n    _this.on('update-window:debug', function (debug) {\n      _this.renderer.debug = debug;\n    });\n\n    _this.canvas.addEventListener('mousedown', function (e) {\n      return _this.emit('mousedown', e);\n    });\n    _this.canvas.addEventListener('mousemove', function (e) {\n      return _this.emit('mousemove', e);\n    });\n    _this.canvas.addEventListener('mouseup', function (e) {\n      return _this.emit('mouseup', e);\n    });\n    _this.canvas.addEventListener('touchstart', function (e) {\n      return _this.emit('touchstart', e);\n    });\n    _this.canvas.addEventListener('touchmove', function (e) {\n      return _this.emit('touchmove', e);\n    });\n    _this.canvas.addEventListener('touchend', function (e) {\n      return _this.emit('touchend', e);\n    });\n    _this.canvas.addEventListener('wheel', function (e) {\n      return _this.emit('wheel', e);\n    });\n    _this.canvas.addEventListener('contextmenu', function (e) {\n      return _this.emit('contextmenu', e);\n    });\n    return _this;\n  }\n\n  /**\n   * Schedule a size update in the next millisecond\n   */\n\n\n  _createClass(ScreenLayout, [{\n    key: 'scheduleSizeUpdate',\n    value: function scheduleSizeUpdate() {\n      var _this2 = this;\n\n      clearTimeout(this._scheduledSizeUpdate);\n      this._scheduledSizeUpdate = setTimeout(function () {\n        return _this2.updateSize();\n      }, 1);\n    }\n  }, {\n    key: 'getFont',\n\n\n    /**\n     * Returns a CSS font string with the current font settings and the\n     * specified modifiers.\n     * @param {Object} modifiers\n     * @param {string} [modifiers.style] - the font style\n     * @param {string} [modifiers.weight] - the font weight\n     * @returns {string} a CSS font string\n     */\n    value: function getFont() {\n      var modifiers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      var fontStyle = modifiers.style || 'normal';\n      var fontWeight = modifiers.weight || 'normal';\n      var fontFamily = this.window.fontFamily || '';\n      if (fontFamily.length > 0) fontFamily += ',';\n      fontFamily += DEFAULT_FONT;\n      return fontStyle + ' normal ' + fontWeight + ' ' + this.window.fontSize + 'px ' + fontFamily;\n    }\n\n    /**\n     * Converts screen coordinates to grid coordinates.\n     * @param {number} x - x in pixels\n     * @param {number} y - y in pixels\n     * @param {boolean} rounded - whether to round the coord, used for select highlighting\n     * @returns {number[]} a tuple of (x, y) in cells\n     */\n\n  }, {\n    key: 'screenToGrid',\n    value: function screenToGrid(x, y) {\n      var rounded = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      var cellSize = this.getCellSize();\n\n      x = x / this._windowScale - this._padding;\n      y = y / this._windowScale - this._padding;\n      y = Math.floor(y / cellSize.height);\n      if (this.renderer.drawnScreenLines[y]) x /= 2; // double size\n      x = Math.floor((x + (rounded ? cellSize.width / 2 : 0)) / cellSize.width);\n      x = Math.max(0, Math.min(this.window.width - 1, x));\n      y = Math.max(0, Math.min(this.window.height - 1, y));\n\n      return [x, y];\n    }\n\n    /**\n     * Converts grid coordinates to screen coordinates.\n     * @param {number} x - x in cells\n     * @param {number} y - y in cells\n     * @param {boolean} [withScale] - when true, will apply window scale\n     * @returns {number[]} a tuple of (x, y) in pixels\n     */\n\n  }, {\n    key: 'gridToScreen',\n    value: function gridToScreen(x, y) {\n      var _this3 = this;\n\n      var withScale = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      var cellSize = this.getCellSize();\n\n      if (this.renderer.drawnScreenLines[y]) x *= 2; // double size\n\n      return [x * cellSize.width, y * cellSize.height].map(function (v) {\n        return _this3._padding + (withScale ? v * _this3._windowScale : v);\n      });\n    }\n\n    /**\n     * Update the character size, used for calculating the cell size.\n     * The space character is used for measuring.\n     * @returns {Object} the character size with `width` and `height` in pixels\n     */\n\n  }, {\n    key: 'updateCharSize',\n    value: function updateCharSize() {\n      this.charSize = {\n        width: this.renderer.getCharWidthFor(this.getFont()),\n        height: this.window.fontSize\n      };\n\n      return this.charSize;\n    }\n\n    /**\n     * The cell size, which is the character size multiplied by the grid scale.\n     * @returns {Object} the cell size with `width` and `height` in pixels\n     */\n\n  }, {\n    key: 'getCellSize',\n    value: function getCellSize() {\n      if (!this.charSize.height && this.window.fontSize) this.updateCharSize();\n\n      return {\n        width: Math.ceil(this.charSize.width * this.window.gridScaleX),\n        height: Math.ceil(this.charSize.height * this.window.gridScaleY)\n      };\n    }\n\n    /**\n     * Updates the canvas size if it changed\n     */\n\n  }, {\n    key: 'updateSize',\n    value: function updateSize() {\n      // see below (this is just updating it)\n      this._window.devicePixelRatio = Math.ceil(this._windowScale * (window.devicePixelRatio || 1));\n\n      var didChange = false;\n      for (var key in this.windowState) {\n        if (this.windowState.hasOwnProperty(key) && this.windowState[key] !== this.window[key]) {\n          didChange = true;\n          this.windowState[key] = this.window[key];\n        }\n      }\n\n      if (didChange) {\n        var _window = this.window,\n            width = _window.width,\n            height = _window.height,\n            fitIntoWidth = _window.fitIntoWidth,\n            fitIntoHeight = _window.fitIntoHeight,\n            padding = _window.padding;\n\n\n        this.updateCharSize();\n        var cellSize = this.getCellSize();\n\n        // real height of the canvas element in pixels\n        var realWidth = width * cellSize.width;\n        var realHeight = height * cellSize.height;\n        var originalWidth = realWidth;\n\n        if (fitIntoWidth && fitIntoHeight) {\n          var terminalAspect = realWidth / realHeight;\n          var fitAspect = fitIntoWidth / fitIntoHeight;\n\n          if (terminalAspect < fitAspect) {\n            // align heights\n            realHeight = fitIntoHeight - 2 * padding;\n            realWidth = realHeight * terminalAspect;\n          } else {\n            // align widths\n            realWidth = fitIntoWidth - 2 * padding;\n            realHeight = realWidth / terminalAspect;\n          }\n        }\n\n        // store new window scale\n        this._windowScale = realWidth / originalWidth;\n\n        realWidth += 2 * padding;\n        realHeight += 2 * padding;\n\n        // store padding\n        this._padding = padding * (originalWidth / realWidth);\n\n        // the DPR must be rounded to a very nice value to prevent gaps between cells\n        var devicePixelRatio = this._window.devicePixelRatio = Math.ceil(this._windowScale * (window.devicePixelRatio || 1));\n\n        this.canvas.width = (width * cellSize.width + 2 * Math.round(this._padding)) * devicePixelRatio;\n        this.canvas.style.width = realWidth + 'px';\n        this.canvas.height = (height * cellSize.height + 2 * Math.round(this._padding)) * devicePixelRatio;\n        this.canvas.style.height = realHeight + 'px';\n\n        // the screen has been cleared (by changing canvas width)\n        this.renderer.resetDrawn();\n\n        this.renderer.render('update-size', this.serializeRenderData());\n\n        this.emit('size-update');\n      }\n    }\n  }, {\n    key: 'serializeRenderData',\n    value: function serializeRenderData() {\n      return {\n        padding: Math.round(this._padding),\n        devicePixelRatio: this.window.devicePixelRatio,\n        charSize: this.charSize,\n        cellSize: this.getCellSize(),\n        fonts: [this.getFont(), this.getFont({ weight: 'bold' }), this.getFont({ style: 'italic' }), this.getFont({ weight: 'bold', style: 'italic' })]\n      };\n    }\n  }, {\n    key: 'render',\n    value: function render(reason, data) {\n      this.window.width = data.width;\n      this.window.height = data.height;\n\n      Object.assign(data, this.serializeRenderData());\n\n      this.renderer.render(reason, data);\n    }\n  }, {\n    key: 'backgroundImage',\n    get: function get() {\n      return this.canvas.style.backgroundImage;\n    },\n    set: function set(value) {\n      this.canvas.style.backgroundImage = value ? 'url(' + value + ')' : '';\n      if (this.renderer.backgroundImage !== !!value) {\n        this.renderer.backgroundImage = !!value;\n        this.renderer.resetDrawn();\n        this.renderer.scheduleDraw('background-image');\n      }\n    }\n  }, {\n    key: 'selectable',\n    get: function get() {\n      return this.canvas.classList.contains('selectable');\n    },\n    set: function set(selectable) {\n      if (selectable) this.canvas.classList.add('selectable');else this.canvas.classList.remove('selectable');\n    }\n  }]);\n\n  return ScreenLayout;\n}(EventEmitter);\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar EventEmitter = __webpack_require__(2);\n\nvar _require = __webpack_require__(3),\n    themes = _require.themes,\n    _getColor = _require.getColor;\n\nvar _require2 = __webpack_require__(6),\n    ATTR_FG = _require2.ATTR_FG,\n    ATTR_BG = _require2.ATTR_BG,\n    ATTR_BOLD = _require2.ATTR_BOLD,\n    ATTR_UNDERLINE = _require2.ATTR_UNDERLINE,\n    ATTR_INVERSE = _require2.ATTR_INVERSE,\n    ATTR_BLINK = _require2.ATTR_BLINK,\n    ATTR_ITALIC = _require2.ATTR_ITALIC,\n    ATTR_STRIKE = _require2.ATTR_STRIKE,\n    ATTR_OVERLINE = _require2.ATTR_OVERLINE,\n    ATTR_FAINT = _require2.ATTR_FAINT,\n    ATTR_FRAKTUR = _require2.ATTR_FRAKTUR;\n\n// Some non-bold Fraktur symbols are outside the contiguous block\n\n\nvar frakturExceptions = {\n  'C': '\\u212D',\n  'H': '\\u210C',\n  'I': '\\u2111',\n  'R': '\\u211C',\n  'Z': '\\u2128'\n\n  /**\n   * A terminal screen renderer, using canvas 2D\n   */\n};module.exports = function (_EventEmitter) {\n  _inherits(CanvasRenderer, _EventEmitter);\n\n  function CanvasRenderer(canvas) {\n    _classCallCheck(this, CanvasRenderer);\n\n    var _this = _possibleConstructorReturn(this, (CanvasRenderer.__proto__ || Object.getPrototypeOf(CanvasRenderer)).call(this));\n\n    _this.canvas = canvas;\n    _this.ctx = _this.canvas.getContext('2d');\n\n    _this._palette = null; // colors 0-15\n    _this.defaultBG = 0;\n    _this.defaultFG = 7;\n\n    _this.debug = false;\n    _this._debug = null;\n\n    _this.graphics = 0;\n\n    _this.statusFont = \"-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif\";\n\n    // screen data, considered immutable\n    _this.width = 0;\n    _this.height = 0;\n    _this.padding = 0;\n    _this.charSize = { width: 0, height: 0 };\n    _this.cellSize = { width: 0, height: 0 };\n    _this.fonts = ['', '', '', '']; // normal, bold, italic, bold-italic\n    _this.screen = [];\n    _this.screenFG = [];\n    _this.screenBG = [];\n    _this.screenAttrs = [];\n    _this.screenSelection = [];\n    _this.screenLines = [];\n    _this.cursor = {};\n    _this.reverseVideo = false;\n    _this.hasBlinkingCells = false;\n    _this.statusScreen = null;\n\n    _this.resetDrawn();\n\n    _this.blinkStyleOn = false;\n    _this.blinkInterval = null;\n    _this.cursorBlinkOn = false;\n    _this.cursorBlinkInterval = null;\n\n    // start blink timers\n    _this.resetBlink();\n    _this.resetCursorBlink();\n    return _this;\n  }\n\n  _createClass(CanvasRenderer, [{\n    key: 'render',\n    value: function render(reason, data) {\n      if ('hasBlinkingCells' in data && data.hasBlinkingCells !== this.hasBlinkingCells) {\n        if (data.hasBlinkingCells) this.resetBlink();else clearInterval(this.blinkInterval);\n      }\n\n      Object.assign(this, data);\n      this.scheduleDraw(reason);\n    }\n  }, {\n    key: 'resetDrawn',\n    value: function resetDrawn() {\n      // used to determine if a cell should be redrawn; storing the current state\n      // as it is on screen\n      if (this.debug) console.log('Resetting drawn screen');\n\n      this.drawnScreen = [];\n      this.drawnScreenFG = [];\n      this.drawnScreenBG = [];\n      this.drawnScreenAttrs = [];\n      this.drawnScreenLines = [];\n      this.drawnCursor = [-1, -1, '', false];\n    }\n\n    /**\n     * The color palette. Should define 16 colors in an array.\n     * @type {string[]}\n     */\n\n  }, {\n    key: 'getCharWidthFor',\n    value: function getCharWidthFor(font) {\n      this.ctx.font = font;\n      return Math.floor(this.ctx.measureText(' ').width);\n    }\n  }, {\n    key: 'loadTheme',\n    value: function loadTheme(i) {\n      if (i in themes) this.palette = themes[i];\n    }\n  }, {\n    key: 'setDefaultColors',\n    value: function setDefaultColors(fg, bg) {\n      if (fg !== this.defaultFG || bg !== this.defaultBG) {\n        this.resetDrawn();\n        this.defaultFG = fg;\n        this.defaultBG = bg;\n        this.scheduleDraw('default-colors');\n\n        // full bg with default color (goes behind the image)\n        this.canvas.style.backgroundColor = this.getColor(bg);\n      }\n    }\n\n    /**\n     * Schedule a draw in the next millisecond\n     * @param {string} why - the reason why the draw occured (for debugging)\n     * @param {number} [aggregateTime] - time to wait for more scheduleDraw calls\n     *   to occur. 1 ms by default.\n     */\n\n  }, {\n    key: 'scheduleDraw',\n    value: function scheduleDraw(why) {\n      var _this2 = this;\n\n      var aggregateTime = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n\n      clearTimeout(this._scheduledDraw);\n      this._scheduledDraw = setTimeout(function () {\n        return _this2.draw(why);\n      }, aggregateTime);\n    }\n\n    /**\n     * Returns the specified color. If `i` is in the palette, it will return the\n     * palette color. If `i` is between 16 and 255, it will return the 256color\n     * value. If `i` is larger than 255, it will return an RGB color value. If `i`\n     * is -1 (foreground) or -2 (background), it will return the selection colors.\n     * @param {number} i - the color\n     * @returns {string} the CSS color\n     */\n\n  }, {\n    key: 'getColor',\n    value: function getColor(i) {\n      return _getColor(i, this.palette);\n    }\n\n    /**\n     * Resets the cursor blink to on and restarts the timer\n     */\n\n  }, {\n    key: 'resetCursorBlink',\n    value: function resetCursorBlink() {\n      var _this3 = this;\n\n      this.cursorBlinkOn = true;\n      clearInterval(this.cursorBlinkInterval);\n      this.cursorBlinkInterval = setInterval(function () {\n        _this3.cursorBlinkOn = _this3.cursor.blinking ? !_this3.cursorBlinkOn : true;\n        if (_this3.cursor.blinking) _this3.scheduleDraw('cursor-blink');\n      }, 500);\n    }\n\n    /**\n     * Resets the blink style to on and restarts the timer\n     */\n\n  }, {\n    key: 'resetBlink',\n    value: function resetBlink() {\n      var _this4 = this;\n\n      this.blinkStyleOn = true;\n      clearInterval(this.blinkInterval);\n      var intervals = 0;\n      this.blinkInterval = setInterval(function () {\n        if (_this4.blinkingCellCount <= 0) return;\n\n        intervals++;\n        if (intervals >= 4 && _this4.blinkStyleOn) {\n          _this4.blinkStyleOn = false;\n          intervals = 0;\n          _this4.scheduleDraw('blink-style');\n        } else if (intervals >= 1 && !_this4.blinkStyleOn) {\n          _this4.blinkStyleOn = true;\n          intervals = 0;\n          _this4.scheduleDraw('blink-style');\n        }\n      }, 200);\n    }\n\n    /**\n     * Draws a cell's background with the given parameters.\n     * @param {Object} options\n     * @param {number} options.x - x in cells\n     * @param {number} options.y - y in cells\n     * @param {number} options.cellWidth - cell width in pixels\n     * @param {number} options.cellHeight - cell height in pixels\n     * @param {number} options.bg - the background color\n     * @param {number} options.isDefaultBG - if true, will draw image background if available\n     */\n\n  }, {\n    key: 'drawBackground',\n    value: function drawBackground(_ref) {\n      var x = _ref.x,\n          y = _ref.y,\n          cellWidth = _ref.cellWidth,\n          cellHeight = _ref.cellHeight,\n          bg = _ref.bg,\n          isDefaultBG = _ref.isDefaultBG;\n      var ctx = this.ctx,\n          width = this.width,\n          height = this.height,\n          padding = this.padding;\n\n      // is a double-width/double-height line\n\n      if (this.screenLines[y] & 1) cellWidth *= 2;\n\n      ctx.fillStyle = this.getColor(bg);\n      var screenX = x * cellWidth + padding;\n      var screenY = y * cellHeight + padding;\n      var isBorderCell = x === 0 || y === 0 || x === width - 1 || y === height - 1;\n\n      var fillX = void 0,\n          fillY = void 0,\n          fillWidth = void 0,\n          fillHeight = void 0;\n      if (isBorderCell) {\n        var left = screenX;\n        var top = screenY;\n        var right = screenX + cellWidth;\n        var bottom = screenY + cellHeight;\n        if (x === 0) left -= padding;else if (x === width - 1) right += padding;\n        if (y === 0) top -= padding;else if (y === height - 1) bottom += padding;\n\n        fillX = left;\n        fillY = top;\n        fillWidth = right - left;\n        fillHeight = bottom - top;\n      } else {\n        fillX = screenX;\n        fillY = screenY;\n        fillWidth = cellWidth;\n        fillHeight = cellHeight;\n      }\n\n      ctx.clearRect(fillX, fillY, fillWidth, fillHeight);\n\n      if (!isDefaultBG || bg < 0 || !this.backgroundImage) {\n        ctx.fillRect(fillX, fillY, fillWidth, fillHeight);\n      }\n    }\n\n    /**\n     * Draws a cell's character with the given parameters. Won't do anything if\n     * text is an empty string.\n     * @param {Object} options\n     * @param {number} options.x - x in cells\n     * @param {number} options.y - y in cells\n     * @param {Object} options.charSize - the character size, an object with\n     *   `width` and `height` in pixels\n     * @param {number} options.cellWidth - cell width in pixels\n     * @param {number} options.cellHeight - cell height in pixels\n     * @param {string} options.text - the cell content\n     * @param {number} options.fg - the foreground color\n     * @param {number} options.attrs - the cell's attributes\n     */\n\n  }, {\n    key: 'drawCharacter',\n    value: function drawCharacter(_ref2) {\n      var x = _ref2.x,\n          y = _ref2.y,\n          charSize = _ref2.charSize,\n          cellWidth = _ref2.cellWidth,\n          cellHeight = _ref2.cellHeight,\n          text = _ref2.text,\n          fg = _ref2.fg,\n          attrs = _ref2.attrs;\n\n      if (!text) return;\n\n      var ctx = this.ctx,\n          padding = this.padding;\n\n\n      var underline = false;\n      var strike = false;\n      var overline = false;\n      if (attrs & ATTR_FAINT) ctx.globalAlpha = 0.5;\n      if (attrs & ATTR_UNDERLINE) underline = true;\n      if (attrs & ATTR_FRAKTUR) text = CanvasRenderer.alphaToFraktur(text);\n      if (attrs & ATTR_STRIKE) strike = true;\n      if (attrs & ATTR_OVERLINE) overline = true;\n\n      ctx.fillStyle = this.getColor(fg);\n\n      var screenX = x * cellWidth + padding;\n      var screenY = y * cellHeight + padding;\n\n      var dblWidth = this.screenLines[y] & 1;\n      var dblHeightTop = this.screenLines[y] & 2;\n      var dblHeightBot = this.screenLines[y] & 4;\n\n      if (this.screenLines[y]) {\n        // is a double-width/double-height line\n        if (dblWidth) cellWidth *= 2;\n\n        ctx.save();\n        ctx.translate(padding, screenY + 0.5 * cellHeight);\n        if (dblWidth) ctx.scale(2, 1);\n        if (dblHeightTop) {\n          // top half\n          ctx.scale(1, 2);\n          ctx.translate(0, cellHeight / 4);\n        } else if (dblHeightBot) {\n          // bottom half\n          ctx.scale(1, 2);\n          ctx.translate(0, -cellHeight / 4);\n        }\n        ctx.translate(-padding, -screenY - 0.5 * cellHeight);\n        if (dblWidth) ctx.translate(-cellWidth / 4, 0);\n\n        if (dblHeightBot || dblHeightTop) {\n          // characters overflow -- needs clipping\n          // TODO: clipping is really expensive\n          ctx.beginPath();\n          if (dblHeightTop) ctx.rect(screenX, screenY, cellWidth, cellHeight / 2);else ctx.rect(screenX, screenY + cellHeight / 2, cellWidth, cellHeight / 2);\n          ctx.clip();\n        }\n      }\n\n      var codePoint = text.codePointAt(0);\n      if (codePoint >= 0x2580 && codePoint <= 0x259F) {\n        // block elements\n        ctx.beginPath();\n        var left = screenX;\n        var top = screenY;\n        var cw = cellWidth;\n        var ch = cellHeight;\n        var c2w = cellWidth / 2;\n        var c2h = cellHeight / 2;\n\n        // http://www.fileformat.info/info/unicode/block/block_elements/utf8test.htm\n        //         0x00  0x01  0x02  0x03  0x04  0x05  0x06  0x07  0x08  0x09  0x0A  0x0B  0x0C  0x0D  0x0E  0x0F\n        // 0x2580     ▀     ▁     ▂     ▃     ▄     ▅     ▆     ▇     █     ▉     ▊     ▋     ▌     ▍     ▎     ▏\n        // 0x2590     ▐     ░     ▒     ▓     ▔     ▕     ▖     ▗     ▘     ▙     ▚     ▛     ▜     ▝     ▞     ▟\n\n        if (codePoint === 0x2580) {\n          // upper half block >▀<\n          ctx.rect(left, top, cw, c2h);\n        } else if (codePoint <= 0x2588) {\n          // lower n eighth block (increasing) >▁< to >█<\n          var offset = (1 - (codePoint - 0x2580) / 8) * ch;\n          ctx.rect(left, top + offset, cw, ch - offset);\n        } else if (codePoint <= 0x258F) {\n          // left n eighth block (decreasing) >▉< to >▏<\n          var _offset = (codePoint - 0x2588) / 8 * cw;\n          ctx.rect(left, top, cw - _offset, ch);\n        } else if (codePoint === 0x2590) {\n          // right half block >▐<\n          ctx.rect(left + c2w, top, c2w, ch);\n        } else if (codePoint <= 0x2593) {\n          // shading >░< >▒< >▓<\n\n          // dot spacing by dividing cell size by a constant. This could be\n          // reworked to always return a whole number, but that would require\n          // prime factorization, and doing that without a loop would let you\n          // take over the world, which is not within the scope of this project.\n          var dotSpacingX = void 0,\n              dotSpacingY = void 0,\n              dotSize = void 0;\n          if (codePoint === 0x2591) {\n            dotSpacingX = cw / 4;\n            dotSpacingY = ch / 10;\n            dotSize = 1;\n          } else if (codePoint === 0x2592) {\n            dotSpacingX = cw / 6;\n            dotSpacingY = cw / 10;\n            dotSize = 1;\n          } else if (codePoint === 0x2593) {\n            dotSpacingX = cw / 4;\n            dotSpacingY = cw / 7;\n            dotSize = 2;\n          }\n\n          var alignRight = false;\n          for (var dy = 0; dy < ch; dy += dotSpacingY) {\n            for (var dx = 0; dx < cw; dx += dotSpacingX) {\n              // prevent overflow\n              var dotSizeY = Math.min(dotSize, ch - dy);\n              ctx.rect(left + (alignRight ? cw - dx - dotSize : dx), top + dy, dotSize, dotSizeY);\n            }\n            alignRight = !alignRight;\n          }\n        } else if (codePoint === 0x2594) {\n          // upper one eighth block >▔<\n          ctx.rect(left, top, cw, ch / 8);\n        } else if (codePoint === 0x2595) {\n          // right one eighth block >▕<\n          ctx.rect(left + 7 / 8 * cw, top, cw / 8, ch);\n        } else if (codePoint === 0x2596) {\n          // left bottom quadrant >▖<\n          ctx.rect(left, top + c2h, c2w, c2h);\n        } else if (codePoint === 0x2597) {\n          // right bottom quadrant >▗<\n          ctx.rect(left + c2w, top + c2h, c2w, c2h);\n        } else if (codePoint === 0x2598) {\n          // left top quadrant >▘<\n          ctx.rect(left, top, c2w, c2h);\n        } else if (codePoint === 0x2599) {\n          // left chair >▙<\n          ctx.rect(left, top, c2w, ch);\n          ctx.rect(left + c2w, top + c2h, c2w, c2h);\n        } else if (codePoint === 0x259A) {\n          // quadrants lt rb >▚<\n          ctx.rect(left, top, c2w, c2h);\n          ctx.rect(left + c2w, top + c2h, c2w, c2h);\n        } else if (codePoint === 0x259B) {\n          // left chair upside down >▛<\n          ctx.rect(left, top, c2w, ch);\n          ctx.rect(left + c2w, top, c2w, c2h);\n        } else if (codePoint === 0x259C) {\n          // right chair upside down >▜<\n          ctx.rect(left, top, cw, c2h);\n          ctx.rect(left + c2w, top + c2h, c2w, c2h);\n        } else if (codePoint === 0x259D) {\n          // right top quadrant >▝<\n          ctx.rect(left + c2w, top, c2w, c2h);\n        } else if (codePoint === 0x259E) {\n          // quadrants lb rt >▞<\n          ctx.rect(left, top + c2h, c2w, c2h);\n          ctx.rect(left + c2w, top, c2w, c2h);\n        } else if (codePoint === 0x259F) {\n          // right chair upside down >▟<\n          ctx.rect(left, top + c2h, c2w, c2h);\n          ctx.rect(left + c2w, top, c2w, ch);\n        }\n\n        ctx.fill();\n      } else if (codePoint >= 0xE0B0 && codePoint <= 0xE0B3) {\n        // powerline symbols, except branch, line, and lock. Basically, just the triangles\n        ctx.beginPath();\n\n        if (codePoint === 0xE0B0 || codePoint === 0xE0B1) {\n          // right-pointing triangle\n          ctx.moveTo(screenX, screenY);\n          ctx.lineTo(screenX + cellWidth, screenY + cellHeight / 2);\n          ctx.lineTo(screenX, screenY + cellHeight);\n        } else if (codePoint === 0xE0B2 || codePoint === 0xE0B3) {\n          // left-pointing triangle\n          ctx.moveTo(screenX + cellWidth, screenY);\n          ctx.lineTo(screenX, screenY + cellHeight / 2);\n          ctx.lineTo(screenX + cellWidth, screenY + cellHeight);\n        }\n\n        if (codePoint % 2 === 0) {\n          // triangle\n          ctx.fill();\n        } else {\n          // chevron\n          ctx.strokeStyle = ctx.fillStyle;\n          ctx.stroke();\n        }\n      } else {\n        // Draw other characters using the text renderer\n        ctx.fillText(text, screenX + 0.5 * cellWidth, screenY + 0.5 * cellHeight);\n      }\n\n      // -- line drawing - a reference for a possible future rect/line implementation ---\n      // http://www.fileformat.info/info/unicode/block/box_drawing/utf8test.htm\n      //         0x00  0x01  0x02  0x03  0x04  0x05  0x06  0x07  0x08  0x09  0x0A  0x0B  0x0C  0x0D  0x0E  0x0F\n      // 0x2500     ─     ━     │     ┃     ┄     ┅     ┆     ┇     ┈     ┉     ┊     ┋     ┌     ┍     ┎     ┏\n      // 0x2510     ┐     ┑     ┒     ┓     └     ┕     ┖     ┗     ┘     ┙     ┚     ┛     ├     ┝     ┞     ┟\n      // 0x2520     ┠     ┡     ┢     ┣     ┤     ┥     ┦     ┧     ┨     ┩     ┪     ┫     ┬     ┭     ┮     ┯\n      // 0x2530     ┰     ┱     ┲     ┳     ┴     ┵     ┶     ┷     ┸     ┹     ┺     ┻     ┼     ┽     ┾     ┿\n      // 0x2540     ╀     ╁     ╂     ╃     ╄     ╅     ╆     ╇     ╈     ╉     ╊     ╋     ╌     ╍     ╎     ╏\n      // 0x2550     ═     ║     ╒     ╓     ╔     ╕     ╖     ╗     ╘     ╙     ╚     ╛     ╜     ╝     ╞     ╟\n      // 0x2560     ╠     ╡     ╢     ╣     ╤     ╥     ╦     ╧     ╨     ╩     ╪     ╫     ╬     ╭     ╮     ╯\n      // 0x2570     ╰     ╱     ╲     ╳     ╴     ╵     ╶     ╷     ╸     ╹     ╺     ╻     ╼     ╽     ╾     ╿\n\n      if (underline || strike || overline) {\n        ctx.strokeStyle = this.getColor(fg);\n        ctx.lineWidth = 1;\n        ctx.lineCap = 'round';\n        ctx.beginPath();\n\n        if (underline) {\n          var lineY = Math.round(screenY + charSize.height) + 0.5;\n          ctx.moveTo(screenX, lineY);\n          ctx.lineTo(screenX + cellWidth, lineY);\n        }\n\n        if (strike) {\n          var _lineY = Math.round(screenY + 0.5 * cellHeight) + 0.5;\n          ctx.moveTo(screenX, _lineY);\n          ctx.lineTo(screenX + cellWidth, _lineY);\n        }\n\n        if (overline) {\n          var _lineY2 = Math.round(screenY) + 0.5;\n          ctx.moveTo(screenX, _lineY2);\n          ctx.lineTo(screenX + cellWidth, _lineY2);\n        }\n\n        ctx.stroke();\n      }\n\n      if (this.screenLines[y]) ctx.restore();\n\n      ctx.globalAlpha = 1;\n    }\n\n    /**\n     * Returns all adjacent cell indices given a radius.\n     * @param {number} cell - the center cell index\n     * @param {number} [radius] - the radius. 1 by default\n     * @returns {number[]} an array of cell indices\n     */\n\n  }, {\n    key: 'getAdjacentCells',\n    value: function getAdjacentCells(cell) {\n      var radius = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n      var width = this.width,\n          height = this.height;\n\n      var screenLength = width * height;\n\n      var cells = [];\n\n      for (var x = -radius; x <= radius; x++) {\n        for (var y = -radius; y <= radius; y++) {\n          if (x === 0 && y === 0) continue;\n          cells.push(cell + x + y * width);\n        }\n      }\n\n      return cells.filter(function (cell) {\n        return cell >= 0 && cell < screenLength;\n      });\n    }\n\n    /**\n     * Updates the screen.\n     * @param {string} why - the draw reason (for debugging)\n     */\n\n  }, {\n    key: 'draw',\n    value: function draw(why) {\n      var ctx = this.ctx;\n      var width = this.width,\n          height = this.height,\n          devicePixelRatio = this.devicePixelRatio,\n          statusScreen = this.statusScreen;\n\n\n      if (statusScreen) {\n        // draw status screen instead\n        this.drawStatus(statusScreen);\n        this.startDrawLoop();\n        return;\n      } else this.stopDrawLoop();\n\n      var charSize = this.charSize;\n      var _cellSize = this.cellSize,\n          cellWidth = _cellSize.width,\n          cellHeight = _cellSize.height;\n\n      var screenLength = width * height;\n\n      ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);\n\n      if (this.debug && this._debug) this._debug.drawStart(why);\n\n      ctx.font = this.fonts[0];\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n\n      // bits in the attr value that affect the font\n      var FONT_MASK = ATTR_BOLD | ATTR_ITALIC;\n\n      // Map of (attrs & FONT_MASK) -> Array of cell indices\n      var fontGroups = new Map();\n\n      // Map of (cell index) -> boolean, whether or not a cell has updated\n      var updateMap = new Map();\n\n      for (var cell = 0; cell < screenLength; cell++) {\n        var x = cell % width;\n        var y = Math.floor(cell / width);\n        var isCursor = this.cursorBlinkOn && this.cursor.x === x && this.cursor.y === y && this.cursor.visible;\n\n        var wasCursor = x === this.drawnCursor[0] && y === this.drawnCursor[1];\n\n        var text = this.screen[cell];\n        var fg = this.screenFG[cell] | 0;\n        var bg = this.screenBG[cell] | 0;\n        var attrs = this.screenAttrs[cell] | 0;\n        var inSelection = this.screenSelection[cell];\n\n        var isDefaultBG = false;\n\n        if (!(attrs & ATTR_FG)) fg = this.defaultFG;\n        if (!(attrs & ATTR_BG)) {\n          bg = this.defaultBG;\n          isDefaultBG = true;\n        }\n\n        if (attrs & ATTR_INVERSE) {\n          ;var _ref3 = [bg, fg];\n          fg = _ref3[0];\n          bg = _ref3[1];\n        } // swap - reversed character colors\n        if (this.reverseVideo) {\n          ;var _ref4 = [bg, fg];\n          fg = _ref4[0];\n          bg = _ref4[1];\n        } // swap - reversed all screen\n\n        if (attrs & ATTR_BLINK && !this.blinkStyleOn) {\n          // blinking is enabled and blink style is off\n          // set text to nothing so drawCharacter only draws decoration\n          text = ' ';\n        }\n\n        if (inSelection) {\n          fg = -1;\n          bg = -2;\n        }\n\n        var didUpdate = text !== this.drawnScreen[cell] || // text updated\n        fg !== this.drawnScreenFG[cell] || // foreground updated, and this cell has text\n        bg !== this.drawnScreenBG[cell] || // background updated\n        attrs !== this.drawnScreenAttrs[cell] || // attributes updated\n        this.screenLines[y] !== this.drawnScreenLines[y] || // line updated\n        // TODO: fix artifacts or keep this hack:\n        isCursor || wasCursor || // cursor blink/position updated\n        isCursor && this.cursor.style !== this.drawnCursor[2] || // cursor style updated\n        isCursor && this.cursor.hanging !== this.drawnCursor[3]; // cursor hanging updated\n\n        var font = attrs & FONT_MASK;\n        if (!fontGroups.has(font)) fontGroups.set(font, []);\n\n        fontGroups.get(font).push({ cell: cell, x: x, y: y, text: text, fg: fg, bg: bg, attrs: attrs, isCursor: isCursor, inSelection: inSelection, isDefaultBG: isDefaultBG });\n        updateMap.set(cell, didUpdate);\n      }\n\n      // set drawn screen lines\n      this.drawnScreenLines = this.screenLines.slice();\n\n      var debugFilledUpdates = [];\n\n      if (this.graphics >= 1) {\n        // fancy graphics gets really slow when there's a lot of masks\n        // so here's an algorithm that fills in holes in the update map\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = updateMap.keys()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var _cell = _step.value;\n\n            if (updateMap.get(_cell)) continue;\n            var previous = updateMap.get(_cell - 1) || false;\n            var next = updateMap.get(_cell + 1) || false;\n\n            if (previous && next) {\n              // set cell to true of horizontally adjacent updated\n              updateMap.set(_cell, true);\n              if (this.debug && this._debug) debugFilledUpdates.push(_cell);\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n\n      // Map of (cell index) -> boolean, whether or not a cell should be redrawn\n      var redrawMap = new Map();\n      var maskedCells = new Map();\n\n      var isTextWide = function isTextWide(text) {\n        return text !== ' ' && ctx.measureText(text).width >= cellWidth + 0.05;\n      };\n\n      // decide for each cell if it should be redrawn\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = updateMap.keys()[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var _cell2 = _step2.value;\n\n          var shouldUpdate = updateMap.get(_cell2) || redrawMap.get(_cell2) || false;\n\n          // TODO: fonts (necessary?)\n          var _text = this.screen[_cell2];\n          var isWideCell = isTextWide(_text);\n          var checkRadius = isWideCell ? 2 : 1;\n\n          if (!shouldUpdate) {\n            // check adjacent cells\n            var adjacentDidUpdate = false;\n\n            var _iteratorNormalCompletion6 = true;\n            var _didIteratorError6 = false;\n            var _iteratorError6 = undefined;\n\n            try {\n              for (var _iterator6 = this.getAdjacentCells(_cell2, checkRadius)[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n                var adjacentCell = _step6.value;\n\n                // update this cell if:\n                // - the adjacent cell updated (For now, this'll always be true because characters can be slightly larger than they say they are)\n                // - the adjacent cell updated and this cell or the adjacent cell is wide\n                // - this or the adjacent cell is not double-sized\n                if (updateMap.get(adjacentCell) && (this.graphics < 2 || isWideCell || isTextWide(this.screen[adjacentCell])) && !this.screenLines[Math.floor(_cell2 / this.width)] && !this.screenLines[Math.floor(adjacentCell / this.width)]) {\n                  adjacentDidUpdate = true;\n\n                  if (this.getAdjacentCells(_cell2, 1).includes(adjacentCell)) {\n                    // this is within a radius of 1, therefore this cell should be included in the mask as well\n                    maskedCells.set(_cell2, true);\n                  }\n                  break;\n                }\n              }\n            } catch (err) {\n              _didIteratorError6 = true;\n              _iteratorError6 = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion6 && _iterator6.return) {\n                  _iterator6.return();\n                }\n              } finally {\n                if (_didIteratorError6) {\n                  throw _iteratorError6;\n                }\n              }\n            }\n\n            if (adjacentDidUpdate) shouldUpdate = true;\n          }\n\n          if (updateMap.get(_cell2)) {\n            // this was updated, it should definitely be included in the mask\n            maskedCells.set(_cell2, true);\n          }\n\n          redrawMap.set(_cell2, shouldUpdate);\n        }\n\n        // mask to masked regions only\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      if (this.graphics >= 1) {\n        // TODO: include padding in border cells\n        var padding = this.padding;\n\n        var regions = [];\n\n        for (var _y = 0; _y < height; _y++) {\n          var regionStart = null;\n          for (var _x3 = 0; _x3 < width; _x3++) {\n            var _cell3 = _y * width + _x3;\n            var masked = maskedCells.get(_cell3);\n            if (masked && regionStart === null) regionStart = _x3;\n            if (!masked && regionStart !== null) {\n              regions.push([regionStart, _y, _x3, _y + 1]);\n              regionStart = null;\n            }\n          }\n          if (regionStart !== null) {\n            regions.push([regionStart, _y, width, _y + 1]);\n          }\n        }\n\n        // join regions if possible (O(n^2-1), sorry)\n        var i = 0;\n        while (i < regions.length) {\n          var region = regions[i];\n          var j = 0;\n          while (j < regions.length) {\n            var other = regions[j];\n            if (other === region) {\n              j++;\n              continue;\n            }\n            if (other[0] === region[0] && other[2] === region[2] && other[3] === region[1]) {\n              region[1] = other[1];\n              regions.splice(j, 1);\n              if (i > j) i--;\n              j--;\n            }\n            j++;\n          }\n          i++;\n        }\n\n        ctx.save();\n        ctx.beginPath();\n        var _iteratorNormalCompletion3 = true;\n        var _didIteratorError3 = false;\n        var _iteratorError3 = undefined;\n\n        try {\n          for (var _iterator3 = regions[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n            var _region = _step3.value;\n\n            var _region2 = _slicedToArray(_region, 4),\n                _regionStart = _region2[0],\n                _y2 = _region2[1],\n                endX = _region2[2],\n                endY = _region2[3];\n\n            var rectX = padding + _regionStart * cellWidth;\n            var rectY = padding + _y2 * cellHeight;\n            var rectWidth = (endX - _regionStart) * cellWidth;\n            var rectHeight = (endY - _y2) * cellHeight;\n\n            // compensate for padding\n            if (_regionStart === 0) {\n              rectX -= padding;\n              rectWidth += padding;\n            }\n            if (_y2 === 0) {\n              rectY -= padding;\n              rectHeight += padding;\n            }\n            if (endX === width - 1) rectWidth += padding;\n            if (_y2 === height - 1) rectHeight += padding;\n\n            ctx.rect(rectX, rectY, rectWidth, rectHeight);\n          }\n        } catch (err) {\n          _didIteratorError3 = true;\n          _iteratorError3 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion3 && _iterator3.return) {\n              _iterator3.return();\n            }\n          } finally {\n            if (_didIteratorError3) {\n              throw _iteratorError3;\n            }\n          }\n        }\n\n        ctx.clip();\n      }\n\n      // pass 1: backgrounds\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = fontGroups.keys()[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var _font = _step4.value;\n          var _iteratorNormalCompletion7 = true;\n          var _didIteratorError7 = false;\n          var _iteratorError7 = undefined;\n\n          try {\n            for (var _iterator7 = fontGroups.get(_font)[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n              var data = _step7.value;\n              var _cell4 = data.cell,\n                  _x4 = data.x,\n                  _y3 = data.y,\n                  _text2 = data.text,\n                  _bg = data.bg,\n                  _isDefaultBG = data.isDefaultBG;\n\n\n              if (redrawMap.get(_cell4)) {\n                this.drawBackground({ x: _x4, y: _y3, cellWidth: cellWidth, cellHeight: cellHeight, bg: _bg, isDefaultBG: _isDefaultBG });\n\n                if (this.debug) {\n                  // set cell flags\n                  var flags = +redrawMap.get(_cell4);\n                  flags |= +updateMap.get(_cell4) << 1;\n                  flags |= +maskedCells.get(_cell4) << 2;\n                  flags |= +isTextWide(_text2) << 3;\n                  flags |= +debugFilledUpdates.includes(_cell4) << 4;\n                  this._debug.setCell(_cell4, flags);\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError7 = true;\n            _iteratorError7 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion7 && _iterator7.return) {\n                _iterator7.return();\n              }\n            } finally {\n              if (_didIteratorError7) {\n                throw _iteratorError7;\n              }\n            }\n          }\n        }\n\n        // reset drawn cursor\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      this.drawnCursor = [-1, -1, '', false];\n\n      // pass 2: characters\n      var _iteratorNormalCompletion5 = true;\n      var _didIteratorError5 = false;\n      var _iteratorError5 = undefined;\n\n      try {\n        for (var _iterator5 = fontGroups.keys()[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n          var _font2 = _step5.value;\n\n          // set font once because in Firefox, this is a really slow action for some\n          // reason\n          var fontIndex = 0;\n          if (_font2 & ATTR_BOLD) fontIndex |= 1;\n          if (_font2 & ATTR_ITALIC) fontIndex |= 2;\n          ctx.font = this.fonts[fontIndex];\n\n          var _iteratorNormalCompletion8 = true;\n          var _didIteratorError8 = false;\n          var _iteratorError8 = undefined;\n\n          try {\n            for (var _iterator8 = fontGroups.get(_font2)[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n              var _data = _step8.value;\n              var _cell5 = _data.cell,\n                  _x5 = _data.x,\n                  _y4 = _data.y,\n                  _text3 = _data.text,\n                  _fg = _data.fg,\n                  _bg2 = _data.bg,\n                  _attrs = _data.attrs,\n                  _isCursor = _data.isCursor,\n                  _inSelection = _data.inSelection;\n\n\n              if (redrawMap.get(_cell5)) {\n                this.drawCharacter({\n                  x: _x5, y: _y4, charSize: charSize, cellWidth: cellWidth, cellHeight: cellHeight, text: _text3, fg: _fg, attrs: _attrs\n                });\n\n                this.drawnScreen[_cell5] = _text3;\n                this.drawnScreenFG[_cell5] = _fg;\n                this.drawnScreenBG[_cell5] = _bg2;\n                this.drawnScreenAttrs[_cell5] = _attrs;\n\n                if (_isCursor) this.drawnCursor = [_x5, _y4, this.cursor.style, this.cursor.hanging];\n\n                // draw cursor\n                if (_isCursor && !_inSelection) {\n                  ctx.save();\n                  ctx.beginPath();\n\n                  var cursorX = _x5;\n                  var cursorY = _y4;\n                  var cursorWidth = cellWidth; // JS doesn't allow same-name assignment\n\n                  if (this.cursor.hanging) {\n                    // draw hanging cursor in the margin\n                    cursorX += 1;\n                  }\n\n                  // double-width lines\n                  if (this.screenLines[cursorY] & 1) cursorWidth *= 2;\n\n                  var screenX = cursorX * cursorWidth + this.padding;\n                  var screenY = cursorY * cellHeight + this.padding;\n\n                  if (this.cursor.style === 'block') {\n                    // block\n                    ctx.rect(screenX, screenY, cursorWidth, cellHeight);\n                  } else if (this.cursor.style === 'bar') {\n                    // vertical bar\n                    var barWidth = 2;\n                    ctx.rect(screenX, screenY, barWidth, cellHeight);\n                  } else if (this.cursor.style === 'line') {\n                    // underline\n                    var lineHeight = 2;\n                    ctx.rect(screenX, screenY + charSize.height, cursorWidth, lineHeight);\n                  }\n                  ctx.clip()\n\n                  // swap foreground/background\n                  ;\n\n                  // HACK: ensure cursor is visible\n                  var _ref5 = [_bg2, _fg];\n                  _fg = _ref5[0];\n                  _bg2 = _ref5[1];\n                  if (_fg === _bg2) _bg2 = _fg === 0 ? 7 : 0;\n\n                  this.drawBackground({ x: cursorX, y: cursorY, cellWidth: cellWidth, cellHeight: cellHeight, bg: _bg2 });\n                  this.drawCharacter({\n                    x: cursorX, y: cursorY, charSize: charSize, cellWidth: cellWidth, cellHeight: cellHeight, text: _text3, fg: _fg, attrs: _attrs\n                  });\n                  ctx.restore();\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError8 = true;\n            _iteratorError8 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion8 && _iterator8.return) {\n                _iterator8.return();\n              }\n            } finally {\n              if (_didIteratorError8) {\n                throw _iteratorError8;\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError5 = true;\n        _iteratorError5 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion5 && _iterator5.return) {\n            _iterator5.return();\n          }\n        } finally {\n          if (_didIteratorError5) {\n            throw _iteratorError5;\n          }\n        }\n      }\n\n      if (this.graphics >= 1) ctx.restore();\n\n      if (this.debug && this._debug) this._debug.drawEnd();\n\n      this.emit('draw', why);\n    }\n  }, {\n    key: 'drawStatus',\n    value: function drawStatus(statusScreen) {\n      var ctx = this.ctx,\n          width = this.width,\n          height = this.height,\n          devicePixelRatio = this.devicePixelRatio;\n\n      // reset drawnScreen to force redraw when statusScreen is disabled\n\n      this.drawnScreen = [];\n\n      var cellSize = this.cellSize;\n      var screenWidth = width * cellSize.width + 2 * this.padding;\n      var screenHeight = height * cellSize.height + 2 * this.padding;\n\n      ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);\n      ctx.fillStyle = this.getColor(this.defaultBG);\n      ctx.fillRect(0, 0, screenWidth, screenHeight);\n\n      ctx.font = '24px ' + this.statusFont;\n      ctx.fillStyle = this.getColor(this.defaultFG);\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(statusScreen.title || '', screenWidth / 2, screenHeight / 2 - 50);\n\n      if (statusScreen.loading) {\n        // show loading spinner\n        ctx.save();\n        ctx.translate(screenWidth / 2, screenHeight / 2 + 20);\n\n        ctx.strokeStyle = this.getColor(this.defaultFG);\n        ctx.lineWidth = 5;\n        ctx.lineCap = 'round';\n\n        var t = Date.now() / 1000;\n\n        for (var i = 0; i < 12; i++) {\n          ctx.rotate(Math.PI / 6);\n          var offset = (t * 12 - i) % 12;\n          ctx.globalAlpha = Math.max(0.2, 1 - offset / 3);\n          ctx.beginPath();\n          ctx.moveTo(0, 15);\n          ctx.lineTo(0, 30);\n          ctx.stroke();\n        }\n\n        ctx.restore();\n      }\n    }\n  }, {\n    key: 'startDrawLoop',\n    value: function startDrawLoop() {\n      if (this._drawTimerThread) return;\n      var threadID = Math.random().toString(36);\n      this._drawTimerThread = threadID;\n      this.drawTimerLoop(threadID);\n    }\n  }, {\n    key: 'stopDrawLoop',\n    value: function stopDrawLoop() {\n      this._drawTimerThread = null;\n    }\n  }, {\n    key: 'drawTimerLoop',\n    value: function drawTimerLoop(threadID) {\n      var _this5 = this;\n\n      if (!threadID || threadID !== this._drawTimerThread) return;\n      window.requestAnimationFrame(function () {\n        return _this5.drawTimerLoop(threadID);\n      });\n      this.draw('draw-loop');\n    }\n\n    /**\n     * Converts an alphabetic character to its fraktur variant.\n     * @param {string} character - the character\n     * @returns {string} the converted character\n     */\n\n  }, {\n    key: 'palette',\n    get: function get() {\n      return this._palette || themes[0];\n    }\n\n    /** @type {string[]} */\n    ,\n    set: function set(palette) {\n      if (this._palette !== palette) {\n        this._palette = palette;\n        this.resetDrawn();\n        this.emit('palette-update', palette);\n        this.scheduleDraw('palette');\n      }\n    }\n  }], [{\n    key: 'alphaToFraktur',\n    value: function alphaToFraktur(character) {\n      if (character >= 'a' && character <= 'z') {\n        character = String.fromCodePoint(0x1d51e - 0x61 + character.charCodeAt(0));\n      } else if (character >= 'A' && character <= 'Z') {\n        character = frakturExceptions[character] || String.fromCodePoint(0x1d504 - 0x41 + character.charCodeAt(0));\n      }\n      return character;\n    }\n  }]);\n\n  return CanvasRenderer;\n}(EventEmitter);\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar EventEmitter = __webpack_require__(2);\nvar $ = __webpack_require__(1);\nvar demo = void 0;\ntry {\n  demo = __webpack_require__(8);\n} catch (err) {}\n\nvar RECONN_DELAY = 2000;\nvar HEARTBEAT_TIME = 3000;\nvar HTTPS = window.location.protocol.match(/s:/);\n\n/** Handle connections */\nmodule.exports = function (_EventEmitter) {\n  _inherits(TermConnection, _EventEmitter);\n\n  function TermConnection(screen) {\n    _classCallCheck(this, TermConnection);\n\n    var _this = _possibleConstructorReturn(this, (TermConnection.__proto__ || Object.getPrototypeOf(TermConnection)).call(this));\n\n    _this.screen = screen;\n    _this.ws = null;\n    _this.heartbeatTimeout = null;\n    _this.pingInterval = null;\n    _this.xoff = false;\n    _this.autoXoffTimeout = null;\n    _this.reconnTimeout = null;\n    _this.forceClosing = false;\n    _this.queue = [];\n\n    try {\n      _this.blobReader = new window.FileReader();\n      _this.blobReader.onload = function (evt) {\n        _this.onDecodedWSMessage(_this.blobReader.result);\n      };\n      _this.blobReader.onerror = function (evt) {\n        console.error(evt);\n      };\n    } catch (e) {\n      _this.blobReader = null;\n    }\n\n    _this.pageShown = false;\n\n    _this.disconnectTimeout = null;\n\n    document.addEventListener('visibilitychange', function () {\n      if (document.hidden === true) {\n        console.info('Window lost focus, freeing socket');\n        // Delayed, avoid disconnecting if the background time is short\n        _this.disconnectTimeout = setTimeout(function () {\n          _this.closeSocket();\n          clearTimeout(_this.heartbeatTimeout);\n        }, 1000);\n      } else {\n        clearTimeout(_this.disconnectTimeout);\n        console.info('Window got focus, re-connecting');\n        _this.init();\n      }\n    }, false);\n    return _this;\n  }\n\n  _createClass(TermConnection, [{\n    key: 'onWSOpen',\n    value: function onWSOpen(evt) {\n      console.log('CONNECTED');\n      this.heartbeat();\n      this.send('i');\n      this.forceClosing = false;\n\n      this.emit('connect');\n    }\n  }, {\n    key: 'onWSClose',\n    value: function onWSClose(evt) {\n      var _this2 = this;\n\n      if (this.forceClosing) {\n        this.forceClosing = false;\n        return;\n      }\n      console.warn('SOCKET CLOSED, code ' + evt.code + '. Reconnecting...');\n      if (evt.code < 1000) {\n        console.error('Bad code from socket!');\n        // this sometimes happens for unknown reasons, code < 1000 is invalid\n        // location.reload()\n      }\n\n      clearTimeout(this.reconnTimeout);\n      this.reconnTimeout = setTimeout(function () {\n        return _this2.init();\n      }, RECONN_DELAY);\n\n      this.emit('disconnect', evt.code);\n    }\n  }, {\n    key: 'onDecodedWSMessage',\n    value: function onDecodedWSMessage(str) {\n      var _this3 = this;\n\n      switch (str.charAt(0)) {\n        case '.':\n          // heartbeat, no-op message\n          break;\n\n        case '-':\n          // console.log('xoff');\n          this.xoff = true;\n          this.autoXoffTimeout = setTimeout(function () {\n            _this3.xoff = false;\n            _this3.flushQueue();\n          }, 250);\n          break;\n\n        case '+':\n          // console.log('xon');\n          this.xoff = false;\n          this.flushQueue();\n          clearTimeout(this.autoXoffTimeout);\n          break;\n\n        default:\n          this.screen.load(str);\n          if (!this.pageShown) {\n            window.showPage();\n            this.pageShown = true;\n          }\n          break;\n      }\n      this.heartbeat();\n    }\n  }, {\n    key: 'onWSMessage',\n    value: function onWSMessage(evt) {\n      var _this4 = this;\n\n      if (typeof evt.data === 'string') this.onDecodedWSMessage(evt.data);else {\n        if (!this.blobReader) {\n          console.error('No FileReader!');\n          return;\n        }\n\n        if (this.blobReader.readyState !== 1) {\n          this.blobReader.readAsText(evt.data);\n        } else {\n          setTimeout(function () {\n            _this4.onWSMessage(evt);\n          }, 1);\n        }\n      }\n    }\n  }, {\n    key: 'canSend',\n    value: function canSend() {\n      return !this.xoff;\n    }\n  }, {\n    key: 'send',\n    value: function send(message) {\n      if (window._demo) {\n        if (typeof window.demoInterface !== 'undefined') {\n          demo.input(message);\n        } else {\n          console.log('TX: ' + JSON.stringify(message));\n        }\n        return true; // Simulate success\n      }\n      if (this.xoff) {\n        console.log(\"Can't send, flood control. Queueing\");\n        this.queue.push(message);\n        return false;\n      }\n\n      if (!this.ws) return false; // for dry testing\n      if (this.ws.readyState !== 1) {\n        console.error('Socket not ready');\n        return false;\n      }\n      if (typeof message !== 'string') {\n        message = JSON.stringify(message);\n      }\n      this.ws.send(message);\n      return true;\n    }\n  }, {\n    key: 'flushQueue',\n    value: function flushQueue() {\n      console.log('Flushing input queue');\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.queue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n          this.send(message);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.queue = [];\n    }\n\n    /** Safely close the socket */\n\n  }, {\n    key: 'closeSocket',\n    value: function closeSocket() {\n      if (this.ws) {\n        this.forceClosing = true;\n        if (this.ws.readyState === 1) this.ws.close();\n        this.ws = null;\n      }\n    }\n  }, {\n    key: 'init',\n    value: function init() {\n      var _this5 = this;\n\n      if (window._demo) {\n        if (typeof window.demoInterface === 'undefined') {\n          window.alert('Demoing non-demo build!'); // this will catch mistakes when deploying to the website\n        } else {\n          demo.init(this.screen);\n        }\n        return;\n      }\n\n      clearTimeout(this.reconnTimeout);\n      clearTimeout(this.heartbeatTimeout);\n\n      this.closeSocket();\n\n      this.ws = new window.WebSocket((HTTPS ? 'wss' : 'ws') + '://' + window._root + '/term/update.ws');\n      this.ws.addEventListener('open', function () {\n        return _this5.onWSOpen.apply(_this5, arguments);\n      });\n      this.ws.addEventListener('close', function () {\n        return _this5.onWSClose.apply(_this5, arguments);\n      });\n      this.ws.addEventListener('message', function () {\n        return _this5.onWSMessage.apply(_this5, arguments);\n      });\n      console.log('Opening socket.');\n      this.heartbeat();\n\n      this.emit('open');\n    }\n  }, {\n    key: 'heartbeat',\n    value: function heartbeat() {\n      var _this6 = this;\n\n      this.emit('heartbeat');\n      clearTimeout(this.heartbeatTimeout);\n      this.heartbeatTimeout = setTimeout(function () {\n        return _this6.onHeartbeatFail();\n      }, HEARTBEAT_TIME);\n    }\n  }, {\n    key: 'sendPing',\n    value: function sendPing() {\n      var _this7 = this;\n\n      console.log('> ping');\n      this.emit('ping');\n      $.get((HTTPS ? 'https' : 'http') + '://' + window._root + '/api/v1/ping', function (resp, status) {\n        if (status === 200) {\n          clearInterval(_this7.pingInterval);\n          console.info('Server ready, opening socket…');\n          _this7.emit('ping-success');\n          _this7.init();\n          // location.reload()\n        } else _this7.emit('ping-fail', status);\n      }, {\n        timeout: 100,\n        loader: false // we have loader on-screen\n      });\n    }\n  }, {\n    key: 'onHeartbeatFail',\n    value: function onHeartbeatFail() {\n      var _this8 = this;\n\n      this.closeSocket();\n      this.emit('silence');\n      console.error('Heartbeat lost, probing server...');\n      clearInterval(this.pingInterval);\n      this.pingInterval = setInterval(function () {\n        _this8.sendPing();\n      }, 1000);\n\n      // first ping, if this gets through, it'll will reduce delay\n      setTimeout(function () {\n        _this8.sendPing();\n      }, 200);\n    }\n  }]);\n\n  return TermConnection;\n}(EventEmitter);\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _require = __webpack_require__(0),\n    encode2B = _require.encode2B;\n\n/**\n * User input\n *\n * --- Rx messages: ---\n * S - screen content (binary encoding of the entire screen with simple compression)\n * T - text labels - Title and buttons, \\0x01-separated\n * B - beep\n * . - heartbeat\n *\n * --- Tx messages ---\n * s - string\n * b - action button\n * p - mb press\n * r - mb release\n * m - mouse move\n */\n\n\nmodule.exports = function (conn, screen) {\n  // handle for input object\n  var input = void 0;\n\n  var KEY_NAMES = {\n    0x03: 'Cancel',\n    0x06: 'Help',\n    0x08: 'Backspace',\n    0x09: 'Tab',\n    0x0C: 'Clear',\n    0x0D: 'Enter',\n    0x10: 'Shift',\n    0x11: 'Control',\n    0x12: 'Alt',\n    0x13: 'Pause',\n    0x14: 'CapsLock',\n    0x1B: 'Escape',\n    0x20: ' ',\n    0x21: 'PageUp',\n    0x22: 'PageDown',\n    0x23: 'End',\n    0x24: 'Home',\n    0x25: 'ArrowLeft',\n    0x26: 'ArrowUp',\n    0x27: 'ArrowRight',\n    0x28: 'ArrowDown',\n    0x29: 'Select',\n    0x2A: 'Print',\n    0x2B: 'Execute',\n    0x2C: 'PrintScreen',\n    0x2D: 'Insert',\n    0x2E: 'Delete',\n    0x3A: ':',\n    0x3B: ';',\n    0x3C: '<',\n    0x3D: '=',\n    0x3E: '>',\n    0x3F: '?',\n    0x40: '@',\n    0x5B: 'Meta',\n    0x5C: 'Meta',\n    0x5D: 'ContextMenu',\n    0x6A: 'Numpad*',\n    0x6B: 'Numpad+',\n    0x6D: 'Numpad-',\n    0x6E: 'Numpad.',\n    0x6F: 'Numpad/',\n    0x90: 'NumLock',\n    0x91: 'ScrollLock',\n    0xA0: '^',\n    0xA1: '!',\n    0xA2: '\"',\n    0xA3: '#',\n    0xA4: '$',\n    0xA5: '%',\n    0xA6: '&',\n    0xA7: '_',\n    0xA8: '(',\n    0xA9: ')',\n    0xAA: '*',\n    0xAB: '+',\n    0xAC: '|',\n    0xAD: '-',\n    0xAE: '{',\n    0xAF: '}',\n    0xB0: '~',\n    0xBA: ';',\n    0xBB: '=',\n    0xBC: 'Numpad,',\n    0xBD: '-',\n    0xBE: 'Numpad,',\n    0xC0: '`',\n    0xC2: 'Numpad,',\n    0xDB: '[',\n    0xDC: '\\\\',\n    0xDD: ']',\n    0xDE: \"'\",\n    0xE0: 'Meta'\n    // numbers 0-9\n  };for (var i = 0x30; i <= 0x39; i++) {\n    KEY_NAMES[i] = String.fromCharCode(i);\n  } // characters A-Z\n  for (var _i = 0x41; _i <= 0x5A; _i++) {\n    KEY_NAMES[_i] = String.fromCharCode(_i);\n  } // function F1-F20\n  for (var _i2 = 0x70; _i2 <= 0x83; _i2++) {\n    KEY_NAMES[_i2] = 'F' + (_i2 - 0x70 + 1);\n  } // numpad 0-9\n  for (var _i3 = 0x60; _i3 <= 0x69; _i3++) {\n    KEY_NAMES[_i3] = 'Numpad' + (_i3 - 0x60);\n  }var cfg = {\n    np_alt: false, // Application Numpad Mode\n    cu_alt: false, // Application Cursors Mode\n    fn_alt: false, // SS3 function keys mode\n    mt_click: false, // Mouse click tracking\n    mt_move: false, // Mouse move tracking\n    no_keys: false, // Suppress any key / clipboard event intercepting\n    crlf_mode: false, // Enter sends CR LF\n    all_fn: false // Capture also F5, F11 and F12\n\n\n    /** Fn alt choice for key message */\n  };var fa = function fa(alt, normal) {\n    return cfg.fn_alt ? alt : normal;\n  };\n\n  /** Cursor alt choice for key message */\n  var ca = function ca(alt, normal) {\n    return cfg.cu_alt ? alt : normal;\n  };\n\n  /** Numpad alt choice for key message */\n  var na = function na(alt, normal) {\n    return cfg.np_alt ? alt : normal;\n  };\n\n  var keymap = {\n    /* eslint-disable key-spacing */\n    'Backspace': '\\x08',\n    'Tab': '\\x09',\n    'Enter': function Enter() {\n      return cfg.crlf_mode ? '\\x0d\\x0a' : '\\x0d';\n    },\n    'Control+Enter': '\\x0a',\n    'Escape': '\\x1b',\n    'ArrowUp': function ArrowUp() {\n      return ca('\\x1bOA', '\\x1b[A');\n    },\n    'ArrowDown': function ArrowDown() {\n      return ca('\\x1bOB', '\\x1b[B');\n    },\n    'ArrowRight': function ArrowRight() {\n      return ca('\\x1bOC', '\\x1b[C');\n    },\n    'ArrowLeft': function ArrowLeft() {\n      return ca('\\x1bOD', '\\x1b[D');\n    },\n    'Home': function Home() {\n      return ca('\\x1bOH', fa('\\x1b[H', '\\x1b[1~'));\n    },\n    'Insert': '\\x1b[2~',\n    'Delete': '\\x1b[3~',\n    'End': function End() {\n      return ca('\\x1bOF', fa('\\x1b[F', '\\x1b[4~'));\n    },\n    'PageUp': '\\x1b[5~',\n    'PageDown': '\\x1b[6~',\n    'F1': function F1() {\n      return fa('\\x1bOP', '\\x1b[11~');\n    },\n    'F2': function F2() {\n      return fa('\\x1bOQ', '\\x1b[12~');\n    },\n    'F3': function F3() {\n      return fa('\\x1bOR', '\\x1b[13~');\n    },\n    'F4': function F4() {\n      return fa('\\x1bOS', '\\x1b[14~');\n    },\n    'F5': '\\x1b[15~', // note the disconnect\n    'F6': '\\x1b[17~',\n    'F7': '\\x1b[18~',\n    'F8': '\\x1b[19~',\n    'F9': '\\x1b[20~',\n    'F10': '\\x1b[21~', // note the disconnect\n    'F11': '\\x1b[23~',\n    'F12': '\\x1b[24~',\n    'Shift+F1': function ShiftF1() {\n      return fa('\\x1bO1;2P', '\\x1b[25~');\n    },\n    'Shift+F2': function ShiftF2() {\n      return fa('\\x1bO1;2Q', '\\x1b[26~');\n    }, // note the disconnect\n    'Shift+F3': function ShiftF3() {\n      return fa('\\x1bO1;2R', '\\x1b[28~');\n    },\n    'Shift+F4': function ShiftF4() {\n      return fa('\\x1bO1;2S', '\\x1b[29~');\n    }, // note the disconnect\n    'Shift+F5': function ShiftF5() {\n      return fa('\\x1b[15;2~', '\\x1b[31~');\n    },\n    'Shift+F6': function ShiftF6() {\n      return fa('\\x1b[17;2~', '\\x1b[32~');\n    },\n    'Shift+F7': function ShiftF7() {\n      return fa('\\x1b[18;2~', '\\x1b[33~');\n    },\n    'Shift+F8': function ShiftF8() {\n      return fa('\\x1b[19;2~', '\\x1b[34~');\n    },\n    'Shift+F9': function ShiftF9() {\n      return fa('\\x1b[20;2~', '\\x1b[35~');\n    }, // 35-38 are not standard - but what is?\n    'Shift+F10': function ShiftF10() {\n      return fa('\\x1b[21;2~', '\\x1b[36~');\n    },\n    'Shift+F11': function ShiftF11() {\n      return fa('\\x1b[22;2~', '\\x1b[37~');\n    },\n    'Shift+F12': function ShiftF12() {\n      return fa('\\x1b[23;2~', '\\x1b[38~');\n    },\n    'Numpad0': function Numpad0() {\n      return na('\\x1bOp', '0');\n    },\n    'Numpad1': function Numpad1() {\n      return na('\\x1bOq', '1');\n    },\n    'Numpad2': function Numpad2() {\n      return na('\\x1bOr', '2');\n    },\n    'Numpad3': function Numpad3() {\n      return na('\\x1bOs', '3');\n    },\n    'Numpad4': function Numpad4() {\n      return na('\\x1bOt', '4');\n    },\n    'Numpad5': function Numpad5() {\n      return na('\\x1bOu', '5');\n    },\n    'Numpad6': function Numpad6() {\n      return na('\\x1bOv', '6');\n    },\n    'Numpad7': function Numpad7() {\n      return na('\\x1bOw', '7');\n    },\n    'Numpad8': function Numpad8() {\n      return na('\\x1bOx', '8');\n    },\n    'Numpad9': function Numpad9() {\n      return na('\\x1bOy', '9');\n    },\n    'Numpad*': function Numpad() {\n      return na('\\x1bOR', '*');\n    },\n    'Numpad+': function Numpad() {\n      return na('\\x1bOl', '+');\n    },\n    'Numpad-': function Numpad() {\n      return na('\\x1bOS', '-');\n    },\n    'Numpad.': function Numpad() {\n      return na('\\x1bOn', '.');\n    },\n    'Numpad/': function Numpad() {\n      return na('\\x1bOQ', '/');\n    },\n    // we don't implement numlock key (should change in numpad_alt mode,\n    // but it's even more useless than the rest and also has the side\n    // effect of changing the user's numlock state)\n\n    // shortcuts\n    'Control+]': '\\x1b', // alternate way to enter ESC\n    'Control+\\\\': '\\x1c',\n    'Control+[': '\\x1d',\n    'Control+^': '\\x1e',\n    'Control+_': '\\x1f',\n\n    // extra controls\n    'Control+ArrowLeft': '\\x1f[1;5D',\n    'Control+ArrowRight': '\\x1f[1;5C',\n    'Control+ArrowUp': '\\x1f[1;5A',\n    'Control+ArrowDown': '\\x1f[1;5B',\n    'Control+Home': '\\x1f[1;5H',\n    'Control+End': '\\x1f[1;5F',\n\n    // extra shift controls\n    'Shift+ArrowLeft': '\\x1f[1;2D',\n    'Shift+ArrowRight': '\\x1f[1;2C',\n    'Shift+ArrowUp': '\\x1f[1;2A',\n    'Shift+ArrowDown': '\\x1f[1;2B',\n    'Shift+Home': '\\x1f[1;2H',\n    'Shift+End': '\\x1f[1;2F',\n\n    // macOS text editing commands\n    'Alt+ArrowLeft': '\\x1bb', // ⌥← to go back a word (^[b)\n    'Alt+ArrowRight': '\\x1bf', // ⌥→ to go forward one word (^[f)\n    'Meta+ArrowLeft': '\\x01', // ⌘← to go to the beginning of a line (^A)\n    'Meta+ArrowRight': '\\x05', // ⌘→ to go to the end of a line (^E)\n    'Alt+Backspace': '\\x17', // ⌥⌫ to delete a word (^W)\n    'Meta+Backspace': '\\x15', // ⌘⌫ to delete to the beginning of a line (^U)\n\n    // copy to clipboard\n    'Control+Shift+C': function ControlShiftC() {\n      screen.copySelectionToClipboard();\n    },\n    'Control+Insert': function ControlInsert() {\n      screen.copySelectionToClipboard();\n    },\n\n\n    // toggle debug mode\n    'Control+F12': function ControlF12() {\n      screen.window.debug ^= 1;\n    }\n    /* eslint-enable key-spacing */\n\n  };\n\n  // ctrl+[A-Z] sent as simple low ASCII codes\n  for (var _i4 = 1; _i4 <= 26; _i4++) {\n    keymap['Control+' + String.fromCharCode(0x40 + _i4)] = String.fromCharCode(_i4);\n  }\n\n  /** Send a literal message */\n  function sendString(str) {\n    return conn.send('s' + str);\n  }\n\n  /** Send a button event */\n  function sendButton(index) {\n    conn.send('b' + String.fromCharCode(index + 1));\n  }\n\n  var shouldAcceptEvent = function shouldAcceptEvent() {\n    if (cfg.no_keys) return false;\n    if (document.activeElement instanceof window.HTMLTextAreaElement) return false;\n    return true;\n  };\n\n  var keyBlacklist = ['F5', 'F11', 'F12', 'Shift+F5'];\n\n  var softModifiers = {\n    alt: false,\n    ctrl: false,\n    meta: false,\n    shift: false\n  };\n\n  var handleKeyDown = function handleKeyDown(e) {\n    if (!shouldAcceptEvent()) return;\n\n    var modifiers = [];\n    // sorted alphabetically\n    if (e.altKey || softModifiers.alt) modifiers.push('Alt');\n    if (e.ctrlKey || softModifiers.ctrl) modifiers.push('Control');\n    if (e.metaKey || softModifiers.meta) modifiers.push('Meta');\n    if (e.shiftKey || softModifiers.shift) modifiers.push('Shift');\n\n    var key = KEY_NAMES[e.which] || e.key;\n\n    // ignore clipboard events\n    if ((e.ctrlKey || e.metaKey) && key === 'V') return;\n\n    var binding = null;\n\n    for (var name in keymap) {\n      var itemModifiers = name.split('+');\n      var itemKey = itemModifiers.pop();\n\n      if (itemKey === key && itemModifiers.sort().join() === modifiers.join()) {\n        if (keyBlacklist.includes(name) && !cfg.all_fn) continue;\n        binding = keymap[name];\n        break;\n      }\n    }\n\n    if (binding) {\n      if (binding instanceof Function) binding = binding();\n      e.preventDefault();\n      if (typeof binding === 'string') {\n        sendString(binding);\n      }\n    }\n  };\n\n  /** Bind/rebind key messages */\n  function initKeys(_ref) {\n    var allFn = _ref.allFn;\n\n    // This takes care of text characters typed\n    window.addEventListener('keypress', function (evt) {\n      if (!shouldAcceptEvent()) return;\n      if (evt.ctrlKey || evt.metaKey) return;\n\n      var str = '';\n      if (evt.key && evt.key.length === 1) str = evt.key;else if (evt.which && evt.which !== 229) str = String.fromCodePoint(evt.which);\n\n      if (str.length > 0 && str.charCodeAt(0) >= 32) {\n        // prevent space from scrolling\n        if (evt.which === 32) evt.preventDefault();\n        sendString(str);\n      }\n    });\n\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('copy', function (e) {\n      if (!shouldAcceptEvent()) return;\n      var selectedText = screen.getSelectedText();\n      if (selectedText) {\n        e.preventDefault();\n        e.clipboardData.setData('text/plain', selectedText);\n      }\n    });\n    window.addEventListener('paste', function (e) {\n      if (!shouldAcceptEvent()) return;\n      e.preventDefault();\n      var string = e.clipboardData.getData('text/plain');\n      if (string.includes('\\n') || string.length > 90) {\n        if (!input.termUpload) console.error('input.termUpload is undefined');\n        input.termUpload.setContent(string);\n        input.termUpload.open();\n      } else {\n        // simple string, just paste it\n        if (screen.bracketedPaste) string = '\\x1B[200~' + string + '\\x1B[201~';\n        sendString(string);\n      }\n    });\n\n    cfg.all_fn = allFn;\n  }\n\n  // mouse button states\n  var mb1 = 0;\n  var mb2 = 0;\n  var mb3 = 0;\n\n  /** Init the Input module */\n  function init(opts) {\n    initKeys(opts);\n\n    // global mouse state tracking - for motion reporting\n    window.addEventListener('mousedown', function (evt) {\n      if (evt.button === 0) mb1 = 1;\n      if (evt.button === 1) mb2 = 1;\n      if (evt.button === 2) mb3 = 1;\n    });\n\n    window.addEventListener('mouseup', function (evt) {\n      if (evt.button === 0) mb1 = 0;\n      if (evt.button === 1) mb2 = 0;\n      if (evt.button === 2) mb3 = 0;\n    });\n  }\n\n  // record modifier keys\n  // bits: Meta, Alt, Shift, Ctrl\n  var modifiers = 0;\n\n  window.addEventListener('keydown', function (e) {\n    if (e.ctrlKey) modifiers |= 1;\n    if (e.shiftKey) modifiers |= 2;\n    if (e.altKey) modifiers |= 4;\n    if (e.metaKey) modifiers |= 8;\n  });\n  window.addEventListener('keyup', function (e) {\n    modifiers = 0;\n    if (e.ctrlKey) modifiers |= 1;\n    if (e.shiftKey) modifiers |= 2;\n    if (e.altKey) modifiers |= 4;\n    if (e.metaKey) modifiers |= 8;\n  });\n\n  /** Prepare modifiers byte for mouse message */\n  function packModifiersForMouse() {\n    return modifiers;\n  }\n\n  input = {\n    /** Init the Input module */\n    init: init,\n\n    /** Send a literal string message */\n    sendString: sendString,\n    sendButton: sendButton,\n\n    /** Enable alternate key modes (cursors, numpad, fn) */\n    setAlts: function setAlts(cu, np, fn, crlf) {\n      if (cfg.cu_alt !== cu || cfg.np_alt !== np || cfg.fn_alt !== fn || cfg.crlf_mode !== crlf) {\n        cfg.cu_alt = cu;\n        cfg.np_alt = np;\n        cfg.fn_alt = fn;\n        cfg.crlf_mode = crlf;\n      }\n    },\n\n    setMouseMode: function setMouseMode(click, move) {\n      cfg.mt_click = click;\n      cfg.mt_move = move;\n    },\n\n\n    // Mouse events\n    onMouseMove: function onMouseMove(x, y) {\n      if (!cfg.mt_move) return;\n      var b = mb1 ? 1 : mb2 ? 2 : mb3 ? 3 : 0;\n      var m = packModifiersForMouse();\n      conn.send('m' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m));\n    },\n    onMouseDown: function onMouseDown(x, y, b) {\n      if (!cfg.mt_click) return;\n      if (b > 3 || b < 1) return;\n      var m = packModifiersForMouse();\n      conn.send('p' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m));\n    },\n    onMouseUp: function onMouseUp(x, y, b) {\n      if (!cfg.mt_click) return;\n      if (b > 3 || b < 1) return;\n      var m = packModifiersForMouse();\n      conn.send('r' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m));\n      // console.log(\"B \",b,\" M \",m);\n    },\n    onMouseWheel: function onMouseWheel(x, y, dir) {\n      if (!cfg.mt_click) return;\n      // -1 ... btn 4 (away from user)\n      // +1 ... btn 5 (towards user)\n      var m = packModifiersForMouse();\n      var b = dir < 0 ? 4 : 5;\n      conn.send('p' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m));\n      // console.log(\"B \",b,\" M \",m);\n    },\n\n\n    /**\n     * Prevent capturing keys. This is used for text input\n     * modals on the terminal screen\n     */\n    blockKeys: function blockKeys(yes) {\n      cfg.no_keys = yes;\n    },\n\n\n    handleKeyDown: handleKeyDown,\n    softModifiers: softModifiers\n  };\n  return input;\n};\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar $ = __webpack_require__(1);\n\nvar _require = __webpack_require__(0),\n    qs = _require.qs;\n\nvar modal = __webpack_require__(4);\n\n/** File upload utility */\nmodule.exports = function (conn, input, screen) {\n  var lines = void 0,\n      // array of lines without newlines\n  line_i = void 0,\n      // current line index\n  fuTout = void 0,\n      // timeout handle for line sending\n  send_delay_ms = void 0,\n      // delay between lines (ms)\n  nl_str = void 0,\n      // newline string to use\n  curLine = void 0,\n      // current line (when using fuOil)\n  inline_pos = void 0; // Offset in line (for long lines)\n\n  // lines longer than this are split to chunks\n  // sending a super-ling string through the socket is not a good idea\n  var MAX_LINE_LEN = 128;\n\n  function openUploadDialog() {\n    updateStatus('Ready...');\n    modal.show('#fu_modal', onDialogClose);\n    $('#fu_form').toggleClass('busy', false);\n    input.blockKeys(true);\n  }\n\n  function onDialogClose() {\n    console.log('Upload modal closed.');\n    clearTimeout(fuTout);\n    line_i = 0;\n    input.blockKeys(false);\n  }\n\n  function updateStatus(msg) {\n    qs('#fu_prog').textContent = msg;\n  }\n\n  function startUpload() {\n    var v = qs('#fu_text').value;\n    if (!v.length) {\n      fuClose();\n      return;\n    }\n\n    lines = v.split('\\n');\n    line_i = 0;\n    inline_pos = 0; // offset in line\n    send_delay_ms = +qs('#fu_delay').value;\n\n    // sanitize - 0 causes overflows\n    if (send_delay_ms < 0) {\n      send_delay_ms = 0;\n      qs('#fu_delay').value = send_delay_ms;\n    }\n\n    nl_str = {\n      'CR': '\\r',\n      'LF': '\\n',\n      'CRLF': '\\r\\n'\n    }[qs('#fu_crlf').value];\n\n    $('#fu_form').toggleClass('busy', true);\n    updateStatus('Starting...');\n    uploadLine();\n  }\n\n  function uploadLine() {\n    if (!$('#fu_modal').hasClass('visible')) {\n      // Modal is closed, cancel\n      return;\n    }\n\n    if (!conn.canSend()) {\n      // postpone\n      fuTout = setTimeout(uploadLine, 1);\n      return;\n    }\n\n    if (inline_pos === 0) {\n      curLine = '';\n      if (line_i === 0) {\n        if (screen.bracketedPaste) {\n          curLine = '\\x1b[200~';\n        }\n      }\n\n      curLine += lines[line_i++] + nl_str;\n\n      if (line_i === lines.length) {\n        if (screen.bracketedPaste) {\n          curLine += '\\x1b[201~';\n        }\n      }\n    }\n\n    var maxChunk = +qs('#fu_chunk').value;\n    if (maxChunk === 0 || maxChunk > MAX_LINE_LEN) {\n      maxChunk = MAX_LINE_LEN;\n    }\n\n    var chunk = void 0;\n    if (curLine.length - inline_pos <= maxChunk) {\n      chunk = curLine.substr(inline_pos, maxChunk);\n      inline_pos = 0;\n    } else {\n      chunk = curLine.substr(inline_pos, maxChunk);\n      inline_pos += maxChunk;\n    }\n\n    if (!input.sendString(chunk)) {\n      updateStatus('FAILED!');\n      return;\n    }\n\n    var pt = Math.round(line_i / lines.length * 1000) / 10;\n    updateStatus(line_i + ' / ' + lines.length + ' (' + pt + '%)');\n\n    if (lines.length > line_i || inline_pos > 0) {\n      fuTout = setTimeout(uploadLine, send_delay_ms);\n    } else {\n      closeWhenReady();\n    }\n  }\n\n  function closeWhenReady() {\n    if (!conn.canSend()) {\n      // stuck in XOFF still, wait to process...\n      updateStatus('Waiting for Tx buffer...');\n      setTimeout(closeWhenReady, 100);\n    } else {\n      updateStatus('Done.');\n      // delay to show it\n      fuClose();\n    }\n  }\n\n  function fuClose() {\n    modal.hide('#fu_modal');\n  }\n\n  return {\n    init: function init() {\n      qs('#fu_file').addEventListener('change', function (evt) {\n        var reader = new window.FileReader();\n        var file = evt.target.files[0];\n        var ftype = file.type || 'application/octet-stream';\n        console.log('Selected file type: ' + ftype);\n        if (!ftype.match(/text\\/.*|application\\/(json|csv|.*xml.*|.*script.*|x-php)/)) {\n          // Deny load of blobs like img - can crash browser and will get corrupted anyway\n          if (!window.confirm('This does not look like a text file: ' + ftype + '\\nReally load?')) {\n            qs('#fu_file').value = '';\n            return;\n          }\n        }\n        reader.onload = function (e) {\n          var txt = e.target.result.replace(/[\\r\\n]+/, '\\n');\n          qs('#fu_text').value = txt;\n        };\n        console.log('Loading file...');\n        reader.readAsText(file);\n      }, false);\n\n      qs('#term-fu-open').addEventListener('click', function (e) {\n        e.preventDefault();\n        openUploadDialog();\n      });\n\n      qs('#term-fu-start').addEventListener('click', function (e) {\n        e.preventDefault();\n        startUpload();\n      });\n\n      qs('#term-fu-close').addEventListener('click', function (e) {\n        e.preventDefault();\n        fuClose();\n      });\n    },\n    open: openUploadDialog,\n    setContent: function setContent(content) {\n      qs('#fu_text').value = content;\n    }\n  };\n};\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _require = __webpack_require__(0),\n    qs = _require.qs;\n\nmodule.exports = function (screen, input) {\n  var keyInput = qs('#softkb-input');\n  if (!keyInput) return; // abort, we're not on the terminal page\n\n  var shortcutBar = document.createElement('div');\n  shortcutBar.id = 'keyboard-shortcut-bar';\n  if (navigator.userAgent.match(/iPad|iPhone|iPod/)) {\n    qs('#screen').appendChild(shortcutBar);\n  }\n\n  var keyboardOpen = false;\n\n  // moves the input to where the cursor is on the canvas.\n  // this is because most browsers will always scroll to wherever the focused\n  // input is\n  var updateInputPosition = function updateInputPosition() {\n    if (!keyboardOpen) return;\n\n    var _screen$layout$gridTo = screen.layout.gridToScreen(screen.cursor.x, screen.cursor.y, true),\n        _screen$layout$gridTo2 = _slicedToArray(_screen$layout$gridTo, 2),\n        x = _screen$layout$gridTo2[0],\n        y = _screen$layout$gridTo2[1];\n\n    keyInput.style.transform = 'translate(' + x + 'px, ' + y + 'px)';\n  };\n\n  keyInput.addEventListener('focus', function () {\n    keyboardOpen = true;\n    updateInputPosition();\n    shortcutBar.classList.add('open');\n  });\n\n  keyInput.addEventListener('blur', function () {\n    keyboardOpen = false;\n    shortcutBar.classList.remove('open');\n  });\n\n  screen.on('cursor-moved', updateInputPosition);\n\n  qs('#term-kb-open').addEventListener('click', function (e) {\n    e.preventDefault();\n    keyInput.focus();\n  });\n\n  // Chrome for Android doesn't send proper keydown/keypress events with\n  // real key values instead of 229 “Unidentified,” so here's a workaround\n  // that deals with the input composition events.\n\n  var lastCompositionString = '';\n\n  // sends the difference between the last and the new composition string\n  var sendInputDelta = function sendInputDelta(newValue) {\n    if (newValue === null) newValue = ''; // this sometimes happens, why?\n    var resend = false;\n    if (newValue.length > lastCompositionString.length) {\n      if (newValue.startsWith(lastCompositionString)) {\n        // characters have been added at the end\n        input.sendString(newValue.substr(lastCompositionString.length));\n      } else resend = true;\n    } else if (newValue.length < lastCompositionString.length) {\n      if (lastCompositionString.startsWith(newValue)) {\n        // characters have been removed at the end\n        input.sendString('\\b'.repeat(lastCompositionString.length - newValue.length));\n      } else resend = true;\n    } else if (newValue !== lastCompositionString) resend = true;\n\n    if (resend) {\n      // the entire string changed; resend everything\n      input.sendString('\\b'.repeat(lastCompositionString.length) + newValue);\n    }\n    lastCompositionString = newValue;\n  };\n\n  keyInput.addEventListener('keydown', function (e) {\n    if (e.key === 'Unidentified') return;\n\n    keyInput.value = '';\n\n    e.stopPropagation();\n    input.handleKeyDown(e);\n  });\n\n  keyInput.addEventListener('keypress', function (e) {\n    // prevent key duplication on iOS (because Safari *does* send proper events)\n    e.stopPropagation();\n  });\n\n  keyInput.addEventListener('input', function (e) {\n    e.stopPropagation();\n\n    if (e.isComposing && 'data' in e) {\n      sendInputDelta(e.data);\n    } else if (e.isComposing) {\n      // Firefox Mobile doesn't support InputEvent#data, so here's a hack\n      // that just takes the input value and uses that\n      sendInputDelta(keyInput.value);\n    } else {\n      if (e.inputType === 'insertCompositionText') input.sendString(e.data);else if (e.inputType === 'deleteContentBackward') {\n        lastCompositionString = '';\n        sendInputDelta('');\n      } else if (e.inputType === 'insertText') {\n        input.sendString(e.data);\n      }\n    }\n  });\n\n  keyInput.addEventListener('compositionstart', function (e) {\n    lastCompositionString = '';\n  });\n\n  keyInput.addEventListener('compositionend', function (e) {\n    lastCompositionString = '';\n    keyInput.value = '';\n  });\n\n  screen.on('open-soft-keyboard', function () {\n    return keyInput.focus();\n  });\n\n  // shortcut bar\n  var shortcuts = {\n    Control: 'ctrl',\n    Esc: 0x1b,\n    Tab: 0x09,\n    '←': 0x25,\n    '↓': 0x28,\n    '↑': 0x26,\n    '→': 0x27\n  };\n\n  var touchMoved = false;\n\n  var _loop = function _loop(shortcut) {\n    var button = document.createElement('button');\n    button.classList.add('shortcut-button');\n    button.textContent = shortcut;\n    shortcutBar.appendChild(button);\n\n    var key = shortcuts[shortcut];\n    if (typeof key === 'string') button.classList.add('modifier');\n    button.addEventListener('touchstart', function (e) {\n      touchMoved = false;\n      if (typeof key === 'string') {\n        // modifier button\n        input.softModifiers[key] = true;\n        button.classList.add('enabled');\n\n        // prevent default. This prevents scrolling, but also prevents the\n        // selection popup\n        e.preventDefault();\n      }\n    });\n    window.addEventListener('touchmove', function (e) {\n      touchMoved = true;\n    });\n    button.addEventListener('touchend', function (e) {\n      e.preventDefault();\n      if (typeof key === 'number') {\n        if (touchMoved) return;\n        var fakeEvent = { which: key, preventDefault: function preventDefault() {} };\n        input.handleKeyDown(fakeEvent);\n      } else if (typeof key === 'string') {\n        button.classList.remove('enabled');\n        input.softModifiers[key] = false;\n      }\n    });\n  };\n\n  for (var shortcut in shortcuts) {\n    _loop(shortcut);\n  }\n};\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar _require = __webpack_require__(3),\n    getColor = _require.getColor;\n\nvar _require2 = __webpack_require__(6),\n    ATTR_FG = _require2.ATTR_FG,\n    ATTR_BG = _require2.ATTR_BG,\n    ATTR_BOLD = _require2.ATTR_BOLD,\n    ATTR_UNDERLINE = _require2.ATTR_UNDERLINE,\n    ATTR_BLINK = _require2.ATTR_BLINK,\n    ATTR_ITALIC = _require2.ATTR_ITALIC,\n    ATTR_STRIKE = _require2.ATTR_STRIKE,\n    ATTR_OVERLINE = _require2.ATTR_OVERLINE,\n    ATTR_FAINT = _require2.ATTR_FAINT,\n    ATTR_FRAKTUR = _require2.ATTR_FRAKTUR;\n\n// debug toolbar, tooltip and screen\n\n\nmodule.exports = function attachDebugger(screen, connection) {\n  // debug screen overlay\n  var debugCanvas = document.createElement('canvas');\n  debugCanvas.classList.add('debug-canvas');\n  var ctx = debugCanvas.getContext('2d');\n\n  // debug toolbar\n  var toolbar = document.createElement('div');\n  toolbar.classList.add('debug-toolbar');\n\n  // debug tooltip\n  var tooltip = document.createElement('div');\n  tooltip.classList.add('debug-tooltip');\n  tooltip.classList.add('hidden');\n\n  // update functions, defined somewhere below\n  var updateTooltip = void 0;\n  var updateToolbar = void 0;\n\n  // tooltip cell\n  var selectedCell = null;\n\n  // update tooltip cell when mouse moves\n  var onMouseMove = function onMouseMove(e) {\n    if (e.target !== screen.layout.canvas) {\n      selectedCell = null;\n      return;\n    }\n    selectedCell = screen.layout.screenToGrid(e.offsetX, e.offsetY);\n    updateTooltip();\n  };\n\n  // hide tooltip when mouse leaves\n  var onMouseOut = function onMouseOut(e) {\n    selectedCell = null;\n    tooltip.classList.add('hidden');\n  };\n\n  // updates debug canvas size\n  var updateCanvasSize = function updateCanvasSize() {\n    var _screen$layout$window = screen.layout.window,\n        width = _screen$layout$window.width,\n        height = _screen$layout$window.height,\n        devicePixelRatio = _screen$layout$window.devicePixelRatio;\n\n    var cellSize = screen.layout.getCellSize();\n    var padding = Math.round(screen.layout._padding);\n    debugCanvas.width = (width * cellSize.width + 2 * padding) * devicePixelRatio;\n    debugCanvas.height = (height * cellSize.height + 2 * padding) * devicePixelRatio;\n    debugCanvas.style.width = width * cellSize.width + 2 * screen.layout._padding + 'px';\n    debugCanvas.style.height = height * cellSize.height + 2 * screen.layout._padding + 'px';\n  };\n\n  // defined somewhere below\n  var startDrawLoop = void 0;\n\n  var screenAttached = false;\n\n  // node to which events were bound (kept here for when they need to be removed)\n  var eventNode = void 0;\n\n  // attaches/detaches debug screen overlay to/from DOM\n  var setScreenAttached = function setScreenAttached(attached) {\n    if (attached && !debugCanvas.parentNode) {\n      screen.layout.canvas.parentNode.appendChild(debugCanvas);\n      eventNode = debugCanvas.parentNode;\n      eventNode.addEventListener('mousemove', onMouseMove);\n      eventNode.addEventListener('mouseout', onMouseOut);\n      screen.layout.on('size-update', updateCanvasSize);\n      updateCanvasSize();\n      screenAttached = true;\n      startDrawLoop();\n    } else if (!attached && debugCanvas.parentNode) {\n      debugCanvas.parentNode.removeChild(debugCanvas);\n      eventNode.removeEventListener('mousemove', onMouseMove);\n      eventNode.removeEventListener('mouseout', onMouseOut);\n      screen.layout.removeListener('size-update', updateCanvasSize);\n      screenAttached = false;\n    }\n  };\n\n  // attaches/detaches toolbar and tooltip to/from DOM\n  var setToolbarAttached = function setToolbarAttached(attached) {\n    if (attached && !toolbar.parentNode) {\n      screen.layout.canvas.parentNode.appendChild(toolbar);\n      screen.layout.canvas.parentNode.appendChild(tooltip);\n      updateToolbar();\n    } else if (!attached && toolbar.parentNode) {\n      screen.layout.canvas.parentNode.removeChild(toolbar);\n      screen.layout.canvas.parentNode.removeChild(tooltip);\n    }\n  };\n\n  // attach/detach toolbar when debug mode is enabled/disabled\n  screen.on('update-window:debug', function (enabled) {\n    setToolbarAttached(enabled);\n  });\n\n  // ditto ^\n  screen.layout.on('update-window:debug', function (enabled) {\n    setScreenAttached(enabled);\n  });\n\n  var drawData = {\n    // last draw reason\n    reason: '',\n\n    // when true, will show colored cell update overlays\n    showUpdates: false,\n\n    // draw start time in milliseconds\n    startTime: 0,\n\n    // end time\n    endTime: 0,\n\n    // partial update frames\n    frames: [],\n\n    // cell data\n    cells: new Map(),\n\n    // scroll region\n    scrollRegion: null\n\n    // debug interface\n  };screen._debug = screen.layout.renderer._debug = {\n    drawStart: function drawStart(reason) {\n      drawData.reason = reason;\n      drawData.startTime = window.performance.now();\n    },\n    drawEnd: function drawEnd() {\n      drawData.endTime = window.performance.now();\n    },\n    setCell: function setCell(cell, flags) {\n      drawData.cells.set(cell, [flags, window.performance.now()]);\n    },\n    pushFrame: function pushFrame(frame) {\n      drawData.frames.push([].concat(_toConsumableArray(frame), [window.performance.now()]));\n    }\n  };\n\n  var isDrawing = false;\n  var drawLoop = function drawLoop() {\n    // draw while the screen is attached\n    if (screenAttached) window.requestAnimationFrame(drawLoop);else isDrawing = false;\n\n    var now = window.performance.now();\n\n    var _screen$layout$window2 = screen.layout.window,\n        width = _screen$layout$window2.width,\n        height = _screen$layout$window2.height,\n        devicePixelRatio = _screen$layout$window2.devicePixelRatio;\n\n    var padding = Math.round(screen.layout._padding);\n    var cellSize = screen.layout.getCellSize();\n\n    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);\n    ctx.clearRect(0, 0, width * cellSize.width + 2 * padding, height * cellSize.height + 2 * padding);\n    ctx.translate(padding, padding);\n\n    ctx.lineWidth = 2;\n    ctx.lineJoin = 'round';\n\n    if (drawData.showUpdates) {\n      var cells = drawData.cells;\n      for (var cell = 0; cell < width * height; cell++) {\n        // cell does not exist or has no flags set\n        if (!cells.has(cell) || cells.get(cell)[0] === 0) continue;\n\n        var _cells$get = cells.get(cell),\n            _cells$get2 = _slicedToArray(_cells$get, 2),\n            flags = _cells$get2[0],\n            timestamp = _cells$get2[1];\n\n        var elapsedTime = (now - timestamp) / 1000;\n\n        if (elapsedTime > 1) {\n          cells.delete(cell);\n          continue;\n        }\n\n        ctx.globalAlpha = 0.5 * Math.max(0, 1 - elapsedTime);\n\n        var x = cell % width;\n        var y = Math.floor(cell / width);\n\n        if (flags & 2) {\n          // updated\n          ctx.fillStyle = '#0f0';\n        } else if (flags & 1) {\n          // redrawn\n          ctx.fillStyle = '#f0f';\n        }\n\n        if (!(flags & 4)) {\n          // outside a clipped region\n          ctx.fillStyle = '#0ff';\n        }\n\n        if (flags & 16) {\n          // was filled to speed up rendering\n          ctx.globalAlpha /= 2;\n        }\n\n        ctx.fillRect(x * cellSize.width, y * cellSize.height, cellSize.width, cellSize.height);\n\n        if (flags & 8) {\n          // wide cell\n          ctx.strokeStyle = '#f00';\n          ctx.beginPath();\n          ctx.moveTo(x * cellSize.width, (y + 1) * cellSize.height);\n          ctx.lineTo((x + 1) * cellSize.width, (y + 1) * cellSize.height);\n          ctx.stroke();\n        }\n      }\n\n      var framesToDelete = [];\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = drawData.frames[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var frame = _step.value;\n\n          var _timestamp = frame[4];\n          var _elapsedTime = (now - _timestamp) / 1000;\n          if (_elapsedTime > 1) framesToDelete.push(frame);else {\n            ctx.globalAlpha = 1 - _elapsedTime;\n            ctx.strokeStyle = '#ff0';\n            ctx.strokeRect(frame[0] * cellSize.width, frame[1] * cellSize.height, frame[2] * cellSize.width, frame[3] * cellSize.height);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = framesToDelete[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var _frame = _step2.value;\n\n          drawData.frames.splice(drawData.frames.indexOf(_frame), 1);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n\n    if (selectedCell !== null) {\n      // draw a dashed outline around the selected cell\n      var _selectedCell = selectedCell,\n          _selectedCell2 = _slicedToArray(_selectedCell, 2),\n          _x = _selectedCell2[0],\n          _y = _selectedCell2[1];\n\n      ctx.save();\n      ctx.globalAlpha = 0.5;\n      ctx.lineWidth = 1;\n\n      // draw X line\n      ctx.beginPath();\n      ctx.moveTo(0, _y * cellSize.height);\n      ctx.lineTo(_x * cellSize.width, _y * cellSize.height);\n      ctx.strokeStyle = '#f00';\n      ctx.setLineDash([cellSize.width]);\n      ctx.stroke();\n\n      // draw Y line\n      ctx.beginPath();\n      ctx.moveTo(_x * cellSize.width, 0);\n      ctx.lineTo(_x * cellSize.width, _y * cellSize.height);\n      ctx.strokeStyle = '#0f0';\n      ctx.setLineDash([cellSize.height]);\n      ctx.stroke();\n\n      ctx.globalAlpha = 1;\n      ctx.lineWidth = 1 + 0.5 * Math.sin(now / 1000 * 10);\n      ctx.strokeStyle = '#fff';\n      ctx.lineJoin = 'round';\n      ctx.setLineDash([2, 2]);\n      ctx.lineDashOffset = now / 1000 * 10;\n      ctx.strokeRect(_x * cellSize.width, _y * cellSize.height, cellSize.width, cellSize.height);\n      ctx.lineDashOffset += 2;\n      ctx.strokeStyle = '#000';\n      ctx.strokeRect(_x * cellSize.width, _y * cellSize.height, cellSize.width, cellSize.height);\n      ctx.restore();\n    }\n\n    if (drawData.scrollRegion !== null) {\n      // draw two lines marking the scroll region bounds\n      var _drawData$scrollRegio = _slicedToArray(drawData.scrollRegion, 2),\n          start = _drawData$scrollRegio[0],\n          end = _drawData$scrollRegio[1];\n\n      ctx.save();\n      ctx.globalAlpha = 1;\n      ctx.strokeStyle = '#00f';\n      ctx.lineWidth = 2;\n      ctx.setLineDash([2, 2]);\n\n      ctx.beginPath();\n      ctx.moveTo(0, start * cellSize.height);\n      ctx.lineTo(width * cellSize.width, start * cellSize.height);\n      ctx.stroke();\n\n      ctx.beginPath();\n      ctx.moveTo(0, (end + 1) * cellSize.height);\n      ctx.lineTo(width * cellSize.width, (end + 1) * cellSize.height);\n      ctx.stroke();\n\n      ctx.restore();\n    }\n  };\n\n  startDrawLoop = function startDrawLoop() {\n    if (isDrawing) return;\n    isDrawing = true;\n    drawLoop();\n  };\n\n  var pad2 = function pad2(i) {\n    return ('00' + i.toString()).substr(-2);\n  };\n  var formatColor = function formatColor(color) {\n    return color < 256 ? color.toString() : '#' + pad2(color >> 16) + pad2(color >> 8 & 0xFF) + pad2(color & 0xFF);\n  };\n\n  var makeSpan = function makeSpan(text, styles) {\n    var span = document.createElement('span');\n    span.textContent = text;\n    Object.assign(span.style, styles || {});\n    return span;\n  };\n  var formatAttributes = function formatAttributes(target, attrs) {\n    if (attrs & ATTR_FG) target.appendChild(makeSpan('HasFG'));\n    if (attrs & ATTR_BG) target.appendChild(makeSpan('HasBG'));\n    if (attrs & ATTR_BOLD) target.appendChild(makeSpan('Bold', { fontWeight: 'bold' }));\n    if (attrs & ATTR_UNDERLINE) target.appendChild(makeSpan('Uline', { textDecoration: 'underline' }));\n    if (attrs & ATTR_BLINK) target.appendChild(makeSpan('Blink'));\n    if (attrs & ATTR_ITALIC) target.appendChild(makeSpan('Italic', { fontStyle: 'italic' }));\n    if (attrs & ATTR_STRIKE) target.appendChild(makeSpan('Strike', { textDecoration: 'line-through' }));\n    if (attrs & ATTR_OVERLINE) target.appendChild(makeSpan('Oline', { textDecoration: 'overline' }));\n    if (attrs & ATTR_FAINT) target.appendChild(makeSpan('Faint', { opacity: 0.5 }));\n    if (attrs & ATTR_FRAKTUR) target.appendChild(makeSpan('Fraktur'));\n  };\n\n  updateTooltip = function updateTooltip() {\n    // TODO: make this not destroy and recreate the same nodes every time\n    tooltip.classList.remove('hidden');\n    tooltip.innerHTML = '';\n    var cell = selectedCell[1] * screen.window.width + selectedCell[0];\n    if (!screen.screen[cell]) return;\n\n    var foreground = document.createElement('span');\n    foreground.textContent = formatColor(screen.screenFG[cell]);\n    var preview = document.createElement('span');\n    preview.textContent = ' ●';\n    preview.style.color = getColor(screen.screenFG[cell], screen.layout.renderer.palette);\n    foreground.appendChild(preview);\n\n    var background = document.createElement('span');\n    background.textContent = formatColor(screen.screenBG[cell]);\n    var bgPreview = document.createElement('span');\n    bgPreview.textContent = ' ●';\n    bgPreview.style.color = getColor(screen.screenBG[cell], screen.layout.renderer.palette);\n    background.appendChild(bgPreview);\n\n    var character = screen.screen[cell];\n    var codePoint = character.codePointAt(0);\n    var formattedCodePoint = codePoint.toString(16).length <= 4 ? ('0000' + codePoint.toString(16)).substr(-4) : codePoint.toString(16);\n\n    var attributes = document.createElement('span');\n    attributes.classList.add('attributes');\n    formatAttributes(attributes, screen.screenAttrs[cell]);\n\n    var data = {\n      Cell: 'col ' + (selectedCell[0] + 1) + ', ln ' + (selectedCell[1] + 1) + ' (' + cell + ')',\n      Foreground: foreground,\n      Background: background,\n      Character: 'U+' + formattedCodePoint,\n      Attributes: attributes\n    };\n\n    var table = document.createElement('table');\n\n    for (var name in data) {\n      var row = document.createElement('tr');\n      var label = document.createElement('td');\n      label.appendChild(new window.Text(name));\n      label.classList.add('label');\n\n      var value = document.createElement('td');\n      value.appendChild(typeof data[name] === 'string' ? new window.Text(data[name]) : data[name]);\n      value.classList.add('value');\n\n      row.appendChild(label);\n      row.appendChild(value);\n      table.appendChild(row);\n    }\n\n    tooltip.appendChild(table);\n\n    var cellSize = screen.layout.getCellSize();\n    // add 3 to the position because for some reason the corner is off\n    var posX = (selectedCell[0] + 1) * cellSize.width + 3;\n    var posY = (selectedCell[1] + 1) * cellSize.height + 3;\n    tooltip.style.transform = 'translate(' + posX + 'px, ' + posY + 'px)';\n  };\n\n  var toolbarData = null;\n  var toolbarNodes = {};\n\n  // construct the toolbar if it wasn't already\n  var initToolbar = function initToolbar() {\n    if (toolbarData) return;\n\n    var showUpdates = document.createElement('input');\n    showUpdates.type = 'checkbox';\n    showUpdates.addEventListener('change', function (e) {\n      drawData.showUpdates = showUpdates.checked;\n    });\n\n    var fancyGraphics = document.createElement('input');\n    fancyGraphics.type = 'checkbox';\n    fancyGraphics.value = !!screen.layout.renderer.graphics;\n    fancyGraphics.addEventListener('change', function (e) {\n      screen.layout.renderer.graphics = +fancyGraphics.checked;\n    });\n\n    toolbarData = {\n      cursor: {\n        title: 'Cursor',\n        Position: '',\n        Style: '',\n        Visible: true,\n        Hanging: false\n      },\n      internal: {\n        Flags: '',\n        'Cursor Attributes': '',\n        'Code Page': '',\n        Heap: 0,\n        Clients: 0\n      },\n      drawing: {\n        title: 'Drawing',\n        'Last Update': '',\n        'Show Updates': showUpdates,\n        'Fancy Graphics': fancyGraphics,\n        'Redraw Screen': function RedrawScreen() {\n          screen.layout.renderer.resetDrawn();\n          screen.layout.renderer.draw('debug-redraw');\n        }\n      }\n    };\n\n    var _loop = function _loop(i) {\n      var group = toolbarData[i];\n      var table = document.createElement('table');\n      table.classList.add('toolbar-group');\n\n      toolbarNodes[i] = {};\n\n      var _loop2 = function _loop2(key) {\n        var item = document.createElement('tr');\n        var name = document.createElement('td');\n        name.classList.add('name');\n        var value = document.createElement('td');\n        value.classList.add('value');\n\n        toolbarNodes[i][key] = { name: name, value: value };\n\n        if (key === 'title') {\n          name.textContent = group[key];\n          name.classList.add('title');\n        } else {\n          name.textContent = key;\n          if (group[key] instanceof Function) {\n            name.textContent = '';\n            var button = document.createElement('button');\n            name.classList.add('has-button');\n            name.appendChild(button);\n            button.textContent = key;\n            button.addEventListener('click', function (e) {\n              return group[key](e);\n            });\n          } else if (group[key] instanceof window.Node) value.appendChild(group[key]);else value.textContent = group[key];\n        }\n\n        item.appendChild(name);\n        item.appendChild(value);\n        table.appendChild(item);\n      };\n\n      for (var key in group) {\n        _loop2(key);\n      }\n\n      toolbar.appendChild(table);\n    };\n\n    for (var i in toolbarData) {\n      _loop(i);\n    }\n\n    var heartbeat = toolbarNodes.heartbeat = document.createElement('div');\n    heartbeat.classList.add('heartbeat');\n    heartbeat.textContent = '❤';\n    toolbar.appendChild(heartbeat);\n  };\n\n  connection.on('heartbeat', function () {\n    if (screenAttached && toolbarNodes.heartbeat) {\n      toolbarNodes.heartbeat.classList.remove('beat');\n      window.requestAnimationFrame(function () {\n        toolbarNodes.heartbeat.classList.add('beat');\n      });\n    }\n  });\n\n  updateToolbar = function updateToolbar() {\n    initToolbar();\n\n    Object.assign(toolbarData.cursor, {\n      Position: 'col ' + (screen.cursor.x + 1) + ', ln ' + (screen.cursor.y + 1),\n      Style: screen.cursor.style + (screen.cursor.blinking ? ', blink' : ''),\n      Visible: screen.cursor.visible,\n      Hanging: screen.cursor.hanging\n    });\n\n    var drawTime = Math.round((drawData.endTime - drawData.startTime) * 100) / 100;\n    toolbarData.drawing['Last Update'] = drawData.reason + ' (' + drawTime + 'ms)';\n    toolbarData.drawing['Fancy Graphics'].checked = !!screen.layout.renderer.graphics;\n\n    for (var i in toolbarData) {\n      var _group = toolbarData[i];\n      var nodes = toolbarNodes[i];\n      for (var key in _group) {\n        if (key === 'title') continue;\n        var _value = nodes[key].value;\n        if (!(_group[key] instanceof window.Node) && !(_group[key] instanceof Function)) {\n          _value.textContent = _group[key];\n        }\n      }\n    }\n  };\n\n  screen.on('update', updateToolbar);\n  screen.on('internal', function (data) {\n    if (screenAttached && toolbarData) {\n      Object.assign(toolbarData.internal, {\n        Flags: data.flags.toString(2),\n        'Cursor Attributes': data.cursorAttrs.toString(2),\n        'Code Page': data.charsetGx + ' (' + data.charsetG0 + ', ' + data.charsetG1 + ')',\n        Heap: data.freeHeap,\n        Clients: data.clientCount\n      });\n      drawData.scrollRegion = [data.regionStart, data.regionEnd];\n      updateToolbar();\n    }\n  });\n};\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar _require = __webpack_require__(3),\n    getColor = _require.getColor;\n\nvar _require2 = __webpack_require__(0),\n    qs = _require2.qs;\n\nvar _require3 = __webpack_require__(7),\n    rgb2hsl = _require3.rgb2hsl,\n    hex2rgb = _require3.hex2rgb,\n    rgb2hex = _require3.rgb2hex,\n    hsl2rgb = _require3.hsl2rgb;\n\nmodule.exports = function initButtons(input) {\n  var container = qs('#action-buttons');\n\n  // current color palette\n  var palette = [];\n\n  // button labels\n  var labels = [];\n\n  // button colors\n  var colors = {};\n\n  // button elements\n  var buttons = [];\n\n  // add a button element\n  var pushButton = function pushButton() {\n    var button = document.createElement('button');\n    button.classList.add('action-button');\n    button.setAttribute('data-n', buttons.length);\n    buttons.push(button);\n    container.appendChild(button);\n\n    button.addEventListener('click', function (e) {\n      // might as well use the attribute ¯\\_(ツ)_/¯\n      var index = +button.getAttribute('data-n');\n      input.sendButton(index);\n\n      e.target.blur(); // if it keeps focus, spacebar will push it\n    });\n\n    // this prevents button retaining focus after half-click/drag-away\n    button.addEventListener('mouseleave', function (e) {\n      e.target.blur();\n    });\n\n    return button;\n  };\n\n  // remove a button element\n  var popButton = function popButton() {\n    var button = buttons.pop();\n    button.parentNode.removeChild(button);\n  };\n\n  // sync with DOM\n  var update = function updateButtons() {\n    if (labels.length > buttons.length) {\n      for (var i = buttons.length; i < labels.length; i++) {\n        pushButton();\n      }\n    } else if (buttons.length > labels.length) {\n      for (var _i = buttons.length; _i > labels.length; _i--) {\n        popButton();\n      }\n    }\n\n    for (var _i2 = 0; _i2 < labels.length; _i2++) {\n      var label = labels[_i2].trim();\n      var button = buttons[_i2];\n      var color = colors[_i2];\n\n      button.textContent = label || '\\xA0'; // label or nbsp\n\n      if (!label) button.classList.add('inactive');else button.classList.remove('inactive');\n\n      // 0 or undefined can be used to disable custom color\n      if (Number.isFinite(color) && color !== 0) {\n        var clr = getColor(color, palette);\n        button.style.background = clr;\n\n        // darken the color a bit for the 3D side\n        var hsl = rgb2hsl.apply(undefined, _toConsumableArray(hex2rgb(clr)));\n        var hex = rgb2hex.apply(undefined, _toConsumableArray(hsl2rgb(hsl[0], hsl[1], hsl[2] * 0.7)));\n        button.style.boxShadow = '0 3px 0 ' + hex;\n      } else {\n        button.style.background = null;\n        button.style.boxShadow = null;\n      }\n    }\n  };\n\n  return {\n    update: update,\n    get labels() {\n      return labels;\n    },\n    set labels(value) {\n      labels = value;\n      update();\n    },\n    get colors() {\n      return colors;\n    },\n    set colors(value) {\n      colors = value;\n      update();\n    },\n    get palette() {\n      return palette;\n    },\n    set palette(value) {\n      palette = value;\n      update();\n    }\n  };\n};\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar ColorTriangle = __webpack_require__(28);\nvar $ = __webpack_require__(1);\nvar themes = __webpack_require__(3);\n\nvar _require = __webpack_require__(0),\n    qs = _require.qs;\n\nfunction selectedTheme() {\n  return +$('#theme').val();\n}\n\nexports.init = function () {\n  $('#theme').on('change', showColor);\n  $('#default_fg,#default_bg').on('input', showColor);\n\n  var opts = {\n    padding: 10,\n    event: 'drag',\n    uppercase: true,\n    trianglePointerSize: 20,\n    // wheelPointerSize: 12,\n    size: 200,\n    parseColor: function parseColor(color) {\n      return themes.toHex(color, selectedTheme());\n    }\n  };\n\n  ColorTriangle.initInput(qs('#default_fg'), opts);\n  ColorTriangle.initInput(qs('#default_bg'), opts);\n  for (var i = 1; i <= 5; i++) {\n    ColorTriangle.initInput(qs('#bc' + i), opts);\n  }\n\n  $('.colorprev.bg span').on('click', function () {\n    var bg = this.dataset.bg;\n    if (typeof bg != 'undefined') $('#default_bg').val(bg);\n    showColor();\n  });\n\n  $('.colorprev.fg span').on('click', function () {\n    var fg = this.dataset.fg;\n    if (typeof fg != 'undefined') $('#default_fg').val(fg);\n    showColor();\n  });\n\n  var $presets = $('#fgbg_presets');\n  for (var _i = 0; _i < themes.fgbgThemes.length; _i++) {\n    var thm = themes.fgbgThemes[_i];\n    var fg = thm[0];\n    var bg = thm[1];\n    var lbl = thm[2];\n    var tit = thm[3];\n    $presets.htmlAppend('<span class=\"preset\" ' + 'data-xfg=\"' + fg + '\" data-xbg=\"' + bg + '\" ' + 'style=\"color:' + fg + ';background:' + bg + '\" title=\"' + tit + '\">&nbsp;' + lbl + '&nbsp;</span>');\n\n    if ((_i + 1) % 5 === 0) $presets.htmlAppend('<br>');\n  }\n\n  $('.preset').on('click', function () {\n    $('#default_fg').val(this.dataset.xfg);\n    $('#default_bg').val(this.dataset.xbg);\n    showColor();\n  });\n\n  showColor();\n};\n\nfunction showColor() {\n  var ex = qs('.color-example');\n  var fg = $('#default_fg').val();\n  var bg = $('#default_bg').val();\n\n  if (/^\\d+$/.test(fg)) {\n    fg = +fg;\n  } else if (!/^#[\\da-f]{6}$/i.test(fg)) {\n    fg = 'black';\n  }\n\n  if (/^\\d+$/.test(bg)) {\n    bg = +bg;\n  } else if (!/^#[\\da-f]{6}$/i.test(bg)) {\n    bg = 'black';\n  }\n\n  var themeN = selectedTheme();\n  ex.dataset.fg = fg;\n  ex.dataset.bg = bg;\n\n  themes.themePreview(themeN);\n\n  $('.colorprev.fg span').css('background', themes.toHex(bg, themeN));\n}\n\nexports.nextTheme = function () {\n  var sel = qs('#theme');\n  var i = sel.selectedIndex;\n  sel.options[++i % sel.options.length].selected = true;\n  showColor();\n};\n\nexports.prevTheme = function () {\n  var sel = qs('#theme');\n  var i = sel.selectedIndex;\n  sel.options[(sel.options.length + --i) % sel.options.length].selected = true;\n  showColor();\n};\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/*\n * Copyright (c) 2010 Tim Baumann\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n// NOTE: Converted to ES6 by MightyPork (2017)\n// Modified for ESPTerm\n\nvar EventEmitter = __webpack_require__(2);\n\nvar _require = __webpack_require__(7),\n    rgb2hex = _require.rgb2hex,\n    hex2rgb = _require.hex2rgb,\n    hsl2rgb = _require.hsl2rgb,\n    rgb2hsl = _require.rgb2hsl;\n\nvar win = window;\nvar doc = document;\nvar M = Math;\nvar TAU = 2 * M.PI;\n\nfunction times(i, fn) {\n  for (var j = 0; j < i; j++) {\n    fn(j);\n  }\n}\n\nfunction each(obj, fn) {\n  if (obj.length) {\n    times(obj.length, function (i) {\n      fn(obj[i], i);\n    });\n  } else {\n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        fn(obj[key], key);\n      }\n    }\n  }\n}\n\nmodule.exports = function (_EventEmitter) {\n  _inherits(ColorTriangle, _EventEmitter);\n\n  /****************\n   * ColorTriangle *\n   ****************/\n\n  // Constructor function:\n  function ColorTriangle(color, options) {\n    _classCallCheck(this, ColorTriangle);\n\n    var _this = _possibleConstructorReturn(this, (ColorTriangle.__proto__ || Object.getPrototypeOf(ColorTriangle)).call(this));\n\n    _this.options = {\n      size: 150,\n      padding: 8,\n      triangleSize: 0.8,\n      wheelPointerColor1: '#444',\n      wheelPointerColor2: '#eee',\n      trianglePointerSize: 16,\n      // wheelPointerSize: 16,\n      trianglePointerColor1: '#eee',\n      trianglePointerColor2: '#444',\n      background: 'transparent'\n    };\n\n    _this.pixelRatio = window.devicePixelRatio;\n\n    _this.setOptions(options);\n    _this.calculateProperties();\n\n    _this.createContainer();\n    _this.createTriangle();\n    _this.createWheel();\n    _this.createWheelPointer();\n    _this.createTrianglePointer();\n    _this.attachEvents();\n\n    color = color || '#f00';\n    if (typeof color == 'string') {\n      _this.setHEX(color);\n    }\n    return _this;\n  }\n\n  _createClass(ColorTriangle, [{\n    key: 'calculateProperties',\n    value: function calculateProperties() {\n      var opts = this.options;\n\n      this.padding = opts.padding;\n      this.innerSize = opts.size - opts.padding * 2;\n      this.triangleSize = opts.triangleSize * this.innerSize;\n      this.wheelThickness = (this.innerSize - this.triangleSize) / 2;\n      this.wheelPointerSize = opts.wheelPointerSize || this.wheelThickness;\n\n      this.wheelRadius = this.innerSize / 2;\n      this.triangleRadius = this.triangleSize / 2;\n      this.triangleSideLength = M.sqrt(3) * this.triangleRadius;\n    }\n  }, {\n    key: 'calculatePositions',\n    value: function calculatePositions() {\n      var r = this.triangleRadius;\n      var hue = this.hue;\n      var third = TAU / 3;\n      var s = this.saturation;\n      var l = this.lightness;\n\n      // Colored point\n      var hx = this.hx = M.cos(hue) * r;\n      var hy = this.hy = -M.sin(hue) * r;\n      // Black point\n      var sx = this.sx = M.cos(hue - third) * r;\n      var sy = this.sy = -M.sin(hue - third) * r;\n      // White point\n      var vx = this.vx = M.cos(hue + third) * r;\n      var vy = this.vy = -M.sin(hue + third) * r;\n      // Current point\n      var mx = (sx + vx) / 2;\n      var my = (sy + vy) / 2;\n      var a = (1 - 2 * M.abs(l - 0.5)) * s;\n      this.x = sx + (vx - sx) * l + (hx - mx) * a;\n      this.y = sy + (vy - sy) * l + (hy - my) * a;\n    }\n  }, {\n    key: 'createContainer',\n    value: function createContainer() {\n      var c = this.container = doc.createElement('div');\n      c.className = 'color-triangle';\n\n      c.style.display = 'block';\n      c.style.padding = this.padding + 'px';\n      c.style.position = 'relative';\n      c.style.boxShadow = '0 1px 10px black';\n      c.style.borderRadius = '5px';\n      c.style.width = c.style.height = this.innerSize + 2 * this.padding + 'px';\n      c.style.background = this.options.background;\n    }\n  }, {\n    key: 'createWheel',\n    value: function createWheel() {\n      var c = this.wheel = doc.createElement('canvas');\n      c.width = c.height = this.innerSize * this.pixelRatio;\n      c.style.width = c.style.height = this.innerSize + 'px';\n      c.style.position = 'absolute';\n      c.style.margin = c.style.padding = '0';\n      c.style.left = c.style.top = this.padding + 'px';\n\n      this.drawWheel(c.getContext('2d'));\n      this.container.appendChild(c);\n    }\n  }, {\n    key: 'drawWheel',\n    value: function drawWheel(ctx) {\n      var s = void 0,\n          i = void 0;\n\n      ctx.save();\n      ctx.setTransform(this.pixelRatio, 0, 0, this.pixelRatio, 0, 0);\n      ctx.translate(this.wheelRadius, this.wheelRadius);\n      s = this.wheelRadius - this.triangleRadius;\n      // Draw a circle for every color\n      for (i = 0; i < 360; i++) {\n        ctx.rotate(TAU / -360); // rotate one degree\n        ctx.beginPath();\n        ctx.fillStyle = 'hsl(' + i + ', 100%, 50%)';\n        ctx.arc(this.wheelRadius - s / 2, 0, s / 2, 0, TAU, true);\n        ctx.fill();\n      }\n      ctx.restore();\n    }\n  }, {\n    key: 'createTriangle',\n    value: function createTriangle() {\n      var c = this.triangle = doc.createElement('canvas');\n\n      c.width = c.height = this.innerSize * this.pixelRatio;\n      c.style.width = c.style.height = this.innerSize + 'px';\n      c.style.position = 'absolute';\n      c.style.margin = c.style.padding = '0';\n      c.style.left = c.style.top = this.padding + 'px';\n\n      this.triangleCtx = c.getContext('2d');\n\n      this.container.appendChild(c);\n    }\n  }, {\n    key: 'drawTriangle',\n    value: function drawTriangle() {\n      var hx = this.hx;\n      var hy = this.hy;\n      var sx = this.sx;\n      var sy = this.sy;\n      var vx = this.vx;\n      var vy = this.vy;\n      var size = this.innerSize;\n\n      var ctx = this.triangleCtx;\n\n      // clear\n      ctx.clearRect(0, 0, size * this.pixelRatio, size * this.pixelRatio);\n\n      ctx.save();\n      ctx.setTransform(this.pixelRatio, 0, 0, this.pixelRatio, 0, 0);\n      ctx.translate(this.wheelRadius, this.wheelRadius);\n\n      // make a triangle\n      ctx.beginPath();\n      ctx.moveTo(hx, hy);\n      ctx.lineTo(sx, sy);\n      ctx.lineTo(vx, vy);\n      ctx.closePath();\n      ctx.clip();\n\n      ctx.fillStyle = '#000';\n      ctx.fillRect(-this.wheelRadius, -this.wheelRadius, size, size);\n      // => black triangle\n\n      // create gradient from hsl(hue, 1, 1) to transparent\n      var grad0 = ctx.createLinearGradient(hx, hy, (sx + vx) / 2, (sy + vy) / 2);\n      var hsla = 'hsla(' + M.round(this.hue * (360 / TAU)) + ', 100%, 50%, ';\n      grad0.addColorStop(0, hsla + '1)');\n      grad0.addColorStop(1, hsla + '0)');\n      ctx.fillStyle = grad0;\n      ctx.fillRect(-this.wheelRadius, -this.wheelRadius, size, size);\n      // => gradient: one side of the triangle is black, the opponent angle is $color\n\n      // create color gradient from white to transparent\n      var grad1 = ctx.createLinearGradient(vx, vy, (hx + sx) / 2, (hy + sy) / 2);\n      grad1.addColorStop(0, '#fff');\n      grad1.addColorStop(1, 'rgba(255, 255, 255, 0)');\n      ctx.globalCompositeOperation = 'lighter';\n      ctx.fillStyle = grad1;\n      ctx.fillRect(-this.wheelRadius, -this.wheelRadius, size, size);\n      // => white angle\n\n      ctx.restore();\n    }\n\n    // The two pointers\n\n  }, {\n    key: 'createWheelPointer',\n    value: function createWheelPointer() {\n      var c = this.wheelPointer = doc.createElement('canvas');\n      var size = this.wheelPointerSize;\n      c.width = c.height = size * this.pixelRatio;\n      c.style.width = c.style.height = size + 'px';\n      c.style.position = 'absolute';\n      c.style.margin = c.style.padding = '0';\n      this.drawPointer(c.getContext('2d'), size / 2, this.options.wheelPointerColor1, this.options.wheelPointerColor2);\n      this.container.appendChild(c);\n    }\n  }, {\n    key: 'moveWheelPointer',\n    value: function moveWheelPointer() {\n      var r = this.wheelPointerSize / 2;\n      var s = this.wheelPointer.style;\n      s.top = this.padding + this.wheelRadius - M.sin(this.hue) * (this.triangleRadius + this.wheelThickness / 2) - r + 'px';\n      s.left = this.padding + this.wheelRadius + M.cos(this.hue) * (this.triangleRadius + this.wheelThickness / 2) - r + 'px';\n    }\n  }, {\n    key: 'createTrianglePointer',\n    value: function createTrianglePointer() {\n      // create pointer in the triangle\n      var c = this.trianglePointer = doc.createElement('canvas');\n      var size = this.options.trianglePointerSize;\n\n      c.width = c.height = size * this.pixelRatio;\n      c.style.width = c.style.height = size + 'px';\n      c.style.position = 'absolute';\n      c.style.margin = c.style.padding = '0';\n      this.drawPointer(c.getContext('2d'), size / 2, this.options.trianglePointerColor1, this.options.trianglePointerColor2);\n      this.container.appendChild(c);\n    }\n  }, {\n    key: 'moveTrianglePointer',\n    value: function moveTrianglePointer(x, y) {\n      var s = this.trianglePointer.style;\n      var r = this.options.trianglePointerSize / 2;\n      s.top = this.y + this.wheelRadius + this.padding - r + 'px';\n      s.left = this.x + this.wheelRadius + this.padding - r + 'px';\n    }\n  }, {\n    key: 'drawPointer',\n    value: function drawPointer(ctx, r, color1, color2) {\n      ctx.setTransform(this.pixelRatio, 0, 0, this.pixelRatio, 0, 0);\n      ctx.fillStyle = color2;\n      ctx.beginPath();\n      ctx.arc(r, r, r, 0, TAU, true);\n      ctx.fill(); // => black circle\n      ctx.fillStyle = color1;\n      ctx.beginPath();\n      ctx.arc(r, r, r - 2, 0, TAU, true);\n      ctx.fill(); // => white circle with 1px black border\n      ctx.fillStyle = color2;\n      ctx.beginPath();\n      ctx.arc(r, r, r / 4 + 2, 0, TAU, true);\n      ctx.fill(); // => black circle with big white border and a small black border\n      ctx.globalCompositeOperation = 'destination-out';\n      ctx.beginPath();\n      ctx.arc(r, r, r / 4, 0, TAU, true);\n      ctx.fill(); // => transparent center\n    }\n\n    // The Element and the DOM\n\n  }, {\n    key: 'inject',\n    value: function inject(parent) {\n      parent.appendChild(this.container);\n    }\n  }, {\n    key: 'getRelativeCoordinates',\n    value: function getRelativeCoordinates(evt) {\n      var elem = this.triangle;\n      var rect = elem.getBoundingClientRect();\n\n      return {\n        x: evt.clientX - rect.x,\n        y: evt.clientY - rect.y\n      };\n    }\n  }, {\n    key: 'dispose',\n    value: function dispose() {\n      var parent = this.container.parentNode;\n      if (parent) {\n        parent.removeChild(this.container);\n      }\n    }\n  }, {\n    key: 'getElement',\n    value: function getElement() {\n      return this.container;\n    }\n\n    // Color accessors\n\n  }, {\n    key: 'getCSS',\n    value: function getCSS() {\n      var h = Math.round(this.hue * (360 / TAU));\n      var s = Math.round(this.saturation * 100);\n      var l = Math.round(this.lightness * 100);\n\n      return 'hsl(' + h + ', ' + s + '%, ' + l + '%)';\n    }\n  }, {\n    key: 'getHEX',\n    value: function getHEX() {\n      return rgb2hex.apply(undefined, _toConsumableArray(this.getRGB()));\n    }\n  }, {\n    key: 'setHEX',\n    value: function setHEX(hex) {\n      this.setRGB.apply(this, _toConsumableArray(hex2rgb(hex)));\n    }\n  }, {\n    key: 'getRGB',\n    value: function getRGB() {\n      return hsl2rgb.apply(undefined, _toConsumableArray(this.getHSL()));\n    }\n  }, {\n    key: 'setRGB',\n    value: function setRGB(r, g, b) {\n      this.setHSL.apply(this, _toConsumableArray(rgb2hsl(r, g, b)));\n    }\n  }, {\n    key: 'getHSL',\n    value: function getHSL() {\n      return [this.hue, this.saturation, this.lightness];\n    }\n  }, {\n    key: 'setHSL',\n    value: function setHSL(h, s, l) {\n      this.hue = h;\n      this.saturation = s;\n      this.lightness = l;\n\n      this.initColor();\n    }\n  }, {\n    key: 'initColor',\n    value: function initColor() {\n      this.calculatePositions();\n      this.moveWheelPointer();\n      this.drawTriangle();\n      this.moveTrianglePointer();\n    }\n\n    // Mouse event handling\n\n  }, {\n    key: 'attachEvents',\n    value: function attachEvents() {\n      var _this2 = this;\n\n      this.down = null;\n\n      var mousedown = function mousedown(evt) {\n        evt.stopPropagation();\n        evt.preventDefault();\n\n        doc.body.addEventListener('mousemove', mousemove, false);\n        doc.body.addEventListener('mouseup', mouseup, false);\n\n        var xy = _this2.getRelativeCoordinates(evt);\n        _this2.map(xy.x, xy.y);\n      };\n\n      var mousemove = function mousemove(evt) {\n        var xy = _this2.getRelativeCoordinates(evt);\n        _this2.move(xy.x, xy.y);\n      };\n\n      var mouseup = function mouseup(evt) {\n        if (_this2.down) {\n          _this2.down = null;\n          _this2.emit('dragend');\n        }\n        doc.body.removeEventListener('mousemove', mousemove, false);\n        doc.body.removeEventListener('mouseup', mouseup, false);\n      };\n\n      this.container.addEventListener('mousedown', mousedown, false);\n      this.container.addEventListener('mousemove', mousemove, false);\n    }\n  }, {\n    key: 'map',\n    value: function map(x, y) {\n      var x0 = x;\n      var y0 = y;\n      x -= this.wheelRadius;\n      y -= this.wheelRadius;\n\n      var r = M.sqrt(x * x + y * y); // Pythagoras\n      if (r > this.triangleRadius && r < this.wheelRadius) {\n        // Wheel\n        this.down = 'wheel';\n        this.emit('dragstart');\n        this.move(x0, y0);\n      } else if (r < this.triangleRadius) {\n        // Inner circle\n        this.down = 'triangle';\n        this.emit('dragstart');\n        this.move(x0, y0);\n      }\n    }\n  }, {\n    key: 'move',\n    value: function move(x, y) {\n      if (!this.down) {\n        return;\n      }\n\n      x -= this.wheelRadius;\n      y -= this.wheelRadius;\n\n      var rad = M.atan2(-y, x);\n      if (rad < 0) {\n        rad += TAU;\n      }\n\n      if (this.down === 'wheel') {\n        this.hue = rad;\n        this.initColor();\n        this.emit('drag');\n      } else if (this.down === 'triangle') {\n        // get radius and max radius\n        var rad0 = (rad + TAU - this.hue) % TAU;\n        var rad1 = rad0 % (TAU / 3) - TAU / 6;\n        var a = 0.5 * this.triangleRadius;\n        var b = M.tan(rad1) * a;\n        var r = M.sqrt(x * x + y * y); // Pythagoras\n        var maxR = M.sqrt(a * a + b * b); // Pythagoras\n\n        if (r > maxR) {\n          var dx = M.tan(rad1) * r;\n          var rad2 = M.atan(dx / maxR);\n          if (rad2 > TAU / 6) {\n            rad2 = TAU / 6;\n          } else if (rad2 < -TAU / 6) {\n            rad2 = -TAU / 6;\n          }\n          rad += rad2 - rad1;\n\n          rad0 = (rad + TAU - this.hue) % TAU;\n          rad1 = rad0 % (TAU / 3) - TAU / 6;\n          b = M.tan(rad1) * a;\n          r = maxR = M.sqrt(a * a + b * b); // Pythagoras\n        }\n\n        x = M.round(M.cos(rad) * r);\n        y = M.round(-M.sin(rad) * r);\n\n        var l = this.lightness = M.sin(rad0) * r / this.triangleSideLength + 0.5;\n\n        var widthShare = 1 - M.abs(l - 0.5) * 2;\n        var s = this.saturation = (M.cos(rad0) * r + this.triangleRadius / 2) / (1.5 * this.triangleRadius) / widthShare;\n        s = M.max(0, s); // cannot be lower than 0\n        s = M.min(1, s); // cannot be greater than 1\n\n        this.lightness = l;\n        this.saturation = s;\n\n        this.x = x;\n        this.y = y;\n        this.moveTrianglePointer();\n\n        this.emit('drag');\n      }\n    }\n\n    /***************\n     * Init helpers *\n     ***************/\n\n  }, {\n    key: 'setOptions',\n\n\n    /*******************\n     * Helper functions *\n     *******************/\n\n    value: function setOptions(opts) {\n      opts = opts || {};\n      var dflt = this.options;\n      var options = this.options = {};\n\n      each(dflt, function (val, key) {\n        options[key] = opts.hasOwnProperty(key) ? opts[key] : val;\n      });\n    }\n  }], [{\n    key: 'initInput',\n    value: function initInput(input, options) {\n      options = options || {};\n\n      var ct = void 0;\n      var openColorTriangle = function openColorTriangle() {\n        var hex = input.value;\n        if (options.parseColor) hex = options.parseColor(hex);\n        if (!ct) {\n          options.size = options.size || input.offsetWidth;\n          options.background = win.getComputedStyle(input, null).backgroundColor;\n          options.margin = options.margin || 10;\n          options.event = options.event || 'dragend';\n\n          ct = new ColorTriangle(hex, options);\n          ct.on(options.event, function () {\n            var hex = ct.getHEX();\n            input.value = options.uppercase ? hex.toUpperCase() : hex;\n            fireChangeEvent();\n          });\n        } else {\n          ct.setHEX(hex);\n        }\n\n        var top = input.offsetTop;\n        if (win.innerHeight - input.getBoundingClientRect().top > input.offsetHeight + options.margin + options.size) {\n          top += input.offsetHeight + options.margin; // below\n        } else {\n          top -= options.margin + options.size; // above\n        }\n\n        var el = ct.getElement();\n        el.style.position = 'absolute';\n        el.style.left = input.offsetLeft + 'px';\n        el.style.top = top + 'px';\n        el.style.zIndex = '1338'; // above everything\n\n        ct.inject(input.parentNode);\n      };\n\n      var closeColorTriangle = function closeColorTriangle() {\n        if (ct) {\n          ct.dispose();\n        }\n      };\n\n      var fireChangeEvent = function fireChangeEvent() {\n        var evt = doc.createEvent('HTMLEvents');\n        evt.initEvent('input', true, false); // bubbles = true, cancable = false\n        input.dispatchEvent(evt); // fire event\n      };\n\n      input.addEventListener('focus', openColorTriangle, false);\n      input.addEventListener('blur', closeColorTriangle, false);\n      input.addEventListener('keyup', function () {\n        var val = input.value;\n        if (val.match(/^#((?:[0-9A-Fa-f]{3})|(?:[0-9A-Fa-f]{6}))$/)) {\n          openColorTriangle();\n          fireChangeEvent();\n        } else {\n          closeColorTriangle();\n        }\n      }, false);\n    }\n  }]);\n\n  return ColorTriangle;\n}(EventEmitter);\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// app.9aae724-en.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b64d5b4ad8c9e58eb51b","/** Make a node */\nexports.mk = function mk (e) {\n  return document.createElement(e)\n}\n\n/** Find one by query */\nexports.qs = function qs (s) {\n  return document.querySelector(s)\n}\n\n/** Find all by query */\nexports.qsa = function qsa (s) {\n  return document.querySelectorAll(s)\n}\n\n/**\n * Filter 'spacebar' and 'return' from keypress handler,\n * and when they're pressed, fire the callback.\n * use $(...).on('keypress', cr(handler))\n */\nexports.cr = function cr (hdl) {\n  return function (e) {\n    if (e.which === 10 || e.which === 13 || e.which === 32) {\n      hdl.call(this, e)\n    }\n  }\n}\n\n/** Decode number from 2B encoding */\nexports.parse2B = function parse2B (s, i = 0) {\n  return (s.charCodeAt(i++) - 1) + (s.charCodeAt(i) - 1) * 127\n}\n\n/** Decode number from 3B encoding */\nexports.parse3B = function parse3B (s, i = 0) {\n  return (s.charCodeAt(i) - 1) + (s.charCodeAt(i + 1) - 1) * 127 + (s.charCodeAt(i + 2) - 1) * 127 * 127\n}\n\n/** Encode using 2B encoding, returns string. */\nexports.encode2B = function encode2B (n) {\n  let lsb, msb\n  lsb = (n % 127)\n  n = ((n - lsb) / 127)\n  lsb += 1\n  msb = (n + 1)\n  return String.fromCharCode(lsb) + String.fromCharCode(msb)\n}\n\n/** Encode using 3B encoding, returns string. */\nexports.encode3B = function encode3B (n) {\n  let lsb, msb, xsb\n  lsb = (n % 127)\n  n = (n - lsb) / 127\n  lsb += 1\n  msb = (n % 127)\n  n = (n - msb) / 127\n  msb += 1\n  xsb = (n + 1)\n  return String.fromCharCode(lsb) + String.fromCharCode(msb) + String.fromCharCode(xsb)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils.js","/*!chibi 3.0.7, Copyright 2012-2016 Kyle Barrow, released under MIT license */\n\n// MODIFIED VERSION.\n(function () {\n\t'use strict';\n\n\tvar readyfn = [],\n\t\tloadedfn = [],\n\t\tdomready = false,\n\t\tpageloaded = false,\n\t\td = document,\n\t\tw = window;\n\n\t// Fire any function calls on ready event\n\tfunction fireReady() {\n\t\tvar i;\n\t\tdomready = true;\n\t\tfor (i = 0; i < readyfn.length; i += 1) {\n\t\t\treadyfn[i]();\n\t\t}\n\t\treadyfn = [];\n\t}\n\n\t// Fire any function calls on loaded event\n\tfunction fireLoaded() {\n\t\tvar i;\n\t\tpageloaded = true;\n\t\t// For browsers with no DOM loaded support\n\t\tif (!domready) {\n\t\t\tfireReady();\n\t\t}\n\t\tfor (i = 0; i < loadedfn.length; i += 1) {\n\t\t\tloadedfn[i]();\n\t\t}\n\t\tloadedfn = [];\n\t}\n\n\t// Check DOM ready, page loaded\n\tif (d.addEventListener) {\n\t\t// Standards\n\t\td.addEventListener('DOMContentLoaded', fireReady, false);\n\t\tw.addEventListener('load', fireLoaded, false);\n\t} else if (d.attachEvent) {\n\t\t// IE\n\t\td.attachEvent('onreadystatechange', fireReady);\n\t\t// IE < 9\n\t\tw.attachEvent('onload', fireLoaded);\n\t} else {\n\t\t// Anything else\n\t\tw.onload = fireLoaded;\n\t}\n\n\t// Utility functions\n\n\t// Loop through node array\n\tfunction nodeLoop(fn, nodes) {\n\t\tvar i;\n\t\t// Good idea to walk up the DOM\n\t\tfor (i = nodes.length - 1; i >= 0; i -= 1) {\n\t\t\tfn(nodes[i]);\n\t\t}\n\t}\n\n\t// Convert to camel case\n\tfunction cssCamel(property) {\n\t\treturn property.replace(/-\\w/g, function (result) {\n\t\t\treturn result.charAt(1).toUpperCase();\n\t\t});\n\t}\n\n\t// Get computed style\n\tfunction computeStyle(elm, property) {\n\t\t// IE, everything else or null\n\t\treturn (elm.currentStyle) ? elm.currentStyle[cssCamel(property)] : (w.getComputedStyle) ? w.getComputedStyle(elm, null).getPropertyValue(property) : null;\n\n\t}\n\n\t// Returns URI encoded query string pair\n\tfunction queryPair(name, value) {\n\t\treturn encodeURIComponent(name).replace(/%20/g, '+') + '=' + encodeURIComponent(value).replace(/%20/g, '+');\n\t}\n\n\t// Set CSS, important to wrap in try to prevent error thown on unsupported property\n\tfunction setCss(elm, property, value) {\n\t\ttry {\n\t\t\telm.style[cssCamel(property)] = value;\n\t\t} catch (e) {\n\t\t}\n\t}\n\n\t// Show CSS\n\tfunction showCss(elm) {\n\t\telm.style.display = '';\n\t\t// For elements still hidden by style block\n\t\tif (computeStyle(elm, 'display') === 'none') {\n\t\t\telm.style.display = 'block';\n\t\t}\n\t}\n\n\t// Serialize form & JSON values\n\tfunction serializeData(nodes) {\n\t\tvar querystring = '', subelm, i, j;\n\t\tif (nodes.constructor === Object) { // Serialize JSON data\n\t\t\tfor (subelm in nodes) {\n\t\t\t\tif (nodes.hasOwnProperty(subelm)) {\n\t\t\t\t\tif (nodes[subelm].constructor === Array) {\n\t\t\t\t\t\tfor (i = 0; i < nodes[subelm].length; i += 1) {\n\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm, nodes[subelm][i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tquerystring += '&' + queryPair(subelm, nodes[subelm]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else { // Serialize node data\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tif (elm.nodeName === 'FORM') {\n\t\t\t\t\tfor (i = 0; i < elm.elements.length; i += 1) {\n\t\t\t\t\t\tsubelm = elm.elements[i];\n\n\t\t\t\t\t\tif (!subelm.disabled) {\n\t\t\t\t\t\t\tswitch (subelm.type) {\n\t\t\t\t\t\t\t\t// Ignore buttons, unsupported XHR 1 form fields\n\t\t\t\t\t\t\t\tcase 'button':\n\t\t\t\t\t\t\t\tcase 'image':\n\t\t\t\t\t\t\t\tcase 'file':\n\t\t\t\t\t\t\t\tcase 'submit':\n\t\t\t\t\t\t\t\tcase 'reset':\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'select-one':\n\t\t\t\t\t\t\t\t\tif (subelm.length > 0) {\n\t\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm.value);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'select-multiple':\n\t\t\t\t\t\t\t\t\tfor (j = 0; j < subelm.length; j += 1) {\n\t\t\t\t\t\t\t\t\t\tif (subelm[j].selected) {\n\t\t\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm[j].value);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'checkbox':\n\t\t\t\t\t\t\t\tcase 'radio':\n\t\t\t\t\t\t\t\t\tif (subelm.checked) {\n\t\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm.value);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t// Everything else including shinny new HTML5 input types\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tquerystring += '&' + queryPair(subelm.name, subelm.value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t}\n\t\t// Tidy up first &\n\t\treturn (querystring.length > 0) ? querystring.substring(1) : '';\n\t}\n\n\t// Class helper\n\tfunction classHelper(classes, action, nodes) {\n\t\tvar classarray, search, i, replace, has = false;\n\t\tif (classes) {\n\t\t\t// Trim any whitespace\n\t\t\tclassarray = classes.split(/\\s+/);\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tfor (i = 0; i < classarray.length; i += 1) {\n\t\t\t\t\tvar clz = classarray[i];\n\t\t\t\t\tif (action === 'remove') {\n\t\t\t\t\t\telm.classList.remove(clz);\n\t\t\t\t\t}\n\t\t\t\t\telse if (action === 'add') {\n\t\t\t\t\t\telm.classList.add(clz);\n\t\t\t\t\t}\n\t\t\t\t\telse if (action === 'toggle') {\n\t\t\t\t\t\telm.classList.toggle(clz);\n\t\t\t\t\t}\n\t\t\t\t\telse if (action === 'has') {\n\t\t\t\t\t\tif (elm.classList.contains(clz)) {\n\t\t\t\t\t\t\thas = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// search = new RegExp('\\\\b' + classarray[i] + '\\\\b', 'g');\n\t\t\t\t\t// replace = new RegExp(' *' + classarray[i] + '\\\\b', 'g');\n\t\t\t\t\t// if (action === 'remove') {\n\t\t\t\t\t// \telm.className = elm.className.replace(search, '');\n\t\t\t\t\t// } else if (action === 'toggle') {\n\t\t\t\t\t// \telm.className = (elm.className.match(search)) ? elm.className.replace(replace, '') : elm.className + ' ' + classarray[i];\n\t\t\t\t\t// } else if (action === 'has') {\n\t\t\t\t\t// \tif (elm.className.match(search)) {\n\t\t\t\t\t// \t\thas = true;\n\t\t\t\t\t// \t\tbreak;\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t}\n\t\treturn has;\n\t}\n\n\t// HTML insertion helper\n\tfunction insertHtml(value, position, nodes) {\n\t\tvar tmpnodes, tmpnode;\n\t\tif (value) {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\t// No insertAdjacentHTML support for FF < 8 and IE doesn't allow insertAdjacentHTML table manipulation, so use this instead\n\t\t\t\t// Convert string to node. We can't innerHTML on a document fragment\n\t\t\t\ttmpnodes = d.createElement('div');\n\t\t\t\ttmpnodes.innerHTML = value;\n\t\t\t\twhile ((tmpnode = tmpnodes.lastChild) !== null) {\n\t\t\t\t\t// Catch error in unlikely case elm has been removed\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (position === 'before') {\n\t\t\t\t\t\t\telm.parentNode.insertBefore(tmpnode, elm);\n\t\t\t\t\t\t} else if (position === 'after') {\n\t\t\t\t\t\t\telm.parentNode.insertBefore(tmpnode, elm.nextSibling);\n\t\t\t\t\t\t} else if (position === 'append') {\n\t\t\t\t\t\t\telm.appendChild(tmpnode);\n\t\t\t\t\t\t} else if (position === 'prepend') {\n\t\t\t\t\t\t\telm.insertBefore(tmpnode, elm.firstChild);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t}\n\t}\n\n\t// Get nodes and return chibi\n\tfunction chibi(selector) {\n\t\tvar cb, nodes = [], json = false, nodelist, i;\n\n\t\tif (selector) {\n\n\t\t\t// Element node, would prefer to use (selector instanceof HTMLElement) but no IE support\n\t\t\tif (selector.nodeType && selector.nodeType === 1) {\n\t\t\t\tnodes = [selector]; // return element as node list\n\t\t\t} else if (typeof selector === 'object') {\n\t\t\t\t// JSON, document object or node list, would prefer to use (selector instanceof NodeList) but no IE support\n\t\t\t\tjson = (typeof selector.length !== 'number');\n\t\t\t\tnodes = selector;\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\tnodelist = d.querySelectorAll(selector);\n\n\t\t\t\t// Convert node list to array so results have full access to array methods\n\t\t\t\t// Array.prototype.slice.call not supported in IE < 9 and often slower than loop anyway\n\t\t\t\tfor (i = 0; i < nodelist.length; i += 1) {\n\t\t\t\t\tnodes[i] = nodelist[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Only attach nodes if not JSON\n\t\tcb = json ? {} : nodes;\n\n\t\t// Public functions\n\n\t\t// Executes a function on nodes\n\t\tcb.each = function (fn) {\n\t\t\tif (typeof fn === 'function') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t// <= IE 8 loses scope so need to apply\n\t\t\t\t\treturn fn.apply(elm, arguments);\n\t\t\t\t}, nodes);\n\t\t\t}\n\t\t\treturn cb;\n\t\t};\n\t\t// Find first\n\t\tcb.first = function () {\n\t\t\treturn chibi(nodes.shift());\n\t\t};\n\t\t// Find last\n\t\tcb.last = function () {\n\t\t\treturn chibi(nodes.pop());\n\t\t};\n\t\t// Find odd\n\t\tcb.odd = function () {\n\t\t\tvar odds = [], i;\n\t\t\tfor (i = 0; i < nodes.length; i += 2) {\n\t\t\t\todds.push(nodes[i]);\n\t\t\t}\n\t\t\treturn chibi(odds);\n\t\t};\n\t\t// Find even\n\t\tcb.even = function () {\n\t\t\tvar evens = [], i;\n\t\t\tfor (i = 1; i < nodes.length; i += 2) {\n\t\t\t\tevens.push(nodes[i]);\n\t\t\t}\n\t\t\treturn chibi(evens);\n\t\t};\n\t\t// Hide node\n\t\tcb.hide = function () {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\telm.style.display = 'none';\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Show node\n\t\tcb.show = function () {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tshowCss(elm);\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Toggle node display\n\t\tcb.toggle = function (state) {\n\t\t\tif (typeof state != 'undefined') { // ADDED\n\t\t\t\tif (state)\n\t\t\t\t\tcb.show();\n\t\t\t\telse\n\t\t\t\t\tcb.hide();\n\t\t\t} else {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t// computeStyle instead of style.display == 'none' catches elements that are hidden via style block\n\t\t\t\t\tif (computeStyle(elm, 'display') === 'none') {\n\t\t\t\t\t\tshowCss(elm);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telm.style.display = 'none';\n\t\t\t\t\t}\n\n\t\t\t\t}, nodes);\n\t\t\t}\n\t\t\treturn cb;\n\t\t};\n\t\t// Remove node\n\t\tcb.remove = function () {\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\t// Catch error in unlikely case elm has been removed\n\t\t\t\ttry {\n\t\t\t\t\telm.parentNode.removeChild(elm);\n\t\t\t\t} catch (e) {\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t\treturn chibi();\n\t\t};\n\t\t// Get/Set CSS\n\t\tcb.css = function (property, value) {\n\t\t\tif (property) {\n\t\t\t\tif (value || value === '') {\n\t\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t\tsetCss(elm, property, value);\n\t\t\t\t\t}, nodes);\n\t\t\t\t\treturn cb;\n\t\t\t\t}\n\t\t\t\tif (nodes[0]) {\n\t\t\t\t\tif (nodes[0].style[cssCamel(property)]) {\n\t\t\t\t\t\treturn nodes[0].style[cssCamel(property)];\n\t\t\t\t\t}\n\t\t\t\t\tif (computeStyle(nodes[0], property)) {\n\t\t\t\t\t\treturn computeStyle(nodes[0], property);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Get class(es)\n\t\tcb.getClass = function () {\n\t\t\tif (nodes[0] && nodes[0].className.length > 0) {\n\t\t\t\t// Weak IE trim support\n\t\t\t\treturn nodes[0].className.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '').replace(/\\s+/, ' ');\n\t\t\t}\n\t\t};\n\t\t// Set (replaces) classes\n\t\tcb.setClass = function (classes) {\n\t\t\tif (classes || classes === '') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\telm.className = classes;\n\t\t\t\t}, nodes);\n\t\t\t}\n\t\t\treturn cb;\n\t\t};\n\t\t// Add class\n\t\tcb.addClass = function (classes) {\n\t\t\tclassHelper(classes, 'add', nodes);\n\t\t\t// if (classes) {\n\t\t\t// \tnodeLoop(function (elm) {\n\t\t\t// \t\telm.className += ' ' + classes;\n\t\t\t// \t}, nodes);\n\t\t\t// }\n\t\t\treturn cb;\n\t\t};\n\t\t// Remove class\n\t\tcb.removeClass = function (classes) {\n\t\t\tclassHelper(classes, 'remove', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Toggle class\n\t\tcb.toggleClass = function (classes, set) {\n\t\t\tvar method = ((typeof set === 'undefined') ? 'toggle' : (+set ? 'add' : 'remove'));\n\t\t\tclassHelper(classes, method, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Has class\n\t\tcb.hasClass = function (classes) {\n\t\t\treturn classHelper(classes, 'has', nodes);\n\t\t};\n\t\t// Get/set HTML\n\t\tcb.html = function (value) {\n\t\t\tif (value || value === '') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\telm.innerHTML = value;\n\t\t\t\t}, nodes);\n\t\t\t\treturn cb;\n\t\t\t}\n\t\t\tif (nodes[0]) {\n\t\t\t\treturn nodes[0].innerHTML;\n\t\t\t}\n\t\t};\n\t\t// Insert HTML before selector\n\t\tcb.htmlBefore = function (value) {\n\t\t\tinsertHtml(value, 'before', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Insert HTML after selector\n\t\tcb.htmlAfter = function (value) {\n\t\t\tinsertHtml(value, 'after', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Insert HTML after selector innerHTML\n\t\tcb.htmlAppend = function (value) {\n\t\t\tinsertHtml(value, 'append', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Insert HTML before selector innerHTML\n\t\tcb.htmlPrepend = function (value) {\n\t\t\tinsertHtml(value, 'prepend', nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Get/Set HTML attributes\n\t\tcb.attr = function (property, value) {\n\t\t\tif (property) {\n\t\t\t\tproperty = property.toLowerCase();\n\t\t\t\t// IE < 9 doesn't allow style or class via get/setAttribute so switch. cssText returns prettier CSS anyway\n\t\t\t\tif (typeof value !== 'undefined') {//FIXED BUG HERE\n\t\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\t\tif (property === 'style') {\n\t\t\t\t\t\t\telm.style.cssText = value;\n\t\t\t\t\t\t} else if (property === 'class') {\n\t\t\t\t\t\t\telm.className = value;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telm.setAttribute(property, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, nodes);\n\t\t\t\t\treturn cb;\n\t\t\t\t}\n\t\t\t\tif (nodes[0]) {\n\t\t\t\t\tif (property === 'style') {\n\t\t\t\t\t\tif (nodes[0].style.cssText) {\n\t\t\t\t\t\t\treturn nodes[0].style.cssText;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (property === 'class') {\n\t\t\t\t\t\tif (nodes[0].className) {\n\t\t\t\t\t\t\treturn nodes[0].className;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (nodes[0].getAttribute(property)) {\n\t\t\t\t\t\t\treturn nodes[0].getAttribute(property);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Get/Set HTML data property\n\t\tcb.data = function (key, value) {\n\t\t\tif (key) {\n\t\t\t\treturn cb.attr('data-' + key, value);\n\t\t\t}\n\t\t};\n\t\t// Get/Set form element values\n\t\tcb.val = function (value) {\n\t\t\tvar values, i, j;\n\t\t\tif (typeof value != 'undefined') { // FIXED A BUG HERE\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\tswitch (elm.nodeName) {\n\t\t\t\t\t\tcase 'SELECT':\n\t\t\t\t\t\t\tif (typeof value === 'string' || typeof value === 'number') {\n\t\t\t\t\t\t\t\tvalue = [value];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (i = 0; i < elm.length; i += 1) {\n\t\t\t\t\t\t\t\t// Multiple select\n\t\t\t\t\t\t\t\tfor (j = 0; j < value.length; j += 1) {\n\t\t\t\t\t\t\t\t\telm[i].selected = '';\n\t\t\t\t\t\t\t\t\tif (elm[i].value === \"\"+value[j]) {\n\t\t\t\t\t\t\t\t\t\telm[i].selected = 'selected';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'INPUT':\n\t\t\t\t\t\tcase 'TEXTAREA':\n\t\t\t\t\t\tcase 'BUTTON':\n\t\t\t\t\t\t\telm.value = value;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}, nodes);\n\n\t\t\t\treturn cb;\n\t\t\t}\n\t\t\tif (nodes[0]) {\n\t\t\t\tswitch (nodes[0].nodeName) {\n\t\t\t\t\tcase 'SELECT':\n\t\t\t\t\t\tvalues = [];\n\t\t\t\t\t\tfor (i = 0; i < nodes[0].length; i += 1) {\n\t\t\t\t\t\t\tif (nodes[0][i].selected) {\n\t\t\t\t\t\t\t\tvalues.push(nodes[0][i].value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn (values.length > 1) ? values : values[0];\n\t\t\t\t\tcase 'INPUT':\n\t\t\t\t\tcase 'TEXTAREA':\n\t\t\t\t\tcase 'BUTTON':\n\t\t\t\t\t\treturn nodes[0].value;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Return matching checked checkbox or radios\n\t\tcb.checked = function (check) {\n\t\t\tif (typeof check === 'boolean') {\n\t\t\t\tnodeLoop(function (elm) {\n\t\t\t\t\tif (elm.nodeName === 'INPUT' && (elm.type === 'checkbox' || elm.type === 'radio')) {\n\t\t\t\t\t\telm.checked = check;\n\t\t\t\t\t}\n\t\t\t\t}, nodes);\n\t\t\t\treturn cb;\n\t\t\t}\n\t\t\tif (nodes[0] && nodes[0].nodeName === 'INPUT' && (nodes[0].type === 'checkbox' || nodes[0].type === 'radio')) {\n\t\t\t\treturn (!!nodes[0].checked);\n\t\t\t}\n\t\t};\n\t\t// Add event handler\n\t\tcb.on = function (event, fn) {\n\t\t\tif (selector === w || selector === d) {\n\t\t\t\tnodes = [selector];\n\t\t\t}\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tif (d.addEventListener) {\n\t\t\t\t\telm.addEventListener(event, fn, false);\n\t\t\t\t} else if (d.attachEvent) {\n\t\t\t\t\t// <= IE 8 loses scope so need to apply, we add this to object so we can detach later (can't detach anonymous functions)\n\t\t\t\t\telm[event + fn] = function () {\n\t\t\t\t\t\treturn fn.apply(elm, arguments);\n\t\t\t\t\t};\n\t\t\t\t\telm.attachEvent('on' + event, elm[event + fn]);\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\t// Remove event handler\n\t\tcb.off = function (event, fn) {\n\t\t\tif (selector === w || selector === d) {\n\t\t\t\tnodes = [selector];\n\t\t\t}\n\t\t\tnodeLoop(function (elm) {\n\t\t\t\tif (d.addEventListener) {\n\t\t\t\t\telm.removeEventListener(event, fn, false);\n\t\t\t\t} else if (d.attachEvent) {\n\t\t\t\t\telm.detachEvent('on' + event, elm[event + fn]);\n\t\t\t\t\t// Tidy up\n\t\t\t\t\telm[event + fn] = null;\n\t\t\t\t}\n\t\t\t}, nodes);\n\t\t\treturn cb;\n\t\t};\n\t\treturn cb;\n\t}\n\n\t// Basic XHR\n\tchibi.ajax = function (options) { // if options is a number, it's timeout in ms\n\t\tvar opts = Object.assign({\n\t\t\tmethod: 'GET',\n\t\t\tnocache: true,\n\t\t\ttimeout: 5000,\n\t\t\tloader: true,\n\t\t\tcallback: null\n\t\t}, options);\n\t\topts.method = opts.method.toUpperCase();\n\n\t\tvar loaderFn = opts.loader ? chibi._loader : function(){};\n\t\tvar url = opts.url;\n\t\tvar method = opts.method;\n\t\tvar query = null;\n\n\t\tif (opts.data) {\n\t\t\tquery = serializeData(opts.data);\n\t\t}\n\n\t\tif (query && (method === 'GET')) {\n\t\t\turl += (url.indexOf('?') === -1) ? '?' + query : '&' + query;\n\t\t\tquery = null;\n\t\t}\n\n\t\tvar xhr = new XMLHttpRequest();\n\n\t\t// prevent caching\n\t\tif (opts.nocache) {\n\t\t\tvar ts = (+(new Date())).toString(36);\n\t\t\turl += ((url.indexOf('?') === -1) ? '?' : '&') + '_=' + ts;\n\t\t}\n\n\t\tloaderFn(true);\n\n\t\txhr.open(method, url, true);\n\t\txhr.timeout = opts.timeout;\n\n\t\t// Abort after given timeout\n\t\tvar abortTmeo = setTimeout(function () {\n\t\t\tconsole.error(\"XHR timed out.\");\n\t\t\txhr.abort();\n\t\t\tloaderFn(false);\n\t\t}, opts.timeout + 10);\n\n\t\txhr.onreadystatechange = function () {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tloaderFn(false);\n\n\t\t\t\topts.callback && opts.callback(xhr.responseText, xhr.status);\n\n\t\t\t\tclearTimeout(abortTmeo);\n\t\t\t}\n\t\t};\n\n\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\t\tif (method === 'POST') {\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\t\t}\n\n\t\txhr.send(query);\n\t\treturn xhr;\n\t};\n\n\tchibi._loader = function(){};\n\n\t// Alias to cb.ajax(url, 'get', callback)\n\tchibi.get = function (url, callback, opts) {\n\t\topts = opts || {};\n\t\topts.url = url;\n\t\topts.callback = callback;\n\t\topts.method = 'GET';\n\t\treturn chibi.ajax(opts);\n\t};\n\n\t// Alias to cb.ajax(url, 'post', callback)\n\tchibi.post = function (url, callback, opts) {\n\t\topts = opts || {};\n\t\topts.url = url;\n\t\topts.callback = callback;\n\t\topts.method = 'POST';\n\t\treturn chibi.ajax(opts);\n\t};\n\n\t// Fire on DOM ready\n\tchibi.ready = function (fn) {\n\t\tif (fn) {\n\t\t\tif (domready) {\n\t\t\t\tfn();\n\t\t\t\treturn chibi;\n\t\t\t} else {\n\t\t\t\treadyfn.push(fn);\n\t\t\t}\n\t\t}\n\t};\n\n\t// Fire on page loaded\n\tchibi.loaded = function (fn) {\n\t\tif (fn) {\n\t\t\tif (pageloaded) {\n\t\t\t\tfn();\n\t\t\t\treturn chibi;\n\t\t\t} else {\n\t\t\t\tloadedfn.push(fn);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar entityMap = {\n\t\t'&': '&amp;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'\"': '&quot;',\n\t\t\"'\": '&#39;',\n\t\t'/': '&#x2F;',\n\t\t'`': '&#x60;',\n\t\t'=': '&#x3D;'\n\t};\n\n\tchibi.htmlEscape = function(string) {\n\t\treturn String(string).replace(/[&<>\"'`=\\/]/g, function (s) {\n\t\t\treturn entityMap[s];\n\t\t});\n\t};\n\n\t// Set Chibi's global namespace here ($)\n\tmodule.exports = chibi;\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./js/lib/chibi.js","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/events/events.js\n// module id = 2\n// module chunks = 0","const $ = require('../lib/chibi')\nconst { rgb255ToHex } = require('../lib/color_utils')\n\nconst themes = exports.themes = [\n  [ // 0 - Tango - terminator\n    '#111213', '#CC0000', '#4E9A06', '#C4A000', '#3465A4', '#75507B', '#06989A', '#D3D7CF',\n    '#555753', '#EF2929', '#8AE234', '#FCE94F', '#729FCF', '#AD7FA8', '#34E2E2', '#EEEEEC'\n  ],\n  [ // 1 - Linux (CGA) - terminator\n    '#000000', '#aa0000', '#00aa00', '#aa5500', '#0000aa', '#aa00aa', '#00aaaa', '#aaaaaa',\n    '#555555', '#ff5555', '#55ff55', '#ffff55', '#5555ff', '#ff55ff', '#55ffff', '#ffffff'\n  ],\n  [ // 2 - xterm - terminator\n    '#000000', '#cd0000', '#00cd00', '#cdcd00', '#0000ee', '#cd00cd', '#00cdcd', '#e5e5e5',\n    '#7f7f7f', '#ff0000', '#00ff00', '#ffff00', '#5c5cff', '#ff00ff', '#00ffff', '#ffffff'\n  ],\n  [ // 3 - rxvt - terminator\n    '#000000', '#cd0000', '#00cd00', '#cdcd00', '#0000cd', '#cd00cd', '#00cdcd', '#faebd7',\n    '#404040', '#ff0000', '#00ff00', '#ffff00', '#0000ff', '#ff00ff', '#00ffff', '#ffffff'\n  ],\n  [ // 4 - Ambience - terminator\n    '#2e3436', '#cc0000', '#4e9a06', '#c4a000', '#3465a4', '#75507b', '#06989a', '#d3d7cf',\n    '#555753', '#ef2929', '#8ae234', '#fce94f', '#729fcf', '#ad7fa8', '#34e2e2', '#eeeeec'\n  ],\n  [ // 5 - Solarized Dark - terminator\n    '#073642', '#dc322f', '#859900', '#b58900', '#268bd2', '#d33682', '#2aa198', '#eee8d5',\n    '#002b36', '#cb4b16', '#586e75', '#657b83', '#839496', '#6c71c4', '#93a1a1', '#fdf6e3'\n  ],\n  [ // 6 - CGA NTSC - wikipedia\n    '#000000', '#69001A', '#117800', '#769100', '#1A00A6', '#8019AB', '#289E76', '#A4A4A4',\n    '#484848', '#C54E76', '#6DD441', '#D2ED46', '#765BFF', '#DC75FF', '#84FAD2', '#FFFFFF'\n  ],\n  [ // 7 - ZX Spectrum - wikipedia\n    '#000000', '#aa0000', '#00aa00', '#aaaa00', '#0000aa', '#aa00aa', '#00aaaa', '#aaaaaa',\n    '#000000', '#ff0000', '#00FF00', '#ffff00', '#0000ff', '#ff00ff', '#00ffff', '#ffffff'\n  ],\n  [ // 8 - Apple II - wikipedia\n    '#000000', '#722640', '#0E5940', '#808080', '#40337F', '#E434FE', '#1B9AFE', '#BFB3FF',\n    '#404C00', '#E46501', '#1BCB01', '#BFCC80', '#808080', '#F1A6BF', '#8DD9BF', '#ffffff'\n  ],\n  [ // 9 - Commodore - wikipedia\n    '#000000', '#8D3E37', '#55A049', '#AAB95D', '#40318D', '#80348B', '#72C1C8', '#D59F74',\n    '#8B5429', '#B86962', '#94E089', '#FFFFB2', '#8071CC', '#AA5FB6', '#87D6DD', '#ffffff'\n  ],\n  [ // 10 - Solarized Light - https://github.com/sgerrand/xfce4-terminal-colors-solarized\n    '#eee8d5', '#dc322f', '#859900', '#b58900', '#268bd2', '#d33682', '#2aa198', '#073642',\n    '#fdf6e3', '#cb4b16', '#93a1a1', '#839496', '#657b83', '#6c71c4', '#586e75', '#002b36'\n  ],\n  [ // 11 - Solarized Dark High contrast - https://github.com/sgerrand/xfce4-terminal-colors-solarized\n    '#073642', '#dc322f', '#859900', '#b58900', '#268bd2', '#d33682', '#2aa198', '#fdf6e3',\n    '#002b36', '#cb4b16', '#657b83', '#839496', '#93a1a1', '#6c71c4', '#eee8d5', '#fdf6e3'\n  ]\n]\n\nexports.fgbgThemes = [\n  ['#AAAAAA', '#000000', 'Lnx', 'Linux'],\n  ['#FFFFFF', '#000000', 'W+K', 'White on Black'],\n  ['#00FF00', '#000000', 'Lim', 'Lime'],\n  ['#E53C00', '#000000', 'Nix', 'Nixie'],\n  ['#EFF0F1', '#31363B', 'Brz', 'Breeze'],\n  ['#FFFFFF', '#300A24', 'Amb', 'Ambiance'],\n  ['#839496', '#002B36', 'SoD', 'Solarized Dark'],\n  ['#93a1a1', '#002b36', 'SoH', 'Solarized Dark (High Contrast)'],\n  ['#657B83', '#FDF6E3', 'SoL', 'Solarized Light'],\n  ['#000000', '#FFD75F', 'Wsp', 'Wasp'],\n  ['#000000', '#FFFFDD', 'K+Y', 'Black on Yellow'],\n  ['#000000', '#FFFFFF', 'K+W', 'Black on White']\n]\n\nlet colorTable256 = null\n\nexports.buildColorTable = function () {\n  if (colorTable256 !== null) return colorTable256\n\n  // 256color lookup table\n  // should not be used to look up 0-15\n  colorTable256 = new Array(16).fill('#000000')\n\n  // fill color table\n  // colors 16-231 are a 6x6x6 color cube\n  for (let red = 0; red < 6; red++) {\n    for (let green = 0; green < 6; green++) {\n      for (let blue = 0; blue < 6; blue++) {\n        let redValue = red * 40 + (red ? 55 : 0)\n        let greenValue = green * 40 + (green ? 55 : 0)\n        let blueValue = blue * 40 + (blue ? 55 : 0)\n        colorTable256.push(rgb255ToHex(redValue, greenValue, blueValue))\n      }\n    }\n  }\n  // colors 232-255 are a grayscale ramp, sans black and white\n  for (let gray = 0; gray < 24; gray++) {\n    let value = gray * 10 + 8\n    colorTable256.push(rgb255ToHex(value, value, value))\n  }\n\n  return colorTable256\n}\n\nexports.SELECTION_FG = '#333'\nexports.SELECTION_BG = '#b2d7fe'\n\nexports.themePreview = function (themeN) {\n  $('[data-fg]').forEach((elem) => {\n    let shade = elem.dataset.fg\n    if (/^\\d+$/.test(shade)) shade = exports.toHex(shade, themeN)\n    elem.style.color = shade\n  })\n  $('[data-bg]').forEach((elem) => {\n    let shade = elem.dataset.bg\n    if (/^\\d+$/.test(shade)) shade = exports.toHex(shade, themeN)\n    elem.style.backgroundColor = shade\n  })\n}\n\nexports.colorTable256 = null\nexports.ensureColorTable256 = function () {\n  if (!exports.colorTable256) exports.colorTable256 = exports.buildColorTable()\n}\n\nexports.getColor = function (i, palette = []) {\n  // return palette color if it exists\n  if (i < 16 && i in palette) return palette[i]\n\n  // -1 for selection foreground, -2 for selection background\n  if (i === -1) return exports.SELECTION_FG\n  if (i === -2) return exports.SELECTION_BG\n\n  // 256 color\n  if (i > 15 && i < 256) {\n    exports.ensureColorTable256()\n    return exports.colorTable256[i]\n  }\n\n  // 24-bit color, encoded as (hex) + 256 (such that #000000 == 256)\n  if (i > 255) {\n    i -= 256\n    return '#' + `000000${i.toString(16)}`.substr(-6)\n  }\n\n  // return error color\n  return Math.floor(Date.now() / 1000) % 2 === 0 ? '#ff0ff' : '#00ff00'\n}\n\nexports.toHex = function (shade, themeN) {\n  if (/^\\d+$/.test(shade)) {\n    shade = +shade\n    return exports.getColor(shade, themes[themeN])\n  }\n  return shade\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/themes.js","const $ = require('./lib/chibi')\n\n/** Module for toggling a modal overlay */\nlet modal = {}\nlet curCloseCb = null\n\nmodal.show = function (sel, closeCb) {\n  let $m = $(sel)\n  $m.removeClass('hidden visible')\n  setTimeout(function () {\n    $m.addClass('visible')\n  }, 1)\n  curCloseCb = closeCb\n}\n\nmodal.hide = function (sel) {\n  let $m = $(sel)\n  $m.removeClass('visible')\n  setTimeout(function () {\n    $m.addClass('hidden')\n    if (curCloseCb) curCloseCb()\n  }, 500) // transition time\n}\n\nmodal.init = function () {\n  // close modal by click outside the dialog\n  $('.Modal').on('click', function () {\n    if ($(this).hasClass('no-close')) return // this is a no-close modal\n    modal.hide(this)\n  })\n\n  $('.Dialog').on('click', function (e) {\n    e.stopImmediatePropagation()\n  })\n\n  // Hide all modals on esc\n  $(window).on('keydown', function (e) {\n    if (e.which === 27) {\n      modal.hide('.Modal')\n    }\n  })\n}\n\nmodule.exports = modal\n\n\n\n// WEBPACK FOOTER //\n// ./js/modal.js","const $ = require('./lib/chibi')\nconst modal = require('./modal')\n\nlet nt = {}\nconst sel = '#notif'\nlet $balloon\n\nlet timerHideBegin // timeout to start hiding (transition)\nlet timerHideEnd // timeout to add the hidden class\nlet canCancel = false\n\nlet stopTimeouts = function () {\n  clearTimeout(timerHideBegin)\n  clearTimeout(timerHideEnd)\n}\n\nnt.show = function (message, timeout, isError) {\n  $balloon.toggleClass('error', isError === true)\n  $balloon.html(message)\n  modal.show($balloon)\n  stopTimeouts()\n\n  if (!timeout || timeout <= 0) {\n    timeout = 2500\n  }\n\n  timerHideBegin = setTimeout(nt.hide, timeout)\n\n  canCancel = false\n  setTimeout(() => {\n    canCancel = true\n  }, 500)\n}\n\nnt.hide = function () {\n  let $m = $(sel)\n  $m.removeClass('visible')\n  timerHideEnd = setTimeout(function () {\n    $m.addClass('hidden')\n  }, 250) // transition time\n}\n\nnt.init = function () {\n  $balloon = $(sel)\n\n  // close by click outside\n  $(document).on('click', function () {\n    if (!canCancel) return\n    nt.hide(this)\n  })\n\n  // click caused by selecting, prevent it from bubbling\n  $balloon.on('click', function (e) {\n    e.stopImmediatePropagation()\n    return false\n  })\n\n  // stop fading if moused\n  $balloon.on('mouseenter', function () {\n    stopTimeouts()\n    $balloon.removeClass('hidden').addClass('visible')\n  })\n}\n\nmodule.exports = nt\n\n\n\n// WEBPACK FOOTER //\n// ./js/notif.js","// Bits in the cell attribs word\n\n/* eslint-disable no-multi-spaces */\nexports.ATTR_FG        = (1 << 0)  // 1 if not using default background color (ignore cell bg) - color extension bit\nexports.ATTR_BG        = (1 << 1)  // 1 if not using default foreground color (ignore cell fg) - color extension bit\nexports.ATTR_BOLD      = (1 << 2)  // Bold font\nexports.ATTR_UNDERLINE = (1 << 3)  // Underline decoration\nexports.ATTR_INVERSE   = (1 << 4)  // Invert colors - this is useful so we can clear then with SGR manipulation commands\nexports.ATTR_BLINK     = (1 << 5)  // Blinking\nexports.ATTR_ITALIC    = (1 << 6)  // Italic font\nexports.ATTR_STRIKE    = (1 << 7)  // Strike-through decoration\nexports.ATTR_OVERLINE  = (1 << 8)  // Over-line decoration\nexports.ATTR_FAINT     = (1 << 9)  // Faint foreground color (reduced alpha)\nexports.ATTR_FRAKTUR   = (1 << 10) // Fraktur font (unicode substitution)\n/* eslint-enable no-multi-spaces */\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/screen_attr_bits.js","/*\n * Copyright (c) 2010 Tim Baumann\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n// NOTE:\n// Extracted from ColorTriangle and\n// Converted to ES6 by MightyPork (2017)\n\n/*******************\n * Color conversion *\n *******************/\n\nconst M = Math\nconst TAU = 2 * M.PI\n\nexports.hue2rgb = function (v1, v2, h) {\n  if (h < 0) h += 1\n  if (h > 1) h -= 1\n\n  if ((6 * h) < 1) return v1 + (v2 - v1) * 6 * h\n  if ((2 * h) < 1) return v2\n  if ((3 * h) < 2) return v1 + (v2 - v1) * ((2 / 3) - h) * 6\n  return v1\n}\n\nexports.hsl2rgb = function (h, s, l) {\n  h /= TAU\n  let r, g, b\n\n  if (s === 0) {\n    r = g = b = l\n  } else {\n    let var_1, var_2\n\n    if (l < 0.5) var_2 = l * (1 + s)\n    else var_2 = (l + s) - (s * l)\n\n    var_1 = 2 * l - var_2\n\n    r = exports.hue2rgb(var_1, var_2, h + (1 / 3))\n    g = exports.hue2rgb(var_1, var_2, h)\n    b = exports.hue2rgb(var_1, var_2, h - (1 / 3))\n  }\n  return [r, g, b]\n}\n\nexports.rgb2hsl = function (r, g, b) {\n  const min = M.min(r, g, b)\n  const max = M.max(r, g, b)\n  const d = max - min // delta\n\n  let h, s, l\n\n  l = (max + min) / 2\n\n  if (d === 0) {\n    // gray\n    h = s = 0 // HSL results from 0 to 1\n  } else {\n    // chroma\n    if (l < 0.5) s = d / (max + min)\n    else s = d / (2 - max - min)\n\n    const d_r = (((max - r) / 6) + (d / 2)) / d\n    const d_g = (((max - g) / 6) + (d / 2)) / d\n    const d_b = (((max - b) / 6) + (d / 2)) / d // deltas\n\n    if (r === max) h = d_b - d_g\n    else if (g === max) h = (1 / 3) + d_r - d_b\n    else if (b === max) h = (2 / 3) + d_g - d_r\n\n    if (h < 0) h += 1\n    else if (h > 1) h -= 1\n  }\n  h *= TAU\n  return [h, s, l]\n}\n\nexports.hex2rgb = function (hex) {\n  const groups = hex.match(/^#([\\da-f]{3,6})$/i)\n  if (groups) {\n    hex = groups[1]\n    const bytes = hex.length / 3\n    const max = (16 ** bytes) - 1\n    return [0, 1, 2].map(x => parseInt(hex.slice(x * bytes, (x + 1) * bytes), 16) / max)\n  }\n  return [0, 0, 0]\n}\n\nfunction pad (n) {\n  return `00${n}`.substr(-2)\n}\n\nexports.rgb255ToHex = function (r, g, b) {\n  return '#' + [r, g, b].map(x => pad(x.toString(16))).join('')\n}\n\nexports.rgb2hex = function (r, g, b) {\n  return '#' + [r, g, b].map(x => pad(Math.round(x * 255).toString(16))).join('')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/lib/color_utils.js","const EventEmitter = require('events')\nconst { parse2B } = require('../utils')\nconst { themes } = require('./themes')\n\nconst encodeAsCodePoint = i => String.fromCodePoint(i + (i >= 0xD800 ? 0x801 : 1))\n\nclass ANSIParser {\n  constructor (handler) {\n    this.reset()\n    this.handler = handler\n    this.joinChunks = true\n  }\n  reset () {\n    this.currentSequence = 0\n    this.sequence = ''\n  }\n  parseSequence (sequence) {\n    if (sequence[0] === '[') {\n      let type = sequence[sequence.length - 1]\n      let content = sequence.substring(1, sequence.length - 1)\n\n      let numbers = content ? content.split(';').map(i => +i.replace(/\\D/g, '')) : []\n      let numOr1 = numbers.length ? numbers[0] : 1\n      if (type === 'H') {\n        this.handler('set-cursor', (numbers[0] | 0) - 1, (numbers[1] | 0) - 1)\n      } else if (type >= 'A' && type <= 'D') {\n        this.handler(`move-cursor-${type <= 'B' ? 'y' : 'x'}`, ((type === 'B' || type === 'C') ? 1 : -1) * numOr1)\n      } else if (type === 'E' || type === 'F') {\n        this.handler('move-cursor-line', (type === 'E' ? 1 : -1) * numOr1)\n      } else if (type === 'G') {\n        this.handler('set-cursor-x', numOr1 - 1)\n      } else if (type === 'J') {\n        let number = numbers.length ? numbers[0] : 2\n        if (number === 2) this.handler('clear')\n      } else if (type === 'P') {\n        this.handler('delete', numOr1)\n      } else if (type === '@') {\n        this.handler('insert-blanks', numOr1)\n      } else if (type === 'q') this.handler('set-cursor-style', numOr1)\n      else if (type === 'm') {\n        if (!numbers.length) {\n          this.handler('reset-style')\n          return\n        }\n        let type\n        while ((type = numbers.shift())) {\n          if (type === 0) this.handler('reset-style')\n          else if (type === 1) this.handler('add-attrs', 1 << 2) // bold\n          else if (type === 2) this.handler('add-attrs', 1 << 9) // faint\n          else if (type === 3) this.handler('add-attrs', 1 << 6) // italic\n          else if (type === 4) this.handler('add-attrs', 1 << 3) // underline\n          else if (type === 5 || type === 6) this.handler('add-attrs', 1 << 5) // blink\n          else if (type === 7) this.handler('add-attrs', 1 << 4) // invert\n          else if (type === 9) this.handler('add-attrs', 1 << 7) // strike\n          else if (type === 20) this.handler('add-attrs', 1 << 10) // fraktur\n          else if (type >= 30 && type <= 37) this.handler('set-color-fg', type % 10)\n          else if (type >= 40 && type <= 47) this.handler('set-color-bg', type % 10)\n          else if (type === 39) this.handler('reset-color-fg')\n          else if (type === 49) this.handler('reset-color-bg')\n          else if (type >= 90 && type <= 98) this.handler('set-color-fg', (type % 10) + 8)\n          else if (type >= 100 && type <= 108) this.handler('set-color-bg', (type % 10) + 8)\n          else if (type === 38 || type === 48) {\n            let mode = numbers.shift()\n            if (mode === 2) {\n              let r = numbers.shift()\n              let g = numbers.shift()\n              let b = numbers.shift()\n              let color = (r << 16 | g << 8 | b) + 256\n              if (type === 38) this.handler('set-color-fg', color)\n              if (type === 48) this.handler('set-color-bg', color)\n            } else if (mode === 5) {\n              let color = (numbers.shift() | 0) & 0xFF\n              if (type === 38) this.handler('set-color-fg', color)\n              if (type === 48) this.handler('set-color-bg', color)\n            }\n          }\n        }\n      } else if (type === 'h' || type === 'l') {\n        if (content === '?25') {\n          if (type === 'h') this.handler('show-cursor')\n          else if (type === 'l') this.handler('hide-cursor')\n        }\n      }\n    }\n  }\n  write (text) {\n    for (let character of text.toString()) {\n      let code = character.codePointAt(0)\n      if (code === 0x1b) this.currentSequence = 1\n      else if (this.currentSequence === 1 && character === '[') {\n        this.currentSequence = 2\n        this.sequence += '['\n      } else if (this.currentSequence && character.match(/[\\x40-\\x7e]/)) {\n        this.parseSequence(this.sequence + character)\n        this.currentSequence = 0\n        this.sequence = ''\n      } else if (this.currentSequence > 1) this.sequence += character\n      else if (this.currentSequence === 1) {\n        // something something nothing\n        this.currentSequence = 0\n        this.handler('write', character)\n      } else if (code < 0x03) this.handler('_null')\n      else if (code === 0x03) this.handler('sigint')\n      else if (code <= 0x06) this.handler('_null')\n      else if (code === 0x07) this.handler('bell')\n      else if (code === 0x08) this.handler('back')\n      else if (code === 0x09) this.handler('tab')\n      else if (code === 0x0a) this.handler('new-line')\n      else if (code === 0x0d) this.handler('return')\n      else if (code === 0x15) this.handler('delete-line')\n      else if (code === 0x17) this.handler('delete-word')\n      else this.handler('write', character)\n    }\n    if (!this.joinChunks) this.reset()\n  }\n}\nconst TERM_DEFAULT_STYLE = [0, 0, 0]\n\nlet getRainbowColor = t => {\n  let r = Math.floor(Math.sin(t) * 2.5 + 2.5)\n  let g = Math.floor(Math.sin(t + 2 / 3 * Math.PI) * 2.5 + 2.5)\n  let b = Math.floor(Math.sin(t + 4 / 3 * Math.PI) * 2.5 + 2.5)\n  return 16 + 36 * r + 6 * g + b\n}\n\nclass ScrollingTerminal {\n  constructor (screen) {\n    this.width = 80\n    this.height = 25\n    this.termScreen = screen\n    this.parser = new ANSIParser((...args) => this.handleParsed(...args))\n    this.buttonLabels = []\n\n    this.reset()\n\n    this._lastLoad = Date.now()\n    this.loadTimer()\n\n    window.showPage()\n  }\n  reset () {\n    this.style = TERM_DEFAULT_STYLE.slice()\n    this.cursor = { x: 0, y: 0, style: 1, visible: true }\n    this.trackMouse = false\n    this.theme = 0\n    this.defaultFG = 7\n    this.defaultBG = 0\n    this.rainbow = this.superRainbow = false\n    this.parser.reset()\n    this.clear()\n  }\n  clear () {\n    this.screen = []\n    for (let i = 0; i < this.width * this.height; i++) {\n      this.screen.push([' ', this.style.slice()])\n    }\n  }\n  scroll () {\n    this.screen.splice(0, this.width)\n    for (let i = 0; i < this.width; i++) {\n      this.screen.push([' ', TERM_DEFAULT_STYLE.slice()])\n    }\n    this.cursor.y--\n  }\n  newLine () {\n    this.cursor.y++\n    if (this.cursor.y >= this.height) this.scroll()\n  }\n  writeChar (character) {\n    this.screen[this.cursor.y * this.width + this.cursor.x] = [character, this.style.slice()]\n    this.cursor.x++\n    if (this.cursor.x >= this.width) {\n      this.cursor.x = 0\n      this.newLine()\n    }\n  }\n  moveBack (n = 1) {\n    for (let i = 0; i < n; i++) {\n      this.cursor.x--\n      if (this.cursor.x < 0) {\n        if (this.cursor.y > 0) this.cursor.x = this.width - 1\n        else this.cursor.x = 0\n        this.cursor.y = Math.max(0, this.cursor.y - 1)\n      }\n    }\n  }\n  moveForward (n = 1) {\n    for (let i = 0; i < n; i++) {\n      this.cursor.x++\n      if (this.cursor.x >= this.width) {\n        this.cursor.x = 0\n        this.cursor.y++\n        if (this.cursor.y >= this.height) this.scroll()\n      }\n    }\n  }\n  deleteChar () {  // FIXME unused?\n    this.moveBack()\n    this.screen.splice((this.cursor.y + 1) * this.width, 0, [' ', TERM_DEFAULT_STYLE.slice()])\n    this.screen.splice(this.cursor.y * this.width + this.cursor.x, 1)\n  }\n  deleteForward (n) {\n    n = Math.min(this.width, n)\n    for (let i = 0; i < n; i++) this.screen.splice((this.cursor.y + 1) * this.width, 0, [' ', TERM_DEFAULT_STYLE.slice()])\n    this.screen.splice(this.cursor.y * this.width + this.cursor.x, n)\n  }\n  clampCursor () {\n    if (this.cursor.x < 0) this.cursor.x = 0\n    if (this.cursor.y < 0) this.cursor.y = 0\n    if (this.cursor.x > this.width - 1) this.cursor.x = this.width - 1\n    if (this.cursor.y > this.height - 1) this.cursor.y = this.height - 1\n  }\n  handleParsed (action, ...args) {\n    if (action === 'write') {\n      this.writeChar(args[0])\n    } else if (action === 'delete') {\n      this.deleteForward(args[0])\n    } else if (action === 'insert-blanks') {\n      this.insertBlanks(args[0]) // FIXME undefined?\n    } else if (action === 'clear') {\n      this.clear()\n    } else if (action === 'bell') {\n      this.termScreen.load('U\\x01B')\n    } else if (action === 'back') {\n      this.moveBack()\n    } else if (action === 'new-line') {\n      this.newLine()\n      this.cursor.x = 0\n    } else if (action === 'return') {\n      this.cursor.x = 0\n    } else if (action === 'set-cursor') {\n      this.cursor.x = args[1]\n      this.cursor.y = args[0]\n      this.clampCursor()\n    } else if (action === 'move-cursor-y') {\n      this.cursor.y += args[0]\n      this.clampCursor()\n    } else if (action === 'move-cursor-x') {\n      this.cursor.x += args[0]\n      this.clampCursor()\n    } else if (action === 'move-cursor-line') {\n      this.cursor.x = 0\n      this.cursor.y += args[0]\n      this.clampCursor()\n    } else if (action === 'set-cursor-x') {\n      this.cursor.x = args[0]\n    } else if (action === 'set-cursor-style') {\n      this.cursor.style = Math.max(0, Math.min(6, args[0]))\n    } else if (action === 'reset-style') {\n      this.style = TERM_DEFAULT_STYLE.slice()\n    } else if (action === 'add-attrs') {\n      this.style[2] |= args[0]\n    } else if (action === 'set-color-fg') {\n      this.style[0] = args[0]\n      this.style[2] |= 1\n    } else if (action === 'set-color-bg') {\n      this.style[1] = args[0]\n      this.style[2] |= 1 << 1\n    } else if (action === 'reset-color-fg') {\n      this.style[0] = 0\n      if (this.style[2] & 1) this.style[2] ^= 1\n    } else if (action === 'reset-color-bg') {\n      this.style[1] = 0\n      if (this.style[2] & (1 << 1)) this.style[2] ^= (1 << 1)\n    } else if (action === 'hide-cursor') {\n      this.cursor.visible = false\n    } else if (action === 'show-cursor') {\n      this.cursor.visible = true\n    }\n  }\n  write (text) {\n    this.parser.write(text)\n  }\n  getScreenOpts () {\n    let data = 'O'\n    data += encodeAsCodePoint(25)\n    data += encodeAsCodePoint(80)\n    data += encodeAsCodePoint(this.theme)\n    data += this.encodeColor(this.defaultFG)\n    data += this.encodeColor(this.defaultBG)\n    let attributes = +this.cursor.visible\n    attributes |= (3 << 5) * +this.trackMouse // track mouse controls both\n    attributes |= 3 << 7 // buttons/links always visible\n    attributes |= (this.cursor.style << 9)\n    data += encodeAsCodePoint(attributes)\n    return data\n  }\n  getButtons () {\n    let data = 'B'\n    data += encodeAsCodePoint(this.buttonLabels.length)\n    data += this.buttonLabels.map(x => `\\x01${x}\\x01`).join('')\n    return data\n  }\n  getTitle () {\n    return 'TESPTerm Web UI Demo\\x01'\n  }\n  getCursor () {\n    let data = 'C'\n    data += encodeAsCodePoint(this.cursor.y)\n    data += encodeAsCodePoint(this.cursor.x)\n    data += encodeAsCodePoint(0)\n    return data\n  }\n  encodeColor (color) {\n    if (color < 256) {\n      return encodeAsCodePoint(color)\n    } else {\n      color -= 256\n      return encodeAsCodePoint((color & 0xFFF) | 0x10000) + encodeAsCodePoint(color >> 12)\n    }\n  }\n  serializeScreen () {\n    let serialized = 'S'\n    serialized += encodeAsCodePoint(0) + encodeAsCodePoint(0)\n    serialized += encodeAsCodePoint(this.height) + encodeAsCodePoint(this.width)\n\n    let lastStyle = [null, null, null]\n    let index = 0\n    for (let cell of this.screen) {\n      let style = cell[1].slice()\n      if (this.rainbow) {\n        let x = index % this.width\n        let y = Math.floor(index / this.width)\n        // C instead of F in mask and 1 << 8 in attrs to change attr bits 1 and 2\n        let t = (x + y) / 10 + Date.now() / 1000\n        if (this.superRainbow) {\n          t = (x * y + Date.now()) / 100 + Date.now() / 1000\n        }\n        style[0] = getRainbowColor(t)\n        style[1] = 0\n        if (this.superRainbow) style[1] = getRainbowColor(t / 10)\n        style[2] = style[2] | 1\n        if (!this.superRainbow && style[2] & (1 << 1)) style[2] ^= (1 << 1)\n        index++\n      }\n\n      let foreground = style[0]\n      let background = style[1]\n      let attributes = style[2]\n      let setForeground = foreground !== lastStyle[0]\n      let setBackground = background !== lastStyle[1]\n      let setAttributes = attributes !== lastStyle[2]\n\n      if (setForeground && setBackground) {\n        if (foreground < 256 && background < 256) {\n          serialized += '\\x03' + encodeAsCodePoint((background << 8) | foreground)\n        } else {\n          serialized += '\\x05' + this.encodeColor(foreground)\n          serialized += '\\x06' + this.encodeColor(background)\n        }\n      } else if (setForeground) serialized += '\\x05' + this.encodeColor(foreground)\n      else if (setBackground) serialized += '\\x06' + this.encodeColor(background)\n      if (setAttributes) serialized += '\\x04' + encodeAsCodePoint(attributes)\n      lastStyle = style\n\n      serialized += cell[0]\n    }\n    return serialized\n  }\n  getUpdate () {\n    let topics = 0\n    let topicData = []\n    let screenOpts = this.getScreenOpts()\n    let title = this.getTitle()\n    let buttons = this.getButtons()\n    let cursor = this.getCursor()\n    let screen = this.serializeScreen()\n    if (this._screenOpts !== screenOpts) {\n      this._screenOpts = screenOpts\n      topicData.push(screenOpts)\n    }\n    if (this._title !== title) {\n      this._title = title\n      topicData.push(title)\n    }\n    if (this._buttons !== buttons) {\n      this._buttons = buttons\n      topicData.push(buttons)\n    }\n    if (this._cursor !== cursor) {\n      this._cursor = cursor\n      topicData.push(cursor)\n    }\n    if (this._screen !== screen) {\n      this._screen = screen\n      topicData.push(screen)\n    }\n    if (!topicData.length) return ''\n    return 'U' + encodeAsCodePoint(topics) + topicData.join('')\n  }\n  loadTimer () {\n    clearInterval(this._loadTimer)\n    this._loadTimer = setInterval(() => {\n      let update = this.getUpdate()\n      if (update) this.termScreen.load(update)\n    }, 30)\n  }\n}\n\nclass Process extends EventEmitter {\n  write (data) {\n    this.emit('in', data)\n  }\n  destroy () {\n    // death.\n    this.emit('exit', 0)\n  }\n  run () {\n    // noop\n  }\n}\n\nlet demoData = {\n  buttons: [],\n  mouseReceiver: null\n}\n\nlet demoshIndex = {\n  clear: class Clear extends Process {\n    run () {\n      this.emit('write', '\\x1b[2J\\x1b[1;1H')\n      this.destroy()\n    }\n  },\n  screenfetch: class Screenfetch extends Process {\n    run () {\n      let image = `\n ###.                          ESPTerm Demo\n   '###.                       Hostname: ${window.location.hostname}\n     '###.                     Shell: ESPTerm Demo Shell\n       '###.                   Resolution: 80x25@${window.devicePixelRatio}x\n         :###-\n       .###'\n     .###'\n   .###'      ###############\n ###'         ###############\n      `.split('\\n').filter(line => line.trim())\n\n      let chars = ''\n      for (let y = 0; y < image.length; y++) {\n        for (let x = 0; x < 80; x++) {\n          if (image[y][x]) {\n            chars += `\\x1b[38;5;${getRainbowColor((x + y) / 10)}m${image[y][x]}`\n          } else chars += ' '\n        }\n      }\n\n      this.emit('write', '\\r\\n\\x1b[?25l')\n      let loop = () => {\n        this.emit('write', chars.substr(0, 80))\n        chars = chars.substr(80)\n        if (chars.length) setTimeout(loop, 50)\n        else {\n          this.emit('write', '\\r\\n\\x1b[?25h')\n          this.destroy()\n        }\n      }\n      loop()\n    }\n  },\n  'local-echo': class LocalEcho extends Process {\n    run (...args) {\n      if (!args.includes('--suppress-note')) {\n        this.emit('write', '\\x1b[38;5;239mNote: not all terminal features are supported and may not work as expected in this demo\\x1b[m\\n')\n      }\n      this.emit('buttons', [\n        {\n          label: 'Exit',\n          action (shell) {\n            shell.write('\\x03')\n          }\n        }\n      ])\n    }\n    write (data) {\n      this.emit('write', data)\n    }\n  },\n  info: class Info extends Process {\n    run (...args) {\n      let fast = args.includes('--fast')\n      this.showSplash().then(() => {\n        this.printText(fast)\n      })\n    }\n    showSplash () {\n      let splash = `\n              -#####- -###*..#####- ######-\n              -#*    -#-    .## .##.  *#-\n              -##### .-###*..#####-   *#-  -*##*- #*-#--#**#-*##-\n              -#*        -#-.##.      *#-  *##@#* ##.  -#* *# .#*\n              -#####--####- .##.      *#-  -*#@@- ##.  -#* *# .#*\n      `.split('\\n').filter(line => line.trim())\n      let levels = {\n        ' ': -231,\n        '.': 4,\n        '-': 8,\n        '*': 17,\n        '#': 24\n      }\n      let characters = {\n        ' ': ' ',\n        '.': '░',\n        '-': '▒',\n        '*': '▓',\n        '#': '█'\n      }\n      for (let i in splash) {\n        if (splash[i].length < 79) splash[i] += ' '.repeat(79 - splash[i].length)\n      }\n      this.emit('write', '\\r\\n'.repeat(splash.length + 1))\n      this.emit('write', '\\x1b[A'.repeat(splash.length))\n      this.emit('write', '\\x1b[?25l')\n\n      let cursorX = 0\n      let cursorY = 0\n      let moveTo = (x, y) => {\n        let moveX = x - cursorX\n        let moveY = y - cursorY\n        this.emit('write', `\\x1b[${Math.abs(moveX)}${moveX > 0 ? 'C' : 'D'}`)\n        this.emit('write', `\\x1b[${Math.abs(moveY)}${moveY > 0 ? 'B' : 'A'}`)\n        cursorX = x\n        cursorY = y\n      }\n      let drawCell = (x, y) => {\n        moveTo(x, y)\n        if (splash[y][x] === '@') {\n          this.emit('write', '\\x1b[48;5;238m\\x1b[38;5;255m▄\\b')\n        } else {\n          let level = 231 + levels[splash[y][x]]\n          let character = characters[splash[y][x]]\n          this.emit('write', `\\x1b[48;5;${level}m\\x1b[38;5;${level}m${character}\\b`)\n        }\n      }\n      return new Promise((resolve, reject) => {\n        const self = this\n        let x = 13\n        let cycles = 0\n        let loop = function () {\n          for (let y = 0; y < splash.length; y++) {\n            let dx = x - y\n            if (dx > 0) drawCell(dx, y)\n          }\n\n          if (++x < 70) {\n            if (++cycles >= 3) {\n              setTimeout(loop, 50)\n              cycles = 0\n            } else loop()\n          } else {\n            moveTo(0, splash.length)\n            self.emit('write', '\\x1b[m\\x1b[?25h')\n            resolve()\n          }\n        }\n        loop()\n      })\n    }\n    printText (fast = false) {\n      // lots of printing\n      let parts = [\n        '',\n        '  ESPTerm is a VT100-like terminal emulator running on the ESP8266 WiFi chip.',\n        '',\n        '  \\x1b[93mThis is an online demo of the web user interface, simulating a simple ',\n        '  terminal in your browser.\\x1b[m',\n        '',\n        '  Type \\x1b[92mls\\x1b[m to list available commands.',\n        '  Use the \\x1b[94mlinks\\x1b[m below this screen for a demo of the options and more info.',\n        ''\n      ]\n\n      if (fast) {\n        this.emit('write', parts.join('\\r\\n') + '\\r\\n')\n        this.destroy()\n      } else {\n        const self = this\n        let loop = function () {\n          self.emit('write', parts.shift() + '\\r\\n')\n          if (parts.length) setTimeout(loop, 17)\n          else self.destroy()\n        }\n        loop()\n      }\n    }\n  },\n  colors: class PrintColors extends Process {\n    run () {\n      this.emit('write', '\\r\\n')\n      let fgtext = 'foreground-color'\n      this.emit('write', '    ')\n      for (let i = 0; i < 16; i++) {\n        this.emit('write', '\\x1b[' + (i < 8 ? `3${i}` : `9${i - 8}`) + 'm')\n        this.emit('write', fgtext[i] + ' ')\n      }\n      this.emit('write', '\\r\\n    ')\n      for (let i = 0; i < 16; i++) {\n        this.emit('write', '\\x1b[' + (i < 8 ? `4${i}` : `10${i - 8}`) + 'm  ')\n      }\n      this.emit('write', '\\x1b[m\\r\\n')\n      for (let r = 0; r < 6; r++) {\n        this.emit('write', '    ')\n        for (let g = 0; g < 6; g++) {\n          for (let b = 0; b < 6; b++) {\n            this.emit('write', `\\x1b[48;5;${16 + r * 36 + g * 6 + b}m  `)\n          }\n          this.emit('write', '\\x1b[m')\n        }\n        this.emit('write', '\\r\\n')\n      }\n      this.emit('write', '    ')\n      for (let g = 0; g < 24; g++) {\n        this.emit('write', `\\x1b[48;5;${232 + g}m  `)\n      }\n      this.emit('write', '\\x1b[m\\r\\n\\n')\n      this.destroy()\n    }\n  },\n  ls: class ListCommands extends Process {\n    run () {\n      this.emit('write', '\\x1b[92mList of demo commands\\x1b[m\\r\\n')\n      for (let i in demoshIndex) {\n        if (typeof demoshIndex[i] === 'string') continue\n        this.emit('write', i + '\\r\\n')\n      }\n      this.destroy()\n    }\n  },\n  theme: class SetTheme extends Process {\n    constructor (shell) {\n      super()\n      this.shell = shell\n    }\n    run (...args) {\n      let theme = +args[0] | 0\n      const maxnum = themes.length\n      if (!args.length || !Number.isFinite(theme) || theme < 0 || theme >= maxnum) {\n        this.emit('write', `\\x1b[31mUsage: theme [0–${maxnum - 1}]\\n`)\n        this.destroy()\n        return\n      }\n      this.shell.terminal.theme = theme\n      // HACK: reset drawn screen to prevent only partly redrawn screen\n      this.shell.terminal.termScreen.drawnScreenFG = []\n      this.emit('write', '')\n      this.destroy()\n    }\n  },\n  themes: class ShowThemes extends Process {\n    constructor (shell) {\n      super()\n      this.shell = shell\n      this.parser = new ANSIParser((...args) => this.handler(...args))\n    }\n\n    destroy () {\n      this.shell.terminal.cursor.style = this.savedCursorStyle\n      this.emit('write', '\\n\\n')\n      super.destroy()\n    }\n\n    run (...args) {\n      this.savedCursorStyle = this.shell.terminal.cursor.style\n      this.shell.terminal.cursor.style = 3\n\n      this.fgType = 0\n      this.bgType = 0\n\n      let get24FG = () => this.shell.terminal.defaultFG - 256\n      let set24FG = v => { this.shell.terminal.defaultFG = v + 256 }\n      let get24BG = () => this.shell.terminal.defaultBG - 256\n      let set24BG = v => { this.shell.terminal.defaultBG = v + 256 }\n\n      let make24Control = (label, index, getValue, setValue, type) => {\n        index *= 4\n\n        return {\n          label,\n          length: 1,\n          getValue: () => (getValue() >> index) & 0xF,\n          getDisplay: () => ((getValue() >> index) & 0xF).toString(16),\n          setValue: value => {\n            setValue((getValue() & (0xFFFFFF ^ (0xF << index))) | ((value & 0xF) << index))\n          },\n          shouldShow: () => this[type + 'Type'] === 1,\n          parseValue: input => {\n            return parseInt(input, 16) & 0xF\n          },\n          moveAfterInput: index !== 0\n        }\n      }\n\n      this.controls = [\n        {\n          label: 'Theme: ',\n          length: themes.length.toString().length,\n          getValue: () => this.shell.terminal.theme,\n          setValue: value => {\n            let count = themes.length\n            this.shell.terminal.theme = ((value % count) + count) % count\n          }\n        },\n        {\n          label: ' Default Foreground: ',\n          length: 6,\n          getValue: () => this.fgType,\n          getDisplay: () => this.fgType === 0 ? '256' : '24-bit',\n          setValue: value => {\n            this.fgType = ((value % 2) + 2) % 2\n          }\n        },\n        {\n          label: ' ',\n          length: 3,\n          getValue: () => this.shell.terminal.defaultFG & 0xFF,\n          setValue: value => {\n            this.shell.terminal.defaultFG = value & 0xFF\n          },\n          shouldShow: () => this.fgType === 0,\n          parseValue: input => parseInt(input, 16)\n        },\n        make24Control(' #', 5, get24FG, set24FG, 'fg'),\n        make24Control('', 4, get24FG, set24FG, 'fg'),\n        make24Control('', 3, get24FG, set24FG, 'fg'),\n        make24Control('', 2, get24FG, set24FG, 'fg'),\n        make24Control('', 1, get24FG, set24FG, 'fg'),\n        make24Control('', 0, get24FG, set24FG, 'fg'),\n        {\n          label: ' Default Background: ',\n          length: 6,\n          getValue: () => this.bgType,\n          getDisplay: () => this.bgType === 0 ? '256' : '24-bit',\n          setValue: value => {\n            this.bgType = ((value % 2) + 2) % 2\n          }\n        },\n        {\n          label: ' ',\n          length: 3,\n          getValue: () => this.shell.terminal.defaultBG & 0xFF,\n          setValue: value => {\n            this.shell.terminal.defaultBG = value & 0xFF\n          },\n          shouldShow: () => this.bgType === 0,\n          parseValue: input => parseInt(input, 16)\n        },\n        make24Control(' #', 5, get24BG, set24BG, 'bg'),\n        make24Control('', 4, get24BG, set24BG, 'bg'),\n        make24Control('', 3, get24BG, set24BG, 'bg'),\n        make24Control('', 2, get24BG, set24BG, 'bg'),\n        make24Control('', 1, get24BG, set24BG, 'bg'),\n        make24Control('', 0, get24BG, set24BG, 'bg')\n      ]\n      this.selection = 0\n\n      this.emit('write', '\\x1b[1mThemes\\x1b[m\\n\\n\\n\\n\\x1b[2A')\n\n      this.render()\n    }\n\n    render () {\n      this.emit('write', '\\x1b[m\\r')\n      // no ^[2K implementation, here's a hack\n      this.emit('write', ' '.repeat(this.shell.terminal.width - 1) + '\\r')\n\n      let index = 0\n      let selectedX = 0\n      for (let control of this.controls) {\n        if (control.shouldShow && !control.shouldShow()) continue\n        if (control.label) {\n          this.emit('write', `\\x1b[1m${control.label}\\x1b[m`)\n        }\n        // TODO: colors\n        this.emit('write', '\\x1b[38;5;255m\\x1b[48;5;16m')\n        let value = control.getDisplay ? control.getDisplay() : control.getValue().toString()\n        this.emit('write', (control.fill || ' ').repeat(Math.max(0, control.length - value.length)))\n        this.emit('write', value.substr(0, control.length))\n        this.emit('write', '\\x1b[m')\n\n        if (index === this.selection) {\n          selectedX = this.shell.terminal.cursor.x - 1\n\n          // draw arrows\n          this.emit('write', '\\x1b[m\\x1b[D\\x1b[A▲\\x1b[D\\x1b[2B▼\\x1b[A')\n        } else {\n          // clear arrows if they were there\n          this.emit('write', '\\x1b[m\\x1b[D\\x1b[A \\x1b[D\\x1b[2B \\x1b[A')\n        }\n\n        index++\n      }\n\n      this.shell.terminal.cursor.x = selectedX\n    }\n\n    write (data) {\n      this.parser.write(data)\n    }\n\n    getControlCount () {\n      let count = 0\n      for (let control of this.controls) {\n        if (control.shouldShow && !control.shouldShow()) continue\n        count++\n      }\n      return count\n    }\n\n    getSelectedControl () {\n      let selected = null\n      let index = 0\n      for (let control of this.controls) {\n        if (control.shouldShow && !control.shouldShow()) continue\n        if (index === this.selection) {\n          selected = control\n          break\n        }\n        index++\n      }\n      return selected\n    }\n\n    handler (action, ...args) {\n      console.log(action, ...args)\n\n      if (action === 'move-cursor-x') {\n        this.selection += args[0]\n        let count = this.getControlCount()\n        this.selection = ((this.selection % count) + count) % count\n      } else if (action === 'move-cursor-y') {\n        let control = this.getSelectedControl()\n        if (control) control.setValue(control.getValue() - args[0])\n      } else if (action === 'write') {\n        let control = this.getSelectedControl()\n        if (control && control.parseValue) {\n          let parsed = control.parseValue(args[0])\n          if (Number.isFinite(parsed)) {\n            control.setValue(parsed)\n            if (control.moveAfterInput) {\n              if (this.selection < this.getControlCount() - 1) this.selection++\n            }\n          }\n        }\n      }\n\n      this.render()\n    }\n  },\n  cursor: class SetCursor extends Process {\n    run (...args) {\n      let steady = args.includes('--steady')\n      if (args.includes('block')) {\n        this.emit('write', `\\x1b[${2 * steady} q`)\n      } else if (args.includes('line')) {\n        this.emit('write', `\\x1b[${3 + steady} q`)\n      } else if (args.includes('bar') || args.includes('beam')) {\n        this.emit('write', `\\x1b[${5 + steady} q`)\n      } else {\n        this.emit('write', '\\x1b[31mUsage: cursor [block|line|bar] [--steady]\\r\\n')\n      }\n      this.destroy()\n    }\n  },\n  rainbow: class ToggleRainbow extends Process {\n    constructor (shell, options = {}) {\n      super()\n      this.shell = shell\n      this.su = options.su\n      this.abort = false\n    }\n    write (data, newLine = true) {\n      if (data === 'y') {\n        this.shell.terminal.rainbow = !this.shell.terminal.rainbow\n        this.shell.terminal.superRainbow = true\n        demoData._didWarnRainbow = true\n      } else {\n        this.emit('write', data)\n      }\n      if (newLine) this.emit('write', '\\x1b[0;32m\\x1b[G\\x1b[79PRainbow!\\n')\n      this.destroy()\n    }\n    run () {\n      if (this.su && !this.shell.terminal.rainbow) {\n        if (!demoData._didWarnRainbow) {\n          this.emit('write', '\\x1b[31;1mWarning: flashy colors. Continue? [y/N] ')\n        } else {\n          this.write('y', false)\n        }\n      } else {\n        this.shell.terminal.rainbow = !this.shell.terminal.rainbow\n        this.shell.terminal.superRainbow = false\n        this.destroy()\n      }\n    }\n    destroy () {\n      this.abort = true\n      super.destroy()\n    }\n  },\n  mouse: class MouseDemo extends Process {\n    constructor (shell) {\n      super()\n      this.shell = shell\n    }\n    run () {\n      const self = this\n      this.emit('buttons', [\n        {\n          label: 'Exit',\n          action (shell) {\n            shell.write('\\x03')\n          }\n        },\n        {\n          label: 'Add Box',\n          action () {\n            self.boxes.push(self.generateRandomBox())\n            self.render()\n          }\n        }\n      ])\n\n      this.shell.terminal.trackMouse = true\n      demoData.mouseReceiver = this\n\n      this.boxes = Array(3).fill(0).map(x => this.generateRandomBox())\n      this.grabbedBox = null\n      this.grabOffset = [0, 0]\n\n      this.render()\n    }\n    render () {\n      this.emit('write', '\\x1b[m\\x1b[2J\\x1b[1;1H')\n      this.emit('write', '\\x1b[97m\\x1b[1mMouse Demo\\r\\n\\x1b[mMove boxes around or scroll their contents!')\n\n      // draw boxes\n      for (let box of this.boxes) {\n        this.emit('write', `\\x1b[${box.y + 1};${box.x + 1}H`)\n        this.emit('write', `\\x1b[m\\x1b[48;2;${box.color.join(';')}m`)\n        for (let y = box.y; y < box.y + box.height; y++) {\n          let drawnX = 0\n          for (let x = box.x; x < box.x + box.width; x++) {\n            if (x < 0 || x >= this.shell.terminal.width - 1) continue\n            if (y < 0 || y >= this.shell.terminal.height) continue\n            drawnX++\n            this.emit('write', box.content[y - box.y][x - box.x])\n          }\n          this.emit('write', '\\x1b[D'.repeat(drawnX) + '\\x1b[B')\n        }\n      }\n\n      // move cursor to mouse\n      if (this.mouse) {\n        this.emit('write', `\\x1b[${this.mouse.y + 1};${this.mouse.x + 1}H`)\n      }\n    }\n    generateRandomBox () {\n      let chars = 'abcdefghijklmnopqrstuvwxyz-*()!@#$%'\n      let content = []\n      let width = [5, 10, 15][Math.floor(Math.random() * 3)]\n      let height = [4, 5, 6][Math.floor(Math.random() * 3)]\n\n      for (let y = 0; y < height; y++) {\n        content.push('')\n        for (let x = 0; x < width; x++) {\n          if (Math.random() > 0.6) {\n            content[y] += chars[Math.floor(Math.random() * chars.length)]\n          } else content[y] += ' '\n        }\n      }\n\n      return {\n        x: Math.floor(Math.random() * (this.shell.terminal.width - 1)) + 1,\n        y: Math.floor(Math.random() * (this.shell.terminal.height - 1)) + 1,\n        width,\n        height,\n        color: [Math.random(), Math.random(), Math.random()].map(x => Math.floor(x * 255)),\n        content\n      }\n    }\n    getBoxAt (x, y) {\n      let boxes = this.boxes.slice().reverse() // top to bottom, like drawing order\n      for (let box of boxes) {\n        if (box.x <= x && box.x + box.width > x && box.y <= y && box.y + box.height > y) {\n          return box\n        }\n      }\n    }\n    mouseMove (x, y) {\n      this.mouse = { x, y }\n      if (this.grabbedBox) {\n        this.grabbedBox.x = x + this.grabOffset[0]\n        this.grabbedBox.y = y + this.grabOffset[1]\n      }\n      this.render()\n    }\n    mouseDown (x, y, button) {\n      if (button === 4) this.scrollInsideBox(this.getBoxAt(x, y), -1)\n      else if (button === 5) this.scrollInsideBox(this.getBoxAt(x, y), 1)\n      else {\n        let box = this.getBoxAt(x, y)\n        if (box) {\n          this.grabbedBox = box\n          this.grabOffset = [box.x - x, box.y - y]\n          // move grabbed box to top of stack\n          this.boxes.push(...this.boxes.splice(this.boxes.indexOf(box), 1))\n        }\n      }\n      this.render()\n    }\n    mouseUp (x, y, button) {\n      this.grabbedBox = null\n    }\n    scrollInsideBox (box, amount) {\n      if (!box) return\n      let content = box.content.slice()\n      box.content = []\n      for (let i = 0; i < content.length; i++) {\n        box.content.push(content[((i + amount % content.length) + content.length) % content.length])\n      }\n    }\n    destroy () {\n      this.shell.terminal.write('\\x1b[m\\x1b[2J\\x1b[1;1H')\n      this.shell.terminal.trackMouse = false\n      if (demoData.mouseReceiver === this) demoData.mouseReceiver = null\n      super.destroy()\n    }\n  },\n  sudo: class Sudo extends Process {\n    constructor (shell) {\n      super()\n      this.shell = shell\n      this.didDestroy = false\n    }\n    run (...args) {\n      if (args.length === 0) {\n        this.emit('write', '\\x1b[31mUsage: sudo [command]\\x1b[m\\r\\n')\n        this.destroy()\n      } else {\n        let name = args.shift()\n        if (this.shell.index[name]) {\n          let Process = this.shell.index[name]\n          if (Process instanceof Function) {\n            let child = this.child = new Process(this.shell, { su: true })\n            this.on('in', data => child.write(data))\n            let write = data => this.emit('write', data)\n            let setButtons = buttons => this.emit('buttons', buttons)\n            child.on('write', write)\n            child.on('buttons', setButtons)\n            child.on('exit', code => {\n              child.removeListener('write', write)\n              child.removeListener('buttons', setButtons)\n              this.destroy()\n            })\n            child.run(...args)\n          } else {\n            this.emit('write', Process)\n            this.destroy()\n          }\n        } else {\n          this.emit('write', `sudo: ${name}: command not found\\r\\n`)\n          this.destroy()\n        }\n      }\n    }\n    destroy () {\n      if (this.didDestroy) return\n      this.didDestroy = true\n      if (this.child) this.child.destroy()\n      super.destroy()\n    }\n  },\n  make: class Make extends Process {\n    constructor (shell, options = {}) {\n      super()\n      this.su = options.su\n    }\n    run (...args) {\n      if (args.length === 0) this.emit('write', '\\x1b[31mmake: *** No targets specified.  Stop.\\x1b[0m\\r\\n')\n      else if (args.length === 3 && args.join(' ').toLowerCase() === 'me a sandwich') {\n        if (this.su) {\n          const b = '\\x1b[33m'\n          const r = '\\x1b[0m'\n          const l = '\\x1b[32m'\n          const c = '\\x1b[38;5;229m'\n          const h = '\\x1b[38;5;225m'\n          this.emit('write',\n            `                    ${b}_.---._\\r\\n` +\n            `                _.-~       ~-._\\r\\n` +\n            `            _.-~               ~-._\\r\\n` +\n            `        _.-~                       ~---._\\r\\n` +\n            `    _.-~                                 ~\\\\\\r\\n` +\n            ` .-~                                    _.;\\r\\n` +\n            ` :-._                               _.-~ ./\\r\\n` +\n            ` \\`-._~-._                   _..__.-~ _.-~\\r\\n` +\n            `  ${c}/  ${b}~-._~-._              / .__..--${c}~-${l}---._\\r\\n` +\n            `${c} \\\\_____(_${b};-._\\\\.        _.-~_/${c}       ~)${l}.. . \\\\\\r\\n` +\n            `${l}    /(_____  ${b}\\\\\\`--...--~_.-~${c}______..-+${l}_______)\\r\\n` +\n            `${l}  .(_________/${b}\\`--...--~/${l}    _/ ${h}          ${b}/\\\\\\r\\n` +\n            `${b} /-._${h}     \\\\_     ${l}(___./_..-~${h}__.....${b}__..-~./\\r\\n` +\n            `${b} \\`-._~-._${h}   ~\\\\--------~  .-~${b}_..__.-~ _.-~\\r\\n` +\n            `${b}     ~-._~-._ ${h}~---------\\`  ${b}/ .__..--~\\r\\n` +\n            `${b}         ~-._\\\\.        _.-~_/\\r\\n` +\n            `${b}             \\\\\\`--...--~_.-~\\r\\n` +\n            `${b}              \\`--...--~${r}\\r\\n`)\n        } else {\n          this.emit('write', '\\x1b[31mmake: me a sandwich : Permission denied\\x1b[0m\\r\\n')\n        }\n      } else {\n        this.emit('write', `\\x1b[31mmake: *** No rule to make target '${args.join(' ').toLowerCase()}'.  Stop.\\x1b[0m\\r\\n`)\n      }\n      this.destroy()\n    }\n  },\n  pwd: '/this/is/a/demo\\r\\n',\n  cd: '\\x1b[38;5;239mNo directories to change to\\r\\n',\n  whoami: `${window.navigator.userAgent}\\r\\n`,\n  hostname: `${window.location.hostname}`,\n  uname: 'ESPTerm Demo\\r\\n',\n  mkdir: '\\x1b[38;5;239mDid not create a directory because this is a demo.\\r\\n',\n  rm: '\\x1b[38;5;239mDid not delete anything because this is a demo.\\r\\n',\n  cp: '\\x1b[38;5;239mNothing to copy because this is a demo.\\r\\n',\n  mv: '\\x1b[38;5;239mNothing to move because this is a demo.\\r\\n',\n  ln: '\\x1b[38;5;239mNothing to link because this is a demo.\\r\\n',\n  touch: '\\x1b[38;5;239mNothing to touch\\r\\n',\n  exit: '\\x1b[38;5;239mNowhere to go\\r\\n',\n  github: class GoToGithub extends Process {\n    run () {\n      window.open('https://github.com/espterm/espterm-firmware')\n      this.destroy()\n    }\n  }\n}\nlet autocompleteIndex = {\n  'local-echo': 'local-echo [--suppress-note]',\n  theme: 'theme [n]',\n  cursor: 'cursor [block|line|bar] [--steady]',\n  sudo: 'sudo [command]'\n}\n\nclass DemoShell {\n  constructor (terminal, printInfo) {\n    this.terminal = terminal\n    this.terminal.reset()\n    this.parser = new ANSIParser((...args) => this.handleParsed(...args))\n    this.history = []\n    this.historyIndex = 0\n    this.cursorPos = 0\n    this.lastInputLength = 0\n    this.child = null\n    this.index = demoshIndex\n\n    if (printInfo) this.run('info')\n    else this.prompt()\n  }\n  write (text) {\n    if (this.child) {\n      if (text.codePointAt(0) === 3) this.child.destroy()\n      else this.child.write(text)\n    } else this.parser.write(text)\n  }\n  prompt (success = true) {\n    if (this.terminal.cursor.x !== 0) this.terminal.write('\\x1b[m\\x1b[38;5;238m⏎\\r\\n')\n    this.terminal.write('\\x1b[34;1mdemosh \\x1b[m')\n    if (!success) this.terminal.write('\\x1b[31m')\n    this.terminal.write('$ \\x1b[m')\n    this.history.unshift('')\n    this.cursorPos = 0\n\n    this.setButtons()\n  }\n  copyFromHistoryIndex () {\n    if (!this.historyIndex) return\n    let current = this.history[this.historyIndex]\n    this.history[0] = current\n    this.historyIndex = 0\n  }\n  getCompleted (visual = false) {\n    if (this.history[0]) {\n      let input = this.history[0]\n      let prefix = ''\n      if (input.startsWith('sudo ')) {\n        let newInput = input.replace(/^(sudo\\s+)+/, '')\n        prefix = input.substr(0, input.length - newInput.length)\n        input = newInput\n      }\n      if (!input) return null\n      for (let name in this.index) {\n        if (name.startsWith(input) && name !== input) {\n          if (visual && name in autocompleteIndex) return prefix + autocompleteIndex[name]\n          return prefix + name\n        }\n      }\n      return null\n    }\n    return null\n  }\n  handleParsed (action, ...args) {\n    this.terminal.write(`\\x1b[${this.lastInputLength - this.cursorPos}P`)\n    this.terminal.write('\\b\\x1b[P'.repeat(this.cursorPos))\n\n    if (action === 'write') {\n      this.copyFromHistoryIndex()\n      this.history[0] = this.history[0].substr(0, this.cursorPos) + args[0] + this.history[0].substr(this.cursorPos)\n      this.cursorPos++\n    } else if (action === 'back') {\n      this.copyFromHistoryIndex()\n      this.history[0] = this.history[0].substr(0, this.cursorPos - 1) + this.history[0].substr(this.cursorPos)\n      this.cursorPos--\n      if (this.cursorPos < 0) this.cursorPos = 0\n    } else if (action === 'tab') {\n      let completed = this.getCompleted()\n      if (completed) {\n        this.history[0] = completed\n        this.cursorPos = this.history[0].length\n      }\n    } else if (action === 'move-cursor-x') {\n      this.cursorPos = Math.max(0, Math.min(this.history[this.historyIndex].length, this.cursorPos + args[0]))\n    } else if (action === 'delete-line') {\n      this.copyFromHistoryIndex()\n      this.history[0] = ''\n      this.cursorPos = 0\n    } else if (action === 'delete-word') {\n      this.copyFromHistoryIndex()\n      let words = this.history[0].substr(0, this.cursorPos).split(' ')\n      words.pop()\n      this.history[0] = words.join(' ') + this.history[0].substr(this.cursorPos)\n      this.cursorPos = words.join(' ').length\n    } else if (action === 'move-cursor-y') {\n      this.historyIndex -= args[0]\n      if (this.historyIndex < 0) this.historyIndex = 0\n      if (this.historyIndex >= this.history.length) this.historyIndex = this.history.length - 1\n      this.cursorPos = this.history[this.historyIndex].length\n    }\n\n    this.terminal.write(this.history[this.historyIndex])\n    this.terminal.write('\\b'.repeat(this.history[this.historyIndex].length))\n    this.terminal.moveForward(this.cursorPos)\n\n    this.lastInputLength = this.cursorPos\n\n    let completed = this.getCompleted(true)\n    if (this.historyIndex === 0 && completed && action !== 'return') {\n      // show closest match faintly\n      let rest = completed.substr(this.history[0].length)\n      this.terminal.write(`\\x1b[2m${rest}\\x1b[m${'\\b'.repeat(rest.length)}`)\n      this.lastInputLength += rest.length\n    }\n\n    if (action === 'return') {\n      this.terminal.write('\\n')\n      this.parse(this.history[this.historyIndex])\n    }\n  }\n  parse (input) {\n    if (input === 'help') input = 'info'\n    // TODO: basic chaining (i.e. semicolon)\n    if (input) this.run(input)\n    else this.prompt()\n  }\n  run (command) {\n    let parts = ['']\n\n    let inQuote = false\n    for (let character of command.trim()) {\n      if (inQuote && character !== inQuote) {\n        parts[parts.length - 1] += character\n      } else if (inQuote) {\n        inQuote = false\n      } else if (character === '\"' || character === \"'\") {\n        inQuote = character\n      } else if (character.match(/\\s/)) {\n        if (parts[parts.length - 1]) parts.push('')\n      } else parts[parts.length - 1] += character\n    }\n\n    let name = parts.shift()\n\n    if (name in this.index) {\n      this.spawn(name, parts)\n    } else {\n      this.terminal.write(`demosh: Unknown command: ${name}\\r\\n`)\n      this.prompt(false)\n    }\n  }\n  spawn (name, args = []) {\n    let Process = this.index[name]\n    if (Process instanceof Function) {\n      this.setButtons([])\n      this.child = new Process(this)\n      let write = data => this.terminal.write(data)\n      let setButtons = buttons => this.setButtons(buttons)\n      this.child.on('write', write)\n      this.child.on('buttons', setButtons)\n      this.child.on('exit', code => {\n        if (this.child) {\n          this.child.removeListener('write', write)\n          this.child.removeListener('buttons', setButtons)\n        }\n        this.child = null\n        this.prompt(!code)\n      })\n      this.child.run(...args)\n    } else {\n      this.terminal.write(Process)\n      this.prompt()\n    }\n  }\n\n  setButtons (buttons) {\n    if (!buttons) {\n      const shell = this\n      let writeChars = chars => {\n        let loop = () => {\n          shell.write(chars[0])\n          chars = chars.substr(1)\n          if (chars) setTimeout(loop, 100)\n        }\n        setTimeout(loop, 200)\n      }\n\n      buttons = [\n        {\n          label: 'Open GitHub',\n          action (shell) {\n            if (shell.child) shell.child.destroy()\n            writeChars('github\\r')\n          }\n        },\n        {\n          label: 'Help',\n          action (shell) {\n            if (shell.child) shell.child.destroy()\n            writeChars('info\\r')\n          }\n        }\n      ]\n    }\n    if (!buttons.length) buttons.push({ label: '', action () {} })\n    this.buttons = buttons\n    this.terminal.buttonLabels = buttons.map(x => x.label)\n  }\n\n  onButtonPress (index) {\n    let button = this.buttons[index]\n    if (!button) return\n    button.action(this, this.terminal)\n  }\n}\n\nwindow.demoInterface = module.exports = {\n  input (data) {\n    let type = data[0]\n    let content = data.substr(1)\n\n    if (type === 's') {\n      this.shell.write(content)\n    } else if (type === 'b') {\n      let button = content.charCodeAt(0)\n      this.shell.onButtonPress(button - 1)\n    } else if (type === 'm' || type === 'p' || type === 'r') {\n      let row = parse2B(content, 0)\n      let column = parse2B(content, 2)\n      let button = parse2B(content, 4)\n      let modifiers = parse2B(content, 6)\n\n      if (demoData.mouseReceiver) {\n        if (type === 'm') demoData.mouseReceiver.mouseMove(column, row, button, modifiers)\n        else if (type === 'p') demoData.mouseReceiver.mouseDown(column, row, button, modifiers)\n        else if (type === 'r') demoData.mouseReceiver.mouseUp(column, row, button, modifiers)\n      }\n    }\n  },\n  didInit: false,\n  init (screen) {\n    if (this.didInit) return\n    this.didInit = true\n    this.terminal = new ScrollingTerminal(screen)\n    this.shell = new DemoShell(this.terminal, true)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/demo.js","let data = require('locale-data')\n\nmodule.exports = function localize (key) {\n  return data[key] || `?${key}?`\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/lang.js","require('./lib/polyfills')\nrequire('./modal')\nrequire('./notif')\nrequire('./appcommon')\ntry { require('./term/demo') } catch (err) {}\nrequire('./wifi')\nrequire('./gpio_control')\n\nconst $ = require('./lib/chibi')\nconst { qs } = require('./utils')\n\n/* Export stuff to the global scope for inline scripts */\nwindow.termInit = require('./term')\nwindow.$ = $\nwindow.qs = qs\n\nwindow.themes = require('./term/themes')\n\nwindow.TermConf = require('./term_conf')\n\n\n\n// WEBPACK FOOTER //\n// ./js/index.js","/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */\nif (!String.fromCodePoint) {\n  (function () {\n    var defineProperty = (function () {\n      // IE 8 only supports `Object.defineProperty` on DOM elements\n      try {\n        var object = {};\n        var $defineProperty = Object.defineProperty;\n        var result = $defineProperty(object, object, object) && $defineProperty;\n      } catch (error) {\n      }\n      return result;\n    }());\n    var stringFromCharCode = String.fromCharCode;\n    var floor = Math.floor;\n    var fromCodePoint = function () {\n      var MAX_SIZE = 0x4000;\n      var codeUnits = [];\n      var highSurrogate;\n      var lowSurrogate;\n      var index = -1;\n      var length = arguments.length;\n      if (!length) {\n        return '';\n      }\n      var result = '';\n      while (++index < length) {\n        var codePoint = Number(arguments[index]);\n        if (\n          !isFinite(codePoint) ||       // `NaN`, `+Infinity`, or `-Infinity`\n          codePoint < 0 ||              // not a valid Unicode code point\n          codePoint > 0x10FFFF ||       // not a valid Unicode code point\n          floor(codePoint) != codePoint // not an integer\n        ) {\n          throw RangeError('Invalid code point: ' + codePoint);\n        }\n        if (codePoint <= 0xFFFF) { // BMP code point\n          codeUnits.push(codePoint);\n        } else { // Astral code point; split in surrogate halves\n          // http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\n          codePoint -= 0x10000;\n          highSurrogate = (codePoint >> 10) + 0xD800;\n          lowSurrogate = (codePoint % 0x400) + 0xDC00;\n          codeUnits.push(highSurrogate, lowSurrogate);\n        }\n        if (index + 1 == length || codeUnits.length > MAX_SIZE) {\n          result += stringFromCharCode.apply(null, codeUnits);\n          codeUnits.length = 0;\n        }\n      }\n      return result;\n    };\n    if (defineProperty) {\n      defineProperty(String, 'fromCodePoint', {\n        'value': fromCodePoint,\n        'configurable': true,\n        'writable': true\n      });\n    } else {\n      String.fromCodePoint = fromCodePoint;\n    }\n  }());\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/lib/polyfills.js","const $ = require('./lib/chibi')\nconst { mk, qs, qsa, cr } = require('./utils')\nconst modal = require('./modal')\nconst notify = require('./notif')\n\n/** Global generic init */\n$.ready(function () {\n  // Opening menu on mobile / narrow screen\n  function menuOpen () {\n    $('#menu').toggleClass('expanded')\n  }\n  $('#brand')\n    .on('click', menuOpen)\n    .on('keypress', cr(menuOpen))\n\n  // Checkbox UI (checkbox CSS and hidden input with int value)\n  $('.Row.checkbox').forEach(function (x) {\n    let inp = x.querySelector('input')\n    let box = x.querySelector('.box')\n\n    $(box).toggleClass('checked', inp.value)\n\n    let hdl = function () {\n      inp.value = 1 - inp.value\n      $(box).toggleClass('checked', inp.value)\n    }\n\n    $(x).on('click', hdl).on('keypress', cr(hdl))\n  })\n\n  // Expanding boxes on mobile\n  $('.Box.mobcol,.Box.fold').forEach(function (x) {\n    let h = x.querySelector('h2')\n\n    let hdl = function () {\n      if ($(x).hasClass('d-expanded')) {\n        $(x).removeClass('d-expanded')\n      } else {\n        $(x).toggleClass('expanded')\n      }\n    }\n    $(h).on('click', hdl).on('keypress', cr(hdl))\n  })\n\n  $('form').forEach(function (x) {\n    $(x).on('keypress', function (e) {\n      if ((e.keyCode === 10 || e.keyCode === 13) && e.ctrlKey) {\n        x.submit()\n      }\n    })\n  })\n\n  // loader dots...\n  setInterval(function () {\n    $('.anim-dots').each(function (x) {\n      let $x = $(x)\n      let dots = $x.html() + '.'\n      if (dots.length === 5) dots = '.'\n      $x.html(dots)\n    })\n  }, 1000)\n\n  // flipping number boxes with the mouse wheel\n  $('input[type=number]').on('wheel', function (e) {\n    let $this = $(this)\n    let val = +$this.val()\n    if (isNaN(val)) val = 1\n\n    const step = +($this.attr('step') || 1)\n    const min = +$this.attr('min')\n    const max = +$this.attr('max')\n    if (e.deltaY > 0) {\n      val += step\n    } else {\n      val -= step\n    }\n\n    if (Number.isFinite(min)) val = Math.max(val, +min)\n    if (Number.isFinite(max)) val = Math.min(val, +max)\n    $this.val(val)\n\n    if ('createEvent' in document) {\n      let evt = document.createEvent('HTMLEvents')\n      evt.initEvent('change', false, true)\n      $this[0].dispatchEvent(evt)\n    } else {\n      $this[0].fireEvent('onchange')\n    }\n\n    e.preventDefault()\n  })\n\n  try {\n    do {\n      let msgAt, box\n      // populate the form errors box from GET arg ?err=...\n      // (a way to pass errors back from server via redirect)\n      msgAt = window.location.search.indexOf('err=')\n      if (msgAt !== -1 && qs('.Box.errors')) {\n        let errs = decodeURIComponent(window.location.search.substr(msgAt + 4)).split(',')\n        let humanReadableErrors = []\n        errs.forEach(function (er) {\n          if (er.length === 0) return\n          let lbls = qsa('label[for=\"' + er + '\"]')\n          if (lbls && lbls.length > 0) {\n            for (let i = 0; i < lbls.length; i++) {\n              let lbl = lbls[i]\n              lbl.classList.add('error')\n              if (i === 0) humanReadableErrors.push(lbl.childNodes[0].textContent.trim().replace(/: ?$/, ''))\n            }\n          } else {\n            console.log(JSON.stringify(er))\n            humanReadableErrors.push(er)\n          }\n        })\n\n        qs('.Box.errors .list').innerHTML = humanReadableErrors.join(', ')\n        qs('.Box.errors').classList.remove('hidden')\n        break\n      }\n\n      let fademsgbox = function (box, time) {\n        box.classList.remove('hidden')\n        setTimeout(() => {\n          box.classList.add('hiding')\n          setTimeout(() => {\n            box.classList.add('hidden')\n          }, 1000)\n        }, time)\n      }\n\n      msgAt = window.location.search.indexOf('errmsg=')\n      box = qs('.Box.errmessage')\n      if (msgAt !== -1 && box) {\n        let msg = decodeURIComponent(window.location.search.substr(msgAt + 7))\n        box.innerHTML = msg\n        fademsgbox(box, 3000)\n        break\n      }\n\n      msgAt = window.location.search.indexOf('msg=')\n      box = qs('.Box.message')\n      if (msgAt !== -1 && box) {\n        let msg = decodeURIComponent(window.location.search.substr(msgAt + 4))\n        box.innerHTML = msg\n        fademsgbox(box, 2000)\n        break\n      }\n    } while (0)\n  } catch (e) {\n    console.error(e)\n  }\n\n  modal.init()\n  notify.init()\n\n  // remove tabindices from h2 if wide\n  if (window.innerWidth > 550) {\n    $('.Box h2').forEach(function (x) {\n      x.removeAttribute('tabindex')\n    })\n\n    // brand works as a link back to term in widescreen mode\n    let br = qs('#brand')\n    br && br.addEventListener('click', function () {\n      window.location.href = '/' // go to terminal\n    })\n  }\n})\n\n// setup the ajax loader\n$._loader = function (vis) {\n  $('#loader').toggleClass('show', vis)\n}\n\nlet pageShown = false\n// reveal content on load\nfunction showPage () {\n  pageShown = true\n  $('#content').addClass('load')\n}\n// HACKITY HACK: fix this later\nwindow.showPage = showPage\n\n// Auto reveal pages other than the terminal (sets window.noAutoShow)\n$.ready(function () {\n  if (window.noAutoShow === true) {\n    setTimeout(function () {\n      if (!pageShown) {\n        let bnr = mk('P')\n        bnr.id = 'load-failed'\n        bnr.innerHTML =\n          'Server connection failed! Trying again' +\n          '<span class=\"anim-dots\" style=\"width:1.5em;text-align:left;display:inline-block\">.</span>'\n        qs('#screen').appendChild(bnr)\n        qs('#screen').classList.add('failed')\n        showPage()\n      }\n    }, 2000)\n  } else {\n    setTimeout(function () {\n      showPage()\n    }, 1)\n  }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./js/appcommon.js","const $ = require('./lib/chibi')\nconst { mk } = require('./utils')\nconst tr = require('./lang')\n\nconst HTTPS = window.location.protocol.match(/s:/)\n\n{\n  const w = window.WiFi = {}\n\n  const authTypes = ['Open', 'WEP', 'WPA', 'WPA2', 'WPA/WPA2']\n  let curSSID\n\n  // Get XX % for a slider input\n  function calc_dBm (inp) {\n    return `+${(inp.value * 0.25).toFixed(2)} dBm`\n  }\n\n  // Display selected STA SSID etc\n  function selectSta (name, password, ip) {\n    $('#sta_ssid').val(name)\n    $('#sta_password').val(password)\n\n    $('#sta-nw').toggleClass('hidden', name.length === 0)\n    $('#sta-nw-nil').toggleClass('hidden', name.length > 0)\n\n    $('#sta-nw .essid').html($.htmlEscape(name))\n    const hasPassword = !!password\n\n    // (the following is kind of confusing with the double-double negations,\n    // but it works)\n    $('#sta-nw .passwd').toggleClass('hidden', !hasPassword)\n    $('#sta-nw .nopasswd').toggleClass('hidden', hasPassword)\n\n    $('#sta-nw .ip').html(ip.length > 0 ? tr('wifi.connected_ip_is') + ip : tr('wifi.not_conn'))\n  }\n\n  /** Update display for received response */\n  function onScan (resp, status) {\n    // var ap_json = {\n    //  \"result\": {\n    //    \"inProgress\": \"0\",\n    //    \"APs\": [\n    //      {\"essid\": \"Chlivek\", \"bssid\": \"88:f7:c7:52:b3:99\", \"rssi\": \"204\", \"enc\": \"4\", \"channel\": \"1\"},\n    //      {\"essid\": \"TyNikdy\", \"bssid\": \"5c:f4:ab:0d:f1:1b\", \"rssi\": \"164\", \"enc\": \"3\", \"channel\": \"1\"},\n    //    ]\n    //  }\n    // };\n\n    if (status !== 200) {\n      // bad response\n      rescan(5000) // wait 5s then retry\n      return\n    }\n\n    try {\n      resp = JSON.parse(resp)\n    } catch (e) {\n      console.log(e)\n      rescan(5000)\n      return\n    }\n\n    const done = !resp.result.inProgress && resp.result.APs.length > 0\n    rescan(done ? 15000 : 1000)\n    if (!done) return // no redraw yet\n\n    // clear the AP list\n    let $list = $('#ap-list')\n    // remove old APs\n    $('#ap-list .AP').remove()\n\n    $list.toggleClass('hidden', !done)\n    $('#ap-loader').toggleClass('hidden', done)\n\n    // scan done\n    resp.result.APs.sort((a, b) => b.rssi - a.rssi).forEach(function (ap) {\n      ap.enc = parseInt(ap.enc)\n\n      if (ap.enc > 4) return // hide unsupported auths\n\n      let item = mk('div')\n\n      let $item = $(item)\n        .data('ssid', ap.essid)\n        .data('pwd', ap.enc)\n        .attr('tabindex', 0)\n        .addClass('AP')\n\n      // mark current SSID\n      if (ap.essid === curSSID) {\n        $item.addClass('selected')\n      }\n\n      let inner = mk('div')\n      let escapedSSID = $.htmlEscape(ap.essid)\n      $(inner).addClass('inner')\n        .htmlAppend(`<div class=\"rssi\">${ap.rssi_perc}</div>`)\n        .htmlAppend(`<div class=\"essid\" title=\"${escapedSSID}\">${escapedSSID}</div>`)\n        .htmlAppend(`<div class=\"auth\">${authTypes[ap.enc]}</div>`)\n\n      $item.on('click', function () {\n        let $th = $(this)\n\n        const conn_ssid = $th.data('ssid')\n        let conn_pass = ''\n\n        if (+$th.data('pwd')) {\n          // this AP needs a password\n          conn_pass = window.prompt(tr('wifi.enter_passwd').replace(':ssid:', conn_ssid))\n          if (!conn_pass) return\n        }\n\n        $('#sta_password').val(conn_pass)\n        $('#sta_ssid').val(conn_ssid)\n        selectSta(conn_ssid, conn_pass, '')\n      })\n\n      item.appendChild(inner)\n      $list[0].appendChild(item)\n    })\n  }\n\n  function startScanning () {\n    $('#ap-loader').removeClass('hidden')\n    $('#ap-scan').addClass('hidden')\n    $('#ap-loader .anim-dots').html('.')\n\n    scanAPs()\n  }\n\n  /** Ask the CGI what APs are visible (async) */\n  function scanAPs () {\n    if (window._demo) {\n      onScan(window._demo_aps, 200)\n    } else {\n      $.get(`${HTTPS ? 'https' : 'http'}://${window._root}/cfg/wifi/scan`, onScan)\n    }\n  }\n\n  function rescan (time) {\n    setTimeout(scanAPs, time)\n  }\n\n  /** Set up the WiFi page */\n  function wifiInit (cfg) {\n    // Update slider value displays\n    $('.Row.range').forEach(function (x) {\n      let inp = x.querySelector('input')\n      let disp1 = x.querySelector('.x-disp1')\n      let disp2 = x.querySelector('.x-disp2')\n      let t = calc_dBm(inp)\n      $(disp1).html(t)\n      $(disp2).html(t)\n      $(inp).on('input', function () {\n        t = calc_dBm(inp)\n        $(disp1).html(t)\n        $(disp2).html(t)\n      })\n    })\n\n    // Forget STA credentials\n    $('#forget-sta').on('click', () => {\n      selectSta('', '', '')\n      return false\n    })\n\n    selectSta(cfg.sta_ssid, cfg.sta_password, cfg.sta_active_ip)\n    curSSID = cfg.sta_active_ssid\n  }\n\n  w.init = wifiInit\n  w.startScanning = startScanning\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/wifi.js","<?php\n\nreturn [\n\t'menu.cfg_wifi' => 'WiFi Settings',\n\t'menu.cfg_network' => 'Network Settings',\n\t'menu.cfg_term' => 'Terminal Settings',\n\t'menu.about' => 'About ESPTerm',\n\t'menu.help' => 'Quick Reference',\n\t'menu.term' => 'Back to Terminal',\n\t'menu.cfg_system' => 'System Settings',\n\t'menu.cfg_wifi_conn' => 'Connecting to Network',\n\t'menu.settings' => 'Settings',\n\t'menu.cfg_gpio' => 'GPIO Control',\n\n\t// Terminal page\n\n\t'title.term' => 'Terminal', // page title of the terminal page\n\n\t'term_nav.fullscreen' => 'Fullscreen',\n\t'term_nav.config' => 'Config',\n\t'term_nav.wifi' => 'WiFi',\n\t'term_nav.help' => 'Help',\n\t'term_nav.about' => 'About',\n\t'term_nav.paste' => 'Paste',\n\t'term_nav.upload' => 'Upload',\n\t'term_nav.keybd' => 'Keyboard',\n\t'term_nav.paste_prompt' => 'Paste text to send:',\n\n\t'term_conn.connecting' => 'Connecting',\n\t'term_conn.waiting_content' => 'Waiting for content',\n\t'term_conn.disconnected' => 'Disconnected',\n\t'term_conn.waiting_server' => 'Waiting for server',\n\t'term_conn.reconnecting' => 'Reconnecting',\n\n\t// Terminal settings page\n\n\t'term.defaults' => 'Initial Settings',\n\t'term.expert' => 'Expert Options',\n\t'term.explain_initials' => '\n\t\tThose are the initial settings used after ESPTerm powers on, \n\t\tor when the screen reset command is received (<code>\\ec</code>).\n\t\tThey can be changed by the terminal application using escape sequences.\n\t\t',\n\t'term.explain_expert' => '\n\t\tThose are advanced config options that usually don\\'t need to be changed.\n\t\tEdit them only if you know what you\\'re doing.',\n\n\t'term.example' => 'Default colors preview',\n\n\t'term.explain_scheme' => '\n\t\tTo select default text and background color, click on the\n\t\tpreview palette. Alternatively, use numbers 0-15 for theme colors,\n\t\t16-255 for standard colors and hex (#FFFFFF) for True Color (24-bit).\n\t\t',\n\n\t'term.fgbg_presets' => 'Defaults Presets',\n\t'term.color_scheme' => 'Color Scheme',\n\t'term.reset_screen' => 'Reset screen & parser',\n\t'term.term_title' => 'Header Text',\n\t'term.term_width' => 'Width',\n\t'term.term_height' => 'Height',\n\t'term.buttons' => 'Button Labels',\n\t'term.theme' => 'Color Palette',\n\t'term.cursor_shape' => 'Cursor Style',\n\t'term.parser_tout_ms' => 'Parser Timeout',\n\t'term.display_tout_ms' => 'Redraw Delay',\n\t'term.display_cooldown_ms' => 'Redraw Cooldown',\n\t'term.allow_decopt_12' => 'Allow \\e?12h/l',\n\t'term.fn_alt_mode' => 'SS3 Fn keys',\n\t'term.show_config_links' => 'Show nav links',\n\t'term.show_buttons' => 'Show buttons',\n\t'term.loopback' => 'Local Echo (<span style=\"text-decoration:overline\">SRM</span>)',\n\t'term.crlf_mode' => 'Enter = CR+LF (LNM)',\n\t'term.want_all_fn' => 'Capture F5, F11, F12',\n\t'term.button_msgs' => 'Button codes<br>(ASCII, dec, CSV)',\n\t'term.color_fg' => 'Default Fg.',\n\t'term.color_bg' => 'Default Bg.',\n\t'term.color_fg_prev' => 'Foreground',\n\t'term.color_bg_prev' => 'Background',\n\t'term.colors_preview' => '',\n\t'term.debugbar' => 'Debug internal state',\n\t'term.ascii_debug' => 'Display control codes',\n\t'term.backdrop' => 'Background image URL',\n\t'term.button_count' => 'Button count',\n\t'term.button_colors' => 'Button colors',\n\t'term.font_stack' => 'Font stack',\n\t'term.font_size' => 'Font size',\n\n\t'cursor.block_blink' => 'Block, blinking',\n    'cursor.block_steady' => 'Block, steady',\n    'cursor.underline_blink' => 'Underline, blinking',\n    'cursor.underline_steady' => 'Underline, steady',\n    'cursor.bar_blink' => 'I-bar, blinking',\n    'cursor.bar_steady' => 'I-bar, steady',\n\n\t// Text upload dialog\n\n\t'upload.title' => 'Text Upload',\n\t'upload.prompt' => 'Load a text file:',\n\t'upload.endings' => 'Line endings:',\n\t'upload.endings.cr' => 'CR (Enter key)',\n\t'upload.endings.crlf' => 'CR LF (Windows)',\n\t'upload.endings.lf' => 'LF (Linux)',\n\t'upload.chunk_delay' => 'Chunk delay (ms):',\n\t'upload.chunk_size' => 'Chunk size (0=line):',\n\t'upload.progress' => 'Upload:',\n\n\t// Network config page\n\n\t'net.explain_sta' => '\n\t\tSwitch off Dynamic IP to configure the static IP address.',\n\n\t'net.explain_ap' => '\n\t\tThose settings affect the built-in DHCP server in AP mode.',\n\n\t'net.ap_dhcp_time' => 'Lease time',\n\t'net.ap_dhcp_start' => 'Pool start IP',\n\t'net.ap_dhcp_end' => 'Pool end IP',\n\t'net.ap_addr_ip' => 'Own IP address',\n\t'net.ap_addr_mask' => 'Subnet mask',\n\n\t'net.sta_dhcp_enable' => 'Use dynamic IP',\n\t'net.sta_addr_ip' => 'ESPTerm static IP',\n\t'net.sta_addr_mask' => 'Subnet mask',\n\t'net.sta_addr_gw' => 'Gateway IP',\n\n\t'net.ap' => 'DHCP Server (AP)',\n\t'net.sta' => 'DHCP Client (Station)',\n\t'net.sta_mac' => 'Station MAC',\n\t'net.ap_mac' => 'AP MAC',\n\t'net.details' => 'MAC addresses',\n\n\t// Wifi config page\n\n\t'wifi.ap' => 'Built-in Access Point',\n\t'wifi.sta' => 'Join Existing Network',\n\n\t'wifi.enable' => 'Enabled',\n\t'wifi.tpw' => 'Transmit power',\n\t'wifi.ap_channel' => 'Channel',\n\t'wifi.ap_ssid' => 'AP SSID',\n\t'wifi.ap_password' => 'Password',\n\t'wifi.ap_hidden' => 'Hide SSID',\n\t'wifi.sta_info' => 'Selected',\n\n\t'wifi.not_conn' => 'Not connected.',\n\t'wifi.sta_none' => 'None',\n\t'wifi.sta_active_pw' => '🔒 Password saved',\n\t'wifi.sta_active_nopw' => '🔓 Open access',\n\t'wifi.connected_ip_is' => 'Connected, IP is ',\n\t'wifi.sta_password' => 'Password:',\n\n\t'wifi.scanning' => 'Scanning',\n\t'wifi.scan_now' => 'Click here to start scanning!',\n\t'wifi.cant_scan_no_sta' => 'Click here to enable client mode and start scanning!',\n\t'wifi.select_ssid' => 'Available networks:',\n\t'wifi.enter_passwd' => 'Enter password for \":ssid:\"',\n\t'wifi.sta_explain' => 'After selecting a network, press Apply to connect.',\n\n\t// Wifi connecting status page\n\n\t'wificonn.status' => 'Status:',\n\t'wificonn.back_to_config' => 'Back to WiFi config',\n\t'wificonn.telemetry_lost' => 'Telemetry lost; something went wrong, or your device disconnected.',\n\t'wificonn.explain_android_sucks' => '\n\t\tIf you\\'re configuring ESPTerm via a smartphone, or were connected \n\t\tfrom another external network, your device may lose connection and \n\t\tthis progress indicator won\\'t work. Please wait a while (~ 15 seconds), \n\t\tthen check if the connection succeeded.',\n\n\t'wificonn.explain_reset' => '\n\t\tTo force enable the built-in AP, hold the BOOT button until the blue LED \n\t\tstarts flashing. Hold the button longer (until the LED flashes rapidly) \n\t\tfor a \"factory reset\".',\n\n\t'wificonn.disabled' =>\"Station mode is disabled.\",\n\t'wificonn.idle' =>\"Idle, not connected and has no IP.\",\n\t'wificonn.success' => \"Connected! Received IP \",\n\t'wificonn.working' => \"Connecting to selected AP\",\n\t'wificonn.fail' => \"Connection failed, check settings & try again. Cause: \",\n\n\t// Access restrictions form\n\n\t'pwlock.title' => 'Access Restrictions',\n\t'pwlock.explain' => '\n\t\tSome parts, or all of the web interface can be protected by a password prompt.\n\t\tLeave the new password fields empty if you do not wish to change it.<br>\n\t\tThe default password is \"%def_access_pw%\".\n\t',\n\t'pwlock.region' => 'Protected pages',\n\t'pwlock.region.none' => 'None, all open',\n\t'pwlock.region.settings_noterm' => 'WiFi, Net & System settings',\n\t'pwlock.region.settings' => 'All settings pages',\n\t'pwlock.region.menus' => 'This entire menu section',\n\t'pwlock.region.all' => 'Everything, even terminal',\n\t'pwlock.new_access_pw' => 'New password',\n\t'pwlock.new_access_pw2' => 'Repeat',\n\t'pwlock.admin_pw' => 'Admin password',\n\t'pwlock.access_name' => 'Username',\n\n\t// Setting admin password\n\n\t'adminpw.title' => 'Change Admin Password',\n\t'adminpw.explain' =>\n\t\t'\n\t\tThe \"admin password\" is used to manipulate the stored default settings \n\t\tand to change access restrictions. This password is not saved as part \n\t\tof the main config, i.e. using save / restore does not affect this \n\t\tpassword. When the admin password is forgotten, the easiest way to \n\t\tre-gain access is to wipe and re-flash the chip.<br>\n\t\tThe default admin password is \"%def_admin_pw%\".\n\t\t',\n\t'adminpw.new_admin_pw' => 'New admin password',\n\t'adminpw.new_admin_pw2' => 'Repeat',\n\t'adminpw.old_admin_pw' => 'Old admin password',\n\n\t// Persist form\n\n\t'persist.title' => 'Save & Restore',\n\t'persist.explain' => '\n\t\tESPTerm saves all settings in Flash. The active settings can be copied to\n\t\tthe \"defaults area\" and restored later using the blue button below.\n\t\t',\n\t'persist.confirm_restore' => 'Restore all settings to their default values?',\n\t'persist.confirm_restore_hard' =>\n\t\t'Restore to firmware default settings? This will reset ' .\n\t\t'all active settings and switch to AP mode with the default SSID.',\n\t'persist.confirm_store_defaults' =>\n\t\t'Enter admin password to confirm you want to overwrite the default settings.',\n\t'persist.password' => 'Admin password:',\n\t'persist.restore_defaults' => 'Reset to saved defaults',\n\t'persist.write_defaults' => 'Save active settings as defaults',\n\t'persist.restore_hard' => 'Reset active settings to factory defaults',\n\t'persist.restore_hard_explain' =>\n\t\t'(This clears the WiFi config! Does not affect saved defaults or admin password.)',\n\n\t'backup.title' => 'Back-up Config File',\n\t'backup.explain' => 'All config except the admin password can be backed up and restored using an INI file.',\n\t'backup.export' => 'Export to file',\n\t'backup.import' => 'Import!',\n\n\t// UART settings form\n\n\t'uart.title' => 'Serial Port Parameters',\n\t'uart.explain' => '\n\t\tThis form controls the communication UART. The debug UART is fixed\n\t\tat 115.200 baud, one stop-bit and no parity.\n\t\t',\n\t'uart.baud' => 'Baud rate',\n\t'uart.parity' => 'Parity',\n\t'uart.parity.none' => 'None',\n\t'uart.parity.odd' => 'Odd',\n\t'uart.parity.even' => 'Even',\n\t'uart.stop_bits' => 'Stop-bits',\n\t'uart.stop_bits.one' => 'One',\n\t'uart.stop_bits.one_and_half' => 'One and half',\n\t'uart.stop_bits.two' => 'Two',\n\n\t// HW tuning form\n\n\t'hwtuning.title' => 'Hardware Tuning',\n\t'hwtuning.explain' => '\n\t\tESP8266 can be overclocked from 80&nbsp;MHz to 160&nbsp;MHz. This will make \n\t\tit more responsive and allow faster screen updates at the expense of slightly \n\t\thigher power consumption. This can also make it more susceptible to interference.\n\t\tUse with care.\n\t\t',\n\t'hwtuning.overclock' => 'Overclock to 160MHz',\n\n\t'gpiox_config' => 'GPIO:x function',\n\t'gpiox_level' => 'GPIO:x level',\n\t'gpio_config.title_config' => 'Pin Config',\n\t'gpio_config.title_control' => 'Pin State',\n\t'gpio_config.off' => 'Disabled',\n\t'gpio_config.off_2' => 'Debug UART Tx',\n\t'gpio_config.out_initial0' => 'Output (initial 0)',\n\t'gpio_config.out_initial1' => 'Output (initial 1)',\n\t'gpio_config.in_pull' => 'Input (pull-up)',\n\t'gpio_config.in_nopull' => 'Input (floating)',\n\t'gpio_config.explain' =>\n\t\t'Click state indicators to toggle output levels. \n\t\t See the help page for information about the GPIO access HTTP API.',\n\n\t// Generic button / dialog labels\n\n\t'apply' => 'Apply!',\n\t'start' => 'Start',\n\t'cancel' => 'Cancel',\n\t'enabled' => 'Enabled',\n\t'disabled' => 'Disabled',\n\t'yes' => 'Yes',\n\t'no' => 'No',\n\t'confirm' => 'OK',\n\t'copy' => 'Copy',\n\t'form_errors' => 'Validation errors for:',\n];\n\n\n\n// WEBPACK FOOTER //\n// ./lang/en.php","import {cr} from './utils'\n\nconst $ = require('./lib/chibi')\n\nconst HTTPS = window.location.protocol.match(/s:/)\n\nconst PERIOD_NORMAL = 500\nconst PERIOD_FAIL = 2500\n\nconst w = window.GPIO_Ctl = {}\n\nlet scheduledSampleTimeout = null\nlet lastState = {'io2': -1, 'io4': -1, 'io5': -1}\n\nlet $in2, $in4, $in5\n\nlet enablePolling\n\nfunction scheduleSample (time) {\n  if (!enablePolling || window._demo) return // no scanning in demo mode\n\n  clearTimeout(scheduledSampleTimeout)\n  scheduledSampleTimeout = setTimeout(sampleGPIOs, time)\n}\n\nfunction onSampled (resp, status) {\n  if (status !== 200) {\n    // bad response\n    scheduleSample(PERIOD_FAIL) // wait 5s then retry\n    return\n  }\n\n  try {\n    if (typeof resp !== 'object') resp = JSON.parse(resp)\n\n    if (resp.io2 !== lastState.io2) $in2.toggleClass('active', resp.io2)\n    if (resp.io4 !== lastState.io4) $in4.toggleClass('active', resp.io4)\n    if (resp.io5 !== lastState.io5) $in5.toggleClass('active', resp.io5)\n  } catch (e) {\n    console.log(e)\n    scheduleSample(PERIOD_FAIL)\n    return\n  }\n\n  lastState = resp\n\n  scheduleSample(PERIOD_NORMAL)\n}\n\nfunction sampleGPIOs (getargs = '') {\n  clearTimeout(scheduledSampleTimeout)\n  $.get(`${HTTPS ? 'https' : 'http'}://${window._root}/api/v1/gpio${getargs}`, onSampled, {loader: getargs !== ''})\n}\n\nw.init = function (state, doPoll) {\n\n  $in2 = $('.x-in2')\n  $in4 = $('.x-in4')\n  $in5 = $('.x-in5')\n\n  enablePolling = doPoll\n\n  $('.gpio-indicator, .x-in-handle')\n    .on('click', function (e) {\n      let num = $(this).data('num')\n      sampleGPIOs(`?do${num}=${1 - lastState['io' + num]}`)\n    })\n\n  $('.x-in-handle')\n    .on('keypress', cr(function (e) {\n      let num = $(this).data('num')\n      sampleGPIOs(`?do${num}=${1 - lastState['io' + num]}`)\n    }))\n\n  onSampled(state, 200)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/gpio_control.js","const $ = require('../lib/chibi')\nconst { qs, mk } = require('../utils')\nconst localize = require('../lang')\nconst Notify = require('../notif')\nconst TermScreen = require('./screen')\nconst TermConnection = require('./connection')\nconst TermInput = require('./input')\nconst TermUpload = require('./upload')\nconst initSoftKeyboard = require('./soft_keyboard')\nconst attachDebugger = require('./debug')\nconst initButtons = require('./buttons')\n\n/** Init the terminal sub-module - called from HTML */\nmodule.exports = function (opts) {\n  const screen = new TermScreen()\n  const conn = new TermConnection(screen)\n  const input = TermInput(conn, screen)\n  const termUpload = TermUpload(conn, input, screen)\n  input.termUpload = termUpload\n\n  // forward screen input events\n  screen.on('mousedown', (...args) => input.onMouseDown(...args))\n  screen.on('mousemove', (...args) => input.onMouseMove(...args))\n  screen.on('mouseup', (...args) => input.onMouseUp(...args))\n  screen.on('mousewheel', (...args) => input.onMouseWheel(...args))\n  screen.on('input-alts', (...args) => input.setAlts(...args))\n  screen.on('mouse-mode', (...args) => input.setMouseMode(...args))\n\n  // touch selection menu (the Copy button)\n  $.ready(() => {\n    const touchSelectMenu = qs('#touch-select-menu')\n    screen.on('show-touch-select-menu', (x, y) => {\n      let rect = touchSelectMenu.getBoundingClientRect()\n      x -= rect.width / 2\n      y -= rect.height / 2\n\n      touchSelectMenu.classList.add('open')\n      touchSelectMenu.style.transform = `translate(${x}px,${y}px)`\n    })\n    screen.on('hide-touch-select-menu', () => touchSelectMenu.classList.remove('open'))\n\n    const copyButton = qs('#touch-select-copy-btn')\n    if (copyButton) {\n      copyButton.addEventListener('click', () => {\n        screen.copySelectionToClipboard()\n      })\n    }\n  })\n\n  // buttons\n  const buttons = initButtons(input)\n  screen.on('buttons-update', update => {\n    buttons.labels = update.labels\n    buttons.colors = update.colors\n  })\n  // TODO: don't access the renderer here\n  buttons.palette = screen.layout.renderer.palette\n  screen.layout.renderer.on('palette-update', palette => {\n    buttons.palette = palette\n  })\n\n  screen.on('full-load', () => {\n    let scr = qs('#screen')\n    let errmsg = qs('#load-failed')\n    if (scr) scr.classList.remove('failed')\n    if (errmsg) errmsg.parentNode.removeChild(errmsg)\n  })\n\n  let setLinkVisibility = visible => {\n    let buttons = [...document.querySelectorAll('.x-term-conf-btn')]\n    if (visible) buttons.forEach(x => x.classList.remove('hidden'))\n    else buttons.forEach(x => x.classList.add('hidden'))\n  }\n  let setButtonVisibility = visible => {\n    if (visible) qs('#action-buttons').classList.remove('hidden')\n    else qs('#action-buttons').classList.add('hidden')\n  }\n\n  screen.on('opts-update', () => {\n    setLinkVisibility(screen.showLinks)\n    setButtonVisibility(screen.showButtons)\n  })\n\n  screen.on('title-update', text => {\n    qs('#screen-title').textContent = text\n    if (!text) text = 'Terminal'\n    qs('title').textContent = `${text} :: ESPTerm`\n  })\n\n  // connection status\n\n  let showSplashTimeout = null\n  let showSplash = (obj, delay = 250) => {\n    clearTimeout(showSplashTimeout)\n    showSplashTimeout = setTimeout(() => {\n      screen.window.statusScreen = obj\n    }, delay)\n  }\n\n  conn.on('open', () => {\n    // console.log('*open')\n    showSplash({ title: localize('term_conn.connecting'), loading: true })\n  })\n  conn.on('connect', () => {\n    // console.log('*connect')\n    showSplash({ title: localize('term_conn.waiting_content'), loading: true })\n  })\n  screen.on('load', () => {\n    // console.log('*load')\n    clearTimeout(showSplashTimeout)\n    if (screen.window.statusScreen) screen.window.statusScreen = null\n  })\n  conn.on('disconnect', () => {\n    // console.log('*disconnect')\n    showSplash({ title: localize('term_conn.disconnected') }, 500)\n    screen.screen = []\n    screen.screenFG = []\n    screen.screenBG = []\n    screen.screenAttrs = []\n  })\n  conn.on('silence', () => {\n    // console.log('*silence')\n    showSplash({ title: localize('term_conn.waiting_server'), loading: true }, 0)\n  })\n  // conn.on('ping-fail', () => { screen.window.statusScreen = { title: 'Disconnected' } })\n  conn.on('ping-success', () => {\n    // console.log('*ping-success')\n    showSplash({ title: localize('term_conn.reconnecting'), loading: true }, 0)\n  })\n\n  conn.init()\n  input.init(opts)\n  termUpload.init()\n  Notify.init()\n\n  window.onerror = function (errorMsg, file, line, col) {\n    Notify.show(`<b>JS ERROR!</b><br>${errorMsg}<br>at ${file}:${line}:${col}`, 10000, true)\n    return false\n  }\n\n  qs('#screen').appendChild(screen.layout.canvas)\n\n  initSoftKeyboard(screen, input)\n  if (attachDebugger) attachDebugger(screen, conn)\n\n  // fullscreen mode\n\n  let fullscreenIcon = {} // dummy\n  let isFullscreen = false\n  let properFullscreen = false\n  let fitScreen = false\n  let screenPadding = screen.layout.window.padding\n  let fitScreenIfNeeded = function fitScreenIfNeeded () {\n    if (isFullscreen) {\n      fullscreenIcon.className = 'icn-resize-small'\n      if (properFullscreen) {\n        screen.layout.window.fitIntoWidth = window.screen.width\n        screen.layout.window.fitIntoHeight = window.screen.height\n        screen.layout.window.padding = 0\n      } else {\n        screen.layout.window.fitIntoWidth = window.innerWidth\n        if (qs('#term-nav').classList.contains('hidden')) {\n          screen.layout.window.fitIntoHeight = window.innerHeight\n        } else {\n          screen.layout.window.fitIntoHeight = window.innerHeight - 24\n        }\n        screen.layout.window.padding = 0\n      }\n    } else {\n      fullscreenIcon.className = 'icn-resize-full'\n      screen.layout.window.fitIntoWidth = fitScreen ? window.innerWidth - 4 : 0\n      screen.layout.window.fitIntoHeight = fitScreen ? window.innerHeight : 0\n      screen.layout.window.padding = screenPadding\n    }\n  }\n  fitScreenIfNeeded()\n  window.addEventListener('resize', fitScreenIfNeeded)\n\n  let toggleFitScreen = function () {\n    fitScreen = !fitScreen\n    const resizeButtonIcon = qs('#resize-button-icon')\n    if (fitScreen) {\n      resizeButtonIcon.classList.remove('icn-resize-small')\n      resizeButtonIcon.classList.add('icn-resize-full')\n    } else {\n      resizeButtonIcon.classList.remove('icn-resize-full')\n      resizeButtonIcon.classList.add('icn-resize-small')\n    }\n    fitScreenIfNeeded()\n  }\n\n  qs('#term-fit-screen').addEventListener('click', function () {\n    toggleFitScreen()\n    return false\n  })\n\n  // add fullscreen mode & button\n  if (window.Element.prototype.requestFullscreen || window.Element.prototype.webkitRequestFullscreen) {\n    properFullscreen = true\n\n    let checkForFullscreen = function () {\n      // document.fullscreenElement is not really supported yet, so here's a hack\n      if (isFullscreen && (window.innerWidth !== window.screen.width || window.innerHeight !== window.screen.height)) {\n        isFullscreen = false\n        fitScreenIfNeeded()\n      }\n    }\n    setInterval(checkForFullscreen, 500)\n  }\n\n  // (why are the buttons anchors?)\n  let button = mk('a')\n  button.id = 'fullscreen-button'\n  button.href = '#'\n  button.addEventListener('click', e => {\n    e.preventDefault()\n\n    if (document.body.classList.contains('pseudo-fullscreen')) {\n      document.body.classList.remove('pseudo-fullscreen')\n      isFullscreen = false\n      fitScreenIfNeeded()\n      return\n    }\n\n    isFullscreen = true\n    fitScreenIfNeeded()\n    screen.layout.updateSize()\n\n    if (properFullscreen) {\n      if (screen.layout.canvas.requestFullscreen) screen.layout.canvas.requestFullscreen()\n      else screen.layout.canvas.webkitRequestFullscreen()\n    } else {\n      document.body.classList.add('pseudo-fullscreen')\n    }\n  })\n  fullscreenIcon = mk('i')\n  fullscreenIcon.className = 'icn-resize-full'\n  button.appendChild(fullscreenIcon)\n  let span = mk('span')\n  span.textContent = localize('term_nav.fullscreen')\n  button.appendChild(span)\n  qs('#term-nav').insertBefore(button, qs('#term-nav').firstChild)\n\n  // for debugging\n  window.termScreen = screen\n  window.buttons = buttons\n  window.conn = conn\n  window.input = input\n  window.termUpl = termUpload\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/index.js","const EventEmitter = require('events')\nconst { mk } = require('../utils')\nconst notify = require('../notif')\nconst ScreenParser = require('./screen_parser')\nconst ScreenLayout = require('./screen_layout')\nconst { ATTR_BLINK } = require('./screen_attr_bits')\n\n/**\n * A terminal screen.\n */\nmodule.exports = class TermScreen extends EventEmitter {\n  constructor () {\n    super()\n\n    this.parser = new ScreenParser()\n    this.layout = new ScreenLayout()\n\n    // debug screen handle\n    this._debug = null\n\n    if ('AudioContext' in window || 'webkitAudioContext' in window) {\n      this.audioCtx = new (window.AudioContext || window.webkitAudioContext)()\n    } else {\n      console.warn('No AudioContext!')\n    }\n\n    this._window = {\n      width: 0,\n      height: 0,\n      // two bits. LSB: debug enabled by user, MSB: debug enabled by server\n      debug: 0,\n      statusScreen: null\n    }\n\n    // make writing to window update size and draw\n    this.window = new Proxy(this._window, {\n      set (target, key, value) {\n        if (target[key] !== value) {\n          target[key] = value\n          self.updateLayout()\n          self.renderScreen(`window:${key}=${value}`)\n          self.emit(`update-window:${key}`, value)\n        }\n        return true\n      }\n    })\n\n    this.on('update-window:debug', debug => { this.layout.window.debug = !!debug })\n\n    this.cursor = {\n      x: 0,\n      y: 0,\n      blinking: true,\n      visible: true,\n      hanging: false,\n      style: 'block'\n    }\n\n    const self = this\n\n    // current selection\n    this.selection = {\n      // when false, this will prevent selection in favor of mouse events,\n      // though alt can be held to override it\n      selectable: null,\n\n      // selection start and end (x, y) tuples\n      start: [0, 0],\n      end: [0, 0],\n\n      setSelectable (value) {\n        if (value !== this.selectable) {\n          this.selectable = self.layout.selectable = value\n        }\n      }\n    }\n\n    // mouse features\n    this.mouseMode = { clicks: false, movement: false }\n\n    this.showLinks = false\n    this.showButtons = false\n    this.title = ''\n\n    this.bracketedPaste = false\n    this.blinkingCellCount = 0\n    this.reverseVideo = false\n\n    this.screen = []\n    this.screenFG = []\n    this.screenBG = []\n    this.screenAttrs = []\n    this.screenLines = []\n\n    // For testing TODO remove\n    //   this.screenLines[0] = 0b001\n    //   this.screenLines[1] = 0b010\n    //   this.screenLines[2] = 0b100\n    //   this.screenLines[3] = 0b011\n    //   this.screenLines[4] = 0b101\n\n    let selecting = false\n\n    let selectStart = (x, y) => {\n      if (selecting) return\n      selecting = true\n      this.selection.start = this.selection.end = this.layout.screenToGrid(x, y, true)\n      this.renderScreen('select-start')\n    }\n\n    let selectMove = (x, y) => {\n      if (!selecting) return\n      this.selection.end = this.layout.screenToGrid(x, y, true)\n      this.renderScreen('select-move')\n    }\n\n    let selectEnd = (x, y) => {\n      if (!selecting) return\n      selecting = false\n      this.selection.end = this.layout.screenToGrid(x, y, true)\n      this.renderScreen('select-end')\n      Object.assign(this.selection, this.getNormalizedSelection())\n    }\n\n    // bind event listeners\n\n    this.layout.on('mousedown', e => {\n      this.emit('hide-touch-select-menu')\n      if ((this.selection.selectable || e.altKey) && e.button === 0) {\n        selectStart(e.offsetX, e.offsetY)\n      } else {\n        this.emit('mousedown', ...this.layout.screenToGrid(e.offsetX, e.offsetY), e.button + 1)\n      }\n    })\n\n    window.addEventListener('mousemove', e => {\n      selectMove(e.offsetX, e.offsetY)\n    })\n\n    window.addEventListener('mouseup', e => {\n      selectEnd(e.offsetX, e.offsetY)\n    })\n\n    // touch event listeners\n\n    let touchPosition = null\n    let touchDownTime = 0\n    let touchSelectMinTime = 500\n    let touchDidMove = false\n\n    let getTouchPositionOffset = touch => {\n      let rect = this.layout.canvas.getBoundingClientRect()\n      return [touch.clientX - rect.left, touch.clientY - rect.top]\n    }\n\n    this.layout.on('touchstart', e => {\n      touchPosition = getTouchPositionOffset(e.touches[0])\n      touchDidMove = false\n      touchDownTime = Date.now()\n\n      if (this.mouseMode.clicks) {\n        this.emit('mousedown', ...this.layout.screenToGrid(...touchPosition), 1)\n        e.preventDefault()\n      }\n    })\n\n    this.layout.on('touchmove', e => {\n      touchPosition = getTouchPositionOffset(e.touches[0])\n\n      if (!selecting && touchDidMove === false) {\n        if (touchDownTime < Date.now() - touchSelectMinTime) {\n          selectStart(...touchPosition)\n        }\n      } else if (selecting) {\n        e.preventDefault()\n        selectMove(...touchPosition)\n      } else if (this.mouseMode.movement && !selecting) {\n        this.emit('mousemove', ...this.layout.screenToGrid(...touchPosition))\n        e.preventDefault()\n      }\n\n      touchDidMove = true\n    })\n\n    this.layout.on('touchend', e => {\n      if (e.touches[0]) {\n        touchPosition = getTouchPositionOffset(e.touches[0])\n      }\n\n      if (selecting) {\n        e.preventDefault()\n        selectEnd(...touchPosition)\n\n        // selection ended; show touch select menu\n        // use middle position for x and one line above for y\n        let selectionPos = this.layout.gridToScreen(\n          (this.selection.start[0] + this.selection.end[0]) / 2,\n          this.selection.start[1] - 1\n        )\n\n        this.emit('show-touch-select-menu', selectionPos[0], selectionPos[1])\n      } else if (this.mouseMode.clicks) {\n        this.emit('mouseup', ...this.layout.screenToGrid(...touchPosition), 1)\n        e.preventDefault()\n      }\n\n      if (!touchDidMove && !this.mouseMode.clicks) {\n        this.emit('tap', Object.assign(e, {\n          x: touchPosition[0],\n          y: touchPosition[1]\n        }))\n      } else if (!touchDidMove) this.resetSelection()\n\n      touchPosition = null\n    })\n\n    this.on('tap', e => {\n      if (this.selection.start[0] !== this.selection.end[0] ||\n        this.selection.start[1] !== this.selection.end[1]) {\n        // selection is not empty\n        this.resetSelection()\n      } else {\n        e.preventDefault()\n        this.emit('open-soft-keyboard')\n      }\n    })\n\n    this.layout.on('mousemove', e => {\n      if (!selecting) {\n        this.emit('mousemove', ...this.layout.screenToGrid(e.offsetX, e.offsetY))\n      }\n    })\n\n    this.layout.on('mouseup', e => {\n      if (!selecting) {\n        this.emit('mouseup', ...this.layout.screenToGrid(e.offsetX, e.offsetY),\n          e.button + 1)\n      }\n    })\n\n    let aggregateWheelDelta = 0\n    this.layout.on('wheel', e => {\n      if (this.mouseMode.clicks) {\n        if (Math.abs(e.wheelDeltaY) === 120) {\n          // mouse wheel scrolling\n          this.emit('mousewheel', ...this.layout.screenToGrid(e.offsetX, e.offsetY), e.deltaY > 0 ? 1 : -1)\n        } else {\n          // smooth scrolling\n          aggregateWheelDelta -= e.wheelDeltaY\n          if (Math.abs(aggregateWheelDelta) >= 40) {\n            this.emit('mousewheel', ...this.layout.screenToGrid(e.offsetX, e.offsetY), aggregateWheelDelta > 0 ? 1 : -1)\n            aggregateWheelDelta = 0\n          }\n        }\n\n        // prevent page scrolling\n        e.preventDefault()\n      }\n    })\n\n    this.layout.on('contextmenu', e => {\n      if (this.mouseMode.clicks) {\n        // prevent mouse keys getting stuck\n        e.preventDefault()\n      }\n      selectEnd(e.offsetX, e.offsetY)\n    })\n  }\n\n  resetScreen () {\n    const { width, height } = this.window\n    this.blinkingCellCount = 0\n    this.screen.screen = new Array(width * height).fill(' ')\n    this.screen.screenFG = new Array(width * height).fill(0)\n    this.screen.screenBG = new Array(width * height).fill(0)\n    this.screen.screenAttrs = new Array(width * height).fill(0)\n    this.screen.screenLines = new Array(height).fill(0)\n  }\n\n  updateLayout () {\n    this.layout.window.width = this.window.width\n    this.layout.window.height = this.window.height\n  }\n\n  renderScreen (reason) {\n    let selection = []\n\n    for (let cell = 0; cell < this.screen.length; cell++) {\n      selection.push(this.isInSelection(cell % this.window.width, Math.floor(cell / this.window.width)))\n    }\n\n    this.layout.render(reason, {\n      width: this.window.width,\n      height: this.window.height,\n      screen: this.screen,\n      screenFG: this.screenFG,\n      screenBG: this.screenBG,\n      screenSelection: selection,\n      screenAttrs: this.screenAttrs,\n      screenLines: this.screenLines,\n      cursor: this.cursor,\n      statusScreen: this.window.statusScreen,\n      reverseVideo: this.reverseVideo,\n      hasBlinkingCells: !!this.blinkingCellCount\n    })\n  }\n\n  resetSelection () {\n    this.selection.start = this.selection.end = [0, 0]\n    this.emit('hide-touch-select-menu')\n    this.renderScreen('select-reset')\n  }\n\n  /**\n   * Returns a normalized version of the current selection, such that `start`\n   * is always before `end`.\n   * @returns {Object} the normalized selection, with `start` and `end`\n   */\n  getNormalizedSelection () {\n    let { start, end } = this.selection\n    // if the start line is after the end line, or if they're both on the same\n    // line but the start column comes after the end column, swap\n    if (start[1] > end[1] || (start[1] === end[1] && start[0] > end[0])) {\n      [start, end] = [end, start]\n    }\n    return { start, end }\n  }\n\n  /**\n   * Returns whether or not a given cell is in the current selection.\n   * @param {number} col - the column (x)\n   * @param {number} line - the line (y)\n   * @returns {boolean}\n   */\n  isInSelection (col, line) {\n    let { start, end } = this.getNormalizedSelection()\n    let colAfterStart = start[0] <= col\n    let colBeforeEnd = col < end[0]\n    let onStartLine = line === start[1]\n    let onEndLine = line === end[1]\n\n    if (onStartLine && onEndLine) return colAfterStart && colBeforeEnd\n    else if (onStartLine) return colAfterStart\n    else if (onEndLine) return colBeforeEnd\n    else return start[1] < line && line < end[1]\n  }\n\n  /**\n   * Sweeps for selected cells and joins them in a multiline string.\n   * @returns {string} the selection\n   */\n  getSelectedText () {\n    const screenLength = this.window.width * this.window.height\n    let lines = []\n    let previousLineIndex = -1\n\n    for (let cell = 0; cell < screenLength; cell++) {\n      let x = cell % this.window.width\n      let y = Math.floor(cell / this.window.width)\n\n      if (this.isInSelection(x, y)) {\n        if (previousLineIndex !== y) {\n          previousLineIndex = y\n          lines.push('')\n        }\n        lines[lines.length - 1] += this.screen[cell]\n      }\n    }\n\n    return lines.join('\\n')\n  }\n\n  /**\n   * Copies the selection to clipboard and creates a notification balloon.\n   */\n  copySelectionToClipboard () {\n    let selectedText = this.getSelectedText()\n    // don't copy anything if nothing is selected\n    if (!selectedText) return\n    let textarea = mk('textarea')\n    document.body.appendChild(textarea)\n    textarea.value = selectedText\n    textarea.select()\n    if (document.execCommand('copy')) {\n      notify.show('Copied to clipboard')\n    } else {\n      notify.show('Failed to copy')\n    }\n    document.body.removeChild(textarea)\n  }\n\n  /**\n   * Shows an actual notification (if possible) or a notification balloon.\n   * @param {string} text - the notification content\n   */\n  showNotification (text) {\n    console.info(`Notification: ${text}`)\n    if (window.Notification && window.Notification.permission === 'granted') {\n      let notification = new window.Notification('ESPTerm', {\n        body: text\n      })\n      notification.addEventListener('click', () => window.focus())\n    } else {\n      if (window.Notification && window.Notification.permission !== 'denied') {\n        window.Notification.requestPermission()\n      } else {\n        // Fallback using the built-in notification balloon\n        notify.show(text)\n      }\n    }\n  }\n\n  /**\n   * Creates a beep sound.\n   */\n  beep () {\n    const audioCtx = this.audioCtx\n    if (!audioCtx) return\n\n    // prevent screeching\n    if (this._lastBeep && this._lastBeep > Date.now() - 50) return\n    this._lastBeep = Date.now()\n\n    if (!this._convolver) {\n      this._convolver = audioCtx.createConvolver()\n      let impulseLength = audioCtx.sampleRate * 0.8\n      let impulse = audioCtx.createBuffer(2, impulseLength, audioCtx.sampleRate)\n      for (let i = 0; i < impulseLength; i++) {\n        impulse.getChannelData(0)[i] = (1 - i / impulseLength) ** (7 + Math.random())\n        impulse.getChannelData(1)[i] = (1 - i / impulseLength) ** (7 + Math.random())\n      }\n      this._convolver.buffer = impulse\n      this._convolver.connect(audioCtx.destination)\n    }\n\n    // main beep\n    const mainOsc = audioCtx.createOscillator()\n    const mainGain = audioCtx.createGain()\n    mainOsc.connect(mainGain)\n    mainGain.gain.value = 4\n    mainOsc.frequency.value = 750\n    mainOsc.type = 'sine'\n\n    // surrogate beep (making it sound like 'oops')\n    const surrOsc = audioCtx.createOscillator()\n    const surrGain = audioCtx.createGain()\n    surrOsc.connect(surrGain)\n    surrGain.gain.value = 2\n    surrOsc.frequency.value = 400\n    surrOsc.type = 'sine'\n\n    mainGain.connect(this._convolver)\n    surrGain.connect(this._convolver)\n\n    let startTime = audioCtx.currentTime\n    mainOsc.start()\n    mainOsc.stop(startTime + 0.5)\n    surrOsc.start(startTime + 0.05)\n    surrOsc.stop(startTime + 0.8)\n\n    let loop = function () {\n      if (audioCtx.currentTime < startTime + 0.8) window.requestAnimationFrame(loop)\n      mainGain.gain.value *= 0.8\n      surrGain.gain.value *= 0.8\n    }\n    loop()\n  }\n\n  load (...args) {\n    const updates = this.parser.parse(...args)\n\n    for (let update of updates) {\n      switch (update.topic) {\n        case 'screen-opts':\n          if (update.width !== this.window.width || update.height !== this.window.height) {\n            this.window.width = update.width\n            this.window.height = update.height\n            this.resetScreen()\n          }\n          this.layout.renderer.loadTheme(update.theme)\n          this.layout.renderer.setDefaultColors(update.defFG, update.defBG)\n          this.cursor.visible = update.cursorVisible\n          this.emit('input-alts', ...update.inputAlts)\n          this.mouseMode.clicks = update.trackMouseClicks\n          this.mouseMode.movement = update.trackMouseMovement\n          this.emit('mouse-mode', update.trackMouseClicks, update.trackMouseMovement)\n          this.selection.setSelectable(!update.trackMouseClicks && !update.trackMouseMovement)\n          if (this.cursor.blinking !== update.cursorBlinking) {\n            this.cursor.blinking = update.cursorBlinking\n            this.layout.renderer.resetCursorBlink()\n          }\n          this.cursor.style = update.cursorStyle\n          this.bracketedPaste = update.bracketedPaste\n          this.reverseVideo = update.reverseVideo\n          this.window.debug &= 0b01\n          this.window.debug |= (+update.debugEnabled << 1)\n\n          this.showLinks = update.showConfigLinks\n          this.showButtons = update.showButtons\n          this.emit('opts-update')\n          break\n\n        case 'double-lines':\n          this.screenLines = update.lines\n          this.renderScreen('double-lines')\n          break\n\n        case 'static-opts':\n          this.layout.window.fontFamily = update.fontStack || null\n          this.layout.window.fontSize = update.fontSize\n          break\n\n        case 'cursor':\n          if (this.cursor.x !== update.x || this.cursor.y !== update.y || this.cursor.hanging !== update.hanging) {\n            this.cursor.x = update.x\n            this.cursor.y = update.y\n            this.cursor.hanging = update.hanging\n            this.layout.renderer.resetCursorBlink()\n            this.emit('cursor-moved')\n            this.renderScreen('cursor-moved')\n          }\n          break\n\n        case 'title':\n          this.emit('title-update', this.title = update.title)\n          break\n\n        case 'buttons-update':\n          this.emit('buttons-update', update)\n          break\n\n        case 'backdrop':\n          this.backgroundImage = update.image\n          break\n\n        case 'bell':\n          this.beep()\n          break\n\n        case 'internal':\n          this.emit('internal', update)\n          break\n\n        case 'content':\n          const { frameX, frameY, frameWidth, frameHeight, cells } = update\n\n          if (this._debug && this.window.debug) {\n            this._debug.pushFrame([frameX, frameY, frameWidth, frameHeight])\n          }\n\n          for (let cell = 0; cell < cells.length; cell++) {\n            let data = cells[cell]\n\n            let cellXInFrame = cell % frameWidth\n            let cellYInFrame = Math.floor(cell / frameWidth)\n            let index = (frameY + cellYInFrame) * this.window.width + frameX + cellXInFrame\n\n            if ((this.screenAttrs[index] & ATTR_BLINK) !== (data[3] & ATTR_BLINK)) {\n              if (data[3] & ATTR_BLINK) this.blinkingCellCount++\n              else this.blinkingCellCount--\n            }\n\n            this.screen[index] = data[0]\n            this.screenFG[index] = data[1]\n            this.screenBG[index] = data[2]\n            this.screenAttrs[index] = data[3]\n          }\n\n          if (this.window.debug) console.log(`Blinking cells: ${this.blinkingCellCount}`)\n\n          this.renderScreen('load')\n          this.emit('load')\n          break\n\n        case 'full-load-complete':\n          this.emit('full-load')\n          break\n\n        case 'notification':\n          this.showNotification(update.content)\n          break\n\n        default:\n          console.warn('Unhandled update', update)\n      }\n    }\n\n    this.emit('update')\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/screen.js","const {\n  ATTR_FG,\n  ATTR_BG,\n  ATTR_BOLD,\n  ATTR_UNDERLINE,\n  ATTR_BLINK,\n  ATTR_STRIKE,\n  ATTR_OVERLINE,\n  ATTR_FAINT\n} = require('./screen_attr_bits')\n\n// constants for decoding the update blob\nconst SEQ_SKIP = 1\nconst SEQ_REPEAT = 2\nconst SEQ_SET_COLORS = 3\nconst SEQ_SET_ATTRS = 4\nconst SEQ_SET_FG = 5\nconst SEQ_SET_BG = 6\nconst SEQ_SET_ATTR_0 = 7\n\n// decode a number encoded as a unicode code point\nfunction du (str) {\n  if (!str) return NaN\n  let num = str.codePointAt(0)\n  if (num > 0xDFFF) num -= 0x800\n  return num - 1\n}\n\n/* eslint-disable no-multi-spaces */\n//                                mnemonic\nconst TOPIC_SCREEN_OPTS  = 'O' // O-ptions\nconst TOPIC_STATIC_OPTS  = 'P' // P-arams\nconst TOPIC_CONTENT      = 'S' // S-creen\nconst TOPIC_TITLE        = 'T' // T-itle\nconst TOPIC_BUTTONS      = 'B' // B-uttons\nconst TOPIC_CURSOR       = 'C' // C-ursor\nconst TOPIC_INTERNAL     = 'D' // D-ebug\nconst TOPIC_BELL         = '!' // !!!\nconst TOPIC_BACKDROP     = 'W' // W-allpaper\nconst TOPIC_DOUBLE_LINES = 'H' // H-uge\n\nconst OPT_CURSOR_VISIBLE   = (1 << 0)\nconst OPT_DEBUGBAR         = (1 << 1)\nconst OPT_CURSORS_ALT_MODE = (1 << 2)\nconst OPT_NUMPAD_ALT_MODE  = (1 << 3)\nconst OPT_FN_ALT_MODE      = (1 << 4)\nconst OPT_CLICK_TRACKING   = (1 << 5)\nconst OPT_MOVE_TRACKING    = (1 << 6)\nconst OPT_SHOW_BUTTONS     = (1 << 7)\nconst OPT_SHOW_CONFIG_LINKS = (1 << 8)\n// const OPT_CURSOR_SHAPE   = (7 << 9)\nconst OPT_CRLF_MODE        = (1 << 12)\nconst OPT_BRACKETED_PASTE  = (1 << 13)\nconst OPT_REVERSE_VIDEO    = (1 << 14)\n\n/* eslint-enable no-multi-spaces */\n\n/**\n * A parser for screen update messages\n */\nmodule.exports = class ScreenParser {\n  constructor () {\n    // true if full content was loaded\n    this.contentLoaded = false\n  }\n\n  parseUpdate (str) {\n    // console.log(`update ${str}`)\n\n    // current index\n    let ci = 0\n    let strArray = Array.from ? Array.from(str) : str.split('')\n\n    let text\n    const topics = du(strArray[ci++])\n\n    let collectOneTerminatedString = () => {\n      // TODO optimize this\n      text = ''\n      while (ci < strArray.length) {\n        let c = strArray[ci++]\n        if (c !== '\\x01') {\n          text += c\n        } else {\n          break\n        }\n      }\n      return text\n    }\n\n    let collectColor = () => {\n      let c = du(strArray[ci++])\n      if (c & 0x10000) { // support for trueColor\n        c &= 0xFFF\n        c |= (du(strArray[ci++]) & 0xFFF) << 12\n        c += 256\n      }\n      return c\n    }\n\n    const updates = []\n\n    while (ci < strArray.length) {\n      const topic = strArray[ci++]\n\n      if (topic === TOPIC_SCREEN_OPTS) {\n        const height = du(strArray[ci++])\n        const width = du(strArray[ci++])\n        const theme = du(strArray[ci++])\n        const defFG = collectColor()\n        const defBG = collectColor()\n\n        // process attributes\n        const attributes = du(strArray[ci++])\n\n        const cursorVisible = !!(attributes & OPT_CURSOR_VISIBLE)\n\n        // HACK: input alts are formatted as arguments for Input#setAlts\n        const inputAlts = [\n          !!(attributes & OPT_CURSORS_ALT_MODE),\n          !!(attributes & OPT_NUMPAD_ALT_MODE),\n          !!(attributes & OPT_FN_ALT_MODE),\n          !!(attributes & OPT_CRLF_MODE)\n        ]\n\n        const trackMouseClicks = !!(attributes & OPT_CLICK_TRACKING)\n        const trackMouseMovement = !!(attributes & OPT_MOVE_TRACKING)\n\n        // 0 - Block blink     2 - Block steady (1 is unused)\n        // 3 - Underline blink 4 - Underline steady\n        // 5 - I-bar blink     6 - I-bar steady\n        let cursorShape = (attributes >> 9) & 0x07\n        // if it's not zero, decrement such that the two most significant bits\n        // are the type and the least significant bit is the blink state\n        if (cursorShape > 0) cursorShape--\n        let cursorStyle = cursorShape >> 1\n        const cursorBlinking = !(cursorShape & 1)\n        if (cursorStyle === 0) cursorStyle = 'block'\n        else if (cursorStyle === 1) cursorStyle = 'line'\n        else cursorStyle = 'bar'\n\n        const showButtons = !!(attributes & OPT_SHOW_BUTTONS)\n        const showConfigLinks = !!(attributes & OPT_SHOW_CONFIG_LINKS)\n\n        const bracketedPaste = !!(attributes & OPT_BRACKETED_PASTE)\n        const reverseVideo = !!(attributes & OPT_REVERSE_VIDEO)\n\n        const debugEnabled = !!(attributes & OPT_DEBUGBAR)\n\n        updates.push({\n          topic: 'screen-opts',\n          width,\n          height,\n          theme,\n          defFG,\n          defBG,\n          cursorVisible,\n          cursorBlinking,\n          cursorStyle,\n          inputAlts,\n          trackMouseClicks,\n          trackMouseMovement,\n          showButtons,\n          showConfigLinks,\n          bracketedPaste,\n          reverseVideo,\n          debugEnabled\n        })\n\n      } else if (topic === TOPIC_CURSOR) {\n        // cursor position\n        const y = du(strArray[ci++])\n        const x = du(strArray[ci++])\n        const hanging = !!du(strArray[ci++])\n\n        updates.push({\n          topic: 'cursor',\n          x,\n          y,\n          hanging\n        })\n\n      } else if (topic === TOPIC_STATIC_OPTS) {\n        const fontStack = collectOneTerminatedString()\n        const fontSize = du(strArray[ci++])\n\n        updates.push({\n          topic: 'static-opts',\n          fontStack,\n          fontSize\n        })\n\n      } else if (topic === TOPIC_DOUBLE_LINES) {\n        let lines = []\n        const count = du(strArray[ci++])\n        for (let i = 0; i < count; i++) {\n          // format: INDEX<<3 | (dbl-h-bot : dbl-h-top : dbl-w)\n          let n = du(strArray[ci++])\n          lines[n >> 3] = n & 0b111\n        }\n        updates.push({ topic: 'double-lines', lines: lines })\n\n      } else if (topic === TOPIC_TITLE) {\n        updates.push({ topic: 'title', title: collectOneTerminatedString() })\n\n      } else if (topic === TOPIC_BUTTONS) {\n        const count = du(strArray[ci++])\n\n        let labels = []\n        let colors = []\n        for (let j = 0; j < count; j++) {\n          colors.push(collectColor())\n          labels.push(collectOneTerminatedString())\n        }\n\n        updates.push({\n          topic: 'buttons-update',\n          labels,\n          colors\n        })\n\n      } else if (topic === TOPIC_BACKDROP) {\n        updates.push({ topic: 'backdrop', image: collectOneTerminatedString() })\n\n      } else if (topic === TOPIC_BELL) {\n        updates.push({ topic: 'bell' })\n\n      } else if (topic === TOPIC_INTERNAL) {\n        // debug info\n        const flags = du(strArray[ci++])\n        const cursorAttrs = du(strArray[ci++])\n        const regionStart = du(strArray[ci++])\n        const regionEnd = du(strArray[ci++])\n        const charsetGx = du(strArray[ci++])\n        const charsetG0 = strArray[ci++]\n        const charsetG1 = strArray[ci++]\n\n        let cursorFg = collectColor()\n        let cursorBg = collectColor()\n\n        const freeHeap = du(strArray[ci++])\n        const clientCount = du(strArray[ci++])\n\n        updates.push({\n          topic: 'internal',\n          flags,\n          cursorAttrs,\n          regionStart,\n          regionEnd,\n          charsetGx,\n          charsetG0,\n          charsetG1,\n          cursorFg,\n          cursorBg,\n          freeHeap,\n          clientCount\n        })\n\n      } else if (topic === TOPIC_CONTENT) {\n        // set screen content\n        const frameY = du(strArray[ci++])\n        const frameX = du(strArray[ci++])\n        const frameHeight = du(strArray[ci++])\n        const frameWidth = du(strArray[ci++])\n\n        // content\n        let fg = 7\n        let bg = 0\n        let attrs = 0\n        let cell = 0 // cell index\n        let lastChar = ' '\n        let frameLength = frameWidth * frameHeight\n\n        const MASK_LINE_ATTR = ATTR_UNDERLINE | ATTR_OVERLINE | ATTR_STRIKE\n        const MASK_BLINK = ATTR_BLINK\n\n        const cells = []\n\n        let pushCell = () => {\n          let hasFG = attrs & ATTR_FG\n          let hasBG = attrs & ATTR_BG\n          let cellFG = fg\n          let cellBG = bg\n          let cellAttrs = attrs\n\n          // use 0,0 if no fg/bg. this is to match back-end implementation\n          // and allow leaving out fg/bg setting for cells with none\n          if (!hasFG) cellFG = 0\n          if (!hasBG) cellBG = 0\n\n          // Remove blink attribute if it wouldn't have any effect\n          if ((cellAttrs & MASK_BLINK) &&\n            ((lastChar === ' ' && ((cellAttrs & MASK_LINE_ATTR) === 0)) || // no line styles\n              (fg === bg && hasFG && hasBG) // invisible text\n            )\n          ) {\n            cellAttrs ^= MASK_BLINK\n          }\n\n          // 8 dark system colors turn bright when bold\n          if ((cellAttrs & ATTR_BOLD) && !(cellAttrs & ATTR_FAINT) && hasFG && cellFG < 8) {\n            cellFG += 8\n          }\n\n          cells.push([lastChar, cellFG, cellBG, cellAttrs])\n        }\n\n        while (ci < strArray.length && cell < frameLength) {\n          let character = strArray[ci++]\n          let charCode = character.codePointAt(0)\n\n          let data, count\n          switch (charCode) {\n            case SEQ_REPEAT:\n              count = du(strArray[ci++])\n              for (let j = 0; j < count; j++) {\n                pushCell()\n                if (++cell > frameLength) break\n              }\n              break\n\n            case SEQ_SKIP:\n              cell += du(strArray[ci++])\n              break\n\n            case SEQ_SET_COLORS:\n              data = du(strArray[ci++])\n              fg = data & 0xFF\n              bg = (data >> 8) & 0xFF\n              break\n\n            case SEQ_SET_ATTRS:\n              data = du(strArray[ci++])\n              attrs = data & 0xFFFF\n              break\n\n            case SEQ_SET_ATTR_0:\n              attrs = 0\n              break\n\n            case SEQ_SET_FG:\n              data = du(strArray[ci++])\n              if (data & 0x10000) {\n                data &= 0xFFF\n                data |= (du(strArray[ci++]) & 0xFFF) << 12\n                data += 256\n              }\n              fg = data\n              break\n\n            case SEQ_SET_BG:\n              data = du(strArray[ci++])\n              if (data & 0x10000) {\n                data &= 0xFFF\n                data |= (du(strArray[ci++]) & 0xFFF) << 12\n                data += 256\n              }\n              bg = data\n              break\n\n            default:\n              if (charCode < 32) character = '\\ufffd'\n              lastChar = character\n              pushCell()\n              cell++\n          }\n        }\n\n        updates.push({\n          topic: 'content',\n          frameX,\n          frameY,\n          frameWidth,\n          frameHeight,\n          cells\n        })\n      }\n\n      if (topics & 0x3B && !this.contentLoaded) {\n        updates.push({ topic: 'full-load-complete' })\n        this.contentLoaded = true\n      }\n    }\n\n    return updates\n  }\n\n  /**\n   * Parses a message from the server\n   * @param {string} message - the message\n   */\n  parse (message) {\n    const content = message.substr(1)\n    const updates = []\n\n    // This is a good place for debugging the message\n    // console.log(message)\n\n    switch (message[0]) {\n      case 'U':\n        updates.push(...this.parseUpdate(content))\n        break\n\n      case 'G':\n        return [{\n          topic: 'notification',\n          content\n        }]\n\n      default:\n        console.warn(`Bad data message type; ignoring.\\n${JSON.stringify(message)}`)\n    }\n\n    return updates\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/screen_parser.js","const EventEmitter = require('events')\nconst CanvasRenderer = require('./screen_renderer')\n\nconst DEFAULT_FONT = '\"DejaVu Sans Mono\", \"Liberation Mono\", \"Inconsolata\", \"Menlo\", monospace'\n\n/**\n * Manages terminal screen layout and sizing\n */\nmodule.exports = class ScreenLayout extends EventEmitter {\n  constructor () {\n    super()\n\n    this.canvas = document.createElement('canvas')\n    this.renderer = new CanvasRenderer(this.canvas)\n\n    this._window = {\n      width: 0,\n      height: 0,\n      devicePixelRatio: 1,\n      fontFamily: DEFAULT_FONT,\n      fontSize: 20,\n      padding: 6,\n      gridScaleX: 1.0,\n      gridScaleY: 1.2,\n      fitIntoWidth: 0,\n      fitIntoHeight: 0,\n      debug: false\n    }\n\n    // scaling caused by fitIntoWidth/fitIntoHeight\n    this._windowScale = 1\n\n    // actual padding, as it may be disabled by fullscreen mode etc.\n    this._padding = 0\n\n    // properties of this.window that require updating size and redrawing\n    this.windowState = {\n      width: 0,\n      height: 0,\n      devicePixelRatio: 0,\n      padding: 0,\n      gridScaleX: 0,\n      gridScaleY: 0,\n      fontFamily: '',\n      fontSize: 0,\n      fitIntoWidth: 0,\n      fitIntoHeight: 0\n    }\n\n    this.charSize = { width: 0, height: 0 }\n\n    const self = this\n\n    // make writing to window update size and draw\n    this.window = new Proxy(this._window, {\n      set (target, key, value) {\n        if (target[key] !== value) {\n          target[key] = value\n          self.scheduleSizeUpdate()\n          self.renderer.scheduleDraw(`window:${key}=${value}`)\n          self.emit(`update-window:${key}`, value)\n        }\n        return true\n      }\n    })\n\n    this.on('update-window:debug', debug => { this.renderer.debug = debug })\n\n    this.canvas.addEventListener('mousedown', e => this.emit('mousedown', e))\n    this.canvas.addEventListener('mousemove', e => this.emit('mousemove', e))\n    this.canvas.addEventListener('mouseup', e => this.emit('mouseup', e))\n    this.canvas.addEventListener('touchstart', e => this.emit('touchstart', e))\n    this.canvas.addEventListener('touchmove', e => this.emit('touchmove', e))\n    this.canvas.addEventListener('touchend', e => this.emit('touchend', e))\n    this.canvas.addEventListener('wheel', e => this.emit('wheel', e))\n    this.canvas.addEventListener('contextmenu', e => this.emit('contextmenu', e))\n  }\n\n  /**\n   * Schedule a size update in the next millisecond\n   */\n  scheduleSizeUpdate () {\n    clearTimeout(this._scheduledSizeUpdate)\n    this._scheduledSizeUpdate = setTimeout(() => this.updateSize(), 1)\n  }\n\n  get backgroundImage () {\n    return this.canvas.style.backgroundImage\n  }\n\n  set backgroundImage (value) {\n    this.canvas.style.backgroundImage = value ? `url(${value})` : ''\n    if (this.renderer.backgroundImage !== !!value) {\n      this.renderer.backgroundImage = !!value\n      this.renderer.resetDrawn()\n      this.renderer.scheduleDraw('background-image')\n    }\n  }\n\n  get selectable () {\n    return this.canvas.classList.contains('selectable')\n  }\n\n  set selectable (selectable) {\n    if (selectable) this.canvas.classList.add('selectable')\n    else this.canvas.classList.remove('selectable')\n  }\n\n  /**\n   * Returns a CSS font string with the current font settings and the\n   * specified modifiers.\n   * @param {Object} modifiers\n   * @param {string} [modifiers.style] - the font style\n   * @param {string} [modifiers.weight] - the font weight\n   * @returns {string} a CSS font string\n   */\n  getFont (modifiers = {}) {\n    let fontStyle = modifiers.style || 'normal'\n    let fontWeight = modifiers.weight || 'normal'\n    let fontFamily = this.window.fontFamily || ''\n    if (fontFamily.length > 0) fontFamily += ','\n    fontFamily += DEFAULT_FONT\n    return `${fontStyle} normal ${fontWeight} ${this.window.fontSize}px ${fontFamily}`\n  }\n\n  /**\n   * Converts screen coordinates to grid coordinates.\n   * @param {number} x - x in pixels\n   * @param {number} y - y in pixels\n   * @param {boolean} rounded - whether to round the coord, used for select highlighting\n   * @returns {number[]} a tuple of (x, y) in cells\n   */\n  screenToGrid (x, y, rounded = false) {\n    let cellSize = this.getCellSize()\n\n    x = x / this._windowScale - this._padding\n    y = y / this._windowScale - this._padding\n    y = Math.floor(y / cellSize.height)\n    if (this.renderer.drawnScreenLines[y]) x /= 2 // double size\n    x = Math.floor((x + (rounded ? cellSize.width / 2 : 0)) / cellSize.width)\n    x = Math.max(0, Math.min(this.window.width - 1, x))\n    y = Math.max(0, Math.min(this.window.height - 1, y))\n\n    return [x, y]\n  }\n\n  /**\n   * Converts grid coordinates to screen coordinates.\n   * @param {number} x - x in cells\n   * @param {number} y - y in cells\n   * @param {boolean} [withScale] - when true, will apply window scale\n   * @returns {number[]} a tuple of (x, y) in pixels\n   */\n  gridToScreen (x, y, withScale = false) {\n    let cellSize = this.getCellSize()\n\n    if (this.renderer.drawnScreenLines[y]) x *= 2 // double size\n\n    return [x * cellSize.width, y * cellSize.height].map(v => this._padding + (withScale ? v * this._windowScale : v))\n  }\n\n  /**\n   * Update the character size, used for calculating the cell size.\n   * The space character is used for measuring.\n   * @returns {Object} the character size with `width` and `height` in pixels\n   */\n  updateCharSize () {\n    this.charSize = {\n      width: this.renderer.getCharWidthFor(this.getFont()),\n      height: this.window.fontSize\n    }\n\n    return this.charSize\n  }\n\n  /**\n   * The cell size, which is the character size multiplied by the grid scale.\n   * @returns {Object} the cell size with `width` and `height` in pixels\n   */\n  getCellSize () {\n    if (!this.charSize.height && this.window.fontSize) this.updateCharSize()\n\n    return {\n      width: Math.ceil(this.charSize.width * this.window.gridScaleX),\n      height: Math.ceil(this.charSize.height * this.window.gridScaleY)\n    }\n  }\n\n  /**\n   * Updates the canvas size if it changed\n   */\n  updateSize () {\n    // see below (this is just updating it)\n    this._window.devicePixelRatio = Math.ceil(this._windowScale * (window.devicePixelRatio || 1))\n\n    let didChange = false\n    for (let key in this.windowState) {\n      if (this.windowState.hasOwnProperty(key) && this.windowState[key] !== this.window[key]) {\n        didChange = true\n        this.windowState[key] = this.window[key]\n      }\n    }\n\n    if (didChange) {\n      const {\n        width,\n        height,\n        fitIntoWidth,\n        fitIntoHeight,\n        padding\n      } = this.window\n\n      this.updateCharSize()\n      const cellSize = this.getCellSize()\n\n      // real height of the canvas element in pixels\n      let realWidth = width * cellSize.width\n      let realHeight = height * cellSize.height\n      let originalWidth = realWidth\n\n      if (fitIntoWidth && fitIntoHeight) {\n        let terminalAspect = realWidth / realHeight\n        let fitAspect = fitIntoWidth / fitIntoHeight\n\n        if (terminalAspect < fitAspect) {\n          // align heights\n          realHeight = fitIntoHeight - 2 * padding\n          realWidth = realHeight * terminalAspect\n        } else {\n          // align widths\n          realWidth = fitIntoWidth - 2 * padding\n          realHeight = realWidth / terminalAspect\n        }\n      }\n\n      // store new window scale\n      this._windowScale = realWidth / originalWidth\n\n      realWidth += 2 * padding\n      realHeight += 2 * padding\n\n      // store padding\n      this._padding = padding * (originalWidth / realWidth)\n\n      // the DPR must be rounded to a very nice value to prevent gaps between cells\n      let devicePixelRatio = this._window.devicePixelRatio = Math.ceil(this._windowScale * (window.devicePixelRatio || 1))\n\n      this.canvas.width = (width * cellSize.width + 2 * Math.round(this._padding)) * devicePixelRatio\n      this.canvas.style.width = `${realWidth}px`\n      this.canvas.height = (height * cellSize.height + 2 * Math.round(this._padding)) * devicePixelRatio\n      this.canvas.style.height = `${realHeight}px`\n\n      // the screen has been cleared (by changing canvas width)\n      this.renderer.resetDrawn()\n\n      this.renderer.render('update-size', this.serializeRenderData())\n\n      this.emit('size-update')\n    }\n  }\n\n  serializeRenderData () {\n    return {\n      padding: Math.round(this._padding),\n      devicePixelRatio: this.window.devicePixelRatio,\n      charSize: this.charSize,\n      cellSize: this.getCellSize(),\n      fonts: [\n        this.getFont(),\n        this.getFont({ weight: 'bold' }),\n        this.getFont({ style: 'italic' }),\n        this.getFont({ weight: 'bold', style: 'italic' })\n      ]\n    }\n  }\n\n  render (reason, data) {\n    this.window.width = data.width\n    this.window.height = data.height\n\n    Object.assign(data, this.serializeRenderData())\n\n    this.renderer.render(reason, data)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/screen_layout.js","const EventEmitter = require('events')\nconst {\n  themes,\n  getColor\n} = require('./themes')\n\nconst {\n  ATTR_FG,\n  ATTR_BG,\n  ATTR_BOLD,\n  ATTR_UNDERLINE,\n  ATTR_INVERSE,\n  ATTR_BLINK,\n  ATTR_ITALIC,\n  ATTR_STRIKE,\n  ATTR_OVERLINE,\n  ATTR_FAINT,\n  ATTR_FRAKTUR\n} = require('./screen_attr_bits')\n\n// Some non-bold Fraktur symbols are outside the contiguous block\nconst frakturExceptions = {\n  'C': '\\u212d',\n  'H': '\\u210c',\n  'I': '\\u2111',\n  'R': '\\u211c',\n  'Z': '\\u2128'\n}\n\n/**\n * A terminal screen renderer, using canvas 2D\n */\nmodule.exports = class CanvasRenderer extends EventEmitter {\n  constructor (canvas) {\n    super()\n\n    this.canvas = canvas\n    this.ctx = this.canvas.getContext('2d')\n\n    this._palette = null // colors 0-15\n    this.defaultBG = 0\n    this.defaultFG = 7\n\n    this.debug = false\n    this._debug = null\n\n    this.graphics = 0\n\n    this.statusFont = \"-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif\"\n\n    // screen data, considered immutable\n    this.width = 0\n    this.height = 0\n    this.padding = 0\n    this.charSize = { width: 0, height: 0 }\n    this.cellSize = { width: 0, height: 0 }\n    this.fonts = ['', '', '', ''] // normal, bold, italic, bold-italic\n    this.screen = []\n    this.screenFG = []\n    this.screenBG = []\n    this.screenAttrs = []\n    this.screenSelection = []\n    this.screenLines = []\n    this.cursor = {}\n    this.reverseVideo = false\n    this.hasBlinkingCells = false\n    this.statusScreen = null\n\n    this.resetDrawn()\n\n    this.blinkStyleOn = false\n    this.blinkInterval = null\n    this.cursorBlinkOn = false\n    this.cursorBlinkInterval = null\n\n    // start blink timers\n    this.resetBlink()\n    this.resetCursorBlink()\n  }\n\n  render (reason, data) {\n    if ('hasBlinkingCells' in data && data.hasBlinkingCells !== this.hasBlinkingCells) {\n      if (data.hasBlinkingCells) this.resetBlink()\n      else clearInterval(this.blinkInterval)\n    }\n\n    Object.assign(this, data)\n    this.scheduleDraw(reason)\n  }\n\n  resetDrawn () {\n    // used to determine if a cell should be redrawn; storing the current state\n    // as it is on screen\n    if (this.debug) console.log('Resetting drawn screen')\n\n    this.drawnScreen = []\n    this.drawnScreenFG = []\n    this.drawnScreenBG = []\n    this.drawnScreenAttrs = []\n    this.drawnScreenLines = []\n    this.drawnCursor = [-1, -1, '', false]\n  }\n\n  /**\n   * The color palette. Should define 16 colors in an array.\n   * @type {string[]}\n   */\n  get palette () {\n    return this._palette || themes[0]\n  }\n\n  /** @type {string[]} */\n  set palette (palette) {\n    if (this._palette !== palette) {\n      this._palette = palette\n      this.resetDrawn()\n      this.emit('palette-update', palette)\n      this.scheduleDraw('palette')\n    }\n  }\n\n  getCharWidthFor (font) {\n    this.ctx.font = font\n    return Math.floor(this.ctx.measureText(' ').width)\n  }\n\n  loadTheme (i) {\n    if (i in themes) this.palette = themes[i]\n  }\n\n  setDefaultColors (fg, bg) {\n    if (fg !== this.defaultFG || bg !== this.defaultBG) {\n      this.resetDrawn()\n      this.defaultFG = fg\n      this.defaultBG = bg\n      this.scheduleDraw('default-colors')\n\n      // full bg with default color (goes behind the image)\n      this.canvas.style.backgroundColor = this.getColor(bg)\n    }\n  }\n\n  /**\n   * Schedule a draw in the next millisecond\n   * @param {string} why - the reason why the draw occured (for debugging)\n   * @param {number} [aggregateTime] - time to wait for more scheduleDraw calls\n   *   to occur. 1 ms by default.\n   */\n  scheduleDraw (why, aggregateTime = 1) {\n    clearTimeout(this._scheduledDraw)\n    this._scheduledDraw = setTimeout(() => this.draw(why), aggregateTime)\n  }\n\n  /**\n   * Returns the specified color. If `i` is in the palette, it will return the\n   * palette color. If `i` is between 16 and 255, it will return the 256color\n   * value. If `i` is larger than 255, it will return an RGB color value. If `i`\n   * is -1 (foreground) or -2 (background), it will return the selection colors.\n   * @param {number} i - the color\n   * @returns {string} the CSS color\n   */\n  getColor (i) {\n    return getColor(i, this.palette)\n  }\n\n  /**\n   * Resets the cursor blink to on and restarts the timer\n   */\n  resetCursorBlink () {\n    this.cursorBlinkOn = true\n    clearInterval(this.cursorBlinkInterval)\n    this.cursorBlinkInterval = setInterval(() => {\n      this.cursorBlinkOn = this.cursor.blinking ? !this.cursorBlinkOn : true\n      if (this.cursor.blinking) this.scheduleDraw('cursor-blink')\n    }, 500)\n  }\n\n  /**\n   * Resets the blink style to on and restarts the timer\n   */\n  resetBlink () {\n    this.blinkStyleOn = true\n    clearInterval(this.blinkInterval)\n    let intervals = 0\n    this.blinkInterval = setInterval(() => {\n      if (this.blinkingCellCount <= 0) return\n\n      intervals++\n      if (intervals >= 4 && this.blinkStyleOn) {\n        this.blinkStyleOn = false\n        intervals = 0\n        this.scheduleDraw('blink-style')\n      } else if (intervals >= 1 && !this.blinkStyleOn) {\n        this.blinkStyleOn = true\n        intervals = 0\n        this.scheduleDraw('blink-style')\n      }\n    }, 200)\n  }\n\n  /**\n   * Draws a cell's background with the given parameters.\n   * @param {Object} options\n   * @param {number} options.x - x in cells\n   * @param {number} options.y - y in cells\n   * @param {number} options.cellWidth - cell width in pixels\n   * @param {number} options.cellHeight - cell height in pixels\n   * @param {number} options.bg - the background color\n   * @param {number} options.isDefaultBG - if true, will draw image background if available\n   */\n  drawBackground ({ x, y, cellWidth, cellHeight, bg, isDefaultBG }) {\n    const { ctx, width, height, padding } = this\n\n    // is a double-width/double-height line\n    if (this.screenLines[y] & 0b001) cellWidth *= 2\n\n    ctx.fillStyle = this.getColor(bg)\n    let screenX = x * cellWidth + padding\n    let screenY = y * cellHeight + padding\n    let isBorderCell = x === 0 || y === 0 || x === width - 1 || y === height - 1\n\n    let fillX, fillY, fillWidth, fillHeight\n    if (isBorderCell) {\n      let left = screenX\n      let top = screenY\n      let right = screenX + cellWidth\n      let bottom = screenY + cellHeight\n      if (x === 0) left -= padding\n      else if (x === width - 1) right += padding\n      if (y === 0) top -= padding\n      else if (y === height - 1) bottom += padding\n\n      fillX = left\n      fillY = top\n      fillWidth = right - left\n      fillHeight = bottom - top\n    } else {\n      fillX = screenX\n      fillY = screenY\n      fillWidth = cellWidth\n      fillHeight = cellHeight\n    }\n\n    ctx.clearRect(fillX, fillY, fillWidth, fillHeight)\n\n    if (!isDefaultBG || bg < 0 || !this.backgroundImage) {\n      ctx.fillRect(fillX, fillY, fillWidth, fillHeight)\n    }\n  }\n\n  /**\n   * Draws a cell's character with the given parameters. Won't do anything if\n   * text is an empty string.\n   * @param {Object} options\n   * @param {number} options.x - x in cells\n   * @param {number} options.y - y in cells\n   * @param {Object} options.charSize - the character size, an object with\n   *   `width` and `height` in pixels\n   * @param {number} options.cellWidth - cell width in pixels\n   * @param {number} options.cellHeight - cell height in pixels\n   * @param {string} options.text - the cell content\n   * @param {number} options.fg - the foreground color\n   * @param {number} options.attrs - the cell's attributes\n   */\n  drawCharacter ({ x, y, charSize, cellWidth, cellHeight, text, fg, attrs }) {\n    if (!text) return\n\n    const { ctx, padding } = this\n\n    let underline = false\n    let strike = false\n    let overline = false\n    if (attrs & ATTR_FAINT) ctx.globalAlpha = 0.5\n    if (attrs & ATTR_UNDERLINE) underline = true\n    if (attrs & ATTR_FRAKTUR) text = CanvasRenderer.alphaToFraktur(text)\n    if (attrs & ATTR_STRIKE) strike = true\n    if (attrs & ATTR_OVERLINE) overline = true\n\n    ctx.fillStyle = this.getColor(fg)\n\n    let screenX = x * cellWidth + padding\n    let screenY = y * cellHeight + padding\n\n    const dblWidth = this.screenLines[y] & 0b001\n    const dblHeightTop = this.screenLines[y] & 0b010\n    const dblHeightBot = this.screenLines[y] & 0b100\n\n    if (this.screenLines[y]) {\n      // is a double-width/double-height line\n      if (dblWidth) cellWidth *= 2\n\n      ctx.save()\n      ctx.translate(padding, screenY + 0.5 * cellHeight)\n      if (dblWidth) ctx.scale(2, 1)\n      if (dblHeightTop) {\n        // top half\n        ctx.scale(1, 2)\n        ctx.translate(0, cellHeight / 4)\n      } else if (dblHeightBot) {\n        // bottom half\n        ctx.scale(1, 2)\n        ctx.translate(0, -cellHeight / 4)\n      }\n      ctx.translate(-padding, -screenY - 0.5 * cellHeight)\n      if (dblWidth) ctx.translate(-cellWidth / 4, 0)\n\n      if (dblHeightBot || dblHeightTop) {\n        // characters overflow -- needs clipping\n        // TODO: clipping is really expensive\n        ctx.beginPath()\n        if (dblHeightTop) ctx.rect(screenX, screenY, cellWidth, cellHeight / 2)\n        else ctx.rect(screenX, screenY + cellHeight / 2, cellWidth, cellHeight / 2)\n        ctx.clip()\n      }\n    }\n\n    let codePoint = text.codePointAt(0)\n    if (codePoint >= 0x2580 && codePoint <= 0x259F) {\n      // block elements\n      ctx.beginPath()\n      const left = screenX\n      const top = screenY\n      const cw = cellWidth\n      const ch = cellHeight\n      const c2w = cellWidth / 2\n      const c2h = cellHeight / 2\n\n      // http://www.fileformat.info/info/unicode/block/block_elements/utf8test.htm\n      //         0x00  0x01  0x02  0x03  0x04  0x05  0x06  0x07  0x08  0x09  0x0A  0x0B  0x0C  0x0D  0x0E  0x0F\n      // 0x2580     ▀     ▁     ▂     ▃     ▄     ▅     ▆     ▇     █     ▉     ▊     ▋     ▌     ▍     ▎     ▏\n      // 0x2590     ▐     ░     ▒     ▓     ▔     ▕     ▖     ▗     ▘     ▙     ▚     ▛     ▜     ▝     ▞     ▟\n\n      if (codePoint === 0x2580) {\n        // upper half block >▀<\n        ctx.rect(left, top, cw, c2h)\n      } else if (codePoint <= 0x2588) {\n        // lower n eighth block (increasing) >▁< to >█<\n        let offset = (1 - (codePoint - 0x2580) / 8) * ch\n        ctx.rect(left, top + offset, cw, ch - offset)\n      } else if (codePoint <= 0x258F) {\n        // left n eighth block (decreasing) >▉< to >▏<\n        let offset = (codePoint - 0x2588) / 8 * cw\n        ctx.rect(left, top, cw - offset, ch)\n      } else if (codePoint === 0x2590) {\n        // right half block >▐<\n        ctx.rect(left + c2w, top, c2w, ch)\n      } else if (codePoint <= 0x2593) {\n        // shading >░< >▒< >▓<\n\n        // dot spacing by dividing cell size by a constant. This could be\n        // reworked to always return a whole number, but that would require\n        // prime factorization, and doing that without a loop would let you\n        // take over the world, which is not within the scope of this project.\n        let dotSpacingX, dotSpacingY, dotSize\n        if (codePoint === 0x2591) {\n          dotSpacingX = cw / 4\n          dotSpacingY = ch / 10\n          dotSize = 1\n        } else if (codePoint === 0x2592) {\n          dotSpacingX = cw / 6\n          dotSpacingY = cw / 10\n          dotSize = 1\n        } else if (codePoint === 0x2593) {\n          dotSpacingX = cw / 4\n          dotSpacingY = cw / 7\n          dotSize = 2\n        }\n\n        let alignRight = false\n        for (let dy = 0; dy < ch; dy += dotSpacingY) {\n          for (let dx = 0; dx < cw; dx += dotSpacingX) {\n            // prevent overflow\n            let dotSizeY = Math.min(dotSize, ch - dy)\n            ctx.rect(left + (alignRight ? cw - dx - dotSize : dx), top + dy, dotSize, dotSizeY)\n          }\n          alignRight = !alignRight\n        }\n      } else if (codePoint === 0x2594) {\n        // upper one eighth block >▔<\n        ctx.rect(left, top, cw, ch / 8)\n      } else if (codePoint === 0x2595) {\n        // right one eighth block >▕<\n        ctx.rect(left + (7 / 8) * cw, top, cw / 8, ch)\n      } else if (codePoint === 0x2596) {\n        // left bottom quadrant >▖<\n        ctx.rect(left, top + c2h, c2w, c2h)\n      } else if (codePoint === 0x2597) {\n        // right bottom quadrant >▗<\n        ctx.rect(left + c2w, top + c2h, c2w, c2h)\n      } else if (codePoint === 0x2598) {\n        // left top quadrant >▘<\n        ctx.rect(left, top, c2w, c2h)\n      } else if (codePoint === 0x2599) {\n        // left chair >▙<\n        ctx.rect(left, top, c2w, ch)\n        ctx.rect(left + c2w, top + c2h, c2w, c2h)\n      } else if (codePoint === 0x259A) {\n        // quadrants lt rb >▚<\n        ctx.rect(left, top, c2w, c2h)\n        ctx.rect(left + c2w, top + c2h, c2w, c2h)\n      } else if (codePoint === 0x259B) {\n        // left chair upside down >▛<\n        ctx.rect(left, top, c2w, ch)\n        ctx.rect(left + c2w, top, c2w, c2h)\n      } else if (codePoint === 0x259C) {\n        // right chair upside down >▜<\n        ctx.rect(left, top, cw, c2h)\n        ctx.rect(left + c2w, top + c2h, c2w, c2h)\n      } else if (codePoint === 0x259D) {\n        // right top quadrant >▝<\n        ctx.rect(left + c2w, top, c2w, c2h)\n      } else if (codePoint === 0x259E) {\n        // quadrants lb rt >▞<\n        ctx.rect(left, top + c2h, c2w, c2h)\n        ctx.rect(left + c2w, top, c2w, c2h)\n      } else if (codePoint === 0x259F) {\n        // right chair upside down >▟<\n        ctx.rect(left, top + c2h, c2w, c2h)\n        ctx.rect(left + c2w, top, c2w, ch)\n      }\n\n      ctx.fill()\n    } else if (codePoint >= 0xE0B0 && codePoint <= 0xE0B3) {\n      // powerline symbols, except branch, line, and lock. Basically, just the triangles\n      ctx.beginPath()\n\n      if (codePoint === 0xE0B0 || codePoint === 0xE0B1) {\n        // right-pointing triangle\n        ctx.moveTo(screenX, screenY)\n        ctx.lineTo(screenX + cellWidth, screenY + cellHeight / 2)\n        ctx.lineTo(screenX, screenY + cellHeight)\n      } else if (codePoint === 0xE0B2 || codePoint === 0xE0B3) {\n        // left-pointing triangle\n        ctx.moveTo(screenX + cellWidth, screenY)\n        ctx.lineTo(screenX, screenY + cellHeight / 2)\n        ctx.lineTo(screenX + cellWidth, screenY + cellHeight)\n      }\n\n      if (codePoint % 2 === 0) {\n        // triangle\n        ctx.fill()\n      } else {\n        // chevron\n        ctx.strokeStyle = ctx.fillStyle\n        ctx.stroke()\n      }\n    } else {\n      // Draw other characters using the text renderer\n      ctx.fillText(text, screenX + 0.5 * cellWidth, screenY + 0.5 * cellHeight)\n    }\n\n    // -- line drawing - a reference for a possible future rect/line implementation ---\n    // http://www.fileformat.info/info/unicode/block/box_drawing/utf8test.htm\n    //         0x00  0x01  0x02  0x03  0x04  0x05  0x06  0x07  0x08  0x09  0x0A  0x0B  0x0C  0x0D  0x0E  0x0F\n    // 0x2500     ─     ━     │     ┃     ┄     ┅     ┆     ┇     ┈     ┉     ┊     ┋     ┌     ┍     ┎     ┏\n    // 0x2510     ┐     ┑     ┒     ┓     └     ┕     ┖     ┗     ┘     ┙     ┚     ┛     ├     ┝     ┞     ┟\n    // 0x2520     ┠     ┡     ┢     ┣     ┤     ┥     ┦     ┧     ┨     ┩     ┪     ┫     ┬     ┭     ┮     ┯\n    // 0x2530     ┰     ┱     ┲     ┳     ┴     ┵     ┶     ┷     ┸     ┹     ┺     ┻     ┼     ┽     ┾     ┿\n    // 0x2540     ╀     ╁     ╂     ╃     ╄     ╅     ╆     ╇     ╈     ╉     ╊     ╋     ╌     ╍     ╎     ╏\n    // 0x2550     ═     ║     ╒     ╓     ╔     ╕     ╖     ╗     ╘     ╙     ╚     ╛     ╜     ╝     ╞     ╟\n    // 0x2560     ╠     ╡     ╢     ╣     ╤     ╥     ╦     ╧     ╨     ╩     ╪     ╫     ╬     ╭     ╮     ╯\n    // 0x2570     ╰     ╱     ╲     ╳     ╴     ╵     ╶     ╷     ╸     ╹     ╺     ╻     ╼     ╽     ╾     ╿\n\n    if (underline || strike || overline) {\n      ctx.strokeStyle = this.getColor(fg)\n      ctx.lineWidth = 1\n      ctx.lineCap = 'round'\n      ctx.beginPath()\n\n      if (underline) {\n        let lineY = Math.round(screenY + charSize.height) + 0.5\n        ctx.moveTo(screenX, lineY)\n        ctx.lineTo(screenX + cellWidth, lineY)\n      }\n\n      if (strike) {\n        let lineY = Math.round(screenY + 0.5 * cellHeight) + 0.5\n        ctx.moveTo(screenX, lineY)\n        ctx.lineTo(screenX + cellWidth, lineY)\n      }\n\n      if (overline) {\n        let lineY = Math.round(screenY) + 0.5\n        ctx.moveTo(screenX, lineY)\n        ctx.lineTo(screenX + cellWidth, lineY)\n      }\n\n      ctx.stroke()\n    }\n\n    if (this.screenLines[y]) ctx.restore()\n\n    ctx.globalAlpha = 1\n  }\n\n  /**\n   * Returns all adjacent cell indices given a radius.\n   * @param {number} cell - the center cell index\n   * @param {number} [radius] - the radius. 1 by default\n   * @returns {number[]} an array of cell indices\n   */\n  getAdjacentCells (cell, radius = 1) {\n    const { width, height } = this\n    const screenLength = width * height\n\n    let cells = []\n\n    for (let x = -radius; x <= radius; x++) {\n      for (let y = -radius; y <= radius; y++) {\n        if (x === 0 && y === 0) continue\n        cells.push(cell + x + y * width)\n      }\n    }\n\n    return cells.filter(cell => cell >= 0 && cell < screenLength)\n  }\n\n  /**\n   * Updates the screen.\n   * @param {string} why - the draw reason (for debugging)\n   */\n  draw (why) {\n    const ctx = this.ctx\n    const {\n      width,\n      height,\n      devicePixelRatio,\n      statusScreen\n    } = this\n\n    if (statusScreen) {\n      // draw status screen instead\n      this.drawStatus(statusScreen)\n      this.startDrawLoop()\n      return\n    } else this.stopDrawLoop()\n\n    const charSize = this.charSize\n    const { width: cellWidth, height: cellHeight } = this.cellSize\n    const screenLength = width * height\n\n    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0)\n\n    if (this.debug && this._debug) this._debug.drawStart(why)\n\n    ctx.font = this.fonts[0]\n    ctx.textAlign = 'center'\n    ctx.textBaseline = 'middle'\n\n    // bits in the attr value that affect the font\n    const FONT_MASK = ATTR_BOLD | ATTR_ITALIC\n\n    // Map of (attrs & FONT_MASK) -> Array of cell indices\n    let fontGroups = new Map()\n\n    // Map of (cell index) -> boolean, whether or not a cell has updated\n    let updateMap = new Map()\n\n    for (let cell = 0; cell < screenLength; cell++) {\n      let x = cell % width\n      let y = Math.floor(cell / width)\n      let isCursor = this.cursorBlinkOn &&\n        this.cursor.x === x &&\n        this.cursor.y === y &&\n        this.cursor.visible\n\n      let wasCursor = x === this.drawnCursor[0] && y === this.drawnCursor[1]\n\n      let text = this.screen[cell]\n      let fg = this.screenFG[cell] | 0\n      let bg = this.screenBG[cell] | 0\n      let attrs = this.screenAttrs[cell] | 0\n      let inSelection = this.screenSelection[cell]\n\n      let isDefaultBG = false\n\n      if (!(attrs & ATTR_FG)) fg = this.defaultFG\n      if (!(attrs & ATTR_BG)) {\n        bg = this.defaultBG\n        isDefaultBG = true\n      }\n\n      if (attrs & ATTR_INVERSE) [fg, bg] = [bg, fg] // swap - reversed character colors\n      if (this.reverseVideo) [fg, bg] = [bg, fg] // swap - reversed all screen\n\n      if (attrs & ATTR_BLINK && !this.blinkStyleOn) {\n        // blinking is enabled and blink style is off\n        // set text to nothing so drawCharacter only draws decoration\n        text = ' '\n      }\n\n      if (inSelection) {\n        fg = -1\n        bg = -2\n      }\n\n      let didUpdate = text !== this.drawnScreen[cell] || // text updated\n        fg !== this.drawnScreenFG[cell] || // foreground updated, and this cell has text\n        bg !== this.drawnScreenBG[cell] || // background updated\n        attrs !== this.drawnScreenAttrs[cell] || // attributes updated\n        this.screenLines[y] !== this.drawnScreenLines[y] || // line updated\n        // TODO: fix artifacts or keep this hack:\n        isCursor || wasCursor || // cursor blink/position updated\n        (isCursor && this.cursor.style !== this.drawnCursor[2]) || // cursor style updated\n        (isCursor && this.cursor.hanging !== this.drawnCursor[3]) // cursor hanging updated\n\n      let font = attrs & FONT_MASK\n      if (!fontGroups.has(font)) fontGroups.set(font, [])\n\n      fontGroups.get(font).push({ cell, x, y, text, fg, bg, attrs, isCursor, inSelection, isDefaultBG })\n      updateMap.set(cell, didUpdate)\n    }\n\n    // set drawn screen lines\n    this.drawnScreenLines = this.screenLines.slice()\n\n    let debugFilledUpdates = []\n\n    if (this.graphics >= 1) {\n      // fancy graphics gets really slow when there's a lot of masks\n      // so here's an algorithm that fills in holes in the update map\n\n      for (let cell of updateMap.keys()) {\n        if (updateMap.get(cell)) continue\n        let previous = updateMap.get(cell - 1) || false\n        let next = updateMap.get(cell + 1) || false\n\n        if (previous && next) {\n          // set cell to true of horizontally adjacent updated\n          updateMap.set(cell, true)\n          if (this.debug && this._debug) debugFilledUpdates.push(cell)\n        }\n      }\n    }\n\n    // Map of (cell index) -> boolean, whether or not a cell should be redrawn\n    const redrawMap = new Map()\n    const maskedCells = new Map()\n\n    let isTextWide = text =>\n      text !== ' ' && ctx.measureText(text).width >= (cellWidth + 0.05)\n\n    // decide for each cell if it should be redrawn\n    for (let cell of updateMap.keys()) {\n      let shouldUpdate = updateMap.get(cell) || redrawMap.get(cell) || false\n\n      // TODO: fonts (necessary?)\n      let text = this.screen[cell]\n      let isWideCell = isTextWide(text)\n      let checkRadius = isWideCell ? 2 : 1\n\n      if (!shouldUpdate) {\n        // check adjacent cells\n        let adjacentDidUpdate = false\n\n        for (let adjacentCell of this.getAdjacentCells(cell, checkRadius)) {\n          // update this cell if:\n          // - the adjacent cell updated (For now, this'll always be true because characters can be slightly larger than they say they are)\n          // - the adjacent cell updated and this cell or the adjacent cell is wide\n          // - this or the adjacent cell is not double-sized\n          if (updateMap.get(adjacentCell) &&\n              (this.graphics < 2 || isWideCell || isTextWide(this.screen[adjacentCell])) &&\n              (!this.screenLines[Math.floor(cell / this.width)] && !this.screenLines[Math.floor(adjacentCell / this.width)])) {\n            adjacentDidUpdate = true\n\n            if (this.getAdjacentCells(cell, 1).includes(adjacentCell)) {\n              // this is within a radius of 1, therefore this cell should be included in the mask as well\n              maskedCells.set(cell, true)\n            }\n            break\n          }\n        }\n\n        if (adjacentDidUpdate) shouldUpdate = true\n      }\n\n      if (updateMap.get(cell)) {\n        // this was updated, it should definitely be included in the mask\n        maskedCells.set(cell, true)\n      }\n\n      redrawMap.set(cell, shouldUpdate)\n    }\n\n    // mask to masked regions only\n    if (this.graphics >= 1) {\n      // TODO: include padding in border cells\n      const padding = this.padding\n\n      let regions = []\n\n      for (let y = 0; y < height; y++) {\n        let regionStart = null\n        for (let x = 0; x < width; x++) {\n          let cell = y * width + x\n          let masked = maskedCells.get(cell)\n          if (masked && regionStart === null) regionStart = x\n          if (!masked && regionStart !== null) {\n            regions.push([regionStart, y, x, y + 1])\n            regionStart = null\n          }\n        }\n        if (regionStart !== null) {\n          regions.push([regionStart, y, width, y + 1])\n        }\n      }\n\n      // join regions if possible (O(n^2-1), sorry)\n      let i = 0\n      while (i < regions.length) {\n        let region = regions[i]\n        let j = 0\n        while (j < regions.length) {\n          let other = regions[j]\n          if (other === region) {\n            j++\n            continue\n          }\n          if (other[0] === region[0] && other[2] === region[2] && other[3] === region[1]) {\n            region[1] = other[1]\n            regions.splice(j, 1)\n            if (i > j) i--\n            j--\n          }\n          j++\n        }\n        i++\n      }\n\n      ctx.save()\n      ctx.beginPath()\n      for (let region of regions) {\n        let [regionStart, y, endX, endY] = region\n        let rectX = padding + regionStart * cellWidth\n        let rectY = padding + y * cellHeight\n        let rectWidth = (endX - regionStart) * cellWidth\n        let rectHeight = (endY - y) * cellHeight\n\n        // compensate for padding\n        if (regionStart === 0) {\n          rectX -= padding\n          rectWidth += padding\n        }\n        if (y === 0) {\n          rectY -= padding\n          rectHeight += padding\n        }\n        if (endX === width - 1) rectWidth += padding\n        if (y === height - 1) rectHeight += padding\n\n        ctx.rect(rectX, rectY, rectWidth, rectHeight)\n      }\n      ctx.clip()\n    }\n\n    // pass 1: backgrounds\n    for (let font of fontGroups.keys()) {\n      for (let data of fontGroups.get(font)) {\n        let { cell, x, y, text, bg, isDefaultBG } = data\n\n        if (redrawMap.get(cell)) {\n          this.drawBackground({ x, y, cellWidth, cellHeight, bg, isDefaultBG })\n\n          if (this.debug) {\n            // set cell flags\n            let flags = (+redrawMap.get(cell))\n            flags |= (+updateMap.get(cell)) << 1\n            flags |= (+maskedCells.get(cell)) << 2\n            flags |= (+isTextWide(text)) << 3\n            flags |= (+debugFilledUpdates.includes(cell)) << 4\n            this._debug.setCell(cell, flags)\n          }\n        }\n      }\n    }\n\n    // reset drawn cursor\n    this.drawnCursor = [-1, -1, '', false]\n\n    // pass 2: characters\n    for (let font of fontGroups.keys()) {\n      // set font once because in Firefox, this is a really slow action for some\n      // reason\n      let fontIndex = 0\n      if (font & ATTR_BOLD) fontIndex |= 1\n      if (font & ATTR_ITALIC) fontIndex |= 2\n      ctx.font = this.fonts[fontIndex]\n\n      for (let data of fontGroups.get(font)) {\n        let { cell, x, y, text, fg, bg, attrs, isCursor, inSelection } = data\n\n        if (redrawMap.get(cell)) {\n          this.drawCharacter({\n            x, y, charSize, cellWidth, cellHeight, text, fg, attrs\n          })\n\n          this.drawnScreen[cell] = text\n          this.drawnScreenFG[cell] = fg\n          this.drawnScreenBG[cell] = bg\n          this.drawnScreenAttrs[cell] = attrs\n\n          if (isCursor) this.drawnCursor = [x, y, this.cursor.style, this.cursor.hanging]\n\n          // draw cursor\n          if (isCursor && !inSelection) {\n            ctx.save()\n            ctx.beginPath()\n\n            let cursorX = x\n            let cursorY = y\n            let cursorWidth = cellWidth // JS doesn't allow same-name assignment\n\n            if (this.cursor.hanging) {\n              // draw hanging cursor in the margin\n              cursorX += 1\n            }\n\n            // double-width lines\n            if (this.screenLines[cursorY] & 0b001) cursorWidth *= 2\n\n            let screenX = cursorX * cursorWidth + this.padding\n            let screenY = cursorY * cellHeight + this.padding\n\n            if (this.cursor.style === 'block') {\n              // block\n              ctx.rect(screenX, screenY, cursorWidth, cellHeight)\n            } else if (this.cursor.style === 'bar') {\n              // vertical bar\n              let barWidth = 2\n              ctx.rect(screenX, screenY, barWidth, cellHeight)\n            } else if (this.cursor.style === 'line') {\n              // underline\n              let lineHeight = 2\n              ctx.rect(screenX, screenY + charSize.height, cursorWidth, lineHeight)\n            }\n            ctx.clip()\n\n            // swap foreground/background\n            ;[fg, bg] = [bg, fg]\n\n            // HACK: ensure cursor is visible\n            if (fg === bg) bg = fg === 0 ? 7 : 0\n\n            this.drawBackground({ x: cursorX, y: cursorY, cellWidth, cellHeight, bg })\n            this.drawCharacter({\n              x: cursorX, y: cursorY, charSize, cellWidth, cellHeight, text, fg, attrs\n            })\n            ctx.restore()\n          }\n        }\n      }\n    }\n\n    if (this.graphics >= 1) ctx.restore()\n\n    if (this.debug && this._debug) this._debug.drawEnd()\n\n    this.emit('draw', why)\n  }\n\n  drawStatus (statusScreen) {\n    const { ctx, width, height, devicePixelRatio } = this\n\n    // reset drawnScreen to force redraw when statusScreen is disabled\n    this.drawnScreen = []\n\n    const cellSize = this.cellSize\n    const screenWidth = width * cellSize.width + 2 * this.padding\n    const screenHeight = height * cellSize.height + 2 * this.padding\n\n    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0)\n    ctx.fillStyle = this.getColor(this.defaultBG)\n    ctx.fillRect(0, 0, screenWidth, screenHeight)\n\n    ctx.font = `24px ${this.statusFont}`\n    ctx.fillStyle = this.getColor(this.defaultFG)\n    ctx.textAlign = 'center'\n    ctx.textBaseline = 'middle'\n    ctx.fillText(statusScreen.title || '', screenWidth / 2, screenHeight / 2 - 50)\n\n    if (statusScreen.loading) {\n      // show loading spinner\n      ctx.save()\n      ctx.translate(screenWidth / 2, screenHeight / 2 + 20)\n\n      ctx.strokeStyle = this.getColor(this.defaultFG)\n      ctx.lineWidth = 5\n      ctx.lineCap = 'round'\n\n      let t = Date.now() / 1000\n\n      for (let i = 0; i < 12; i++) {\n        ctx.rotate(Math.PI / 6)\n        let offset = ((t * 12) - i) % 12\n        ctx.globalAlpha = Math.max(0.2, 1 - offset / 3)\n        ctx.beginPath()\n        ctx.moveTo(0, 15)\n        ctx.lineTo(0, 30)\n        ctx.stroke()\n      }\n\n      ctx.restore()\n    }\n  }\n\n  startDrawLoop () {\n    if (this._drawTimerThread) return\n    let threadID = Math.random().toString(36)\n    this._drawTimerThread = threadID\n    this.drawTimerLoop(threadID)\n  }\n\n  stopDrawLoop () {\n    this._drawTimerThread = null\n  }\n\n  drawTimerLoop (threadID) {\n    if (!threadID || threadID !== this._drawTimerThread) return\n    window.requestAnimationFrame(() => this.drawTimerLoop(threadID))\n    this.draw('draw-loop')\n  }\n\n  /**\n   * Converts an alphabetic character to its fraktur variant.\n   * @param {string} character - the character\n   * @returns {string} the converted character\n   */\n  static alphaToFraktur (character) {\n    if (character >= 'a' && character <= 'z') {\n      character = String.fromCodePoint(0x1d51e - 0x61 + character.charCodeAt(0))\n    } else if (character >= 'A' && character <= 'Z') {\n      character = frakturExceptions[character] || String.fromCodePoint(0x1d504 - 0x41 + character.charCodeAt(0))\n    }\n    return character\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/screen_renderer.js","const EventEmitter = require('events')\nconst $ = require('../lib/chibi')\nlet demo\ntry { demo = require('./demo') } catch (err) {}\n\nconst RECONN_DELAY = 2000\nconst HEARTBEAT_TIME = 3000\nconst HTTPS = window.location.protocol.match(/s:/)\n\n/** Handle connections */\nmodule.exports = class TermConnection extends EventEmitter {\n  constructor (screen) {\n    super()\n\n    this.screen = screen\n    this.ws = null\n    this.heartbeatTimeout = null\n    this.pingInterval = null\n    this.xoff = false\n    this.autoXoffTimeout = null\n    this.reconnTimeout = null\n    this.forceClosing = false\n    this.queue = []\n\n    try {\n      this.blobReader = new window.FileReader()\n      this.blobReader.onload = (evt) => {\n        this.onDecodedWSMessage(this.blobReader.result)\n      }\n      this.blobReader.onerror = (evt) => {\n        console.error(evt)\n      }\n    } catch (e) {\n      this.blobReader = null\n    }\n\n    this.pageShown = false\n\n    this.disconnectTimeout = null\n\n    document.addEventListener('visibilitychange', () => {\n      if (document.hidden === true) {\n        console.info('Window lost focus, freeing socket')\n        // Delayed, avoid disconnecting if the background time is short\n        this.disconnectTimeout = setTimeout(() => {\n          this.closeSocket()\n          clearTimeout(this.heartbeatTimeout)\n        }, 1000)\n      } else {\n        clearTimeout(this.disconnectTimeout)\n        console.info('Window got focus, re-connecting')\n        this.init()\n      }\n    }, false)\n  }\n\n  onWSOpen (evt) {\n    console.log('CONNECTED')\n    this.heartbeat()\n    this.send('i')\n    this.forceClosing = false\n\n    this.emit('connect')\n  }\n\n  onWSClose (evt) {\n    if (this.forceClosing) {\n      this.forceClosing = false\n      return\n    }\n    console.warn('SOCKET CLOSED, code ' + evt.code + '. Reconnecting...')\n    if (evt.code < 1000) {\n      console.error('Bad code from socket!')\n      // this sometimes happens for unknown reasons, code < 1000 is invalid\n      // location.reload()\n    }\n\n    clearTimeout(this.reconnTimeout)\n    this.reconnTimeout = setTimeout(() => this.init(), RECONN_DELAY)\n\n    this.emit('disconnect', evt.code)\n  }\n\n  onDecodedWSMessage (str) {\n    switch (str.charAt(0)) {\n      case '.':\n        // heartbeat, no-op message\n        break\n\n      case '-':\n        // console.log('xoff');\n        this.xoff = true\n        this.autoXoffTimeout = setTimeout(() => {\n          this.xoff = false\n          this.flushQueue()\n        }, 250)\n        break\n\n      case '+':\n        // console.log('xon');\n        this.xoff = false\n        this.flushQueue()\n        clearTimeout(this.autoXoffTimeout)\n        break\n\n      default:\n        this.screen.load(str)\n        if (!this.pageShown) {\n          window.showPage()\n          this.pageShown = true\n        }\n        break\n    }\n    this.heartbeat()\n  }\n\n  onWSMessage (evt) {\n    if (typeof evt.data === 'string') this.onDecodedWSMessage(evt.data)\n    else {\n      if (!this.blobReader) {\n        console.error('No FileReader!')\n        return\n      }\n\n      if (this.blobReader.readyState !== 1) {\n        this.blobReader.readAsText(evt.data)\n      } else {\n        setTimeout(() => {\n          this.onWSMessage(evt)\n        }, 1)\n      }\n    }\n  }\n\n  canSend () {\n    return !this.xoff\n  }\n\n  send (message) {\n    if (window._demo) {\n      if (typeof window.demoInterface !== 'undefined') {\n        demo.input(message)\n      } else {\n        console.log(`TX: ${JSON.stringify(message)}`)\n      }\n      return true // Simulate success\n    }\n    if (this.xoff) {\n      console.log(\"Can't send, flood control. Queueing\")\n      this.queue.push(message)\n      return false\n    }\n\n    if (!this.ws) return false // for dry testing\n    if (this.ws.readyState !== 1) {\n      console.error('Socket not ready')\n      return false\n    }\n    if (typeof message !== 'string') {\n      message = JSON.stringify(message)\n    }\n    this.ws.send(message)\n    return true\n  }\n\n  flushQueue () {\n    console.log('Flushing input queue')\n    for (let message of this.queue) this.send(message)\n    this.queue = []\n  }\n\n  /** Safely close the socket */\n  closeSocket () {\n    if (this.ws) {\n      this.forceClosing = true\n      if (this.ws.readyState === 1) this.ws.close()\n      this.ws = null\n    }\n  }\n\n  init () {\n    if (window._demo) {\n      if (typeof window.demoInterface === 'undefined') {\n        window.alert('Demoing non-demo build!') // this will catch mistakes when deploying to the website\n      } else {\n        demo.init(this.screen)\n      }\n      return\n    }\n\n    clearTimeout(this.reconnTimeout)\n    clearTimeout(this.heartbeatTimeout)\n\n    this.closeSocket()\n\n    this.ws = new window.WebSocket(`${HTTPS ? 'wss' : 'ws'}://${window._root}/term/update.ws`)\n    this.ws.addEventListener('open', (...args) => this.onWSOpen(...args))\n    this.ws.addEventListener('close', (...args) => this.onWSClose(...args))\n    this.ws.addEventListener('message', (...args) => this.onWSMessage(...args))\n    console.log('Opening socket.')\n    this.heartbeat()\n\n    this.emit('open')\n  }\n\n  heartbeat () {\n    this.emit('heartbeat')\n    clearTimeout(this.heartbeatTimeout)\n    this.heartbeatTimeout = setTimeout(() => this.onHeartbeatFail(), HEARTBEAT_TIME)\n  }\n\n  sendPing () {\n    console.log('> ping')\n    this.emit('ping')\n    $.get(`${HTTPS ? 'https' : 'http'}://${window._root}/api/v1/ping`, (resp, status) => {\n      if (status === 200) {\n        clearInterval(this.pingInterval)\n        console.info('Server ready, opening socket…')\n        this.emit('ping-success')\n        this.init()\n        // location.reload()\n      } else this.emit('ping-fail', status)\n    }, {\n      timeout: 100,\n      loader: false // we have loader on-screen\n    })\n  }\n\n  onHeartbeatFail () {\n    this.closeSocket()\n    this.emit('silence')\n    console.error('Heartbeat lost, probing server...')\n    clearInterval(this.pingInterval)\n    this.pingInterval = setInterval(() => { this.sendPing() }, 1000)\n\n    // first ping, if this gets through, it'll will reduce delay\n    setTimeout(() => { this.sendPing() }, 200)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/connection.js","const { encode2B } = require('../utils')\n\n/**\n * User input\n *\n * --- Rx messages: ---\n * S - screen content (binary encoding of the entire screen with simple compression)\n * T - text labels - Title and buttons, \\0x01-separated\n * B - beep\n * . - heartbeat\n *\n * --- Tx messages ---\n * s - string\n * b - action button\n * p - mb press\n * r - mb release\n * m - mouse move\n */\nmodule.exports = function (conn, screen) {\n  // handle for input object\n  let input\n\n  const KEY_NAMES = {\n    0x03: 'Cancel',\n    0x06: 'Help',\n    0x08: 'Backspace',\n    0x09: 'Tab',\n    0x0C: 'Clear',\n    0x0D: 'Enter',\n    0x10: 'Shift',\n    0x11: 'Control',\n    0x12: 'Alt',\n    0x13: 'Pause',\n    0x14: 'CapsLock',\n    0x1B: 'Escape',\n    0x20: ' ',\n    0x21: 'PageUp',\n    0x22: 'PageDown',\n    0x23: 'End',\n    0x24: 'Home',\n    0x25: 'ArrowLeft',\n    0x26: 'ArrowUp',\n    0x27: 'ArrowRight',\n    0x28: 'ArrowDown',\n    0x29: 'Select',\n    0x2A: 'Print',\n    0x2B: 'Execute',\n    0x2C: 'PrintScreen',\n    0x2D: 'Insert',\n    0x2E: 'Delete',\n    0x3A: ':',\n    0x3B: ';',\n    0x3C: '<',\n    0x3D: '=',\n    0x3E: '>',\n    0x3F: '?',\n    0x40: '@',\n    0x5B: 'Meta',\n    0x5C: 'Meta',\n    0x5D: 'ContextMenu',\n    0x6A: 'Numpad*',\n    0x6B: 'Numpad+',\n    0x6D: 'Numpad-',\n    0x6E: 'Numpad.',\n    0x6F: 'Numpad/',\n    0x90: 'NumLock',\n    0x91: 'ScrollLock',\n    0xA0: '^',\n    0xA1: '!',\n    0xA2: '\"',\n    0xA3: '#',\n    0xA4: '$',\n    0xA5: '%',\n    0xA6: '&',\n    0xA7: '_',\n    0xA8: '(',\n    0xA9: ')',\n    0xAA: '*',\n    0xAB: '+',\n    0xAC: '|',\n    0xAD: '-',\n    0xAE: '{',\n    0xAF: '}',\n    0xB0: '~',\n    0xBA: ';',\n    0xBB: '=',\n    0xBC: 'Numpad,',\n    0xBD: '-',\n    0xBE: 'Numpad,',\n    0xC0: '`',\n    0xC2: 'Numpad,',\n    0xDB: '[',\n    0xDC: '\\\\',\n    0xDD: ']',\n    0xDE: \"'\",\n    0xE0: 'Meta'\n  }\n  // numbers 0-9\n  for (let i = 0x30; i <= 0x39; i++) KEY_NAMES[i] = String.fromCharCode(i)\n  // characters A-Z\n  for (let i = 0x41; i <= 0x5A; i++) KEY_NAMES[i] = String.fromCharCode(i)\n  // function F1-F20\n  for (let i = 0x70; i <= 0x83; i++) KEY_NAMES[i] = `F${i - 0x70 + 1}`\n  // numpad 0-9\n  for (let i = 0x60; i <= 0x69; i++) KEY_NAMES[i] = `Numpad${i - 0x60}`\n\n  let cfg = {\n    np_alt: false,    // Application Numpad Mode\n    cu_alt: false,    // Application Cursors Mode\n    fn_alt: false,    // SS3 function keys mode\n    mt_click: false,  // Mouse click tracking\n    mt_move: false,   // Mouse move tracking\n    no_keys: false,   // Suppress any key / clipboard event intercepting\n    crlf_mode: false, // Enter sends CR LF\n    all_fn: false     // Capture also F5, F11 and F12\n  }\n\n  /** Fn alt choice for key message */\n  const fa = (alt, normal) => cfg.fn_alt ? alt : normal\n\n  /** Cursor alt choice for key message */\n  const ca = (alt, normal) => cfg.cu_alt ? alt : normal\n\n  /** Numpad alt choice for key message */\n  const na = (alt, normal) => cfg.np_alt ? alt : normal\n\n  const keymap = {\n    /* eslint-disable key-spacing */\n    'Backspace':     '\\x08',\n    'Tab':           '\\x09',\n    'Enter':         () => cfg.crlf_mode ? '\\x0d\\x0a' : '\\x0d',\n    'Control+Enter': '\\x0a',\n    'Escape':        '\\x1b',\n    'ArrowUp':       () => ca('\\x1bOA', '\\x1b[A'),\n    'ArrowDown':     () => ca('\\x1bOB', '\\x1b[B'),\n    'ArrowRight':    () => ca('\\x1bOC', '\\x1b[C'),\n    'ArrowLeft':     () => ca('\\x1bOD', '\\x1b[D'),\n    'Home':          () => ca('\\x1bOH', fa('\\x1b[H', '\\x1b[1~')),\n    'Insert':        '\\x1b[2~',\n    'Delete':        '\\x1b[3~',\n    'End':           () => ca('\\x1bOF', fa('\\x1b[F', '\\x1b[4~')),\n    'PageUp':        '\\x1b[5~',\n    'PageDown':      '\\x1b[6~',\n    'F1':            () => fa('\\x1bOP', '\\x1b[11~'),\n    'F2':            () => fa('\\x1bOQ', '\\x1b[12~'),\n    'F3':            () => fa('\\x1bOR', '\\x1b[13~'),\n    'F4':            () => fa('\\x1bOS', '\\x1b[14~'),\n    'F5':            '\\x1b[15~', // note the disconnect\n    'F6':            '\\x1b[17~',\n    'F7':            '\\x1b[18~',\n    'F8':            '\\x1b[19~',\n    'F9':            '\\x1b[20~',\n    'F10':           '\\x1b[21~', // note the disconnect\n    'F11':           '\\x1b[23~',\n    'F12':           '\\x1b[24~',\n    'Shift+F1':      () => fa('\\x1bO1;2P', '\\x1b[25~'),\n    'Shift+F2':      () => fa('\\x1bO1;2Q', '\\x1b[26~'), // note the disconnect\n    'Shift+F3':      () => fa('\\x1bO1;2R', '\\x1b[28~'),\n    'Shift+F4':      () => fa('\\x1bO1;2S', '\\x1b[29~'), // note the disconnect\n    'Shift+F5':      () => fa('\\x1b[15;2~', '\\x1b[31~'),\n    'Shift+F6':      () => fa('\\x1b[17;2~', '\\x1b[32~'),\n    'Shift+F7':      () => fa('\\x1b[18;2~', '\\x1b[33~'),\n    'Shift+F8':      () => fa('\\x1b[19;2~', '\\x1b[34~'),\n    'Shift+F9':      () => fa('\\x1b[20;2~', '\\x1b[35~'), // 35-38 are not standard - but what is?\n    'Shift+F10':     () => fa('\\x1b[21;2~', '\\x1b[36~'),\n    'Shift+F11':     () => fa('\\x1b[22;2~', '\\x1b[37~'),\n    'Shift+F12':     () => fa('\\x1b[23;2~', '\\x1b[38~'),\n    'Numpad0':       () => na('\\x1bOp', '0'),\n    'Numpad1':       () => na('\\x1bOq', '1'),\n    'Numpad2':       () => na('\\x1bOr', '2'),\n    'Numpad3':       () => na('\\x1bOs', '3'),\n    'Numpad4':       () => na('\\x1bOt', '4'),\n    'Numpad5':       () => na('\\x1bOu', '5'),\n    'Numpad6':       () => na('\\x1bOv', '6'),\n    'Numpad7':       () => na('\\x1bOw', '7'),\n    'Numpad8':       () => na('\\x1bOx', '8'),\n    'Numpad9':       () => na('\\x1bOy', '9'),\n    'Numpad*':       () => na('\\x1bOR', '*'),\n    'Numpad+':       () => na('\\x1bOl', '+'),\n    'Numpad-':       () => na('\\x1bOS', '-'),\n    'Numpad.':       () => na('\\x1bOn', '.'),\n    'Numpad/':       () => na('\\x1bOQ', '/'),\n    // we don't implement numlock key (should change in numpad_alt mode,\n    // but it's even more useless than the rest and also has the side\n    // effect of changing the user's numlock state)\n\n    // shortcuts\n    'Control+]':  '\\x1b', // alternate way to enter ESC\n    'Control+\\\\': '\\x1c',\n    'Control+[':  '\\x1d',\n    'Control+^':  '\\x1e',\n    'Control+_':  '\\x1f',\n\n    // extra controls\n    'Control+ArrowLeft':  '\\x1f[1;5D',\n    'Control+ArrowRight': '\\x1f[1;5C',\n    'Control+ArrowUp':    '\\x1f[1;5A',\n    'Control+ArrowDown':  '\\x1f[1;5B',\n    'Control+Home':       '\\x1f[1;5H',\n    'Control+End':        '\\x1f[1;5F',\n\n    // extra shift controls\n    'Shift+ArrowLeft':    '\\x1f[1;2D',\n    'Shift+ArrowRight':   '\\x1f[1;2C',\n    'Shift+ArrowUp':      '\\x1f[1;2A',\n    'Shift+ArrowDown':    '\\x1f[1;2B',\n    'Shift+Home':         '\\x1f[1;2H',\n    'Shift+End':          '\\x1f[1;2F',\n\n    // macOS text editing commands\n    'Alt+ArrowLeft':      '\\x1bb',  // ⌥← to go back a word (^[b)\n    'Alt+ArrowRight':     '\\x1bf',  // ⌥→ to go forward one word (^[f)\n    'Meta+ArrowLeft':     '\\x01',   // ⌘← to go to the beginning of a line (^A)\n    'Meta+ArrowRight':    '\\x05',   // ⌘→ to go to the end of a line (^E)\n    'Alt+Backspace':      '\\x17',   // ⌥⌫ to delete a word (^W)\n    'Meta+Backspace':     '\\x15',   // ⌘⌫ to delete to the beginning of a line (^U)\n\n    // copy to clipboard\n    'Control+Shift+C' () {\n      screen.copySelectionToClipboard()\n    },\n    'Control+Insert' () {\n      screen.copySelectionToClipboard()\n    },\n\n    // toggle debug mode\n    'Control+F12' () {\n      screen.window.debug ^= 1\n    }\n    /* eslint-enable key-spacing */\n  }\n\n  // ctrl+[A-Z] sent as simple low ASCII codes\n  for (let i = 1; i <= 26; i++) {\n    keymap[`Control+${String.fromCharCode(0x40 + i)}`] = String.fromCharCode(i)\n  }\n\n  /** Send a literal message */\n  function sendString (str) {\n    return conn.send('s' + str)\n  }\n\n  /** Send a button event */\n  function sendButton (index) {\n    conn.send('b' + String.fromCharCode(index + 1))\n  }\n\n  const shouldAcceptEvent = function () {\n    if (cfg.no_keys) return false\n    if (document.activeElement instanceof window.HTMLTextAreaElement) return false\n    return true\n  }\n\n  const keyBlacklist = [\n    'F5', 'F11', 'F12', 'Shift+F5'\n  ]\n\n  let softModifiers = {\n    alt: false,\n    ctrl: false,\n    meta: false,\n    shift: false\n  }\n\n  const handleKeyDown = function (e) {\n    if (!shouldAcceptEvent()) return\n\n    let modifiers = []\n    // sorted alphabetically\n    if (e.altKey || softModifiers.alt) modifiers.push('Alt')\n    if (e.ctrlKey || softModifiers.ctrl) modifiers.push('Control')\n    if (e.metaKey || softModifiers.meta) modifiers.push('Meta')\n    if (e.shiftKey || softModifiers.shift) modifiers.push('Shift')\n\n    let key = KEY_NAMES[e.which] || e.key\n\n    // ignore clipboard events\n    if ((e.ctrlKey || e.metaKey) && key === 'V') return\n\n    let binding = null\n\n    for (let name in keymap) {\n      let itemModifiers = name.split('+')\n      let itemKey = itemModifiers.pop()\n\n      if (itemKey === key && itemModifiers.sort().join() === modifiers.join()) {\n        if (keyBlacklist.includes(name) && !cfg.all_fn) continue\n        binding = keymap[name]\n        break\n      }\n    }\n\n    if (binding) {\n      if (binding instanceof Function) binding = binding()\n      e.preventDefault()\n      if (typeof binding === 'string') {\n        sendString(binding)\n      }\n    }\n  }\n\n  /** Bind/rebind key messages */\n  function initKeys ({ allFn }) {\n    // This takes care of text characters typed\n    window.addEventListener('keypress', function (evt) {\n      if (!shouldAcceptEvent()) return\n      if (evt.ctrlKey || evt.metaKey) return\n\n      let str = ''\n      if (evt.key && evt.key.length === 1) str = evt.key\n      else if (evt.which && evt.which !== 229) str = String.fromCodePoint(evt.which)\n\n      if (str.length > 0 && str.charCodeAt(0) >= 32) {\n        // prevent space from scrolling\n        if (evt.which === 32) evt.preventDefault()\n        sendString(str)\n      }\n    })\n\n    window.addEventListener('keydown', handleKeyDown)\n    window.addEventListener('copy', e => {\n      if (!shouldAcceptEvent()) return\n      let selectedText = screen.getSelectedText()\n      if (selectedText) {\n        e.preventDefault()\n        e.clipboardData.setData('text/plain', selectedText)\n      }\n    })\n    window.addEventListener('paste', e => {\n      if (!shouldAcceptEvent()) return\n      e.preventDefault()\n      let string = e.clipboardData.getData('text/plain')\n      if (string.includes('\\n') || string.length > 90) {\n        if (!input.termUpload) console.error('input.termUpload is undefined')\n        input.termUpload.setContent(string)\n        input.termUpload.open()\n      } else {\n        // simple string, just paste it\n        if (screen.bracketedPaste) string = `\\x1b[200~${string}\\x1b[201~`\n        sendString(string)\n      }\n    })\n\n    cfg.all_fn = allFn\n  }\n\n  // mouse button states\n  let mb1 = 0\n  let mb2 = 0\n  let mb3 = 0\n\n  /** Init the Input module */\n  function init (opts) {\n    initKeys(opts)\n\n    // global mouse state tracking - for motion reporting\n    window.addEventListener('mousedown', evt => {\n      if (evt.button === 0) mb1 = 1\n      if (evt.button === 1) mb2 = 1\n      if (evt.button === 2) mb3 = 1\n    })\n\n    window.addEventListener('mouseup', evt => {\n      if (evt.button === 0) mb1 = 0\n      if (evt.button === 1) mb2 = 0\n      if (evt.button === 2) mb3 = 0\n    })\n  }\n\n  // record modifier keys\n  // bits: Meta, Alt, Shift, Ctrl\n  let modifiers = 0b0000\n\n  window.addEventListener('keydown', e => {\n    if (e.ctrlKey) modifiers |= 1\n    if (e.shiftKey) modifiers |= 2\n    if (e.altKey) modifiers |= 4\n    if (e.metaKey) modifiers |= 8\n  })\n  window.addEventListener('keyup', e => {\n    modifiers = 0\n    if (e.ctrlKey) modifiers |= 1\n    if (e.shiftKey) modifiers |= 2\n    if (e.altKey) modifiers |= 4\n    if (e.metaKey) modifiers |= 8\n  })\n\n  /** Prepare modifiers byte for mouse message */\n  function packModifiersForMouse () {\n    return modifiers\n  }\n\n  input = {\n    /** Init the Input module */\n    init,\n\n    /** Send a literal string message */\n    sendString,\n    sendButton,\n\n    /** Enable alternate key modes (cursors, numpad, fn) */\n    setAlts: function (cu, np, fn, crlf) {\n      if (cfg.cu_alt !== cu || cfg.np_alt !== np || cfg.fn_alt !== fn || cfg.crlf_mode !== crlf) {\n        cfg.cu_alt = cu\n        cfg.np_alt = np\n        cfg.fn_alt = fn\n        cfg.crlf_mode = crlf\n      }\n    },\n\n    setMouseMode (click, move) {\n      cfg.mt_click = click\n      cfg.mt_move = move\n    },\n\n    // Mouse events\n    onMouseMove (x, y) {\n      if (!cfg.mt_move) return\n      const b = mb1 ? 1 : mb2 ? 2 : mb3 ? 3 : 0\n      const m = packModifiersForMouse()\n      conn.send('m' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m))\n    },\n\n    onMouseDown (x, y, b) {\n      if (!cfg.mt_click) return\n      if (b > 3 || b < 1) return\n      const m = packModifiersForMouse()\n      conn.send('p' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m))\n    },\n\n    onMouseUp (x, y, b) {\n      if (!cfg.mt_click) return\n      if (b > 3 || b < 1) return\n      const m = packModifiersForMouse()\n      conn.send('r' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m))\n      // console.log(\"B \",b,\" M \",m);\n    },\n\n    onMouseWheel (x, y, dir) {\n      if (!cfg.mt_click) return\n      // -1 ... btn 4 (away from user)\n      // +1 ... btn 5 (towards user)\n      const m = packModifiersForMouse()\n      const b = (dir < 0 ? 4 : 5)\n      conn.send('p' + encode2B(y) + encode2B(x) + encode2B(b) + encode2B(m))\n      // console.log(\"B \",b,\" M \",m);\n    },\n\n    /**\n     * Prevent capturing keys. This is used for text input\n     * modals on the terminal screen\n     */\n    blockKeys (yes) {\n      cfg.no_keys = yes\n    },\n\n    handleKeyDown,\n    softModifiers\n  }\n  return input\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/input.js","const $ = require('../lib/chibi')\nconst { qs } = require('../utils')\nconst modal = require('../modal')\n\n/** File upload utility */\nmodule.exports = function (conn, input, screen) {\n  let lines, // array of lines without newlines\n    line_i, // current line index\n    fuTout, // timeout handle for line sending\n    send_delay_ms, // delay between lines (ms)\n    nl_str, // newline string to use\n    curLine, // current line (when using fuOil)\n    inline_pos // Offset in line (for long lines)\n\n  // lines longer than this are split to chunks\n  // sending a super-ling string through the socket is not a good idea\n  const MAX_LINE_LEN = 128\n\n  function openUploadDialog () {\n    updateStatus('Ready...')\n    modal.show('#fu_modal', onDialogClose)\n    $('#fu_form').toggleClass('busy', false)\n    input.blockKeys(true)\n  }\n\n  function onDialogClose () {\n    console.log('Upload modal closed.')\n    clearTimeout(fuTout)\n    line_i = 0\n    input.blockKeys(false)\n  }\n\n  function updateStatus (msg) {\n    qs('#fu_prog').textContent = msg\n  }\n\n  function startUpload () {\n    let v = qs('#fu_text').value\n    if (!v.length) {\n      fuClose()\n      return\n    }\n\n    lines = v.split('\\n')\n    line_i = 0\n    inline_pos = 0 // offset in line\n    send_delay_ms = +qs('#fu_delay').value\n\n    // sanitize - 0 causes overflows\n    if (send_delay_ms < 0) {\n      send_delay_ms = 0\n      qs('#fu_delay').value = send_delay_ms\n    }\n\n    nl_str = {\n      'CR': '\\r',\n      'LF': '\\n',\n      'CRLF': '\\r\\n'\n    }[qs('#fu_crlf').value]\n\n    $('#fu_form').toggleClass('busy', true)\n    updateStatus('Starting...')\n    uploadLine()\n  }\n\n  function uploadLine () {\n    if (!$('#fu_modal').hasClass('visible')) {\n      // Modal is closed, cancel\n      return\n    }\n\n    if (!conn.canSend()) {\n      // postpone\n      fuTout = setTimeout(uploadLine, 1)\n      return\n    }\n\n    if (inline_pos === 0) {\n      curLine = ''\n      if (line_i === 0) {\n        if (screen.bracketedPaste) {\n          curLine = '\\x1b[200~'\n        }\n      }\n\n      curLine += lines[line_i++] + nl_str\n\n      if (line_i === lines.length) {\n        if (screen.bracketedPaste) {\n          curLine += '\\x1b[201~'\n        }\n      }\n    }\n\n    let maxChunk = +qs('#fu_chunk').value\n    if (maxChunk === 0 || maxChunk > MAX_LINE_LEN) {\n      maxChunk = MAX_LINE_LEN\n    }\n\n    let chunk\n    if ((curLine.length - inline_pos) <= maxChunk) {\n      chunk = curLine.substr(inline_pos, maxChunk)\n      inline_pos = 0\n    } else {\n      chunk = curLine.substr(inline_pos, maxChunk)\n      inline_pos += maxChunk\n    }\n\n    if (!input.sendString(chunk)) {\n      updateStatus('FAILED!')\n      return\n    }\n\n    let pt = Math.round((line_i / lines.length) * 1000) / 10\n    updateStatus(`${line_i} / ${lines.length} (${pt}%)`)\n\n    if (lines.length > line_i || inline_pos > 0) {\n      fuTout = setTimeout(uploadLine, send_delay_ms)\n    } else {\n      closeWhenReady()\n    }\n  }\n\n  function closeWhenReady () {\n    if (!conn.canSend()) {\n      // stuck in XOFF still, wait to process...\n      updateStatus('Waiting for Tx buffer...')\n      setTimeout(closeWhenReady, 100)\n    } else {\n      updateStatus('Done.')\n      // delay to show it\n      fuClose()\n    }\n  }\n\n  function fuClose () {\n    modal.hide('#fu_modal')\n  }\n\n  return {\n    init: function () {\n      qs('#fu_file').addEventListener('change', function (evt) {\n        let reader = new window.FileReader()\n        let file = evt.target.files[0]\n        let ftype = file.type || 'application/octet-stream'\n        console.log('Selected file type: ' + ftype)\n        if (!ftype.match(/text\\/.*|application\\/(json|csv|.*xml.*|.*script.*|x-php)/)) {\n          // Deny load of blobs like img - can crash browser and will get corrupted anyway\n          if (!window.confirm(`This does not look like a text file: ${ftype}\\nReally load?`)) {\n            qs('#fu_file').value = ''\n            return\n          }\n        }\n        reader.onload = function (e) {\n          const txt = e.target.result.replace(/[\\r\\n]+/, '\\n')\n          qs('#fu_text').value = txt\n        }\n        console.log('Loading file...')\n        reader.readAsText(file)\n      }, false)\n\n      qs('#term-fu-open').addEventListener('click', e => {\n        e.preventDefault()\n        openUploadDialog()\n      })\n\n      qs('#term-fu-start').addEventListener('click', e => {\n        e.preventDefault()\n        startUpload()\n      })\n\n      qs('#term-fu-close').addEventListener('click', e => {\n        e.preventDefault()\n        fuClose()\n      })\n    },\n    open: openUploadDialog,\n    setContent (content) {\n      qs('#fu_text').value = content\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/upload.js","const { qs } = require('../utils')\n\nmodule.exports = function (screen, input) {\n  const keyInput = qs('#softkb-input')\n  if (!keyInput) return // abort, we're not on the terminal page\n\n  const shortcutBar = document.createElement('div')\n  shortcutBar.id = 'keyboard-shortcut-bar'\n  if (navigator.userAgent.match(/iPad|iPhone|iPod/)) {\n    qs('#screen').appendChild(shortcutBar)\n  }\n\n  let keyboardOpen = false\n\n  // moves the input to where the cursor is on the canvas.\n  // this is because most browsers will always scroll to wherever the focused\n  // input is\n  let updateInputPosition = function () {\n    if (!keyboardOpen) return\n\n    let [x, y] = screen.layout.gridToScreen(screen.cursor.x, screen.cursor.y, true)\n    keyInput.style.transform = `translate(${x}px, ${y}px)`\n  }\n\n  keyInput.addEventListener('focus', () => {\n    keyboardOpen = true\n    updateInputPosition()\n    shortcutBar.classList.add('open')\n  })\n\n  keyInput.addEventListener('blur', () => {\n    keyboardOpen = false\n    shortcutBar.classList.remove('open')\n  })\n\n  screen.on('cursor-moved', updateInputPosition)\n\n  qs('#term-kb-open').addEventListener('click', e => {\n    e.preventDefault()\n    keyInput.focus()\n  })\n\n  // Chrome for Android doesn't send proper keydown/keypress events with\n  // real key values instead of 229 “Unidentified,” so here's a workaround\n  // that deals with the input composition events.\n\n  let lastCompositionString = ''\n\n  // sends the difference between the last and the new composition string\n  let sendInputDelta = function (newValue) {\n    if (newValue === null) newValue = '' // this sometimes happens, why?\n    let resend = false\n    if (newValue.length > lastCompositionString.length) {\n      if (newValue.startsWith(lastCompositionString)) {\n        // characters have been added at the end\n        input.sendString(newValue.substr(lastCompositionString.length))\n      } else resend = true\n    } else if (newValue.length < lastCompositionString.length) {\n      if (lastCompositionString.startsWith(newValue)) {\n        // characters have been removed at the end\n        input.sendString('\\b'.repeat(lastCompositionString.length -\n          newValue.length))\n      } else resend = true\n    } else if (newValue !== lastCompositionString) resend = true\n\n    if (resend) {\n      // the entire string changed; resend everything\n      input.sendString('\\b'.repeat(lastCompositionString.length) +\n        newValue)\n    }\n    lastCompositionString = newValue\n  }\n\n  keyInput.addEventListener('keydown', e => {\n    if (e.key === 'Unidentified') return\n\n    keyInput.value = ''\n\n    e.stopPropagation()\n    input.handleKeyDown(e)\n  })\n\n  keyInput.addEventListener('keypress', e => {\n    // prevent key duplication on iOS (because Safari *does* send proper events)\n    e.stopPropagation()\n  })\n\n  keyInput.addEventListener('input', e => {\n    e.stopPropagation()\n\n    if (e.isComposing && 'data' in e) {\n      sendInputDelta(e.data)\n    } else if (e.isComposing) {\n      // Firefox Mobile doesn't support InputEvent#data, so here's a hack\n      // that just takes the input value and uses that\n      sendInputDelta(keyInput.value)\n    } else {\n      if (e.inputType === 'insertCompositionText') input.sendString(e.data)\n      else if (e.inputType === 'deleteContentBackward') {\n        lastCompositionString = ''\n        sendInputDelta('')\n      } else if (e.inputType === 'insertText') {\n        input.sendString(e.data)\n      }\n    }\n  })\n\n  keyInput.addEventListener('compositionstart', e => {\n    lastCompositionString = ''\n  })\n\n  keyInput.addEventListener('compositionend', e => {\n    lastCompositionString = ''\n    keyInput.value = ''\n  })\n\n  screen.on('open-soft-keyboard', () => keyInput.focus())\n\n  // shortcut bar\n  const shortcuts = {\n    Control: 'ctrl',\n    Esc: 0x1b,\n    Tab: 0x09,\n    '←': 0x25,\n    '↓': 0x28,\n    '↑': 0x26,\n    '→': 0x27\n  }\n\n  let touchMoved = false\n\n  for (const shortcut in shortcuts) {\n    const button = document.createElement('button')\n    button.classList.add('shortcut-button')\n    button.textContent = shortcut\n    shortcutBar.appendChild(button)\n\n    const key = shortcuts[shortcut]\n    if (typeof key === 'string') button.classList.add('modifier')\n    button.addEventListener('touchstart', e => {\n      touchMoved = false\n      if (typeof key === 'string') {\n        // modifier button\n        input.softModifiers[key] = true\n        button.classList.add('enabled')\n\n        // prevent default. This prevents scrolling, but also prevents the\n        // selection popup\n        e.preventDefault()\n      }\n    })\n    window.addEventListener('touchmove', e => {\n      touchMoved = true\n    })\n    button.addEventListener('touchend', e => {\n      e.preventDefault()\n      if (typeof key === 'number') {\n        if (touchMoved) return\n        let fakeEvent = { which: key, preventDefault: () => {} }\n        input.handleKeyDown(fakeEvent)\n      } else if (typeof key === 'string') {\n        button.classList.remove('enabled')\n        input.softModifiers[key] = false\n      }\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/soft_keyboard.js","const { getColor } = require('./themes')\nconst {\n  ATTR_FG,\n  ATTR_BG,\n  ATTR_BOLD,\n  ATTR_UNDERLINE,\n  ATTR_BLINK,\n  ATTR_ITALIC,\n  ATTR_STRIKE,\n  ATTR_OVERLINE,\n  ATTR_FAINT,\n  ATTR_FRAKTUR\n} = require('./screen_attr_bits')\n\n// debug toolbar, tooltip and screen\nmodule.exports = function attachDebugger (screen, connection) {\n  // debug screen overlay\n  const debugCanvas = document.createElement('canvas')\n  debugCanvas.classList.add('debug-canvas')\n  const ctx = debugCanvas.getContext('2d')\n\n  // debug toolbar\n  const toolbar = document.createElement('div')\n  toolbar.classList.add('debug-toolbar')\n\n  // debug tooltip\n  const tooltip = document.createElement('div')\n  tooltip.classList.add('debug-tooltip')\n  tooltip.classList.add('hidden')\n\n  // update functions, defined somewhere below\n  let updateTooltip\n  let updateToolbar\n\n  // tooltip cell\n  let selectedCell = null\n\n  // update tooltip cell when mouse moves\n  const onMouseMove = (e) => {\n    if (e.target !== screen.layout.canvas) {\n      selectedCell = null\n      return\n    }\n    selectedCell = screen.layout.screenToGrid(e.offsetX, e.offsetY)\n    updateTooltip()\n  }\n\n  // hide tooltip when mouse leaves\n  const onMouseOut = (e) => {\n    selectedCell = null\n    tooltip.classList.add('hidden')\n  }\n\n  // updates debug canvas size\n  const updateCanvasSize = function () {\n    let { width, height, devicePixelRatio } = screen.layout.window\n    let cellSize = screen.layout.getCellSize()\n    let padding = Math.round(screen.layout._padding)\n    debugCanvas.width = (width * cellSize.width + 2 * padding) * devicePixelRatio\n    debugCanvas.height = (height * cellSize.height + 2 * padding) * devicePixelRatio\n    debugCanvas.style.width = `${width * cellSize.width + 2 * screen.layout._padding}px`\n    debugCanvas.style.height = `${height * cellSize.height + 2 * screen.layout._padding}px`\n  }\n\n  // defined somewhere below\n  let startDrawLoop\n\n  let screenAttached = false\n\n  // node to which events were bound (kept here for when they need to be removed)\n  let eventNode\n\n  // attaches/detaches debug screen overlay to/from DOM\n  const setScreenAttached = function (attached) {\n    if (attached && !debugCanvas.parentNode) {\n      screen.layout.canvas.parentNode.appendChild(debugCanvas)\n      eventNode = debugCanvas.parentNode\n      eventNode.addEventListener('mousemove', onMouseMove)\n      eventNode.addEventListener('mouseout', onMouseOut)\n      screen.layout.on('size-update', updateCanvasSize)\n      updateCanvasSize()\n      screenAttached = true\n      startDrawLoop()\n    } else if (!attached && debugCanvas.parentNode) {\n      debugCanvas.parentNode.removeChild(debugCanvas)\n      eventNode.removeEventListener('mousemove', onMouseMove)\n      eventNode.removeEventListener('mouseout', onMouseOut)\n      screen.layout.removeListener('size-update', updateCanvasSize)\n      screenAttached = false\n    }\n  }\n\n  // attaches/detaches toolbar and tooltip to/from DOM\n  const setToolbarAttached = function (attached) {\n    if (attached && !toolbar.parentNode) {\n      screen.layout.canvas.parentNode.appendChild(toolbar)\n      screen.layout.canvas.parentNode.appendChild(tooltip)\n      updateToolbar()\n    } else if (!attached && toolbar.parentNode) {\n      screen.layout.canvas.parentNode.removeChild(toolbar)\n      screen.layout.canvas.parentNode.removeChild(tooltip)\n    }\n  }\n\n  // attach/detach toolbar when debug mode is enabled/disabled\n  screen.on('update-window:debug', enabled => {\n    setToolbarAttached(enabled)\n  })\n\n  // ditto ^\n  screen.layout.on('update-window:debug', enabled => {\n    setScreenAttached(enabled)\n  })\n\n  let drawData = {\n    // last draw reason\n    reason: '',\n\n    // when true, will show colored cell update overlays\n    showUpdates: false,\n\n    // draw start time in milliseconds\n    startTime: 0,\n\n    // end time\n    endTime: 0,\n\n    // partial update frames\n    frames: [],\n\n    // cell data\n    cells: new Map(),\n\n    // scroll region\n    scrollRegion: null\n  }\n\n  // debug interface\n  screen._debug = screen.layout.renderer._debug = {\n    drawStart (reason) {\n      drawData.reason = reason\n      drawData.startTime = window.performance.now()\n    },\n    drawEnd () {\n      drawData.endTime = window.performance.now()\n    },\n    setCell (cell, flags) {\n      drawData.cells.set(cell, [flags, window.performance.now()])\n    },\n    pushFrame (frame) {\n      drawData.frames.push([...frame, window.performance.now()])\n    }\n  }\n\n  let isDrawing = false\n  let drawLoop = function () {\n    // draw while the screen is attached\n    if (screenAttached) window.requestAnimationFrame(drawLoop)\n    else isDrawing = false\n\n    let now = window.performance.now()\n\n    let { width, height, devicePixelRatio } = screen.layout.window\n    let padding = Math.round(screen.layout._padding)\n    let cellSize = screen.layout.getCellSize()\n\n    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0)\n    ctx.clearRect(0, 0, width * cellSize.width + 2 * padding, height * cellSize.height + 2 * padding)\n    ctx.translate(padding, padding)\n\n    ctx.lineWidth = 2\n    ctx.lineJoin = 'round'\n\n    if (drawData.showUpdates) {\n      const cells = drawData.cells\n      for (let cell = 0; cell < width * height; cell++) {\n        // cell does not exist or has no flags set\n        if (!cells.has(cell) || cells.get(cell)[0] === 0) continue\n\n        const [flags, timestamp] = cells.get(cell)\n        let elapsedTime = (now - timestamp) / 1000\n\n        if (elapsedTime > 1) {\n          cells.delete(cell)\n          continue\n        }\n\n        ctx.globalAlpha = 0.5 * Math.max(0, 1 - elapsedTime)\n\n        let x = cell % width\n        let y = Math.floor(cell / width)\n\n        if (flags & 2) {\n          // updated\n          ctx.fillStyle = '#0f0'\n        } else if (flags & 1) {\n          // redrawn\n          ctx.fillStyle = '#f0f'\n        }\n\n        if (!(flags & 4)) {\n          // outside a clipped region\n          ctx.fillStyle = '#0ff'\n        }\n\n        if (flags & 16) {\n          // was filled to speed up rendering\n          ctx.globalAlpha /= 2\n        }\n\n        ctx.fillRect(x * cellSize.width, y * cellSize.height, cellSize.width, cellSize.height)\n\n        if (flags & 8) {\n          // wide cell\n          ctx.strokeStyle = '#f00'\n          ctx.beginPath()\n          ctx.moveTo(x * cellSize.width, (y + 1) * cellSize.height)\n          ctx.lineTo((x + 1) * cellSize.width, (y + 1) * cellSize.height)\n          ctx.stroke()\n        }\n      }\n\n      let framesToDelete = []\n      for (let frame of drawData.frames) {\n        let timestamp = frame[4]\n        let elapsedTime = (now - timestamp) / 1000\n        if (elapsedTime > 1) framesToDelete.push(frame)\n        else {\n          ctx.globalAlpha = 1 - elapsedTime\n          ctx.strokeStyle = '#ff0'\n          ctx.strokeRect(frame[0] * cellSize.width, frame[1] * cellSize.height,\n            frame[2] * cellSize.width, frame[3] * cellSize.height)\n        }\n      }\n      for (let frame of framesToDelete) {\n        drawData.frames.splice(drawData.frames.indexOf(frame), 1)\n      }\n    }\n\n    if (selectedCell !== null) {\n      // draw a dashed outline around the selected cell\n      let [x, y] = selectedCell\n\n      ctx.save()\n      ctx.globalAlpha = 0.5\n      ctx.lineWidth = 1\n\n      // draw X line\n      ctx.beginPath()\n      ctx.moveTo(0, y * cellSize.height)\n      ctx.lineTo(x * cellSize.width, y * cellSize.height)\n      ctx.strokeStyle = '#f00'\n      ctx.setLineDash([cellSize.width])\n      ctx.stroke()\n\n      // draw Y line\n      ctx.beginPath()\n      ctx.moveTo(x * cellSize.width, 0)\n      ctx.lineTo(x * cellSize.width, y * cellSize.height)\n      ctx.strokeStyle = '#0f0'\n      ctx.setLineDash([cellSize.height])\n      ctx.stroke()\n\n      ctx.globalAlpha = 1\n      ctx.lineWidth = 1 + 0.5 * Math.sin((now / 1000) * 10)\n      ctx.strokeStyle = '#fff'\n      ctx.lineJoin = 'round'\n      ctx.setLineDash([2, 2])\n      ctx.lineDashOffset = (now / 1000) * 10\n      ctx.strokeRect(x * cellSize.width, y * cellSize.height, cellSize.width, cellSize.height)\n      ctx.lineDashOffset += 2\n      ctx.strokeStyle = '#000'\n      ctx.strokeRect(x * cellSize.width, y * cellSize.height, cellSize.width, cellSize.height)\n      ctx.restore()\n    }\n\n    if (drawData.scrollRegion !== null) {\n      // draw two lines marking the scroll region bounds\n      let [start, end] = drawData.scrollRegion\n\n      ctx.save()\n      ctx.globalAlpha = 1\n      ctx.strokeStyle = '#00f'\n      ctx.lineWidth = 2\n      ctx.setLineDash([2, 2])\n\n      ctx.beginPath()\n      ctx.moveTo(0, start * cellSize.height)\n      ctx.lineTo(width * cellSize.width, start * cellSize.height)\n      ctx.stroke()\n\n      ctx.beginPath()\n      ctx.moveTo(0, (end + 1) * cellSize.height)\n      ctx.lineTo(width * cellSize.width, (end + 1) * cellSize.height)\n      ctx.stroke()\n\n      ctx.restore()\n    }\n  }\n\n  startDrawLoop = function () {\n    if (isDrawing) return\n    isDrawing = true\n    drawLoop()\n  }\n\n  let pad2 = i => ('00' + i.toString()).substr(-2)\n  let formatColor = color => color < 256\n    ? color.toString()\n    : '#' + pad2(color >> 16) + pad2((color >> 8) & 0xFF) + pad2(color & 0xFF)\n\n  let makeSpan = (text, styles) => {\n    let span = document.createElement('span')\n    span.textContent = text\n    Object.assign(span.style, styles || {})\n    return span\n  }\n  let formatAttributes = (target, attrs) => {\n    if (attrs & ATTR_FG) target.appendChild(makeSpan('HasFG'))\n    if (attrs & ATTR_BG) target.appendChild(makeSpan('HasBG'))\n    if (attrs & ATTR_BOLD) target.appendChild(makeSpan('Bold', { fontWeight: 'bold' }))\n    if (attrs & ATTR_UNDERLINE) target.appendChild(makeSpan('Uline', { textDecoration: 'underline' }))\n    if (attrs & ATTR_BLINK) target.appendChild(makeSpan('Blink'))\n    if (attrs & ATTR_ITALIC) target.appendChild(makeSpan('Italic', { fontStyle: 'italic' }))\n    if (attrs & ATTR_STRIKE) target.appendChild(makeSpan('Strike', { textDecoration: 'line-through' }))\n    if (attrs & ATTR_OVERLINE) target.appendChild(makeSpan('Oline', { textDecoration: 'overline' }))\n    if (attrs & ATTR_FAINT) target.appendChild(makeSpan('Faint', { opacity: 0.5 }))\n    if (attrs & ATTR_FRAKTUR) target.appendChild(makeSpan('Fraktur'))\n  }\n\n  updateTooltip = function () {\n    // TODO: make this not destroy and recreate the same nodes every time\n    tooltip.classList.remove('hidden')\n    tooltip.innerHTML = ''\n    let cell = selectedCell[1] * screen.window.width + selectedCell[0]\n    if (!screen.screen[cell]) return\n\n    let foreground = document.createElement('span')\n    foreground.textContent = formatColor(screen.screenFG[cell])\n    let preview = document.createElement('span')\n    preview.textContent = ' ●'\n    preview.style.color = getColor(screen.screenFG[cell], screen.layout.renderer.palette)\n    foreground.appendChild(preview)\n\n    let background = document.createElement('span')\n    background.textContent = formatColor(screen.screenBG[cell])\n    let bgPreview = document.createElement('span')\n    bgPreview.textContent = ' ●'\n    bgPreview.style.color = getColor(screen.screenBG[cell], screen.layout.renderer.palette)\n    background.appendChild(bgPreview)\n\n    let character = screen.screen[cell]\n    let codePoint = character.codePointAt(0)\n    let formattedCodePoint = codePoint.toString(16).length <= 4\n      ? `0000${codePoint.toString(16)}`.substr(-4)\n      : codePoint.toString(16)\n\n    let attributes = document.createElement('span')\n    attributes.classList.add('attributes')\n    formatAttributes(attributes, screen.screenAttrs[cell])\n\n    let data = {\n      Cell: `col ${selectedCell[0] + 1}, ln ${selectedCell[1] + 1} (${cell})`,\n      Foreground: foreground,\n      Background: background,\n      Character: `U+${formattedCodePoint}`,\n      Attributes: attributes\n    }\n\n    let table = document.createElement('table')\n\n    for (let name in data) {\n      let row = document.createElement('tr')\n      let label = document.createElement('td')\n      label.appendChild(new window.Text(name))\n      label.classList.add('label')\n\n      let value = document.createElement('td')\n      value.appendChild(typeof data[name] === 'string' ? new window.Text(data[name]) : data[name])\n      value.classList.add('value')\n\n      row.appendChild(label)\n      row.appendChild(value)\n      table.appendChild(row)\n    }\n\n    tooltip.appendChild(table)\n\n    let cellSize = screen.layout.getCellSize()\n    // add 3 to the position because for some reason the corner is off\n    let posX = (selectedCell[0] + 1) * cellSize.width + 3\n    let posY = (selectedCell[1] + 1) * cellSize.height + 3\n    tooltip.style.transform = `translate(${posX}px, ${posY}px)`\n  }\n\n  let toolbarData = null\n  let toolbarNodes = {}\n\n  // construct the toolbar if it wasn't already\n  const initToolbar = function () {\n    if (toolbarData) return\n\n    let showUpdates = document.createElement('input')\n    showUpdates.type = 'checkbox'\n    showUpdates.addEventListener('change', e => {\n      drawData.showUpdates = showUpdates.checked\n    })\n\n    let fancyGraphics = document.createElement('input')\n    fancyGraphics.type = 'checkbox'\n    fancyGraphics.value = !!screen.layout.renderer.graphics\n    fancyGraphics.addEventListener('change', e => {\n      screen.layout.renderer.graphics = +fancyGraphics.checked\n    })\n\n    toolbarData = {\n      cursor: {\n        title: 'Cursor',\n        Position: '',\n        Style: '',\n        Visible: true,\n        Hanging: false\n      },\n      internal: {\n        Flags: '',\n        'Cursor Attributes': '',\n        'Code Page': '',\n        Heap: 0,\n        Clients: 0\n      },\n      drawing: {\n        title: 'Drawing',\n        'Last Update': '',\n        'Show Updates': showUpdates,\n        'Fancy Graphics': fancyGraphics,\n        'Redraw Screen': () => {\n          screen.layout.renderer.resetDrawn()\n          screen.layout.renderer.draw('debug-redraw')\n        }\n      }\n    }\n\n    for (let i in toolbarData) {\n      let group = toolbarData[i]\n      let table = document.createElement('table')\n      table.classList.add('toolbar-group')\n\n      toolbarNodes[i] = {}\n\n      for (let key in group) {\n        let item = document.createElement('tr')\n        let name = document.createElement('td')\n        name.classList.add('name')\n        let value = document.createElement('td')\n        value.classList.add('value')\n\n        toolbarNodes[i][key] = { name, value }\n\n        if (key === 'title') {\n          name.textContent = group[key]\n          name.classList.add('title')\n        } else {\n          name.textContent = key\n          if (group[key] instanceof Function) {\n            name.textContent = ''\n            let button = document.createElement('button')\n            name.classList.add('has-button')\n            name.appendChild(button)\n            button.textContent = key\n            button.addEventListener('click', e => group[key](e))\n          } else if (group[key] instanceof window.Node) value.appendChild(group[key])\n          else value.textContent = group[key]\n        }\n\n        item.appendChild(name)\n        item.appendChild(value)\n        table.appendChild(item)\n      }\n\n      toolbar.appendChild(table)\n    }\n\n    let heartbeat = toolbarNodes.heartbeat = document.createElement('div')\n    heartbeat.classList.add('heartbeat')\n    heartbeat.textContent = '❤'\n    toolbar.appendChild(heartbeat)\n  }\n\n  connection.on('heartbeat', () => {\n    if (screenAttached && toolbarNodes.heartbeat) {\n      toolbarNodes.heartbeat.classList.remove('beat')\n      window.requestAnimationFrame(() => {\n        toolbarNodes.heartbeat.classList.add('beat')\n      })\n    }\n  })\n\n  updateToolbar = function () {\n    initToolbar()\n\n    Object.assign(toolbarData.cursor, {\n      Position: `col ${screen.cursor.x + 1}, ln ${screen.cursor.y + 1}`,\n      Style: screen.cursor.style + (screen.cursor.blinking ? ', blink' : ''),\n      Visible: screen.cursor.visible,\n      Hanging: screen.cursor.hanging\n    })\n\n    let drawTime = Math.round((drawData.endTime - drawData.startTime) * 100) / 100\n    toolbarData.drawing['Last Update'] = `${drawData.reason} (${drawTime}ms)`\n    toolbarData.drawing['Fancy Graphics'].checked = !!screen.layout.renderer.graphics\n\n    for (let i in toolbarData) {\n      let group = toolbarData[i]\n      let nodes = toolbarNodes[i]\n      for (let key in group) {\n        if (key === 'title') continue\n        let value = nodes[key].value\n        if (!(group[key] instanceof window.Node) && !(group[key] instanceof Function)) {\n          value.textContent = group[key]\n        }\n      }\n    }\n  }\n\n  screen.on('update', updateToolbar)\n  screen.on('internal', data => {\n    if (screenAttached && toolbarData) {\n      Object.assign(toolbarData.internal, {\n        Flags: data.flags.toString(2),\n        'Cursor Attributes': data.cursorAttrs.toString(2),\n        'Code Page': `${data.charsetGx} (${data.charsetG0}, ${data.charsetG1})`,\n        Heap: data.freeHeap,\n        Clients: data.clientCount\n      })\n      drawData.scrollRegion = [data.regionStart, data.regionEnd]\n      updateToolbar()\n    }\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/debug.js","const { getColor } = require('./themes')\nconst { qs } = require('../utils')\nconst { rgb2hsl, hex2rgb, rgb2hex, hsl2rgb } = require('../lib/color_utils')\n\nmodule.exports = function initButtons (input) {\n  let container = qs('#action-buttons')\n\n  // current color palette\n  let palette = []\n\n  // button labels\n  let labels = []\n\n  // button colors\n  let colors = {}\n\n  // button elements\n  let buttons = []\n\n  // add a button element\n  let pushButton = function pushButton () {\n    let button = document.createElement('button')\n    button.classList.add('action-button')\n    button.setAttribute('data-n', buttons.length)\n    buttons.push(button)\n    container.appendChild(button)\n\n    button.addEventListener('click', e => {\n      // might as well use the attribute ¯\\_(ツ)_/¯\n      let index = +button.getAttribute('data-n')\n      input.sendButton(index)\n\n      e.target.blur() // if it keeps focus, spacebar will push it\n    })\n\n    // this prevents button retaining focus after half-click/drag-away\n    button.addEventListener('mouseleave', e => {\n      e.target.blur()\n    })\n\n    return button\n  }\n\n  // remove a button element\n  let popButton = function popButton () {\n    let button = buttons.pop()\n    button.parentNode.removeChild(button)\n  }\n\n  // sync with DOM\n  let update = function updateButtons () {\n    if (labels.length > buttons.length) {\n      for (let i = buttons.length; i < labels.length; i++) {\n        pushButton()\n      }\n    } else if (buttons.length > labels.length) {\n      for (let i = buttons.length; i > labels.length; i--) {\n        popButton()\n      }\n    }\n\n    for (let i = 0; i < labels.length; i++) {\n      let label = labels[i].trim()\n      let button = buttons[i]\n      let color = colors[i]\n\n      button.textContent = label || '\\u00a0' // label or nbsp\n\n      if (!label) button.classList.add('inactive')\n      else button.classList.remove('inactive')\n\n      // 0 or undefined can be used to disable custom color\n      if (Number.isFinite(color) && color !== 0) {\n        const clr = getColor(color, palette)\n        button.style.background = clr\n\n        // darken the color a bit for the 3D side\n        const hsl = rgb2hsl(...hex2rgb(clr))\n        const hex = rgb2hex(...hsl2rgb(hsl[0], hsl[1], hsl[2] * 0.7))\n        button.style.boxShadow = `0 3px 0 ${hex}`\n      } else {\n        button.style.background = null\n        button.style.boxShadow = null\n      }\n    }\n  }\n\n  return {\n    update,\n    get labels () {\n      return labels\n    },\n    set labels (value) {\n      labels = value\n      update()\n    },\n    get colors () {\n      return colors\n    },\n    set colors (value) {\n      colors = value\n      update()\n    },\n    get palette () {\n      return palette\n    },\n    set palette (value) {\n      palette = value\n      update()\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term/buttons.js","const ColorTriangle = require('./lib/colortriangle')\nconst $ = require('./lib/chibi')\nconst themes = require('./term/themes')\nconst { qs } = require('./utils')\n\nfunction selectedTheme () {\n  return +$('#theme').val()\n}\n\nexports.init = function () {\n  $('#theme').on('change', showColor)\n  $('#default_fg,#default_bg').on('input', showColor)\n\n  let opts = {\n    padding: 10,\n    event: 'drag',\n    uppercase: true,\n    trianglePointerSize: 20,\n    // wheelPointerSize: 12,\n    size: 200,\n    parseColor: (color) => {\n      return themes.toHex(color, selectedTheme())\n    }\n  }\n\n  ColorTriangle.initInput(qs('#default_fg'), opts)\n  ColorTriangle.initInput(qs('#default_bg'), opts)\n  for (let i = 1; i <= 5; i++) {\n    ColorTriangle.initInput(qs(`#bc${i}`), opts)\n  }\n\n  $('.colorprev.bg span').on('click', function () {\n    const bg = this.dataset.bg\n    if (typeof bg != 'undefined') $('#default_bg').val(bg)\n    showColor()\n  })\n\n  $('.colorprev.fg span').on('click', function () {\n    const fg = this.dataset.fg\n    if (typeof fg != 'undefined') $('#default_fg').val(fg)\n    showColor()\n  })\n\n  let $presets = $('#fgbg_presets')\n  for (let i = 0; i < themes.fgbgThemes.length; i++) {\n    const thm = themes.fgbgThemes[i]\n    const fg = thm[0]\n    const bg = thm[1]\n    const lbl = thm[2]\n    const tit = thm[3]\n    $presets.htmlAppend(\n        '<span class=\"preset\" ' +\n        'data-xfg=\"' + fg + '\" data-xbg=\"' + bg + '\" ' +\n        'style=\"color:' + fg + ';background:' + bg + '\" title=\"' + tit + '\">&nbsp;' + lbl + '&nbsp;</span>')\n\n    if ((i + 1) % 5 === 0) $presets.htmlAppend('<br>')\n  }\n\n  $('.preset').on('click', function () {\n    $('#default_fg').val(this.dataset.xfg)\n    $('#default_bg').val(this.dataset.xbg)\n    showColor()\n  })\n\n  showColor()\n}\n\nfunction showColor () {\n  let ex = qs('.color-example')\n  let fg = $('#default_fg').val()\n  let bg = $('#default_bg').val()\n\n  if (/^\\d+$/.test(fg)) {\n    fg = +fg\n  } else if (!/^#[\\da-f]{6}$/i.test(fg)) {\n    fg = 'black'\n  }\n\n  if (/^\\d+$/.test(bg)) {\n    bg = +bg\n  } else if (!/^#[\\da-f]{6}$/i.test(bg)) {\n    bg = 'black'\n  }\n\n  const themeN = selectedTheme()\n  ex.dataset.fg = fg\n  ex.dataset.bg = bg\n\n  themes.themePreview(themeN)\n\n  $('.colorprev.fg span').css('background', themes.toHex(bg, themeN))\n}\n\nexports.nextTheme = () => {\n  let sel = qs('#theme')\n  let i = sel.selectedIndex\n  sel.options[++i % sel.options.length].selected = true\n  showColor()\n}\n\nexports.prevTheme = () => {\n  let sel = qs('#theme')\n  let i = sel.selectedIndex\n  sel.options[(sel.options.length + (--i)) % sel.options.length].selected = true\n  showColor()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term_conf.js","/*\n * Copyright (c) 2010 Tim Baumann\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n// NOTE: Converted to ES6 by MightyPork (2017)\n// Modified for ESPTerm\n\nconst EventEmitter = require('events')\nconst {\n  rgb2hex,\n  hex2rgb,\n  hsl2rgb,\n  rgb2hsl\n} = require('./color_utils')\n\nconst win = window\nconst doc = document\nconst M = Math\nconst TAU = 2 * M.PI\n\nfunction times (i, fn) {\n  for (let j = 0; j < i; j++) {\n    fn(j)\n  }\n}\n\nfunction each (obj, fn) {\n  if (obj.length) {\n    times(obj.length, function (i) {\n      fn(obj[i], i)\n    })\n  } else {\n    for (let key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        fn(obj[key], key)\n      }\n    }\n  }\n}\n\nmodule.exports = class ColorTriangle extends EventEmitter {\n  /****************\n   * ColorTriangle *\n   ****************/\n\n  // Constructor function:\n  constructor (color, options) {\n    super()\n\n    this.options = {\n      size: 150,\n      padding: 8,\n      triangleSize: 0.8,\n      wheelPointerColor1: '#444',\n      wheelPointerColor2: '#eee',\n      trianglePointerSize: 16,\n      // wheelPointerSize: 16,\n      trianglePointerColor1: '#eee',\n      trianglePointerColor2: '#444',\n      background: 'transparent'\n    }\n\n    this.pixelRatio = window.devicePixelRatio\n\n    this.setOptions(options)\n    this.calculateProperties()\n\n    this.createContainer()\n    this.createTriangle()\n    this.createWheel()\n    this.createWheelPointer()\n    this.createTrianglePointer()\n    this.attachEvents()\n\n    color = color || '#f00'\n    if (typeof color == 'string') {\n      this.setHEX(color)\n    }\n  }\n\n  calculateProperties () {\n    let opts = this.options\n\n    this.padding = opts.padding\n    this.innerSize = opts.size - opts.padding * 2\n    this.triangleSize = opts.triangleSize * this.innerSize\n    this.wheelThickness = (this.innerSize - this.triangleSize) / 2\n    this.wheelPointerSize = opts.wheelPointerSize || this.wheelThickness\n\n    this.wheelRadius = (this.innerSize) / 2\n    this.triangleRadius = (this.triangleSize) / 2\n    this.triangleSideLength = M.sqrt(3) * this.triangleRadius\n  }\n\n  calculatePositions () {\n    const r = this.triangleRadius\n    const hue = this.hue\n    const third = TAU / 3\n    const s = this.saturation\n    const l = this.lightness\n\n    // Colored point\n    const hx = this.hx = M.cos(hue) * r\n    const hy = this.hy = -M.sin(hue) * r\n    // Black point\n    const sx = this.sx = M.cos(hue - third) * r\n    const sy = this.sy = -M.sin(hue - third) * r\n    // White point\n    const vx = this.vx = M.cos(hue + third) * r\n    const vy = this.vy = -M.sin(hue + third) * r\n    // Current point\n    const mx = (sx + vx) / 2\n    const my = (sy + vy) / 2\n    const a = (1 - 2 * M.abs(l - 0.5)) * s\n    this.x = sx + (vx - sx) * l + (hx - mx) * a\n    this.y = sy + (vy - sy) * l + (hy - my) * a\n  }\n\n  createContainer () {\n    let c = this.container = doc.createElement('div')\n    c.className = 'color-triangle'\n\n    c.style.display = 'block'\n    c.style.padding = `${this.padding}px`\n    c.style.position = 'relative'\n    c.style.boxShadow = '0 1px 10px black'\n    c.style.borderRadius = '5px'\n    c.style.width = c.style.height = `${this.innerSize + 2 * this.padding}px`\n    c.style.background = this.options.background\n  }\n\n  createWheel () {\n    let c = this.wheel = doc.createElement('canvas')\n    c.width = c.height = this.innerSize * this.pixelRatio\n    c.style.width = c.style.height = `${this.innerSize}px`\n    c.style.position = 'absolute'\n    c.style.margin = c.style.padding = '0'\n    c.style.left = c.style.top = `${this.padding}px`\n\n    this.drawWheel(c.getContext('2d'))\n    this.container.appendChild(c)\n  }\n\n  drawWheel (ctx) {\n    let s, i\n\n    ctx.save()\n    ctx.setTransform(this.pixelRatio, 0, 0, this.pixelRatio, 0, 0)\n    ctx.translate(this.wheelRadius, this.wheelRadius)\n    s = this.wheelRadius - this.triangleRadius\n    // Draw a circle for every color\n    for (i = 0; i < 360; i++) {\n      ctx.rotate(TAU / -360) // rotate one degree\n      ctx.beginPath()\n      ctx.fillStyle = 'hsl(' + i + ', 100%, 50%)'\n      ctx.arc(this.wheelRadius - (s / 2), 0, s / 2, 0, TAU, true)\n      ctx.fill()\n    }\n    ctx.restore()\n  }\n\n  createTriangle () {\n    let c = this.triangle = doc.createElement('canvas')\n\n    c.width = c.height = this.innerSize * this.pixelRatio\n    c.style.width = c.style.height = `${this.innerSize}px`\n    c.style.position = 'absolute'\n    c.style.margin = c.style.padding = '0'\n    c.style.left = c.style.top = this.padding + 'px'\n\n    this.triangleCtx = c.getContext('2d')\n\n    this.container.appendChild(c)\n  }\n\n  drawTriangle () {\n    const hx = this.hx\n    const hy = this.hy\n    const sx = this.sx\n    const sy = this.sy\n    const vx = this.vx\n    const vy = this.vy\n    const size = this.innerSize\n\n    let ctx = this.triangleCtx\n\n    // clear\n    ctx.clearRect(0, 0, size * this.pixelRatio, size * this.pixelRatio)\n\n    ctx.save()\n    ctx.setTransform(this.pixelRatio, 0, 0, this.pixelRatio, 0, 0)\n    ctx.translate(this.wheelRadius, this.wheelRadius)\n\n    // make a triangle\n    ctx.beginPath()\n    ctx.moveTo(hx, hy)\n    ctx.lineTo(sx, sy)\n    ctx.lineTo(vx, vy)\n    ctx.closePath()\n    ctx.clip()\n\n    ctx.fillStyle = '#000'\n    ctx.fillRect(-this.wheelRadius, -this.wheelRadius, size, size)\n    // => black triangle\n\n    // create gradient from hsl(hue, 1, 1) to transparent\n    let grad0 = ctx.createLinearGradient(hx, hy, (sx + vx) / 2, (sy + vy) / 2)\n    const hsla = 'hsla(' + M.round(this.hue * (360 / TAU)) + ', 100%, 50%, '\n    grad0.addColorStop(0, hsla + '1)')\n    grad0.addColorStop(1, hsla + '0)')\n    ctx.fillStyle = grad0\n    ctx.fillRect(-this.wheelRadius, -this.wheelRadius, size, size)\n    // => gradient: one side of the triangle is black, the opponent angle is $color\n\n    // create color gradient from white to transparent\n    let grad1 = ctx.createLinearGradient(vx, vy, (hx + sx) / 2, (hy + sy) / 2)\n    grad1.addColorStop(0, '#fff')\n    grad1.addColorStop(1, 'rgba(255, 255, 255, 0)')\n    ctx.globalCompositeOperation = 'lighter'\n    ctx.fillStyle = grad1\n    ctx.fillRect(-this.wheelRadius, -this.wheelRadius, size, size)\n    // => white angle\n\n    ctx.restore()\n  }\n\n  // The two pointers\n  createWheelPointer () {\n    let c = this.wheelPointer = doc.createElement('canvas')\n    const size = this.wheelPointerSize\n    c.width = c.height = size * this.pixelRatio\n    c.style.width = c.style.height = `${size}px`\n    c.style.position = 'absolute'\n    c.style.margin = c.style.padding = '0'\n    this.drawPointer(c.getContext('2d'), size / 2, this.options.wheelPointerColor1, this.options.wheelPointerColor2)\n    this.container.appendChild(c)\n  }\n\n  moveWheelPointer () {\n    const r = this.wheelPointerSize / 2\n    const s = this.wheelPointer.style\n    s.top = this.padding + this.wheelRadius - M.sin(this.hue) * (this.triangleRadius + this.wheelThickness / 2) - r + 'px'\n    s.left = this.padding + this.wheelRadius + M.cos(this.hue) * (this.triangleRadius + this.wheelThickness / 2) - r + 'px'\n  }\n\n  createTrianglePointer () { // create pointer in the triangle\n    let c = this.trianglePointer = doc.createElement('canvas')\n    const size = this.options.trianglePointerSize\n\n    c.width = c.height = size * this.pixelRatio\n    c.style.width = c.style.height = `${size}px`\n    c.style.position = 'absolute'\n    c.style.margin = c.style.padding = '0'\n    this.drawPointer(c.getContext('2d'), size / 2, this.options.trianglePointerColor1, this.options.trianglePointerColor2)\n    this.container.appendChild(c)\n  }\n\n  moveTrianglePointer (x, y) {\n    const s = this.trianglePointer.style\n    const r = this.options.trianglePointerSize / 2\n    s.top = (this.y + this.wheelRadius + this.padding - r) + 'px'\n    s.left = (this.x + this.wheelRadius + this.padding - r) + 'px'\n  }\n\n  drawPointer (ctx, r, color1, color2) {\n    ctx.setTransform(this.pixelRatio, 0, 0, this.pixelRatio, 0, 0)\n    ctx.fillStyle = color2\n    ctx.beginPath()\n    ctx.arc(r, r, r, 0, TAU, true)\n    ctx.fill() // => black circle\n    ctx.fillStyle = color1\n    ctx.beginPath()\n    ctx.arc(r, r, r - 2, 0, TAU, true)\n    ctx.fill() // => white circle with 1px black border\n    ctx.fillStyle = color2\n    ctx.beginPath()\n    ctx.arc(r, r, r / 4 + 2, 0, TAU, true)\n    ctx.fill() // => black circle with big white border and a small black border\n    ctx.globalCompositeOperation = 'destination-out'\n    ctx.beginPath()\n    ctx.arc(r, r, r / 4, 0, TAU, true)\n    ctx.fill() // => transparent center\n  }\n\n  // The Element and the DOM\n  inject (parent) {\n    parent.appendChild(this.container)\n  }\n\n  getRelativeCoordinates (evt) {\n    let elem = this.triangle\n    let rect = elem.getBoundingClientRect()\n\n    return {\n      x: evt.clientX - rect.x,\n      y: evt.clientY - rect.y\n    }\n  }\n\n  dispose () {\n    let parent = this.container.parentNode\n    if (parent) {\n      parent.removeChild(this.container)\n    }\n  }\n\n  getElement () {\n    return this.container\n  }\n\n  // Color accessors\n  getCSS () {\n    const h = Math.round(this.hue * (360 / TAU))\n    const s = Math.round(this.saturation * 100)\n    const l = Math.round(this.lightness * 100)\n\n    return `hsl(${h}, ${s}%, ${l}%)`\n  }\n\n  getHEX () {\n    return rgb2hex(...this.getRGB())\n  }\n\n  setHEX (hex) {\n    this.setRGB(...hex2rgb(hex))\n  }\n\n  getRGB () {\n    return hsl2rgb(...this.getHSL())\n  }\n\n  setRGB (r, g, b) {\n    this.setHSL(...rgb2hsl(r, g, b))\n  }\n\n  getHSL () {\n    return [this.hue, this.saturation, this.lightness]\n  }\n\n  setHSL (h, s, l) {\n    this.hue = h\n    this.saturation = s\n    this.lightness = l\n\n    this.initColor()\n  }\n\n  initColor () {\n    this.calculatePositions()\n    this.moveWheelPointer()\n    this.drawTriangle()\n    this.moveTrianglePointer()\n  }\n\n  // Mouse event handling\n  attachEvents () {\n    this.down = null\n\n    let mousedown = (evt) => {\n      evt.stopPropagation()\n      evt.preventDefault()\n\n      doc.body.addEventListener('mousemove', mousemove, false)\n      doc.body.addEventListener('mouseup', mouseup, false)\n\n      let xy = this.getRelativeCoordinates(evt)\n      this.map(xy.x, xy.y)\n    }\n\n    let mousemove = (evt) => {\n      let xy = this.getRelativeCoordinates(evt)\n      this.move(xy.x, xy.y)\n    }\n\n    let mouseup = (evt) => {\n      if (this.down) {\n        this.down = null\n        this.emit('dragend')\n      }\n      doc.body.removeEventListener('mousemove', mousemove, false)\n      doc.body.removeEventListener('mouseup', mouseup, false)\n    }\n\n    this.container.addEventListener('mousedown', mousedown, false)\n    this.container.addEventListener('mousemove', mousemove, false)\n  }\n\n  map (x, y) {\n    let x0 = x\n    let y0 = y\n    x -= this.wheelRadius\n    y -= this.wheelRadius\n\n    const r = M.sqrt(x * x + y * y) // Pythagoras\n    if (r > this.triangleRadius && r < this.wheelRadius) {\n      // Wheel\n      this.down = 'wheel'\n      this.emit('dragstart')\n      this.move(x0, y0)\n    } else if (r < this.triangleRadius) {\n      // Inner circle\n      this.down = 'triangle'\n      this.emit('dragstart')\n      this.move(x0, y0)\n    }\n  }\n\n  move (x, y) {\n    if (!this.down) {\n      return\n    }\n\n    x -= this.wheelRadius\n    y -= this.wheelRadius\n\n    let rad = M.atan2(-y, x)\n    if (rad < 0) {\n      rad += TAU\n    }\n\n    if (this.down === 'wheel') {\n      this.hue = rad\n      this.initColor()\n      this.emit('drag')\n    } else if (this.down === 'triangle') {\n      // get radius and max radius\n      let rad0 = (rad + TAU - this.hue) % TAU\n      let rad1 = rad0 % (TAU / 3) - (TAU / 6)\n      let a = 0.5 * this.triangleRadius\n      let b = M.tan(rad1) * a\n      let r = M.sqrt(x * x + y * y) // Pythagoras\n      let maxR = M.sqrt(a * a + b * b) // Pythagoras\n\n      if (r > maxR) {\n        const dx = M.tan(rad1) * r\n        let rad2 = M.atan(dx / maxR)\n        if (rad2 > TAU / 6) {\n          rad2 = TAU / 6\n        } else if (rad2 < -TAU / 6) {\n          rad2 = -TAU / 6\n        }\n        rad += rad2 - rad1\n\n        rad0 = (rad + TAU - this.hue) % TAU\n        rad1 = rad0 % (TAU / 3) - (TAU / 6)\n        b = M.tan(rad1) * a\n        r = maxR = M.sqrt(a * a + b * b) // Pythagoras\n      }\n\n      x = M.round(M.cos(rad) * r)\n      y = M.round(-M.sin(rad) * r)\n\n      const l = this.lightness = ((M.sin(rad0) * r) / this.triangleSideLength) + 0.5\n\n      const widthShare = 1 - (M.abs(l - 0.5) * 2)\n      let s = this.saturation = (((M.cos(rad0) * r) + (this.triangleRadius / 2)) / (1.5 * this.triangleRadius)) / widthShare\n      s = M.max(0, s) // cannot be lower than 0\n      s = M.min(1, s) // cannot be greater than 1\n\n      this.lightness = l\n      this.saturation = s\n\n      this.x = x\n      this.y = y\n      this.moveTrianglePointer()\n\n      this.emit('drag')\n    }\n  }\n\n  /***************\n   * Init helpers *\n   ***************/\n\n  static initInput (input, options) {\n    options = options || {}\n\n    let ct\n    let openColorTriangle = function () {\n      let hex = input.value\n      if (options.parseColor) hex = options.parseColor(hex)\n      if (!ct) {\n        options.size = options.size || input.offsetWidth\n        options.background = win.getComputedStyle(input, null).backgroundColor\n        options.margin = options.margin || 10\n        options.event = options.event || 'dragend'\n\n        ct = new ColorTriangle(hex, options)\n        ct.on(options.event, () => {\n          const hex = ct.getHEX()\n          input.value = options.uppercase ? hex.toUpperCase() : hex\n          fireChangeEvent()\n        })\n      } else {\n        ct.setHEX(hex)\n      }\n\n      let top = input.offsetTop\n      if (win.innerHeight - input.getBoundingClientRect().top > input.offsetHeight + options.margin + options.size) {\n        top += input.offsetHeight + options.margin // below\n      } else {\n        top -= options.margin + options.size // above\n      }\n\n      let el = ct.getElement()\n      el.style.position = 'absolute'\n      el.style.left = input.offsetLeft + 'px'\n      el.style.top = top + 'px'\n      el.style.zIndex = '1338' // above everything\n\n      ct.inject(input.parentNode)\n    }\n\n    let closeColorTriangle = () => {\n      if (ct) {\n        ct.dispose()\n      }\n    }\n\n    let fireChangeEvent = () => {\n      let evt = doc.createEvent('HTMLEvents')\n      evt.initEvent('input', true, false) // bubbles = true, cancable = false\n      input.dispatchEvent(evt) // fire event\n    }\n\n    input.addEventListener('focus', openColorTriangle, false)\n    input.addEventListener('blur', closeColorTriangle, false)\n    input.addEventListener('keyup', () => {\n      const val = input.value\n      if (val.match(/^#((?:[0-9A-Fa-f]{3})|(?:[0-9A-Fa-f]{6}))$/)) {\n        openColorTriangle()\n        fireChangeEvent()\n      } else {\n        closeColorTriangle()\n      }\n    }, false)\n  }\n\n  /*******************\n   * Helper functions *\n   *******************/\n\n  setOptions (opts) {\n    opts = opts || {}\n    let dflt = this.options\n    let options = this.options = {}\n\n    each(dflt, function (val, key) {\n      options[key] = (opts.hasOwnProperty(key))\n        ? opts[key]\n        : val\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/lib/colortriangle.js"],"sourceRoot":""}